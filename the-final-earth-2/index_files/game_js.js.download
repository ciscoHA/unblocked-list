!function(t,o){"use strict";function i(){return Fr.__string_rec(this,"")}var B,V={},x=x||{};function e(t,e){var i,n=Object.create(t);for(i in e)n[i]=e[i];return e.toString!==Object.prototype.toString&&(n.toString=e.toString),n}function p(){}(V.Analytics=p).__name__="Analytics",p.init=function(){if(p.enabled){if("localhost"==window.document.location.hostname||"127.0.0.1"==window.document.location.hostname)return console.log("FloatingSpaceCities/Analytics.hx:19:","game is running locally"),void(k.enableCheats=!1);jsFunctions.loadJS("https://www.googletagmanager.com/gtag/js?id=UA-48260579-2",function(){p.ready=!1,jsFunctions.initGA(),p.sendEvent("game","playVersion",null,"VERSION1.1",!0),p.sendEvent("game","playOnSite",null,window.location.hostname,!0);for(var t=0,e=p.capturedErrors;t<e.length;){var i=e[t];++t,jsFunctions.gaSendError(i)}p.capturedErrors=[]}),p.useAltEarlyGame=!0,p.didABTest=!1,p.useAltEarlyGame&&(k.earlyGameFix1=!0,k.earlyGameFix2=!0)}},p.sendErrorEvent=function(t){3<p.errorsReported||(p.errorsReported++,p.ready?jsFunctions.gaSendError(t):p.capturedErrors.push(t))},p.sendEvent=function(t,e,i,n,s){null==s&&(s=!1),null==n&&(n=""),p.ready&&jsFunctions.gaSendEvent(t,e,n,i,s)},p.update=function(t){1800<(p.sessionTime+=t/60)&&!p.reportedLongPlaytime&&(On.getItem("lptReported",function(t,e){null==t&&"reported"!=e&&On.setItem("lptReported","reported",function(){p.sendEvent("playtime",p.didABTest?p.useAltEarlyGame?"altEarlyGame":"standardEarlyGame":"noABTest")})}),p.reportedLongPlaytime=!0)};var C=function(t){this.isPaused=!1,this.playSecondMusicOnceLoaded=!1,this.music1EverFinished=!1,this.music4=null,this.music3=null,this.music2=null;var e=this;(C.instance=this).game=t,this.music1=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_BackgroundMusic_1.{ogg,mp3}",preload:!0,singleInstance:!0,loaded:function(){R.musicOn&&(e.music1.volume=e.musicVolume(),e.music1.play(fa(e,e.firstMusicCompleteCallback)),e.isPaused&&e.music1.pause())}}),this.music2=null,R.musicOn&&this.loadSecondMusic(),this.buildSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_BuildingBuild.{ogg,mp3}",preload:!0}),this.buildingClickSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_BuildingClick.{ogg,mp3}",preload:!0}),this.buildingUpgradeSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_BuildingUpgrade.{ogg,mp3}",preload:!0}),this.buttonSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_Button.{ogg,mp3}",preload:!0}),this.buttonFailSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_ButtonFail.{ogg,mp3}",preload:!0}),this.followCitizenSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_Follow.{ogg,mp3}",preload:!0}),this.decorateSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_Decorate.{ogg,mp3}",preload:!0}),this.changeVitalBuildingSound=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_ChangeVitalBuilding.{ogg,mp3}",preload:!0}),this.music=this.music1};function T(t,e,i,n,s){switch(this.buildablePositionsDisplayCacheValid=!1,this.lastBuilt=-1,this.fixedSprite=null,this.fixedToPos=null,this.fixedToWorld=null,this.wasMouseHandled=!0,this.isUniqueBuilding=!1,this.city=t,this.builderType=i,this.decorationAppearance=n,this.mirrored=s,i._hx_index){case 0:var r=i.buildingInfo,o=i.buildingType;this.sprite=H.makeSprite(D.field(o,"spriteName"),new xn(22*n,0,20,20)),this.originalCost=M.fromBuildingInfo(r),this.isUniqueBuilding=-1!=r.specialInfo.indexOf("unique");break;case 1:r=i.decorationInfo;this.sprite=H.makeSprite(r.textureName+"@0,0,20,20"),this.originalCost=M.fromDecorationInfo(r);break;case 2:var a=i.resourceInfo;this.sprite=H.makeSprite(""+a.textureName),this.originalCost=M.fromWorldResourceInfo(a);break;case 3:a=i.worldResource;this.sprite=new PIXI.Sprite(a.sprite.texture)}s&&(this.sprite.scale.set(-1,1),this.sprite.anchor.set(1,0)),this.stage=e,this.builderSecondaryHelpSprite=H.makeSprite("spr_insertbuildinghere"),e.addChild(this.sprite),e.addChild(this.builderSecondaryHelpSprite),this.sprite.alpha=0,this.builderSecondaryHelpSprite.alpha=0,this.touchAlpha=0,this.showContinuousTooltip()}(V.Audio=C).__name__="Audio",C.get=function(){return C.instance},C.prototype={loadSecondMusic:function(){var t=this;this.music2=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_BackgroundMusic_2.{ogg,mp3}",preload:!0,singleInstance:!1,loaded:function(){R.musicOn&&t.music==t.music1&&!t.music.isPlaying&&!t.music.paused&&t.playSecondMusicOnceLoaded&&(t.music=t.music2,t.music.volume=t.musicVolume(),t.music2.play(fa(t,t.startNextMusic)),t.isPaused&&t.music2.pause(),t.playSecondMusicOnceLoaded=!1)}})},loadThirdMusic:function(){this.music3=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_BackgroundMusic_3.{ogg,mp3}",preload:!0,singleInstance:!1})},loadFourthMusic:function(){this.music4=PIXI.sound.Sound.from({url:"https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/audio/BTFE_BackgroundMusic_4.{ogg,mp3}",preload:!0,singleInstance:!1})},startNextMusic:function(){var t;null!=this.music2&&this.music2.isLoaded||null!=this.music3&&this.music3.isLoaded||null!=this.music4&&this.music4.isLoaded?(t=[],null!=this.music2&&this.music2.isLoaded&&t.push(this.music2),null!=this.music3&&this.music3.isLoaded?t.push(this.music3):null==this.music3&&this.loadThirdMusic(),null!=this.music4&&this.music4.isLoaded?t.push(this.music4):null!=this.music3&&this.music3.isLoaded&&null==this.music4&&this.loadFourthMusic(),1<t.length&&null!=this.music&&Y.remove(t,this.music),t=bo.fromArray(t),this.music=t,this.music.volume=this.musicVolume(),this.music.play(fa(this,this.startNextMusic)),this.isPaused&&this.music.pause()):this.playSecondMusicOnceLoaded=!0},firstMusicCompleteCallback:function(t){R.musicOn&&(this.music1EverFinished=!0,this.startNextMusic())},changeMusicEnabledness:function(t){R.musicOn=t,R.save(),R.musicOn?(this.music.isPlaying||(this.music1EverFinished?this.startNextMusic():this.music1.isLoaded&&(this.music1.volume=this.musicVolume(),this.music1.play(fa(this,this.firstMusicCompleteCallback)))),null==this.music2&&this.loadSecondMusic()):this.music.isPlaying&&this.music.stop()},changeSoundEnabledness:function(t){R.soundOn=t,R.save()},pauseMusic:function(){null!=this.music&&this.music.isPlaying&&!this.music.paused&&this.music.pause(),this.isPaused=!0},resumeMusic:function(){null!=this.music&&this.music.paused&&R.musicOn&&this.music.resume(),this.isPaused=!1},playSound:function(t){R.soundOn&&t.isLoaded&&(t.volume=this.soundVolume(),t.play({}))},musicVolume:function(){return R.musicVolume*R.musicVolume},soundVolume:function(){return R.soundVolume*R.soundVolume},setVolumeLevels:function(){null!=this.music&&(this.music.volume=this.musicVolume())},__class__:C};var l=x.BuilderType={__ename__:"BuilderType",__constructs__:["Building","Decoration","WorldResource","MoveWorldResource"],Building:((B=function(t,e){return{_hx_index:0,buildingType:t,buildingInfo:e,__enum__:"BuilderType",toString:i}}).__params__=["buildingType","buildingInfo"],B),Decoration:((B=function(t){return{_hx_index:1,decorationInfo:t,__enum__:"BuilderType",toString:i}}).__params__=["decorationInfo"],B),WorldResource:((B=function(t){return{_hx_index:2,resourceInfo:t,__enum__:"BuilderType",toString:i}}).__params__=["resourceInfo"],B),MoveWorldResource:((B=function(t){return{_hx_index:3,worldResource:t,__enum__:"BuilderType",toString:i}}).__params__=["worldResource"],B)},L=x.BuildPossibility={__ename__:"BuildPossibility",__constructs__:["BuildingInWorld","BuildingPositionImpossible","WorldNotAllowed","BuildingOK"],BuildingInWorld:{_hx_index:0,__enum__:"BuildPossibility",toString:i},BuildingPositionImpossible:{_hx_index:1,__enum__:"BuildPossibility",toString:i},WorldNotAllowed:{_hx_index:2,__enum__:"BuildPossibility",toString:i},BuildingOK:{_hx_index:3,__enum__:"BuildPossibility",toString:i}};(V.Builder=T).__name__="Builder",T.canRemoveFromLRPerspective=function(t,e,i){return t?(null==e.leftBuilding||null!=Rr.find(i,e.leftBuilding,function(t){return 0==t.worldPosition.y},function(t){return t==e}))&&(null==e.rightBuilding||null!=Rr.find(i,e.rightBuilding,function(t){return 0==t.worldPosition.y},function(t){return t==e})):(null==e.leftBuilding||0==e.leftBuilding.worldPosition.y||null!=e.leftBuilding.bottomBuilding)&&(null==e.rightBuilding||0==e.rightBuilding.worldPosition.y||null!=e.rightBuilding.bottomBuilding)},T.prototype={get_buildingToBuild:function(){var t=this.builderType;if(0!=t._hx_index)return null;t.buildingInfo;return t.buildingType},fixBuilder:function(t,e){this.fixedToWorld=t,this.fixedToPos=e,null==t||null==e?null!=this.fixedSprite&&this.stage.removeChild(this.fixedSprite):(this.fixedSprite=H.makeSprite("spr_forcedbuildinglocation"),this.stage.addChild(this.fixedSprite),this.fixedSprite.position.set(t.rect.x+20*e-1,t.rect.y-20-31))},invalidateCache:function(){this.buildablePositionsDisplayCacheValid=!1},isCacheValid:function(){return this.buildablePositionsDisplayCacheValid},prevalidateCache:function(){this.buildablePositionsDisplayCacheValid=!0},update:function(t){if(this.lastBuilt+=t,this.city.game.isMobile&&!this.buildablePositionsDisplayCacheValid&&this.city.builderHighlightStage.removeChildren(),this.wasMouseHandled||(this.sprite.alpha=0),0<this.touchAlpha&&(this.touchAlpha=Math.max(this.touchAlpha-t/30,0)),this.wasMouseHandled=!1,this.city.game.mouse.rightPressed&&this.cancel(),this.showContinuousTooltip(),this.city.buildingMode!=E.Destroy&&this.buildingPrerequirementsValid()){t=this.city.game.isMobile&&!this.city.game.mouse.hasSpecificClaim(this);if(t&&!this.buildablePositionsDisplayCacheValid){for(var e=new Mr,i=0,n=this.city.worlds;i<n.length;){var s=n[i];++i;for(var r=1e7,o=null,a=s.rect.x-20,l=0,h=0,u=this.city.worlds;h<u.length;){var d=u[h];++h,d.rect.y<r&&d.rect.y>s.rect.y&&a>=d.rect.x&&a<d.rect.get_x2()&&(l=(a-(o=d).rect.x)/20|0,r=d.rect.y)}null!=o&&(null==(c=e.h[o.__id__])&&(c=[],e.set(o,c)),c.push({world:o,x:l,checkUntil:((o.rect.y-s.rect.y)/20|0)+s.permanents[0].length}));for(var c,p=1e7,g=null,m=s.rect.x+s.rect.width,f=0,y=0,_=this.city.worlds;y<_.length;){var w=_[y];++y,w.rect.y<p&&w.rect.y>s.rect.y&&m>=w.rect.x&&m<w.rect.get_x2()&&(p=(g=w).rect.y,f=(m-g.rect.x)/20|0)}null!=g&&(null==(c=e.h[g.__id__])&&(c=[],e.set(g,c)),c.push({world:g,x:f,checkUntil:((g.rect.y-s.rect.y)/20|0)+s.permanents[s.permanents.length-1].length}))}for(i=0,n=this.city.worlds;i<n.length;){s=n[i];if(++i,null==this.fixedToWorld||s==this.fixedToWorld)switch((h=this.builderType)._hx_index){case 0:for(var b=h.buildingInfo,u=(h.buildingType,0),y=s.permanents.length;u<y;){var v=[u++];if(null==this.fixedToPos||v[0]==this.fixedToPos){var S=s.permanents[v[0]].length+1;1<=v[0]&&(S<(x=s.permanents[v[0]-1].length)&&(S=x));var x=e.h[s.__id__],x=null==x?null:vn.whereMax(x,function(e){return function(t){return e[0]==t.x}}(v),function(t){return t.checkUntil});null==x||S<(x=x.checkUntil)&&(S=x);for(var _=0,P=S;_<P;){var C,I=_++;this.canBuildBuilding(s,v[0],I,b)==L.BuildingOK&&((C=H.makeSprite("spr_buildhereoutline")).position.set(s.rect.x+20*v[0],s.rect.y-20*(1+I)),this.city.builderHighlightStage.addChild(C),this.city.buildingMode==E.Replace&&s.permanents[v[0]].length>I&&null!=s.permanents[v[0]][I]&&(C.tint=16776960))}}}break;case 1:h.decorationInfo;if(!s.canBuildOnSurface())continue;for(var T=0,B=s.permanents.length;T<B;){var k,M=T++;null!=this.fixedToPos&&M!=this.fixedToPos||(0!=(k=s.permanents[M]).length&&null!=k[0]||((k=H.makeSprite("spr_buildhereoutline")).position.set(s.rect.x+20*M,s.rect.y-20),this.city.builderHighlightStage.addChild(k)))}break;case 2:h.resourceInfo;if(!s.canBuildOnSurface())continue;for(var z=0,A=s.permanents.length;z<A;){var W,F=z++;null!=this.fixedToPos&&F!=this.fixedToPos||(0!=(W=s.permanents[F]).length&&null!=W[0]||((W=H.makeSprite("spr_buildhereoutline")).position.set(s.rect.x+20*F,s.rect.y-20),this.city.builderHighlightStage.addChild(W)))}break;case 3:h.worldResource;if(!s.canBuildOnSurface())continue;for(var O=0,D=s.permanents.length;O<D;){var R,U=O++;null!=this.fixedToPos&&U!=this.fixedToPos||(0!=(R=s.permanents[U]).length&&null!=R[0]||((R=H.makeSprite("spr_buildhereoutline")).position.set(s.rect.x+20*U,s.rect.y-20),this.city.builderHighlightStage.addChild(R)))}}}this.buildablePositionsDisplayCacheValid=!0}else t||(this.city.builderHighlightStage.removeChildren(),this.buildablePositionsDisplayCacheValid=!1)}else this.buildablePositionsDisplayCacheValid&&(this.city.builderHighlightStage.removeChildren(),this.buildablePositionsDisplayCacheValid=!1)},showContinuousTooltip:function(){if(this.city.game.isMobile){var t=this.builderType;switch(t._hx_index){case 0:var e=t.buildingInfo,i=t.buildingType;this.city.gui.buildingButtons.showBuildingTooltip(e,i,this,!0);break;case 1:var n=t.decorationInfo;this.city.gui.buildingButtons.showDecorationTooltip(n,this,!0);break;case 2:n=t.resourceInfo;this.city.gui.buildingButtons.showWorldResourceTooltip(n,this,!0)}}},handleMouse:function(t){if(this.city.buildingMode==E.Destroy)return!1;this.wasMouseHandled=!0,this.sprite.alpha=.2;var e=20*Math.floor(t.get_cityX()/20),i=20*Math.floor(t.get_cityY()/20);if(this.sprite.position.set(e,i),this.builderSecondaryHelpSprite.position.set(e,i),this.sprite.tint=16777215,this.builderSecondaryHelpSprite.alpha=0,this.buildingPrerequirementsValid())for(var n=this.calculateCurrentCost(),s=0,r=this.city.worlds;s<r.length;){var o=r[s];if(++s,null==this.fixedToWorld||o==this.fixedToWorld){var a=t.get_cityX(),l=o.rect.x,h=o.rect.get_x2();if(l<=a&&a<h&&t.get_cityY()<o.rect.y){var u=(t.get_cityX()-o.rect.x)/20|0;if(null!=this.fixedToPos&&u!=this.fixedToPos)break;var d=o.permanents[u],c=(o.rect.y-t.get_cityY()-1)/20|0,p=this.builderType;switch(p._hx_index){case 0:var g=p.buildingInfo,m=p.buildingType;if(this.city.buildingMode==E.Drag&&t.hasSpecificClaim(this)){if(this.tryBuildingMulti(o,u,c,m,g,t))return!0}else{var f=this.canBuildBuilding(o,u,c,g);if(f==L.BuildingOK){if(this.tryBuildingAt(o,u,c,m,g,t))return!0}else if(f==L.BuildingInWorld){if(this.sprite.tint=16744576,t.isTouch)if(t.claimMouse(this,u,!1)==A.Active)return this.touchAlpha=1,this.sprite.alpha=this.touchAlpha,!0}else f==L.WorldNotAllowed&&t.claimMouse(this,u,!1)==A.Active&&o.onCannotBuild()}break;case 1:var y=p.decorationInfo;if(!o.canBuildOnSurface()){0==c&&t.claimMouse(this,u,!1)==A.Active&&o.onCannotBuild();continue}if((0==d.length||null==d[0])&&0==c){this.sprite.alpha=.5;var _=t.claimMouse(this,u+" "+c,!1);if(_==A.Confirmed){f=o.decorations[u];return"spr_removedecoration"==y.textureName?o.removeDecoration(u):null!=f&&f.textureName==y.textureName?(++f.subImage>=f.textures.length&&(f.subImage=0),f.sprite.texture=f.textures[f.subImage]):o.setDecoration(y.textureName,u),this.city.materials.remove(n),this.city.game.audio.playSound(this.city.game.audio.decorateSound),!0}if(_==A.Active)return this.sprite.alpha=.8,!0}break;case 2:y=p.resourceInfo;if(!o.canBuildOnSurface()){0==c&&t.claimMouse(this,u,!1)==A.Active&&o.onCannotBuild();continue}if((0==d.length||null==d[0])&&0==c){this.sprite.alpha=.5;var w=t.claimMouse(this,u+" "+c,!1);if(w==A.Confirmed){_="worldResources."+y.className,_=o.createWorldResource(V[_],u);return _ instanceof ha&&(_=_,null==y.initialResources?_.materialsLeft=0:_.materialsLeft=y.initialResources,null!=y.initialGrow&&(_.regrowProgress=y.initialGrow),_.updateTexture()),this.city.materials.remove(n),this.city.game.audio.playSound(this.city.game.audio.decorateSound),this.city.simulation.updatePathfinder(!1),!0}if(w==A.Active)return this.sprite.alpha=.8,!0}break;case 3:var b=p.worldResource;if(!o.canBuildOnSurface()){0==c&&t.claimMouse(this,u,!1)==A.Active&&o.onCannotBuild();continue}if((0==d.length||null==d[0])&&0==c&&o.canBuildOnSurface()){this.sprite.alpha=.5;w=t.claimMouse(this,u+" "+c,!1);if(w==A.Confirmed){for(var v=0,S=this.city.simulation.citizens;v<S.length;){var x,P=S[v];++v,P.inPermanent==b&&(null!=P.inPermanent&&P.inPermanent.isBuilding?(x=null!=P.inPermanent&&P.inPermanent.isBuilding?P.inPermanent:null,P.relativeX=20*x.worldPosition.x+x.doorX):P.relativeX+=20*P.inPermanent.worldPosition.x,null!=P.inPermanent&&P.inPermanent.onCitizenLeave(P,null),P.inBuildingSince=P.city.simulation.time.timeSinceStart,P.set_drawOnStage(P.foregroundStage),P.inPermanent=null,P.relativeY=0,I.shouldUpdateDraw=!0)}return 1==b.world.permanents[b.worldPosition.x].length?b.world.permanents[b.worldPosition.x].splice(0,1):b.world.permanents[b.worldPosition.x][0]=null,b.world=o,b.worldPosition.x=u,b.position.x=o.rect.x+20*u,b.position.y=o.rect.y-20,b.positionSprites(),(d[0]=b).world.removeDecoration(u),this.city.game.audio.playSound(this.city.game.audio.buildSound),this.city.simulation.updatePathfinder(!0),!0}if(w==A.Active)return this.sprite.alpha=.8,!0}}}}}else this.sprite.tint=16744576,this.sprite.alpha=.6;return this.city.cityView.isDraggingView?this.sprite.alpha=0:t.isTouch&&(this.sprite.alpha=this.touchAlpha),!1},tryBuildingMulti:function(t,e,i,n,s,r){return this.canBuildBuilding(t,e,i,s)==L.BuildingOK&&this.tryBuildingAt(t,e,i,n,s,r)},tryBuildingAt:function(t,e,i,n,s,r){var o=this.calculateCurrentCost(),a=t.permanents[e],l=!(this.sprite.alpha=.5),h=!1;this.city.buildingMode==E.Replace?l=i!=a.length&&null!=a[i]:h=i!=a.length&&null!=a[i],h?(this.builderSecondaryHelpSprite.alpha=1,this.sprite.tint=12632256,this.builderSecondaryHelpSprite.texture=H.getTexture("spr_insertbuildinghere")):l&&(this.builderSecondaryHelpSprite.alpha=1,this.sprite.tint=16777215,this.builderSecondaryHelpSprite.texture=H.getTexture("spr_replacebuildinghere"));var u=A.None;if(this.city.buildingMode==E.Drag?(u=r.claimMouse(this,"",!0,!0,!0),r.hasStrongClaim=!0,r.strongClaimOnUpdate=null):u=r.claimMouse(this,e+" "+i,!1),u!=A.Confirmed)return u==A.Active?(this.sprite.alpha=.8,!0):(this.city.game.isMobile&&(this.builderSecondaryHelpSprite.alpha=0),!1);u=!0;if(l)i<a.length&&null!=a[i]&&((u=Fr.getClass(a[i])!=this.get_buildingToBuild())&&a[i].isBuilding&&a[i].giveRecycleReward(u),a[i].destroyForReplacement());else if(h)for(var d=i,c=a.length;d<c;){if(null==(p=a[d++]))break;p.position.y-=20,p.worldPosition.y+=1}e=t.build(this.get_buildingToBuild(),e,i);if(-1!=s.specialInfo.indexOf("as_multi_decor")&&e.customize(this.decorationAppearance,this.mirrored),this.city.game.audio.playSound(this.city.game.audio.buildSound),u&&this.city.materials.remove(o),this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(h||l,e),this.city.progress.unlocks.research(this.get_buildingToBuild()),h)for(var p,d=i+1,c=a.length;d<c;)null!=(p=a[d++])&&p.positionSprites();e.postCreate(),this.fixBuilder(null,null),this.lastBuilt<0||60<this.lastBuilt?(this.city.progress.unlocks.checkBuildRelatedUnlocks(),this.city.saveToBrowserStorage()):this.city.progress.unlocks.checkBuildRelatedUnlocksSoon(),null!=this.city.windowRelatedOnBuildOrDestroy&&this.city.windowRelatedOnBuildOrDestroy(),this.lastBuilt=0;e.is(Wi);return!0},buildingPrerequirementsValid:function(){var e=this,t=this.builderType;if(3==t._hx_index){t.worldResource;return!0}null!=this.get_buildingToBuild()&&this.city.progress.unlocks.getUnlockState(this.get_buildingToBuild())==mo.Researched&&(this.originalCost.knowledge=0);var i=!this.isUniqueBuilding||!vn.any(this.city.permanents,function(t){return t.is(e.get_buildingToBuild())}),t=this.calculateCurrentCost();return!!this.city.materials.canAfford(t)&&i},calculateCurrentCost:function(){var t=this.builderType;if(0!=t._hx_index)return this.originalCost;t.buildingType;t=t.buildingInfo,t=this.city.progress.buildingCost.getBuildingCost(t);return null!=this.get_buildingToBuild()&&this.city.progress.unlocks.getUnlockState(this.get_buildingToBuild())==mo.Researched&&(t.knowledge=0),t},canBuildBuilding:function(e,t,i,n){if(0==i&&!e.canBuildOnSurface())return L.WorldNotAllowed;if(!e.canBuildOnNotSurface("TheMachine"==n.className&&this.city.buildingMode!=E.Replace))return L.WorldNotAllowed;var s=e.permanents[t],r=e.rect.y-20*(s.length+1),o=e.rect.x+20*t,a=e.rect.y-20*(i+1),l=0==s.length,h=!l&&s[s.length-1].isBuilding,u=l||null==s[0]||s[0].isBuilding,d=h&&s[s.length-1].isRooftopBuilding?20+r:r,c=!1,p=this.city.game.keyboard.down[46],g=this.city.game.keyboard.down[16],m=!p&&!g,f=this.city.buildingMode==E.Insert&&m,y=this.city.buildingMode==E.Replace&&m;!y&&i<s.length&&null!=s[i]&&s[i].isBuilding&&s[i].isRooftopBuilding&&(f=!0);var _,w=i<s.length&&null!=s[i]&&s[i].isBuilding,t=!1;if("cityofthekey"==this.city.progress.story.storyName&&w&&y){var b=s[i];if(b.is(Qe)&&(100==b.position.x||-100==b.position.x))return L.BuildingPositionImpossible}(i>=s.length||null==s[i])&&0<i&&-1==n.specialInfo.indexOf("rooftop")&&(_=this.city.getPermanentAtPos(o-20,a),C=this.city.getPermanentAtPos(o+20,a),p=this.city.upgrades.vars.advancedBuildingAllowed,g=null!=_&&_.isBuilding,b=null!=C&&C.isBuilding,(p?g||b:g&&b)&&(t=!0,(p?!(null!=_&&!_.isRooftopBuilding||null!=C&&!C.isRooftopBuilding):_.isRooftopBuilding||C.isRooftopBuilding)||vn.any(this.city.worlds,function(t){return t!=e&&o>=t.rect.x&&o<t.rect.get_x2()&&0<t.rect.y-a&&t.rect.y-a<e.rect.y-a})||(c=!0)));var v=!1;if(f)for(var S=i,x=s.length-1;S<x;){var P=S++;if(null==s[P]){v=!0;break}if(s[P].isBuilding)if(s[P].isRooftopBuilding&&null!=s[1+P])return L.BuildingPositionImpossible}if(-1!=n.specialInfo.indexOf("cityTop")){if(i!=s.length)return L.BuildingPositionImpossible;if(vn.any(this.city.worlds,function(t){return t.rect.y<a&&t.rect.x<=o&&t.rect.get_x2()>o}))return L.BuildingPositionImpossible}else if(0!=i&&i>=s.length&&null!=s[s.length-1]&&s[s.length-1].isBuilding&&-1!=s[s.length-1].info.specialInfo.indexOf("cityTop"))return L.BuildingPositionImpossible;var C=-1!=n.specialInfo.indexOf("rooftop"),n=this.city.upgrades.vars.advancedBuildingAllowed;if(y&&w&&!C||(l||h||c)&&(0!=i||u)&&((f||i<s.length&&null==s[i])&&d<=a&&a<e.rect.y&&(0==i||t||0<i&&null!=s[i]&&s[i].isBuilding||0<i&&null!=s[i-1]&&s[i-1].isBuilding&&!s[i-1].isRooftopBuilding)||!f&&m&&d<=a&&a<20+d||y&&d<=a&&a<e.rect.y&&!C||c)&&(i>=s.length||null==s[i]&&c||0==i||null!=s[i-1]||f)&&(!C||i==s.length||null==s[i]||i==s.length-1&&y&&s[i].isBuilding&&(0==i||null!=s[i].bottomBuilding&&!s[i].bottomBuilding.isRooftopBuilding)&&T.canRemoveFromLRPerspective(n,s[i],this.city))){var I=c||y?a:r;return v?L.BuildingOK:!(i<s.length&&null==s[i])&&vn.any(this.city.worlds,function(t){return t!=e&&null!=t.mask&&(!!t.rect.intersects(new xn(o,I,20,20))&&t.mask[(o-t.rect.x)/20|0][(I-t.rect.y)/20|0])})?L.BuildingInWorld:L.BuildingOK}return L.BuildingPositionImpossible},cancel:function(){this.stage.removeChild(this.sprite),this.stage.removeChild(this.builderSecondaryHelpSprite),null!=this.fixedSprite&&this.fixedSprite.destroy(),(this.city.builder=null)!=this.city.specialActionOld&&this.city.specialActionOld.activate()},__class__:T};var n=function(){};(V.ICreatableCityElement=n).__name__="ICreatableCityElement",n.__isInterface__=!0;var h=function(t,e,i,n,s,r){this.destroyed=!1,this.highlightSprite=null,this.bonusEntertainmentCapacity=0,this.bonusAttractiveness=0,this.game=t,this.id=e,this.city=i,this.world=n,this.position=s,this.worldPosition=r,n.city.permanentsByID.h[e]=this,n.city.permanents.push(this),this.isBuilding=!1,this.ancestors=[];for(var o=Fr.getClass(this);o!=h;)this.ancestors.push(o),o=o.__super__;e=Fr.getClass(this);this.className=e.__name__,this.classID=$.getClassID(this.className),Fr.__implements(this,Vt)&&-1==this.ancestors.indexOf(Yt)&&this.ancestors.push(Yt),this.is(Jt)&&n.city.workBuildings.push(this)};function m(t,e,i,n,s,r,o,a){this.isMedical=!1,this.isEntertainment=!1,this.doorX=13,h.call(this,t,a,n,s,r,o),this.isBuilding=!0,this.upgrades=[],this.buildingMode=null,this.adjecentBuildingEffects=[],this.stage=e,this.bgStage=i,this.drawer=X.createInstance(this.get_drawerType(),[this,e,i,D.field(Fr.getClass(this),"spriteName")]),this.info=n.progress.resources.buildingInfo.h[this.className],this.isRooftopBuilding=-1!=this.info.specialInfo.indexOf("rooftop"),n.simulation.jobAssigner.buildingsHaveWork=!0,n.simulation.houseAssigner.shouldUpdateHouses=!0,n.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,!_.isLoading&&0<this.get_possibleBuildingModes().length&&(this.buildingMode=X.createInstance(this.get_possibleBuildingModes()[0],[e,n.cityMidStage,i,this]))}function r(t,e){this.stage=t,this.building=e;var i=Fr.getClass(this);this.className=i.__name__,e.bonusAttractiveness+=this.get_bonusAttractiveness(),null!=t?(this.textures=H.getTexturesByWidth(this.get_textureName(),20),this.spriteIndex=bo.getInt(this.get_availableTextures()),this.sprite=new PIXI.Sprite(this.textures[this.spriteIndex]),this.reposition(),this.get_canCacheSprite()?(t.cacheableChildren.push(this.sprite),t.isInvalid=!0):t.addChild(this.sprite)):this.textures=[]}(V.Permanent=h).__name__="Permanent",h.__interfaces__=[n],h.prototype={get_name:function(){return""},get_typeID:function(){return 0},get_attractiveness:function(){return this.get_baseAttractiveness()+this.bonusAttractiveness},get_baseAttractiveness:function(){return 50},get_entertainmentCapacity:function(){return this.get_baseEntertainmentCapacity()+this.bonusEntertainmentCapacity},get_baseEntertainmentCapacity:function(){return 0},get_remainingCapacity:function(){return 0},get_connectedBuildingsType:function(){return this.className},destroyForReplacement:function(){h.destroyingForReplacement=!0,this.destroy(),h.destroyingForReplacement=!1},destroy:function(){this.destroyed=!0;var t=this.world.permanents[this.worldPosition.x],e=!1;h.destroyingDisableMoveDown||h.destroyingForReplacement?e=!(t[this.worldPosition.y]=null):this.is(j)&&1<t.length?e=!(t[0]=null):Y.remove(t,this),Y.remove(this.city.permanents,this),this.city.permanentsByID.remove(this.id),this.is(Jt)&&Y.remove(this.world.city.workBuildings,this);for(var i=0,n=this.city.simulation.citizens;i<n.length;){var s,r=n[i];++i,r.inPermanent==this&&(0==this.worldPosition.y?(null!=r.inPermanent&&r.inPermanent.isBuilding?(s=null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null,r.relativeX=20*s.worldPosition.x+s.doorX):r.relativeX+=20*r.inPermanent.worldPosition.x,null!=r.inPermanent&&r.inPermanent.onCitizenLeave(r,null),r.inBuildingSince=r.city.simulation.time.timeSinceStart,r.set_drawOnStage(r.foregroundStage),r.inPermanent=null,r.relativeY=0,I.shouldUpdateDraw=!0):(null!=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).bottomBuilding?(r.inPermanent=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).bottomBuilding,r.onWorld=r.inPermanent.world,this.onCitizenLeave(r,(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).bottomBuilding),r.inBuildingSince=r.city.simulation.time.timeSinceStart):null!=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).leftBuilding?(r.inPermanent=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).leftBuilding,r.onWorld=r.inPermanent.world,this.onCitizenLeave(r,(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).leftBuilding),r.inBuildingSince=r.city.simulation.time.timeSinceStart):null!=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).rightBuilding?(r.inPermanent=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).rightBuilding,r.onWorld=r.inPermanent.world,this.onCitizenLeave(r,(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).rightBuilding),r.inBuildingSince=r.city.simulation.time.timeSinceStart):null!=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).topBuilding?(r.inPermanent=(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).topBuilding,r.onWorld=r.inPermanent.world,this.onCitizenLeave(r,(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).topBuilding),r.inBuildingSince=r.city.simulation.time.timeSinceStart):(null!=r.inPermanent&&r.inPermanent.isBuilding?(s=null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null,r.relativeX=20*s.worldPosition.x+s.doorX):r.relativeX+=20*r.inPermanent.worldPosition.x,null!=r.inPermanent&&r.inPermanent.onCitizenLeave(r,null),r.inBuildingSince=r.city.simulation.time.timeSinceStart,r.set_drawOnStage(r.foregroundStage),r.inPermanent=null,r.relativeY=0,I.shouldUpdateDraw=!0),r.setRelativeY(0)),r.recyclePathArray&&(io.returnToPool(r.path),r.recyclePathArray=!1),r.path=null,r.nextPathPos=-1,r.pathEnd=-1,r.currentPathAction=null,r.canViewSelfInBuilding||(r.delayCanViewSelfInBuilding=!0),r.canViewSelfInBuilding=!0,r.verticalPathProgress=0,r.pathEndFunction=null,r.requestingPathGoal=null,r.pathOnlyRelatedTo=null,r.pathWalkSpeed=1,r.pathCanBeReconsidered=!0,0<r.sprite.alpha&&r.sprite.alpha<1&&(r.sprite.alpha=1),r.actuallyUpdateDraw())}if(!e){for(i=this.worldPosition.y,n=t.length;i<n;){var o=t[a=i++];if(null==o){t.splice(a,0,null);break}if(--o.worldPosition.y,o.position.y=this.world.rect.y-20*(o.worldPosition.y+1),o.isBuilding&&o.isRooftopBuilding&&a+1<t.length){t.splice(a+1,0,null);break}}for(var a=t.length-1,l=0;0<=a&&null==t[a];)++l,--a;0<l&&t.splice(t.length-l,l)}if(h.destroyingForReplacement||this.city.connections.updateCityConnections(),!e)for(i=this.worldPosition.y,n=t.length;i<n;)null!=t[a=i++]&&t[a].positionSprites();h.destroyingForReplacement||this.city.simulation.updatePathfinder(!0,this),this.city.gui.windowRelatedTo==this&&this.city.gui.closeWindow()},postCreate:function(){},onCityChange:function(){},onCityChangePost:function(){},invalidatePathfindingRelatedInfo:function(){},update:function(t){},onClick:function(){null!=this.city.specialAction&&this.city.specialAction.get_hasPermanentAction()?this.city.specialAction.performPermanentAction(this):(this.showWindow(),this.city.game.audio.playSound(this.city.game.audio.buildingClickSound))},onHover:function(t){},showWindow:function(){ir.hasMultiUpgradeModeOn=!1,this.createWindow()},reloadWindow:function(){this.city.gui.reloadWindow(fa(this,this.createWindow))},createWindow:function(){var t=this;this.city.gui.createWindow(this),this.city.gui.setWindowReload(fa(this,this.createWindow)),this.city.gui.windowAddTitleText(this.get_name()),this.createMainWindowPart(),this.createWindowAddBottomButtons(),this.selectedSprite=H.makeSprite("spr_selectedbuilding"),this.selectedSprite.position.set(this.position.x-1,this.position.y-1),this.city.farForegroundStage.addChild(this.selectedSprite),this.city.gui.windowOnDestroy=function(){t.city.farForegroundStage.removeChild(t.selectedSprite),t.selectedSprite=null},this.city.gui.clearWindowStack(),this.city.gui.addWindowToStack(function(){t.destroyed||t.createWindow()})},addWindowInfoLines:function(){},createMainWindowPart:function(){this.addWindowInfoLines()},createWindowAddBottomButtons:function(){this.city.gui.windowAddBottomButtons()},positionSprites:function(){null!=this.selectedSprite&&this.selectedSprite.position.set(this.position.x-1,this.position.y-1),null!=this.highlightSprite&&this.highlightSprite.position.set(this.position.x-1,this.position.y-1)},is:function(t){for(var e=0,i=this.ancestors;e<i.length;){var n=i[e];if(++e,t==n)return!0}return!1},onCitizenLeave:function(t,e){},save:function(t,e){null==e&&(e=!0),e&&t.addString(h.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:h},(V.Building=m).__name__="Building",m.__super__=h,m.prototype=e(h.prototype,{get_name:function(){return this.info.name},get_possibleUpgrades:function(){return[]},get_possibleBuildingModes:function(){return[]},get_possibleCityUpgrades:function(){return[]},get_possiblePolicies:function(){return[]},get_walkThroughCanViewSelfInThisBuilding:function(){return!0},get_drawerType:function(){return $i},onBuild:function(){},destroy:function(){this.isRooftopBuilding&&this.worldPosition.y!=this.world.permanents[this.worldPosition.x].length-1&&(h.destroyingDisableMoveDown=!0),h.prototype.destroy.call(this),h.destroyingDisableMoveDown=!1,this.drawer.destroy(),tt.iter(this.upgrades,function(t){t.destroy()}),null!=this.buildingMode&&this.buildingMode.destroy(),null!=this.city.windowRelatedOnBuildOrDestroy&&this.city.windowRelatedOnBuildOrDestroy()},tryDestroy:function(t){null==t&&(t=!0);var e=!1,i=this.city.upgrades.vars.advancedBuildingAllowed;if(null!=this.world&&this.world.isProtectedKey)return t&&this.city.gui.showSimpleWindow(kn.lo("secret_society_forbidden"),null,!0,!0),!1;if(!this.isRooftopBuilding){for(var n=this;null!=n.topBuilding&&!n.topBuilding.isRooftopBuilding;)n=n.topBuilding;e=!T.canRemoveFromLRPerspective(i,n,this.city),null!=this.topBuilding&&this.topBuilding.isRooftopBuilding&&null==this.bottomBuilding&&0!=this.worldPosition.y&&(e=!0)}return e?(t&&this.city.gui.showSimpleWindow(kn.lo("invalid_structure"),null,!0,!0),!1):(this.giveRecycleReward(),this.destroy(),!0)},giveRecycleReward:function(t){if(null==t&&(t=!0),null!=this.info){for(var e=t?M.fromBuildingInfo(this.info):new M,i=0,n=this.upgrades;i<n.length;){var s=n[i];++i;s=H.buildingUpgradesInfo.h[s.className];e.add(M.fromBuildingUpgradesInfo(s))}e.knowledge=0,e.multiply(this.city.upgrades.vars.recyclingAmount),this.city.materials.add(e)}},createWindowAddBottomButtons:function(){var t,e,i=this;this.city.progress.story.disableDestroy?this.city.gui.windowAddBottomButtons():(e=null,t=!1,e=this.city.gui.windowAddBottomButtons([{text:kn.lo("destroy"),action:function(){t?(i.city.gui.closeWindow(),i.tryDestroy(!0)):(e.setText(kn.lo("really_destroy")),t=!0)},onHover:function(){t||i.city.gui.tooltip.setText(e,i.game.isMobile?kn.lo("destroy_this_building"):kn.lo("destroy_this_building")+"\n"+kn.lo("destroy_tip"))}}])[0])},positionSprites:function(){h.prototype.positionSprites.call(this),this.drawer.positionSprites(),tt.iter(this.upgrades,function(t){t.reposition()}),null!=this.buildingMode&&this.buildingMode.reposition()},changeMainTexture:function(t){this.drawer.changeMainTexture(t)},save:function(t,e){null==e&&(e=!0),h.prototype.save.call(this,t,e);e=this.upgrades.length;t.size+4>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,r,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var i=0,n=this.upgrades;i<n.length;){var s=n[i];++i,t.addString(s.className),s.save(t)}var r,e=null!=this.buildingMode?1:0;t.size+4>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,r,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,null!=this.buildingMode&&(t.addString(this.buildingMode.className),this.buildingMode.save(t))},load:function(t,e){h.prototype.load.call(this,t,e);e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var s=t.readString(),r=X.createInstance(V[s],[this.stage,this.city.cityMidStage,this.bgStage,this]);r.load(t),this.upgrades.push(r)}e=t.bytes.getInt32(t.readStart);t.readStart+=4,1==e?(s=t.readString(),this.buildingMode=X.createInstance(V[s],[this.stage,this.city.cityMidStage,this.bgStage,this]),this.buildingMode.load(t)):this.buildingMode=null},createMainWindowPart:function(){h.prototype.createMainWindowPart.call(this),ps.createMainWindowPart(this,this.city)},getTotalAdjacentBuildingEffects:function(t){for(var e=0,i=0,n=this.adjecentBuildingEffects;i<n.length;){var s=n[i];++i,s.name==t&&(e+=s.intensity)}return e},getEffectsOfAdjecentBuildings:function(t){var e=0;if(null!=this.leftBuilding){for(var i=0,n=0,s=this.leftBuilding.adjecentBuildingEffects;n<s.length;){var r=s[n];++n,r.name==t&&(i+=r.intensity)}e+=i}if(null!=this.rightBuilding){for(i=0,n=0,s=this.rightBuilding.adjecentBuildingEffects;n<s.length;){r=s[n];++n,r.name==t&&(i+=r.intensity)}e+=i}if(null!=this.topBuilding){for(i=0,n=0,s=this.topBuilding.adjecentBuildingEffects;n<s.length;){r=s[n];++n,r.name==t&&(i+=r.intensity)}e+=i}if(null!=this.bottomBuilding){for(i=0,n=0,s=this.bottomBuilding.adjecentBuildingEffects;n<s.length;){r=s[n];++n,r.name==t&&(i+=r.intensity)}e+=i}return e},getEffectsOfAdjecentBuildingsLR:function(t){var e=0;if(null!=this.leftBuilding){for(var i=0,n=0,s=this.leftBuilding.adjecentBuildingEffects;n<s.length;){var r=s[n];++n,r.name==t&&(i+=r.intensity)}e+=i}if(null!=this.rightBuilding){for(i=0,n=0,s=this.rightBuilding.adjecentBuildingEffects;n<s.length;){r=s[n];++n,r.name==t&&(i+=r.intensity)}e+=i}return e},onClick:function(){null!=this.city.specialAction&&this.city.specialAction.get_hasPermanentAction()?this.city.specialAction.performPermanentAction(this):this.game.keyboard.down[46]||this.city.buildingMode==E.Destroy?this.city.progress.story.disableDestroy?this.city.gui.showSimpleWindow(kn.lo("no_destroy_allowed"),null,!0):(this.city.gui.windowRelatedTo==this&&this.city.gui.closeWindow(),this.tryDestroy(!0)&&this.city.game.audio.playSound(this.city.game.audio.buttonFailSound)):this.game.keyboard.down[16]?this.createOrRemoveBuilderForThis():(this.showWindow(),this.city.game.audio.playSound(this.city.game.audio.buildingClickSound))},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Fr.getClass(this),!0)},onHover:function(t){var e;h.prototype.onHover.call(this,t),!this.game.keyboard.down[46]&&this.city.buildingMode!=E.Destroy||null!=this.city.specialAction||((e=new PIXI.Sprite(H.getTexture("spr_destroying"))).position.set(this.position.x,this.position.y),this.city.furtherForegroundTempStage.addChild(e),e.alpha=t?1:this.game.isMobile?0:.5)},hasHolesBelowInBuildingStack:function(){for(var t=0,e=this.worldPosition.y;t<e;){var i=t++,i=this.world.permanents[this.worldPosition.x][i];if(null==i||!i.isBuilding)return!0}return!1},getGlobalGoal:function(){return null},couldStandHere:function(){return this.get_drawerType()!=ji||(null==this.bottomBuilding||!this.bottomBuilding.is(Fr.getClass(this)))},__class__:m});var E=x.BuildingMode={__ename__:"BuildingMode",__constructs__:["Normal","Insert","Replace","Drag","Destroy"],Normal:{_hx_index:0,__enum__:"BuildingMode",toString:i},Insert:{_hx_index:1,__enum__:"BuildingMode",toString:i},Replace:{_hx_index:2,__enum__:"BuildingMode",toString:i},Drag:{_hx_index:3,__enum__:"BuildingMode",toString:i},Destroy:{_hx_index:4,__enum__:"BuildingMode",toString:i}};(V.BuildingUpgrade=r).__name__="BuildingUpgrade",r.__interfaces__=[n],r.prototype={get_textureName:function(){return""},get_hasChangeableAppearance:function(){return 1<this.textures.length},get_bonusAttractiveness:function(){return 0},get_canCacheSprite:function(){return!0},get_availableTextures:function(){return this.textures.length},set_onUpdate:function(t){return-1==this.building.city.simulation.buildingUpgradesToUpdate.indexOf(this)&&this.building.city.simulation.buildingUpgradesToUpdate.push(this),this.onUpdate=t,this.onUpdate},changeAppearance:function(){this.textures.length<=1||((this.spriteIndex+=1)>=this.get_availableTextures()&&(this.spriteIndex=0),this.sprite.texture=this.textures[this.spriteIndex],this.get_canCacheSprite()&&(this.stage.isInvalid=!0))},reposition:function(){null!=this.stage&&(this.sprite.position.set(this.building.position.x,this.building.position.y),this.get_canCacheSprite()&&(this.stage.isInvalid=!0))},postLoad:function(){null!=this.stage&&(this.sprite.texture=this.textures[this.spriteIndex],this.get_canCacheSprite()&&(this.stage.isInvalid=!0))},destroy:function(){var t,e;this.building.bonusAttractiveness-=this.get_bonusAttractiveness(),null!=this.stage&&(this.get_canCacheSprite()?(t=this.stage,e=this.sprite,Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e)):this.stage.removeChild(this.sprite))},update:function(t){this.onUpdate(t)},save:function(t,e){null==e&&(e=!0),e&&t.addString(r.saveDefinition);var i=this.spriteIndex;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"spriteIndex")&&(this.spriteIndex=t.h.spriteIndex),this.postLoad()},__class__:r};var y=x.LifeAction={__ename__:"LifeAction",__constructs__:["Work","School","Nothing"],Work:{_hx_index:0,__enum__:"LifeAction",toString:i},School:{_hx_index:1,__enum__:"LifeAction",toString:i},Nothing:{_hx_index:2,__enum__:"LifeAction",toString:i}},I=function(t,e,i,n,s,r,o,a,l,h,u){null==h&&(h=0),this.lastMorningCommuteTime=-1,this.dynamicUnsavedVars={},this.likesNightclubs=!1,this.hasDied=!1,this.hobby=null,this.isForcedHome=!1,this.wantsNightEntertainmentIn=0,this.pathStartTime=0,this.pathCanBeReconsidered=!0,this.recyclePathArray=!1,this.pathWalkSpeed=1,this.pathOnlyRelatedTo=null,this.pathEndFunction=null,this.currentPathActionTimerXY=0,this.verticalPathProgress=0,this.delayCanViewSelfInBuilding=!1,this.canViewSelfInBuilding=!0,this.inBuildingSince=0,this.inPermanent=null,this.accessorySprite=null,this.educationLevel=0,this.lastInfrequentUpdateAge=0,this.hasWorkTools=!1,this.currentAction=y.Nothing,this.hasBuildingInited=!1,this.city=t,this.simulation=e,this.spriteIndexActual=bo.getInt(o.length),this.nameIndex=bo.getInt(1,0==H.citizenNames.length?8e3:H.citizenNames.length),this.spriteIndex=this.spriteIndexActual+(this.nameIndex<<14),this.onWorld=a,this.relativeX=l,this.relativeY=0,this.foregroundStage=i,this.inBuildingStageNonParticle=s,this.inBuildingStage=n,this.adultTextures=r,this.childrenTextures=o,e.houseAssigner.shouldUpdateHouses=!0,e.schoolAssigner.schoolsShouldBeUpdated=!0,this.bornOn=e.time.timeSinceStart-1440*h,this.lastInfrequentUpdateAge=this.get_age(),this.dieAgeModifier=bo.getInt(-5,5),this.setPreferences(),this.addedToStage=null,this.sprite=new PIXI.Sprite,this.setCurrentTexture(),I.spriteCitizens.set(this.sprite,this),this.sprite.anchor.y=1,this.actuallyUpdateDraw(),!_.isLoading&&16<=this.get_age()&&this.addToWorkers(),null!=u?(null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.set_drawOnStage(n),this.canViewSelfInBuilding=!1):this.set_drawOnStage(i),this.entertainment=new Io(this),this.wantsNightEntertainmentIn=bo.getInt(5),this.pathWalkSpeed=1,this.inBuildingSince=t.simulation.time.timeSinceStart};(V.Citizen=I).__name__="Citizen",I.prototype={get_stepsInBuilding:function(){return(this.city.simulation.time.timeSinceStart-this.inBuildingSince)/this.city.simulation.time.minutesPerTick},get_worldX:function(){return(null==this.inPermanent?0:20*this.inPermanent.worldPosition.x)+this.relativeX},get_workTimePreference:function(){return this.actualWorkTimePreference*(null==this.job?1:this.job.workTimePreferenceMod)},get_educationSpeedModifier:function(){return 1+this.educationLevel/2},get_age:function(){return(this.simulation.time.timeSinceStart-this.bornOn)/1440},set_drawOnStage:function(t){return this.drawOnStage!=(this.drawOnStage=t)&&(this.sprite.alpha=1),this.drawOnStage},setHobby:function(t){this.hobby=t,this.likesNightclubs=!1},postLoad:function(){var t=this.relativeX;isNaN(t)&&(this.relativeX=0),this.entertainment.setAgeRelatedEntertainment()},tryRemove:function(){this.fullyBeingControlled||(this.city.simulation.babyMaker.onCitizenDeath(),Y.remove(this.simulation.jobAssigner.citizensWithoutJob,this),null!=this.job&&(Y.remove(this.job.workers,this),this.simulation.jobAssigner.buildingsHaveWork=!0),null!=this.home&&(Y.remove(this.home.residents,this),this.simulation.houseAssigner.shouldUpdateHouses=!0),null!=this.school&&(Y.remove(this.school.students,this),this.simulation.schoolAssigner.schoolsShouldBeUpdated=!0),null!=this.addedToStage&&this.swapRemoveFromStage(),I.spriteCitizens.remove(this.sprite),Y.remove(this.simulation.citizens,this),null!=this.hobby&&this.hobby.onDie(),this.hasDied=!0,this.isForcedHome&&Y.remove(this.simulation.houseAssigner.citizensWithFixedHomes,this))},setPreferences:function(){this.actualWorkTimePreference=bo.getFloat(-1,1),this.likesNightclubs=this.spriteIndex%5!=0},update:function(t){this.fullyBeingControlled||(I.shouldUpdateDraw=!1,this.delayCanViewSelfInBuilding&&(this.delayCanViewSelfInBuilding=!1,I.shouldUpdateDraw=!0),this.updatePath(t),null!=this.path||this.isRequestingPath||this.updateDailyLife(t),I.shouldUpdateDraw&&this.actuallyUpdateDraw())},shouldWorkNow:function(){if(null==this.job)return!1;var t=this.simulation.time.timeSinceStart/60%24,e=this.job.startTime+this.get_workTimePreference(),i=(this.job.endTime+this.get_workTimePreference()+this.city.policies.vars.workTimeChange)%24;return e<i?e<=t&&t<i:e<=t||t<i},shouldSchoolNow:function(){if(null==this.school)return!1;var t=this.simulation.time.timeSinceStart/60%24,e=this.school.schoolStartTime,i=this.school.schoolEndTime;return e<i?e<=t&&t<i:e<=t||t<i},updateDailyLife:function(t){var e,i,n,s,r,o=this.simulation.time.timeSinceStart/60%24;this.currentAction==y.School?((n=this.school.schoolStartTime)<(r=this.school.schoolEndTime)?n<=o&&o<r:n<=o||o<r)?this.school.beAtSchool(this,t):this.currentAction=y.Nothing:this.currentAction==y.Work?(i=this.job,n=this.job.startTime+this.get_workTimePreference(),r=this.job.endTime+this.get_workTimePreference()+this.city.policies.vars.workTimeChange,i.work(this,t,!(n<r?n<=o&&o<r:n<=o||o<r))):null!=this.hobby&&this.hobby.isActive()?this.hobby.update(t):this.shouldWorkNow()?this.inPermanent==this.job?this.currentAction=y.Work:null!=(e=this.entertainment).citizen.inPermanent&&e.citizen.inPermanent.isBuilding&&e.citizen.inPermanent.isEntertainment&&!e.citizen.inPermanent.finishEntertainment(e.citizen,t)||this.simulation.pathfinder.findPath(this,this.job.get_firstBuildingToGoTo()):this.shouldSchoolNow()?this.inPermanent==this.school?this.currentAction=y.School:null!=(e=this.entertainment).citizen.inPermanent&&e.citizen.inPermanent.isBuilding&&e.citizen.inPermanent.isEntertainment&&!e.citizen.inPermanent.finishEntertainment(e.citizen,t)||(0==this.school.workers.length?this.leaveSchool():this.simulation.pathfinder.findPath(this,this.school)):this.entertainment.updateEntertainment(t)||((i=null!=this.home&&(null!=this.job||!((n=8+this.get_workTimePreference())<(r=21+this.get_workTimePreference())?n<=o&&o<r:n<=o||o<r)))?this.inPermanent!=this.home?this.simulation.pathfinder.findPath(this,this.home):(o=null==this.job?(s=8,21):(s=this.job.startTime,this.job.endTime),i=this.simulation.time.timeSinceStart/60%24,s=s,s+=this.get_workTimePreference()-1,n=s%=24,s=o,s+=this.get_workTimePreference()+1,(n<(r=s%=24)?n<=i&&i<r:n<=i||i<r)||this.get_stepsInBuilding()<240?(this.canViewSelfInBuilding=!0,this.home.walkAround(this,this.get_stepsInBuilding())):this.canViewSelfInBuilding=!1):this.wander(t))},stopWork:function(){this.currentAction=y.Nothing},tryFinishWork:function(t){return this.currentAction==y.Work&&this.job.work(this,t,!0),this.currentAction!=y.Work},evictFromHome:function(){null!=this.home&&(Y.remove(this.home.residents,this),this.home=null,this.simulation.houseAssigner.shouldUpdateHouses=!0)},leaveSchool:function(){null!=this.school&&(Y.remove(this.school.students,this),this.school=null,this.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,this.currentAction==y.School&&(this.currentAction=y.Nothing))},loseJob:function(t){null==t&&(t=!1),null!=this.job&&(Y.remove(this.job.workers,this),this.job=null,t||(this.simulation.jobAssigner.buildingsHaveWork=!0,this.simulation.jobAssigner.citizensWithoutJob.push(this)),this.hasWorkTools=!1,this.currentAction==y.Work&&(this.currentAction=y.Nothing))},infrequentUpdate:function(){this.setCurrentTexture(),this.lastInfrequentUpdateAge<16&&16<=this.get_age()&&(null==this.job?this.addToWorkers():null!=this.school&&this.leaveSchool()),this.lastInfrequentUpdateAge=this.get_age(),this.get_age()>=75+this.dieAgeModifier&&!this.city.progress.story.disableDying&&this.tryRemove();for(var t,e,i=!0,n=0,s=this.city.simulation.festivalManager.festivals;n<s.length;){var r=s[n];++n,r.isInvolvedWithFestival(this)&&(i=!1)}null!=this.path&&this.pathCanBeReconsidered&&i&&(t=this.currentAction!=y.Work&&this.shouldWorkNow(),e=this.currentAction!=y.School&&this.shouldSchoolNow(),(t&&this.pathDestination!=this.job||e&&this.pathDestination!=this.school)&&(null==(e=!1)&&(e=!0),this.recyclePathArray&&(io.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=null,e&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1)))},addToWorkers:function(){this.simulation.jobAssigner.citizensWithoutJob.push(this),this.simulation.jobAssigner.buildingsHaveWork=!0,null!=this.school&&this.leaveSchool()},midDayUpdate:function(){0<this.wantsNightEntertainmentIn&&this.wantsNightEntertainmentIn--,this.dieAgeModifier+=this.simulation.happiness.medicalHappiness/100*.2,this.city.simulation.happiness.happiness<10&&null==this.home&&this.city.materials.food<1&&(null==this.job&&(this.dieAgeModifier-=10),--this.dieAgeModifier),null!=this.home&&(this.dieAgeModifier+=this.home.yearsToLiveLongerPerYearIfLivingHere),this.dieAgeModifier+=this.city.upgrades.vars.extendAgeBy},updatePath:function(t){var e=this;if(null!=this.path){if(null==this.currentPathAction){for(;12==this.path[this.nextPathPos];)this.pathWalkSpeed=+this.path[this.nextPathPos+1]/100,this.nextPathPos+=2;this.currentPathAction=this.path[this.nextPathPos],0==this.currentPathAction||1==this.currentPathAction||9==this.currentPathAction?(this.canViewSelfInBuilding=!1,I.shouldUpdateDraw=!0):(null!=this.pathOnlyRelatedTo||4!=this.currentPathAction&&8!=this.currentPathAction)&&(this.canViewSelfInBuilding=null==(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null)||this.inPermanent.get_walkThroughCanViewSelfInThisBuilding(),I.shouldUpdateDraw=!0),this.currentPathAction<=1&&0<this.relativeY?(this.verticalPathProgress=this.relativeY*(this.currentPathAction-.5)*-2,this.relativeY=0):4!=this.currentPathAction&&8!=this.currentPathAction&&9!=this.currentPathAction&&(this.relativeY=0),this.currentPathActionTimerXY=0,5==this.currentPathAction||7==this.currentPathAction||11==this.currentPathAction||13==this.currentPathAction||14==this.currentPathAction?this.currentPathActionPermanent=this.city.findPermanentByID(this.path[this.nextPathPos+1]):4!=this.currentPathAction&&9!=this.currentPathAction&&8!=this.currentPathAction||(this.currentPathActionTimerXY=this.path[this.nextPathPos+1])}var i,n=!1;switch(this.currentPathAction){case 0:this.verticalPathProgress+=t,20<=this.verticalPathProgress&&(u=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).topBuilding,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.verticalPathProgress-=20,n=!0);break;case 1:this.verticalPathProgress+=t,20<=this.verticalPathProgress&&(u=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).bottomBuilding,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.verticalPathProgress-=20,n=!0);break;case 2:this.relativeX-=t*this.pathWalkSpeed,this.relativeX<-2?(u=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).leftBuilding,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.onWorld=this.inPermanent.world,this.relativeX+=20,n=!0):I.shouldUpdateDraw=!0;break;case 3:this.relativeX+=t*this.pathWalkSpeed,20<this.relativeX?(u=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).rightBuilding,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.onWorld=this.inPermanent.world,this.relativeX-=20,n=!0):I.shouldUpdateDraw=!0;break;case 4:var s=this.currentPathActionTimerXY,r=this.pathWalkSpeed*t;I.shouldUpdateDraw=!0,n=Math.abs(s-this.relativeX)<r?(this.relativeX=s,!0):(d=s-this.relativeX,this.relativeX+=(0<d?1:d<0?-1:0)*r,!1);break;case 5:null!=this.inPermanent?null!=this.inPermanent&&this.inPermanent.isBuilding?(s=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).doorX,r=this.pathWalkSpeed*t,I.shouldUpdateDraw=!0,(Math.abs(s-this.relativeX)<r?(this.relativeX=s,!0):(d=s-this.relativeX,this.relativeX+=(0<d?1:d<0?-1:0)*r,!1))&&(null!=this.inPermanent&&this.inPermanent.isBuilding?(i=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,this.relativeX=20*i.worldPosition.x+i.doorX):this.relativeX+=20*this.inPermanent.worldPosition.x,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,I.shouldUpdateDraw=!0)):(null!=this.inPermanent&&this.inPermanent.isBuilding?(i=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,this.relativeX=20*i.worldPosition.x+i.doorX):this.relativeX+=20*this.inPermanent.worldPosition.x,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,I.shouldUpdateDraw=!0):this.currentPathActionPermanent.isBuilding?(s=20*(a=this.currentPathActionPermanent).worldPosition.x+a.doorX,r=this.pathWalkSpeed*t,I.shouldUpdateDraw=!0,(n=Math.abs(s-this.relativeX)<r?(this.relativeX=s,!0):(d=s-this.relativeX,this.relativeX+=(0<d?1:d<0?-1:0)*r,!1))&&(u=this.currentPathActionPermanent,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.set_drawOnStage(this.inBuildingStage),this.relativeX=a.doorX)):(d=10+(l=20*this.currentPathActionPermanent.worldPosition.x)-this.relativeX,this.relativeX+=(0<d?1:d<0?-1:0)*(t*this.pathWalkSpeed),this.relativeX>l&&this.relativeX<20+l-2&&(u=this.currentPathActionPermanent,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.relativeX-=20*this.inPermanent.worldPosition.x,n=!0)),I.shouldUpdateDraw=!0;break;case 7:0<this.currentPathActionTimerXY?(this.currentPathActionTimerXY+=.1*t,1<=this.currentPathActionTimerXY?(this.sprite.alpha=1,this.inPermanent.is(ri)?(null==(c=!0)&&(c=!0),this.recyclePathArray&&(io.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=null,c&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1),this.waitAndMoveAndWaitRandom(30,45,3,16,120,180,null,!1,!0),this.pathCanBeReconsidered=!1,this.inPermanent.giveReward()):n=!0):this.sprite.alpha=this.currentPathActionTimerXY):this.city.simulation.operatingCost.teleportersEnabled?(s=this.inPermanent.teleportX,r=this.pathWalkSpeed*t,I.shouldUpdateDraw=!0,(Math.abs(s-this.relativeX)<r?(this.relativeX=s,!0):(d=s-this.relativeX,this.relativeX+=(0<d?1:d<0?-1:0)*r,!1))&&(this.inPermanent.createTeleportParticle(),this.inPermanent.timesUsed+=1,null!=this.city.misdirector&&0<this.city.misdirector.get_misdirectChance()&&bo.getFloat()<this.city.misdirector.get_misdirectChance()&&(this.currentPathActionPermanent=this.city.misdirector),u=this.currentPathActionPermanent,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.inPermanent.timesUsedTo+=1,this.onWorld=this.currentPathActionPermanent.world,this.relativeX=this.inPermanent.teleportX,this.currentPathActionTimerXY=.1*t,this.sprite.alpha=this.currentPathActionTimerXY)):(null==(c=!0)&&(c=!0),this.recyclePathArray&&(io.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=null,c&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1)),I.shouldUpdateDraw=!0;break;case 8:n=(this.currentPathActionTimerXY-=t)<=.5*(t-.6666666666666666);break;case 9:r=t;Math.abs(this.currentPathActionTimerXY-this.relativeY)<r?(this.relativeY=this.currentPathActionTimerXY,n=!0):(d=this.currentPathActionTimerXY-this.relativeY,this.relativeY+=(0<d?1:d<0?-1:0)*r),I.shouldUpdateDraw=!0;break;case 10:n=!0;break;case 11:if(this.inPermanent==this.currentPathActionPermanent)n=!0;else{var o,a=this.inPermanent,l=this.currentPathActionPermanent;if(null!=a.currentlyLandedSaucer&&(a.currentlyLandedSaucer.destination==l||a.currentlyLandedSaucer.destination.estimatedFlyingDistanceTo(l)<a.estimatedFlyingDistanceTo(l)))(h=a.currentlyLandedSaucer).addPassenger(this),this.fullyBeingControlled=!0,this.canViewSelfInBuilding=!1,this.inTransportationThing=h,a.currentlyLandedSaucer.destination!=l&&a.estimatedFlyingDistanceTo(l)<a.estimatedFlyingDistanceTo(a.currentlyLandedSaucer.destination)&&null!=(o=this.simulation.flyingPathfinder.findRoute(a,l))&&h.setDestination(l,o);else if(a.hasFlyingSaucer){if(null==(o=this.simulation.flyingPathfinder.findRoute(a,l)))return this.recyclePathArray&&(io.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=null,this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0,this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,void(0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1));var h=new Fo(this.simulation,this.city.farForegroundStage,o,a,this.currentPathActionPermanent);this.simulation.flyingSaucers.push(h),h.addPassenger(this),this.fullyBeingControlled=!0,this.canViewSelfInBuilding=!1,this.inTransportationThing=h,this.inPermanent.removeFlyingSaucer();this.relativeX=bo.getInt(7,14)}else this.relativeY=-1}I.shouldUpdateDraw=!0;break;case 12:break;case 13:var u,d,h=20*(this.currentPathActionPermanent.worldPosition.y-this.inPermanent.worldPosition.y);this.inPermanent==this.currentPathActionPermanent?3<this.currentPathActionTimerXY?this.nextPathPos+2<this.pathEnd&&(0==this.path[this.nextPathPos+2]||1==this.path[this.nextPathPos+2])?(s=10<this.relativeX?18:0,r=this.pathWalkSpeed*t,I.shouldUpdateDraw=!0,(Math.abs(s-this.relativeX)<r?(this.relativeX=s,!0):(d=s-this.relativeX,this.relativeX+=(0<d?1:d<0?-1:0)*r,!1))&&(n=!0)):n=!0:this.currentPathActionTimerXY+=t:0<this.currentPathActionTimerXY?(Math.abs(this.verticalPathProgress)<Math.abs(h)&&(this.verticalPathProgress+=20*t*(0<h?1:h<0?-1:0),this.canViewSelfInBuilding=!1),Math.abs(this.verticalPathProgress)>=Math.abs(h)&&this.currentPathActionPermanent.openDoor()&&(u=this.currentPathActionPermanent,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,u),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=u,this.hasBuildingInited=!1,this.inPermanent.timesUsedTo+=1,this.verticalPathProgress=0,this.canViewSelfInBuilding=!0,this.relativeX+=bo.getInt(-2,3))):(this.canViewSelfInBuilding=!0,r=this.pathWalkSpeed*t,I.shouldUpdateDraw=!0,(Math.abs(9-this.relativeX)<r?(this.relativeX=9,!0):(d=9-this.relativeX,this.relativeX+=(0<d?1:d<0?-1:0)*r,!1))&&this.inPermanent.openDoor()&&(this.inPermanent.timesUsed+=1,this.currentPathActionTimerXY=1,this.canViewSelfInBuilding=!1)),I.shouldUpdateDraw=!0}if(n){if(this.nextPathPos+2>=this.pathEnd){var c,p=e.pathEndFunction;null==(c=!0)&&(c=!0),e.recyclePathArray&&(io.returnToPool(e.path),e.recyclePathArray=!1),e.path=null,e.nextPathPos=-1,e.pathEnd=-1,e.currentPathAction=null,c&&(e.canViewSelfInBuilding||(e.delayCanViewSelfInBuilding=!0),e.canViewSelfInBuilding=!0),e.verticalPathProgress=0,e.pathEndFunction=null,e.requestingPathGoal=null,e.pathOnlyRelatedTo=null,e.pathWalkSpeed=1,e.pathCanBeReconsidered=!0,0<e.sprite.alpha&&e.sprite.alpha<1&&(e.sprite.alpha=1),null!=p&&p(),null!=e.inPermanent&&e.inPermanent==e.job&&e.currentAction!=y.Work&&e.shouldWorkNow()&&(e.lastMorningCommuteTime=e.city.simulation.time.timeSinceStart-e.pathStartTime)}else{if(this.nextPathPos+=2,this.currentPathAction=null,13==this.path[this.nextPathPos])for(;this.nextPathPos+2<this.pathEnd&&13==this.path[this.nextPathPos+2];)this.nextPathPos+=2;if(14==this.path[this.nextPathPos])for(;this.nextPathPos+2<this.pathEnd&&14==this.path[this.nextPathPos+2];)this.nextPathPos+=2;10==this.path[this.nextPathPos]&&(this.nextPathPos+2>=this.pathEnd?(p=e.pathEndFunction,null==(c=!0)&&(c=!0),e.recyclePathArray&&(io.returnToPool(e.path),e.recyclePathArray=!1),e.path=null,e.nextPathPos=-1,e.pathEnd=-1,e.currentPathAction=null,c&&(e.canViewSelfInBuilding||(e.delayCanViewSelfInBuilding=!0),e.canViewSelfInBuilding=!0),e.verticalPathProgress=0,e.pathEndFunction=null,e.requestingPathGoal=null,e.pathOnlyRelatedTo=null,e.pathWalkSpeed=1,e.pathCanBeReconsidered=!0,0<e.sprite.alpha&&e.sprite.alpha<1&&(e.sprite.alpha=1),null!=p&&p(),null!=e.inPermanent&&e.inPermanent==e.job&&e.currentAction!=y.Work&&e.shouldWorkNow()&&(e.lastMorningCommuteTime=e.city.simulation.time.timeSinceStart-e.pathStartTime)):(this.canViewSelfInBuilding=!0,this.nextPathPos+=2))}I.shouldUpdateDraw=!0}}},leavePermanent:function(t){var e,i;null!=this.inPermanent&&this.inPermanent.isBuilding?(e=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).doorX,t=this.pathWalkSpeed*t,I.shouldUpdateDraw=!0,(Math.abs(e-this.relativeX)<t?(this.relativeX=e,0):(e=e-this.relativeX,this.relativeX+=(0<e?1:e<0?-1:0)*t,1))||(null!=this.inPermanent&&this.inPermanent.isBuilding?(i=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,this.relativeX=20*i.worldPosition.x+i.doorX):this.relativeX+=20*this.inPermanent.worldPosition.x,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,I.shouldUpdateDraw=!0)):(null!=this.inPermanent&&this.inPermanent.isBuilding?(i=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,this.relativeX=20*i.worldPosition.x+i.doorX):this.relativeX+=20*this.inPermanent.worldPosition.x,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,I.shouldUpdateDraw=!0)},instantLeavePermanent:function(){var t;null!=this.inPermanent&&this.inPermanent.isBuilding?(t=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,this.relativeX=20*t.worldPosition.x+t.doorX):this.relativeX+=20*this.inPermanent.worldPosition.x,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,I.shouldUpdateDraw=!0},moveTowardsX:function(t,e){e=this.pathWalkSpeed*e;if(I.shouldUpdateDraw=!0,Math.abs(t-this.relativeX)<e)return this.relativeX=t,!0;t-=this.relativeX;return this.relativeX+=(0<t?1:t<0?-1:0)*e,!1},setRelativePos:function(t,e){t==this.relativeX&&e==this.relativeY||(this.relativeX=t,this.relativeY=e,I.shouldUpdateDraw=!0)},setRelativeY:function(t){this.relativeY=t,I.shouldUpdateDraw=!0},setRelativeX:function(t){this.relativeX=t,I.shouldUpdateDraw=!0},wait:function(t,e){var i=io.pool,i=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);i[0]=8,i[1]=t,this.setPath(i,0,2,!0),this.pathEndFunction=e,this.pathOnlyRelatedTo=this.inPermanent},waitRandom:function(t,e,i){var n=io.pool,n=0<n[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2);n[0]=8,n[1]=bo.getInt(t,e),this.setPath(n,0,2,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},wander:function(t){var e,i,n;null==this.inPermanent?(e=(0|this.relativeX)-100,i=100+(0|this.relativeX),n=this.onWorld.rect.width-2,this.moveAndWait(bo.getInt(0<e?e:0,n<i?n:i),bo.getInt(30,60),null,!1,!1)):this.goDownTowardsWorldSurface(t)},goDownTowardsWorldSurface:function(t){if(0==this.inPermanent.worldPosition.y){var e,i;null!=this.inPermanent&&this.inPermanent.isBuilding?(e=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).doorX,t=this.pathWalkSpeed*t,I.shouldUpdateDraw=!0,(Math.abs(e-this.relativeX)<t?(this.relativeX=e,!0):(e=e-this.relativeX,this.relativeX+=(0<e?1:e<0?-1:0)*t,!1))&&(null!=this.inPermanent&&this.inPermanent.isBuilding?(i=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,this.relativeX=20*i.worldPosition.x+i.doorX):this.relativeX+=20*this.inPermanent.worldPosition.x,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,I.shouldUpdateDraw=!0)):(null!=this.inPermanent&&this.inPermanent.isBuilding?(i=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,this.relativeX=20*i.worldPosition.x+i.doorX):this.relativeX+=20*this.inPermanent.worldPosition.x,null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,null),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.set_drawOnStage(this.foregroundStage),this.inPermanent=null,this.relativeY=0,I.shouldUpdateDraw=!0)}else{for(var n=null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null,s=[];0!=n.worldPosition.y;){if(null==n.bottomBuilding){for(var r=n.leftBuilding;null!=r;)r=r.leftBuilding;null!=r?(s.push(2),s.push(0),n=n.leftBuilding):null!=n.rightBuilding&&(s.push(3),s.push(0),n=n.rightBuilding)}if(null==n.bottomBuilding)break;s.push(1),s.push(0),n=n.bottomBuilding}0<s.length&&this.setPath(new Int32Array(s),0,s.length)}},move:function(t,e,i){var n,s;null==i&&(i=!1),i?((s=0<(n=io.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,s[1]=50,s[2]=4,s[3]=t,this.setPath(s,0,4,!0)):((s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=t,this.setPath(s,0,2,!0)),this.pathEndFunction=e,this.pathOnlyRelatedTo=this.inPermanent},moveRandom:function(t,e,i,n){null==n&&(n=!1);var s,r,e=bo.getInt(t,e);n?((r=0<(s=io.pool)[4].length?s[4].splice(s[4].length-1,1)[0]:new Int32Array(4))[0]=12,r[1]=50,r[2]=4,r[3]=e,this.setPath(r,0,4,!0)):((r=0<(s=io.pool)[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=e,this.setPath(r,0,2,!0)),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},moveTowardsRandomInWorldCoords:function(t,e,i){var n,s,r,o=bo.getInt(t,e);null!=this.inPermanent?((n=o-this.relativeX-this.inPermanent.position.x)<-this.relativeX?null!=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).leftBuilding?((r=0<(s=io.pool)[4].length?s[4].splice(s[4].length-1,1)[0]:new Int32Array(4))[0]=2,r[1]=0,r[2]=4,r[3]=18,this.setPath(r,0,4,!0)):((r=0<(s=io.pool)[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=0,this.setPath(r,0,2,!0),this.pathEndFunction=null,this.pathOnlyRelatedTo=this.inPermanent):n>=20-this.relativeX?null!=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null).rightBuilding?((r=0<(s=io.pool)[4].length?s[4].splice(s[4].length-1,1)[0]:new Int32Array(4))[0]=3,r[1]=0,r[2]=4,r[3]=0,this.setPath(r,0,4,!0)):((r=0<(s=io.pool)[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=18,this.setPath(r,0,2,!0),this.pathEndFunction=null,this.pathOnlyRelatedTo=this.inPermanent):(n=Math.floor(n+this.relativeX),(r=0<(s=io.pool)[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=n,this.setPath(r,0,2,!0),this.pathEndFunction=null,this.pathOnlyRelatedTo=this.inPermanent),this.pathEndFunction=i):(o=bo.getInt(t-this.onWorld.rect.x,e-this.onWorld.rect.x),(r=0<(s=io.pool)[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2))[0]=4,r[1]=o,this.setPath(r,0,2,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent)},moveAndWaitRandom:function(t,e,i,n,s,r,o){null==o&&(o=!1),null==r&&(r=!1),this.moveAndWait(bo.getInt(t,e),bo.getInt(i,n),s,r,o)},moveAndWait:function(t,e,i,n,s){var r,o;null==s&&(s=!1),null==n&&(n=!1),n&&(e=e/this.simulation.happiness.actionSpeedModifier|0),s?((o=0<(r=io.pool)[6].length?r[6].splice(r[6].length-1,1)[0]:new Int32Array(6))[0]=12,o[1]=50,o[2]=4,o[3]=t,o[4]=8,o[5]=e,this.setPath(o,0,6,!0)):((o=0<(r=io.pool)[4].length?r[4].splice(r[4].length-1,1)[0]:new Int32Array(4))[0]=4,o[1]=t,o[2]=8,o[3]=e,this.setPath(o,0,4,!0)),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},waitAndMoveAndWaitRandom:function(t,e,i,n,s,r,o,a,l){null==l&&(l=!1),null==a&&(a=!1);var h,u,e=bo.getInt(t,e),r=bo.getInt(s,r),n=bo.getInt(i,n);a&&(e=e/this.simulation.happiness.actionSpeedModifier|0,r=r/this.simulation.happiness.actionSpeedModifier|0),l?((u=0<(h=io.pool)[8].length?h[8].splice(h[8].length-1,1)[0]:new Int32Array(8))[0]=8,u[1]=e,u[2]=12,u[3]=50,u[4]=4,u[5]=n,u[6]=8,u[7]=r,this.setPath(u,0,8,!0)):((u=0<(h=io.pool)[6].length?h[6].splice(h[6].length-1,1)[0]:new Int32Array(6))[0]=8,u[1]=e,u[2]=4,u[3]=n,u[4]=8,u[5]=r,this.setPath(u,0,6,!0)),this.pathEndFunction=o,this.pathOnlyRelatedTo=this.inPermanent},changeFloorAndMoveRandom:function(t,e,i){var n=this.isAtGroundLevel()?10:0,s=io.pool,s=0<s[4].length?s[4].splice(s[4].length-1,1)[0]:new Int32Array(4);s[0]=9,s[1]=n,s[2]=4,s[3]=bo.getInt(t,e),this.setPath(s,0,4,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},isAtGroundLevel:function(){return this.relativeY<5},isAtBottomFloor:function(){return this.relativeY<5},changeFloor:function(t){var e=this.isAtGroundLevel()?10:0,i=io.pool,i=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);i[0]=9,i[1]=e,this.setPath(i,0,2,!0),this.pathEndFunction=t,this.pathOnlyRelatedTo=this.inPermanent},changeFloorAndWait:function(t,e){var i=0==this.relativeY?10:0,n=io.pool,n=0<n[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4);n[0]=9,n[1]=i,n[2]=8,n[3]=t,this.setPath(n,0,4,!0),this.pathEndFunction=e,this.pathOnlyRelatedTo=this.inPermanent},changeFloorAndWaitRandom:function(t,e,i){var n=0==this.relativeY?10:0,s=io.pool,s=0<s[4].length?s[4].splice(s[4].length-1,1)[0]:new Int32Array(4);s[0]=9,s[1]=n,s[2]=8,s[3]=bo.getInt(t,e),this.setPath(s,0,4,!0),this.pathEndFunction=i,this.pathOnlyRelatedTo=this.inPermanent},resetPath:function(t){null==t&&(t=!0),this.recyclePathArray&&(io.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=null,t&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1)},swapRemoveFromStage:function(){var t=this.addedToStage.children[this.addedToStage.children.length-1];this.addedToStage.children[this.stageChildIndex]=t,I.spriteCitizens.h[t.__id__].stageChildIndex=this.stageChildIndex,this.addedToStage.children[this.addedToStage.children.length-1]=this.sprite,this.addedToStage.removeChildAt(this.addedToStage.children.length-1)},actuallyUpdateDraw:function(){null!=this.inPermanent?(this.sprite.position.x=this.inPermanent.position.x+this.relativeX,null!=this.inPermanent&&this.inPermanent.isBuilding?(0!=this.sprite.alpha&&1!=this.sprite.alpha||(this.sprite.alpha=this.canViewSelfInBuilding&&!this.delayCanViewSelfInBuilding?1:0),this.sprite.position.y=this.inPermanent.position.y+20-this.relativeY-1):this.sprite.position.y=this.inPermanent.position.y+20-this.relativeY):(this.sprite.position.x=this.onWorld.rect.x+this.relativeX,this.sprite.position.y=this.onWorld.rect.y-this.relativeY),this.updateCull()},uncull:function(){null==this.addedToStage&&null!=this.drawOnStage&&(this.stageChildIndex=this.drawOnStage.children.length,this.drawOnStage.addChild(this.sprite),this.addedToStage=this.drawOnStage)},updateCull:function(){var t=this.sprite.x>=this.city.cityCullX&&this.sprite.y>=this.city.cityCullY&&this.sprite.x<this.city.cityCullX2&&this.sprite.y<this.city.cityCullY2?this.drawOnStage:null;t!=this.addedToStage&&(null!=this.addedToStage&&this.swapRemoveFromStage(),null!=t&&(this.stageChildIndex=t.children.length,t.addChild(this.sprite)),this.addedToStage=t)},addToOnWorldStage:function(){this.set_drawOnStage(this.foregroundStage)},addToWithAccessoryStage:function(){this.set_drawOnStage(this.inBuildingStageNonParticle)},addToCorrectStage:function(){this.set_drawOnStage(null!=this.inPermanent&&this.inPermanent.isBuilding?null!=this.accessorySprite?this.inBuildingStageNonParticle:this.inBuildingStage:this.foregroundStage)},findPath:function(t,e){this.simulation.pathfinder.findPath(this,t),this.pathOnFail=e},setPath:function(t,e,i,n){var s;if(null==n&&(n=!1),null!=this.path&&(console.log("FloatingSpaceCities/Citizen.hx:1460:","overwriting path"),console.log("FloatingSpaceCities/Citizen.hx:1460:",this)),-1==t[e])return this.isRequestingPath=!1,this.requestingPathGoal==this.home?this.evictFromHome():this.requestingPathGoal==this.job?this.loseJob():this.requestingPathGoal==this.school&&this.leaveSchool(),null!=this.pathOnFail&&this.pathOnFail(),null==(s=!1)&&(s=!0),this.recyclePathArray&&(io.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=null,s&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,void(0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1));this.pathDestination=this.requestingPathGoal,null==(s=!1)&&(s=!0),this.recyclePathArray&&(io.returnToPool(this.path),this.recyclePathArray=!1),this.path=null,this.nextPathPos=-1,this.pathEnd=-1,this.currentPathAction=null,s&&(this.canViewSelfInBuilding||(this.delayCanViewSelfInBuilding=!0),this.canViewSelfInBuilding=!0),this.verticalPathProgress=0,this.pathEndFunction=null,this.requestingPathGoal=null,this.pathOnlyRelatedTo=null,this.pathWalkSpeed=1,this.pathCanBeReconsidered=!0,0<this.sprite.alpha&&this.sprite.alpha<1&&(this.sprite.alpha=1),0!=i&&(this.path=t,this.nextPathPos=e,this.pathEnd=e+i),this.isRequestingPath=!1,this.recyclePathArray=n,this.pathStartTime=this.city.simulation.time.timeSinceStart},setPathWithEnd:function(t,e,i,n,s){null==s&&(s=!1),this.setPath(t,e,i,s),this.pathEndFunction=n},setCurrentTexture:function(){var t=(this.get_age()<16?this.childrenTextures:this.adultTextures)[this.spriteIndexActual];this.sprite.texture=t,this.actualSpriteHeight=this.get_age()<16||6==this.spriteIndexActual||12==this.spriteIndexActual||16==this.spriteIndexActual||20==this.spriteIndexActual||26==this.spriteIndexActual?4:5},load:function(t,e){this.loadBasics(t,e),this.nameIndex=this.spriteIndex>>14,this.spriteIndexActual=this.spriteIndex-(this.nameIndex<<14),0==this.nameIndex&&(this.nameIndex=bo.getInt(1,8e3)),this.likesNightclubs=this.spriteIndex%5!=0,this.setCurrentTexture()},afterLoadingInPermanent:function(){this.addToCorrectStage(),null==this.school&&this.currentAction==y.School&&(this.currentAction=y.Nothing)},goToPermanent:function(t){null!=this.inPermanent&&this.inPermanent.onCitizenLeave(this,t),this.inBuildingSince=this.city.simulation.time.timeSinceStart,this.inPermanent=t,this.hasBuildingInited=!1},goToPermanentLocal:function(t){this.inPermanent=t},educate:function(t,e){this.educationLevel=Math.max(Math.min(this.educationLevel+t,e),this.educationLevel)},getCityPosition:function(){var t,e,i,n,s=new In(0,0);return this.fullyBeingControlled&&null!=this.inTransportationThing?s=new In(this.inTransportationThing.position.x+this.inTransportationThing.get_citizenOffset().x,this.inTransportationThing.position.y+this.inTransportationThing.get_citizenOffset().y):null!=this.inPermanent?(s.x=this.inPermanent.position.x+this.relativeX,null!=(null!=this.inPermanent&&this.inPermanent.isBuilding?this.inPermanent:null)?s.y=this.inPermanent.position.y+20-this.relativeY-1:s.y=this.inPermanent.position.y+20-this.relativeY):(t=(n=this.onWorld.rect).x,e=n.y,i=this.relativeX,n=-this.relativeY,s=new In(t+i,e+n)),null!=this.path&&(0==this.currentPathAction?s.y-=this.verticalPathProgress:1==this.currentPathAction&&(s.y+=this.verticalPathProgress)),s},onClick:function(){_s.createWindow(this.city,this)},save:function(t,e){null==e&&(e=!0),e&&t.addString(I.saveDefinition);var i=this.hasBuildingInited;t.size+1>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)),t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.spriteIndex;t.size+4>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,n,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;i=this.relativeX;t.size+8>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8;i=this.bornOn;t.size+8>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8;i=this.actualWorkTimePreference;t.size+8>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8;e=this.currentAction;t.addString(x[e.__enum__].__constructs__[e._hx_index]);i=this.hasWorkTools;t.size+1>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,n,0,t.size)),t.bytes.b[t.size]=i?1:0,t.size+=1;i=this.lastInfrequentUpdateAge;t.size+8>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8;i=this.dieAgeModifier;t.size+8>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8;var n,i=this.educationLevel;t.size+8>t.bytes.length&&(n=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,n,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"hasBuildingInited")&&(this.hasBuildingInited=t.h.hasBuildingInited),Object.prototype.hasOwnProperty.call(t.h,"spriteIndex")&&(this.spriteIndex=t.h.spriteIndex),Object.prototype.hasOwnProperty.call(t.h,"relativeX")&&(this.relativeX=t.h.relativeX),Object.prototype.hasOwnProperty.call(t.h,"bornOn")&&(this.bornOn=t.h.bornOn),Object.prototype.hasOwnProperty.call(t.h,"actualWorkTimePreference")&&(this.actualWorkTimePreference=t.h.actualWorkTimePreference),Object.prototype.hasOwnProperty.call(t.h,"currentAction")&&(this.currentAction=t.h.currentAction),Object.prototype.hasOwnProperty.call(t.h,"hasWorkTools")&&(this.hasWorkTools=t.h.hasWorkTools),Object.prototype.hasOwnProperty.call(t.h,"lastInfrequentUpdateAge")&&(this.lastInfrequentUpdateAge=t.h.lastInfrequentUpdateAge),Object.prototype.hasOwnProperty.call(t.h,"dieAgeModifier")&&(this.dieAgeModifier=t.h.dieAgeModifier),Object.prototype.hasOwnProperty.call(t.h,"educationLevel")&&(this.educationLevel=t.h.educationLevel),this.postLoad()},__class__:I};var s=function(){};function g(t,e,i,n,s){null==s&&(s="fpc_save"),null==n&&(n=!1),this.cityName="",this.previousCullRectangle=null,this.permanentNumberCached=null,this.updateConnectedBuildingSprites=!1,this.isLoserState=!1,this.skyColor=0,this.saveRawDataToReuse=null,this.currentlySaving=!1,this.secondsSinceAutoSave=0,this.simulationSpeed=1,this.windowRelatedOnBuildOrDestroy=null,this.zoomScale=2,this.fixViewBottomYOn=null,this.specialActionOld=null,this.specialAction=null,this.postCreateBuilder=null,this.misdirector=null,this.maxPermanentID=0,this.worlds=[],this.hoverHighlightSetThisStep=!1,this.cityCullX=0,this.cityCullY=0,this.cityCullX2=1,this.cityCullY2=1,this.zoomScale=Math.max(t.scaling,this.zoomScale),this.game=t,this.outerStage=e,this.displayOnly=n,this.cityFile=s,this.buildingMode=E.Normal,this.materials=new M,this.permanentsByID=new Ir,this.permanents=[],this.workBuildings=[],this.upgrades=new hn(this),this.policies=new $r(this),this.teleporters=[],this.landingSites=[],this.connections=new ko(this),this.progress=new oo(this,i),this.progress.init(),this.viewPos=new In(225,150),this.cityView=new d(this),this.sky=new PIXI.Graphics,this.updateSky(0),this.outerStage.addChild(this.sky),this.starStage=new PIXI.Container,this.outerStage.addChild(this.starStage),this.stars=new $n(this.starStage,this),this.movingViewStage=new PIXI.Container,this.outerStage.addChild(this.movingViewStage),this.movingViewStage.position.set(t.addX,t.addY),this.mainMovingViewStage=new PIXI.Container,this.movingViewStage.addChild(this.mainMovingViewStage),this.cityBgStageBelow=new Nn(new xn(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityBgStageBelow),this.trainStage=new Gn,this.mainMovingViewStage.addChild(this.trainStage),this.cityBgStage=new Nn(new xn(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityBgStage),this.get_usingParticleContainers()?this.citizenInBuildingStage=new PIXI.Container:this.citizenInBuildingStage=new PIXI.particles.ParticleContainer(1e4,{position:!0,alpha:!0,uvs:!0,scale:!1}),this.mainMovingViewStage.addChild(this.citizenInBuildingStage),this.citizenInBuildingStageNonParticle=new PIXI.Container,this.mainMovingViewStage.addChild(this.citizenInBuildingStageNonParticle),this.aboveCitizensInBuildingStage=new Gn,this.mainMovingViewStage.addChild(this.aboveCitizensInBuildingStage),i=new PIXI.Container,this.mainMovingViewStage.addChild(i),this.particles=new Yn(i),this.cityMidStage=new Nn(new xn(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityMidStage),this.cityStage=new Nn(new xn(-1024,-1024,2048,2048)),this.mainMovingViewStage.addChild(this.cityStage),this.justAboveCityStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.justAboveCityStage),this.builderStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.builderStage),this.get_usingParticleContainers()?this.citizenForegroundStage=new PIXI.Container:this.citizenForegroundStage=new PIXI.particles.ParticleContainer(5e3,{position:!0,uvs:!0,scale:!1}),this.mainMovingViewStage.addChild(this.citizenForegroundStage),this.farForegroundStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.farForegroundStage),this.furtherForegroundStage=new PIXI.Container,this.mainMovingViewStage.addChild(this.furtherForegroundStage),this.builderHighlightStage=new PIXI.Container,this.furtherForegroundStage.addChild(this.builderHighlightStage),this.hoverHighlightStage=new PIXI.Container,this.furtherForegroundStage.addChild(this.hoverHighlightStage),this.hoverHighlightStage2=new PIXI.Container,this.furtherForegroundStage.addChild(this.hoverHighlightStage2),this.furtherForegroundTempStage=new PIXI.Container,this.furtherForegroundStage.addChild(this.furtherForegroundTempStage),this.simulation=new a(this,this.citizenForegroundStage,this.citizenInBuildingStage,this.citizenInBuildingStageNonParticle),this.guiStage=new PIXI.Container,n&&(this.guiStage.visible=!1),this.outerStage.addChild(this.guiStage),this.gui=new os(t,this.guiStage,this),this.set_pauseGame(!1),_.isLoading||(this.progress.story.makeWorlds(t,this.cityStage,this.cityMidStage,this.cityBgStage),this.createBottomWorld(),this.progress.story.start(),this.updateDrawCachingRectSize()),_.isLoading||(this.connections.updateCityConnections(),this.simulation.updatePathfinder(!0),this.progress.unlocks.stopAllNotifyForUnlock(),this.gui.refreshCategoryBuildingsShown()),la.alreadyFoundBonuses=[],this.simulation.time.updateSky(),this.secondsSinceAutoSave=0,this.resize(),k.enableCheats&&(window.cheatMaterials=fa(this,this.cheatMaterials),window.cheatPeople=fa(this,this.cheatPeople),window.cheatUnlocks=fa(this,this.cheatUnlocks),window.cheatSpeed=function(){k.cheatSpeedEnabled=!0},window.cheatMaterialsZero=fa(this,this.cheatMaterialsZero),window.cheatFood=fa(this,this.cheatFood),window.cheatWood=fa(this,this.cheatWood),window.cheatStone=fa(this,this.cheatStone)),this.viewActions=new en(this)}(V.GameState=s).__name__="GameState",s.__isInterface__=!0,s.prototype={__class__:s},(V.City=g).__name__="City",g.__interfaces__=[s],g.prototype={get_publicGUI:function(){return this.gui},get_displayWidth:function(){return Math.floor(this.game.rect.width*this.game.scaling/this.zoomScale)},get_displayHeight:function(){return Math.floor(this.game.rect.height*this.game.scaling/this.zoomScale)},set_pauseGame:function(t){return this.pauseGame=t,this.gui.pausedForWindow=!1,this.pauseGame},get_usingParticleContainers:function(){return!this.game.isMobile},enableDisplayOnly:function(){this.displayOnly=!0},disableDisplayOnlyMode:function(t){this.displayOnly=!1,this.guiStage.visible=!0,null!=t&&(this.cityFile=t)},setHoverHightlight:function(t,e){var i=0,n=0;this.hoverHighlightSetThisStep&&(i=this.hoverHighlightStage.children.length,n=this.hoverHighlightStage2.children.length);for(var s=0,r=this.permanents;s<r.length;){var o=r[s];++s;var a,l=t(o);null!=l&&(i>=this.hoverHighlightStage.children.length&&this.hoverHighlightStage.addChild(new PIXI.Sprite),(a=this.hoverHighlightStage.children[i]).position.set(o.position.x-1,o.position.y-1),a.texture=l,a.alpha=.5+(Math.sin(this.gui.guiTimer/10)+1)/4,++i,n>=this.hoverHighlightStage2.children.length&&this.hoverHighlightStage2.addChild(new PIXI.Sprite),(a=this.hoverHighlightStage2.children[n]).position.set(o.position.x-1,o.position.y-1),a.texture=H.getTexture("spr_whiteoutline"),a.tint=e,a.alpha=1,++n)}i<this.hoverHighlightStage.children.length&&this.hoverHighlightStage.removeChildren(i),n<this.hoverHighlightStage2.children.length&&this.hoverHighlightStage2.removeChildren(n),this.hoverHighlightSetThisStep=!0},updateDrawCachingRectSize:function(){var t=new xn(0,0,1024,1024);0<this.worlds.length&&(t=new xn(vn.min(this.worlds,function(t){return t.rect.x}).rect.x,vn.max(this.worlds,function(t){return t.rect.get_y2()}).rect.get_y2()-2040,2046,2046)),this.cityStage.cacheWithinRect=t,this.cityBgStage.cacheWithinRect=t,this.cityMidStage.cacheWithinRect=t,this.cityBgStageBelow.cacheWithinRect=t},stop:function(){this.displayOnly||this.saveToBrowserStorage(),this.simulation.stop();for(var t=0,e=this.worlds;t<e.length;){var i=e[t];++t,i.cleanup()}this.cityStage.removeCache(),this.cityBgStage.removeCache(),this.cityMidStage.removeCache(),this.cityBgStageBelow.removeCache()},pause:function(){this.pauseGame||(this.pausedForUnfocused=!0,this.set_pauseGame(!0))},resume:function(){this.pauseGame&&this.pausedForUnfocused&&(this.pausedForUnfocused=!1,this.set_pauseGame(!1))},handleMouse:function(t){if(this.progress.handleMouse(t))return!0;if(this.displayOnly||this.pauseGame&&this.pausedForUnfocused)return!1;this.pauseGame&&!this.gui.pausedForWindow||this.displayOnly||-1!=this.gui.windowStackMeta.indexOf("GameMenu")||!t.pressed||Fn.reportStartGameplay();var e=!1;if(!this.cityView.isDraggingView){if(this.gui.handleMouse(t))return!0;if(this.cityView.handleScrollbarZoom(t),e=!0,this.cityView.handleEarlyMouse(t))return!0;if(!this.isLoserState){if(this.simulation.handleMouse(t))return!0;if(null!=this.builder&&this.builder.handleMouse(t))return!0;for(var i=0,n=this.worlds;i<n.length;){var s=n[i];if(++i,s.handleMouse(t))return!0}}if(t.pressed&&t.disableCityMovement&&(t.disableCityMovement=!1),this.cityView.handleMouse(t))return!0}return e||this.cityView.handleScrollbarZoom(t),t.releaseAllClaims(),!1},update:function(t){this.game.mouse.rightPressed&&this.buildingMode==E.Destroy&&(this.buildingMode=E.Normal,null!=this.specialActionOld&&this.specialActionOld.activate()),this.pauseGame&&this.pausedForUnfocused||this.displayOnly||!this.game.keyboard.pressed[32]&&!this.game.keyboard.pressed[b.getLetterCode("P")]||(this.set_pauseGame(!this.pauseGame),this.pauseGame&&Fn.reportStopGameplay()),this.pauseGame&&!this.gui.pausedForWindow||this.displayOnly||-1!=this.gui.windowStackMeta.indexOf("GameMenu")||!this.game.keyboard.anyKey()||Fn.reportStartGameplay();for(var e=this.pauseGame?0:.6666666666666666*this.simulationSpeed,i=0,n=this.worlds;i<n.length;){var s=n[i];++i,s.update(t*e)}this.particles.update(t*e),null!=this.builder?this.builder.update(t):this.game.isMobile&&this.builderHighlightStage.removeChildren(),this.displayOnly||this.gui.update(t);var r=Math.ceil(e/1.67);this.cityCullX=this.viewPos.x-this.get_displayWidth()/2-5,this.cityCullY=this.viewPos.y-this.get_displayHeight()/2+5,this.cityCullX2=this.cityCullX+this.get_displayWidth()+10,this.cityCullY2=this.cityCullY+this.get_displayHeight()+10;for(i=0,n=r;i<n;){i++;this.simulation.update(t*(e/r))}if(this.simulation.prevTimeMod=t*e,0==r&&this.simulation.updateWhilePaused(),this.stars.update(),this.progress.update(t),this.displayOnly||bn.cityUpdate(this,this.game.mouse),this.displayOnly||(this.cityView.handleMouseMovement(t),this.cityView.handleKeyboardMove(t)),this.displayOnly||this.handleAutoSave(t),this.displayOnly||this.gui.lateUpdate(),this.updateConnectedBuildingSprites){for(i=0,n=this.permanents;i<n.length;){var o=n[i];++i,o.isBuilding&&o.drawer.positionSpritesMerging()}this.updateConnectedBuildingSprites=!1}var a=new Pn(this.viewPos.x-this.get_displayWidth()/2-1,this.viewPos.y-this.get_displayHeight()/2-1,this.get_displayWidth()+2,this.get_displayHeight()+2);null!=this.previousCullRectangle&&this.previousCullRectangle.x==a.x&&this.previousCullRectangle.y==a.y&&this.previousCullRectangle.width==a.width&&this.previousCullRectangle.height==a.height||(this.simulation.recomputeCull(),this.previousCullRectangle=a.clone()),this.cityBgStage.preDraw(a),this.cityStage.preDraw(a),this.cityMidStage.preDraw(a),this.cityBgStageBelow.preDraw(a),this.aboveCitizensInBuildingStage.preDraw(a),this.trainStage.preDraw(a)},uncull:function(){this.cityBgStage.uncull(),this.cityStage.uncull(),this.cityMidStage.uncull(),this.cityBgStageBelow.uncull(),this.aboveCitizensInBuildingStage.uncull(),this.trainStage.uncull(),this.simulation.uncull()},postDraw:function(){this.simulation.lateUpdate(),this.furtherForegroundTempStage.removeChildren(),this.hoverHighlightSetThisStep?this.hoverHighlightSetThisStep=!1:(this.hoverHighlightStage.removeChildren(),this.hoverHighlightStage2.removeChildren())},resize:function(){this.displayOnly&&(this.zoomScale=this.game.scaling);var t=this.zoomScale,t=this.zoomScale%1<.001||.999<this.zoomScale%1?Math.round(this.zoomScale):this.zoomScale;this.sky.scale.x=this.sky.scale.y=t,this.starStage.scale.x=this.starStage.scale.y=t,this.starStage.position.set(t*(this.get_displayWidth()-this.stars.maxStarX)/2,t*(this.get_displayHeight()-this.stars.maxStarY)/2),this.movingViewStage.scale.x=this.movingViewStage.scale.y=t,this.cityView.updateMovingView(),this.gui.resize(),this.stars.resize(),this.simulation.time.updateSky()},refocus:function(){this.game.isMobile&&(this.cityStage.isInvalid=!0,this.cityMidStage.isInvalid=!0,this.cityBgStage.isInvalid=!0,this.cityBgStageBelow.isInvalid=!0)},updateSky:function(t){this.sky.clear(),this.skyColor=t,this.sky.beginFill(t),this.sky.drawRect(0,0,this.get_displayWidth()+1,this.get_displayHeight()+1),this.sky.endFill()},getCityEdges:function(){for(var t=0,e=0,i=0,n=1,s=0,r=this.worlds;s<r.length;){var o,a=r[s];++s,0!=a.rect.height&&((o=a.rect.x)<t&&(t=o),e<(o=a.rect.get_x2())&&(e=o),(o=a.rect.y-20*vn.max(a.permanents,function(t){return t.length}).length)<i&&(i=o),n<(a=a.rect.get_y2())&&(n=a))}return{minX:t,maxX:e,minY:i,maxY:n}},getPermanentAtPos:function(t,e){for(var i=0,n=this.worlds;i<n.length;){var s=n[i];++i;var r=s.permanents,o=s.rect.y-(e+1),a=(t-s.rect.x)/20|0,o=o<0?-1:o/20|0;if(0<=a&&a<r.length){a=s.permanents[a];if(0<=o&&o<a.length)return a[o]}}return null},fixViewBottom:function(t){this.fixViewBottomYOn=t},createOrRemoveBuilder:function(t,e,i,n){null==n&&(n=!1),null==i&&(i=0),null==e&&(e=!1);var s,r,o,a=!1;null==this.builder||this.builder.get_buildingToBuild()!=t||this.builder.decorationAppearance!=i?(null!=this.builder&&(a=this.builder.isCacheValid()),o=this.progress.resources.buildingInfo,r=t.__name__,s=o.h[r],o=!1,null!=this.builder&&(0==(r=this.builder.builderType)._hx_index&&(r.buildingType,r=r.buildingInfo,o=-1!=s.specialInfo.indexOf("rooftop")==(-1!=r.specialInfo.indexOf("rooftop"))),this.builder.cancel()),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new T(this,this.builderStage,l.Building(t,s),i,n),o&&a&&this.builder.prevalidateCache(),null!=this.postCreateBuilder&&this.postCreateBuilder()):e||this.builder.cancel()},createOrRemoveDecorationBuilder:function(t){var e;null!=this.builder&&(1==(e=this.builder.builderType)._hx_index?e.decorationInfo.name:"")==t.name?this.builder.cancel():(null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new T(this,this.builderStage,l.Decoration(t),0,!1),null!=this.postCreateBuilder&&this.postCreateBuilder())},createOrRemoveWorldResourceBuilder:function(t){var e;null!=this.builder&&(2==(e=this.builder.builderType)._hx_index?e.resourceInfo:null)==t?this.builder.cancel():(null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new T(this,this.builderStage,l.WorldResource(t),0,!1),null!=this.postCreateBuilder&&this.postCreateBuilder())},createWorldResourceBuilderMove:function(t){null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(),this.builder=new T(this,this.builderStage,l.MoveWorldResource(t),0,!1),null!=this.postCreateBuilder&&this.postCreateBuilder()},activateSpecialCityAction:function(t){null!=this.builder&&this.builder.cancel(),null!=this.specialAction&&this.specialAction.deactivate(!0),this.specialAction=t,this.specialAction.activate()},findPermanentByID:function(t){return this.permanentsByID.h[t]},handleAutoSave:function(t){this.secondsSinceAutoSave+=t/60,1.95<this.secondsSinceAutoSave&&!this.currentlySaving&&!this.isLoserState&&this.saveToBrowserStorage(this.cityFile)},saveToBrowserStorage:function(t){var e=this;null==t&&(t=this.cityFile);var i=this.saveToUIntArray();this.currentlySaving=!0,On.setItem(t,i,function(){e.secondsSinceAutoSave=0,e.currentlySaving=!1}),En.saveMetaData(t,this)},saveToString:function(){return this.save().toBase64()},saveToUIntArray:function(){return this.save().getData()},save:function(){var e=new Ln(this.saveRawDataToReuse);e.size+4>e.bytes.length&&(t=e.bytes,i=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=i,e.bytes.blit(0,t,0,e.size)),e.bytes.setInt32(e.size,-1234),e.size+=4,e.addString(this.progress.story.storyName),e.size+4>e.bytes.length&&(t=e.bytes,i=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=i,e.bytes.blit(0,t,0,e.size)),e.bytes.setInt32(e.size,42),e.size+=4,e.size+4>e.bytes.length&&(t=e.bytes,i=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=i,e.bytes.blit(0,t,0,e.size)),e.bytes.setInt32(e.size,0),e.size+=4,R.saveToCitySave(e);var t,i,n=this.worlds.length;return e.size+4>e.bytes.length&&(t=e.bytes,i=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=i,e.bytes.blit(0,t,0,e.size)),e.bytes.setInt32(e.size,n),e.size+=4,tt.iter(this.worlds,function(t){t.save(e)}),this.progress.save(e),this.simulation.save(e),this.saveBasics(e),this.materials.save(e),this.upgrades.save(e),this.policies.save(e),e.size+4>e.bytes.length&&(t=e.bytes,i=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=i,e.bytes.blit(0,t,0,e.size)),e.bytes.setInt32(e.size,0),e.size+=4,this.saveRawDataToReuse=e.bytes,e},createBottomWorld:function(){var t=this.getCityEdges();this.worlds.push(new K(this.game,this,this.cityStage,this.cityMidStage,this.cityBgStage,new xn(t.minX-20,t.maxY+40,t.maxX-t.minX,0),0))},activateLoserState:function(){null!=this.builder&&this.builder.cancel(),this.set_pauseGame(!0),this.gui.activateLoserState(),this.isLoserState=!0},load:function(t){-1234==t.bytes.getInt32(t.readStart)&&(e=t.bytes.getInt32(t.readStart),t.readStart+=4,t.readString());var e=t.bytes.getInt32(t.readStart);t.readStart+=4,t.version=e,36<=t.version&&Dr._performOnLoadEarly(this,t),14<=t.version&&R.loadFromCitySave(t);e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;this.worlds.push(K.fromLoad(t,this.game,this,this.cityStage,this.cityMidStage,this.cityBgStage))}t.version<24&&this.createBottomWorld(),this.updateDrawCachingRectSize(),this.progress.load(t),this.simulation.load(t),this.loadBasics(t),this.materials.load(t),4<=t.version&&this.upgrades.load(t),34<=t.version&&this.policies.load(t),35<=t.version&&Dr._performOnLoad(this,t),this.cityView.updateMovingViewStagePosition(),this.connections.updateCityConnections(),this.simulation.updatePathfinder(!1),this.resize();for(i=0,n=this.permanents;i<n.length;){var s=n[i];++i,s.postCreate()}this.simulation.afterLoad(),t.version<38&&0<this.teleporters.length&&this.gui.showSimpleWindow(kn.lo("welcome_back_teleporter_warning"),kn.lo("update_notice")),this.gui.refreshCityInfo()},getAmountOfPermanentsPerType:function(){if(null!=this.permanentNumberCached)return this.permanentNumberCached;for(var t=new zr,e=0,i=this.permanents;e<i.length;){var n=i[e];++e;var s=Fr.getClass(n).__name__;Object.prototype.hasOwnProperty.call(t.h,s)?(n=t.h[s]+1,t.h[s]=n):t.h[s]=1}return this.permanentNumberCached=t},cheatMaterials:function(){this.materials.add(new M(1e4,1e4,1e4,1e4,1e4,1e4,1e4))},cheatMaterialsZero:function(){this.materials.remove(this.materials)},cheatFood:function(t){this.materials.set_food(t)},cheatWood:function(t){this.materials.wood=t},cheatStone:function(t){this.materials.stone=t},cheatPeople:function(){for(var t=0;t<100;){t++;for(var e=this.simulation,i=[],n=0,s=this.worlds;n<s.length;){var r=s[n];++n,vn.any(this.simulation.citizens,function(e){return function(t){return t.onWorld==e[0]}}([r]))&&i.push(r)}e.createCitizen(i[0],20,null,0)}},cheatUnlocks:function(){for(var t=zr.valueIterator(H.buildingInfo.h);t.hasNext();){var e=t.next(),i="buildings."+e.className;this.progress.unlocks.unlock(V[i]);e="buildings."+e.className;this.progress.unlocks.fullyUnlock(V[e])}},onContextRestored:function(){this.cityStage.isInvalid=!0,this.cityMidStage.isInvalid=!0,this.cityBgStage.isInvalid=!0,this.cityBgStageBelow.isInvalid=!0,this.get_usingParticleContainers()&&(Vn.recreateContainer(this.citizenInBuildingStage),Vn.recreateContainer(this.citizenForegroundStage))},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(g.saveDefinition);e=this.maxPermanentID;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,t.addFPoint(this.viewPos);var i,e=this.zoomScale;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8,t.addString(this.cityName)},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"maxPermanentID")&&(this.maxPermanentID=t.h.maxPermanentID),Object.prototype.hasOwnProperty.call(t.h,"viewPos")&&(this.viewPos=t.h.viewPos),Object.prototype.hasOwnProperty.call(t.h,"zoomScale")&&(this.zoomScale=t.h.zoomScale),Object.prototype.hasOwnProperty.call(t.h,"cityName")&&(this.cityName=t.h.cityName)},__class__:g};var a=function(t,e,i,n){this.infrequentUpdateStart=0,this.adultTextures=[],this.childrenTextures=[],this.citizens=[],this.city=t,this.foregroundStage=e,this.inBuildingStageNonParticle=n,this.inBuildingStage=i,this.time=new u(t,this),this.childrenTextures=H.getTexturesByWidth("spr_children",2),this.adultTextures=H.getTexturesByWidth("spr_humans",2),this.jobAssigner=new Lo(t,this),this.houseAssigner=new Uo(t,this),this.schoolAssigner=new No(t,this),this.pathfinder=new Er(t),this.permanentFinder=new Nr(t),this.routeFinder=new Xr(t),this.flyingPathfinder=new Ur(t),this.happiness=new Do(t,this),this.babyMaker=new So(t,this),this.stats=new Xo(t,this),this.bonuses=new xo,this.flyingSaucers=[],this.trainsByBuildingLeft=new Mr,this.trainsByBuildingRight=new Mr,this.trains=[],this.citizenSpawners=[],this.eating=new Mo(this),this.resourcePriorityManager=new Ho(t),this.fishes=new Wo(this),this.buildingUpgradesToUpdate=[],_.isLoading?this.possibleCitizenHobbies=[]:this.initPossibleHobbies(),this.boostManager=new Co(this),this.festivalManager=new ea(t,this),this.citizenUpdater=new Bo(this),this.operatingCost=new Eo(t)};(V.CitySimulation=a).__name__="CitySimulation",a.prototype={recalculateOperatingCosts:function(){this.operatingCost.recalculate()},stop:function(){this.pathfinder.terminate()},initPossibleHobbies:function(){this.possibleCitizenHobbies=[{hobbyClass:jo,minimumCitizenAmount:1},{hobbyClass:$o,minimumCitizenAmount:2},{hobbyClass:Zo,minimumCitizenAmount:5},{hobbyClass:qo,minimumCitizenAmount:6},{hobbyClass:Ko,minimumCitizenAmount:12},{hobbyClass:Qo,minimumCitizenAmount:18},{hobbyClass:Jo,minimumCitizenAmount:24},{hobbyClass:Yo,minimumCitizenAmount:35},{hobbyClass:Vo,minimumCitizenAmount:80}]},update:function(t){var e=((0|this.time.timeSinceStart)/60|0)%24;this.time.update(t),23<=e&&((0|this.time.timeSinceStart)/60|0)%24<1&&this.stats.midnightUpdate(),this.stats.update(t),this.permanentFinder.preUpdate(),this.pathfinder.distributePaths();for(var i=this.flyingSaucers.length;0<=--i;)this.flyingSaucers[i].update(t);for(i=this.trains.length;0<=--i;);for(i=this.citizenSpawners.length;0<=--i;)this.citizenSpawners[i].update(t);if(this.festivalManager.update(t),0<this.citizens.length){if(this.festivalManager.hasFestival()?this.festivalManager.updateFestivalCitizens(t):this.citizenUpdater.update(t),e<12&&12<=((0|this.time.timeSinceStart)/60|0)%24)for(var n=0,s=this.citizens;n<s.length;){var r=s[n];++n,r.midDayUpdate()}for(var o=this.citizens.length,e=Math.ceil(this.infrequentUpdateStart+this.citizens.length/60),i=e<o?e:o,a=Math.ceil(this.infrequentUpdateStart);--i>=a;)this.citizens[i].infrequentUpdate();this.infrequentUpdateStart+=this.citizens.length/60,this.infrequentUpdateStart>=this.citizens.length&&(this.infrequentUpdateStart=0)}this.fishes.update(t),this.babyMaker.update(t),this.pathfinder.requestAllPaths();for(n=0,s=this.city.permanents;n<s.length;){var l=s[n];++n,l.update(t)}for(n=0,s=this.buildingUpgradesToUpdate;n<s.length;){var h=s[n];++n,h.update(t)}this.boostManager.update(t),this.operatingCost.update(t)},lateUpdate:function(){var t=this.prevTimeMod;this.jobAssigner.assignJobs(),this.schoolAssigner.assignSchools(),this.houseAssigner.assignHouses(),this.happiness.update(t),this.eating.update(t)},updateWhilePaused:function(){this.stats.update(0),this.boostManager.update(0);for(var t=this.prevTimeMod=0,e=this.citizens;t<e.length;){var i=e[t];++t,i.actuallyUpdateDraw()}},recomputeCull:function(){for(var t=0,e=this.citizens;t<e.length;){var i=e[t];++t,i.updateCull()}},createCitizen:function(t,e,i,n){null==e&&(e=0);var s=this;null==n&&(n=null==i?bo.getInt(t.rect.width-2):bo.getInt(20));e=new I(this.city,this,this.foregroundStage,this.inBuildingStage,this.inBuildingStageNonParticle,this.adultTextures,this.childrenTextures,t,n,e,i);this.citizens.push(e);function r(t){return s.citizens.length>=t.minimumCitizenAmount}if(0<this.possibleCitizenHobbies.length&&vn.any(this.possibleCitizenHobbies,r)&&("cityofthekey"!=this.city.progress.story.storyName||100<this.citizens.length)){for(var o=[],a=0,l=this.possibleCitizenHobbies;a<l.length;){var h=l[a];++a,r(h)&&o.push(h)}i=bo.fromArray(o);e.setHobby(X.createInstance(i.hobbyClass,[e])),Y.remove(this.possibleCitizenHobbies,i)}return e},updatePathfinder:function(t,e){if(t){this.pathfinder.invalidateAllPaths();for(var i=0,n=this.citizens;i<n.length;){var s,r=n[i];++i,null==r.path||null!=r.pathOnlyRelatedTo&&null!=e&&e!=r.pathOnlyRelatedTo||(null==(s=!1)&&(s=!0),r.recyclePathArray&&(io.returnToPool(r.path),r.recyclePathArray=!1),r.path=null,r.nextPathPos=-1,r.pathEnd=-1,r.currentPathAction=null,s&&(r.canViewSelfInBuilding||(r.delayCanViewSelfInBuilding=!0),r.canViewSelfInBuilding=!0),r.verticalPathProgress=0,r.pathEndFunction=null,r.requestingPathGoal=null,r.pathOnlyRelatedTo=null,r.pathWalkSpeed=1,r.pathCanBeReconsidered=!0,0<r.sprite.alpha&&r.sprite.alpha<1&&(r.sprite.alpha=1),r.actuallyUpdateDraw())}for(i=0,n=this.city.permanents;i<n.length;){var o=n[i];++i,o.invalidatePathfindingRelatedInfo()}this.permanentFinder.invalidatePathfindingRelatedInfo(),this.permanentFinder.requestQueryLimiting(!0)}for(i=0,n=this.city.permanents;i<n.length;){o=n[i];++i,o.onCityChange()}for(i=0,n=this.city.permanents;i<n.length;){o=n[i];++i,o.onCityChangePost()}for(i=0,n=this.city.worlds;i<n.length;){var a=n[i];++i,a.onCityChange()}for(i=0,n=this.fishes.fishes;i<n.length;){var l=n[i];++i,l.inPermanent!=e&&l.pushBackIntoPermanent()}this.city.permanentNumberCached=null,this.pathfinder.sendPathfindingInfo(),this.recalculateOperatingCosts()},handleMouse:function(t){var e=null!=this.city.specialAction&&"FollowCitizenAction"==this.city.specialAction.get_specialActionID();if(this.city.game.keyboard.down[17]||e)switch(t.claimMouse(this,null,!1)._hx_index){case 0:return!0;case 1:var i=null,n=null,s=10;this.city.game.isMobile&&(s=25);for(var r=0,o=this.citizens;r<o.length;){var a=o[r];++r;var l=(d=a.getCityPosition()).x+1-t.get_cityX(),h=d.y-3-t.get_cityY();(c=Math.sqrt(l*l+h*h))<s&&(s=c,i=a)}for(r=0,o=this.fishes.fishes;r<o.length;){var u=o[r];++r;var d,c,l=(d=u.getCityPosition()).x-t.get_cityX(),h=d.y-t.get_cityY();(c=Math.sqrt(l*l+h*h))<s&&(s=c,i=null,n=u)}return null!=n?(n.onClick(),this.city.game.audio.playSound(this.city.game.audio.followCitizenSound),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)):null!=i&&(i.onClick(),this.city.game.audio.playSound(this.city.game.audio.followCitizenSound),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)),!0;case 2:return e}return!1},save:function(e){this.time.save(e);var t=this.citizenSpawners.length;e.size+4>e.bytes.length&&(u=e.bytes,d=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=d,e.bytes.blit(0,u,0,e.size)),e.bytes.setInt32(e.size,t),e.size+=4,tt.iter(this.citizenSpawners,function(t){t.save(e)}),e.addString(I.saveDefinition);t=this.citizens.length;e.size+4>e.bytes.length&&(u=e.bytes,d=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=d,e.bytes.blit(0,u,0,e.size)),e.bytes.setInt32(e.size,t),e.size+=4;for(var i=0,n=this.citizens;i<n.length;){var s=n[i];++i;t=this.city.worlds.indexOf(s.onWorld);e.size+4>e.bytes.length&&(u=e.bytes,d=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=d,e.bytes.blit(0,u,0,e.size)),e.bytes.setInt32(e.size,t),e.size+=4,s.save(e,!1);var r=null!=s.inPermanent?s.inPermanent.id:-1;e.size+4>e.bytes.length&&(o=e.bytes,a=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=a,e.bytes.blit(0,o,0,e.size)),e.bytes.setInt32(e.size,r),e.size+=4;var o,a=null==s.job?-1:s.job.id;e.size+4>e.bytes.length&&(o=e.bytes,r=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=r,e.bytes.blit(0,o,0,e.size)),e.bytes.setInt32(e.size,a),e.size+=4;a=null==s.home?-1:s.home.id;e.size+4>e.bytes.length&&(l=e.bytes,h=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=h,e.bytes.blit(0,l,0,e.size)),e.bytes.setInt32(e.size,a),e.size+=4;var l,h=null==s.school?-1:s.school.id;e.size+4>e.bytes.length&&(l=e.bytes,a=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=a,e.bytes.blit(0,l,0,e.size)),e.bytes.setInt32(e.size,h),e.size+=4}this.happiness.save(e),this.bonuses.save(e),this.jobAssigner.save(e),this.eating.save(e),this.stats.save(e);for(i=0,n=this.citizens.length;i<n;){var u,d,c=i++,p=this.citizens[c];null!=p.hobby&&(e.size+4>e.bytes.length&&(u=e.bytes,d=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=d,e.bytes.blit(0,u,0,e.size)),e.bytes.setInt32(e.size,c),e.size+=4,s=Fr.getClass(p.hobby),e.addString(s.__name__))}e.size+4>e.bytes.length&&(u=e.bytes,d=new br(new ArrayBuffer(2*(e.size+4))),e.bytes=d,e.bytes.blit(0,u,0,e.size)),e.bytes.setInt32(e.size,-1),e.size+=4,this.babyMaker.save(e),this.resourcePriorityManager.save(e),this.boostManager.save(e),this.houseAssigner.save(e),this.fishes.save(e),this.festivalManager.save(e),this.operatingCost.save(e)},load:function(t){this.time.load(t);var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){var s=i++;this.citizenSpawners.push(Go.fromLoad(t,this.city.simulation,this.city.farForegroundStage))}var r=t.readString(),e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(i=0,n=e;i<n;){var s=i++,o=this.city.worlds,e=t.bytes.getInt32(t.readStart);t.readStart+=4;var a=this.createCitizen(o[e]);a.load(t,r);o=t.bytes.getInt32(t.readStart);t.readStart+=4,-1!=o&&(a.inPermanent=this.city.findPermanentByID(o));o=t.bytes.getInt32(t.readStart);t.readStart+=4,-1!=o?(a.job=this.city.findPermanentByID(o),null!=a.job&&a.job.is(Jt)?a.job.workers.push(a):(a.job=null,16<a.get_age()&&this.jobAssigner.citizensWithoutJob.push(a))):16<a.get_age()&&this.jobAssigner.citizensWithoutJob.push(a);o=t.bytes.getInt32(t.readStart);t.readStart+=4,-1!=o&&(a.home=this.city.findPermanentByID(o),null!=a.home&&a.home.is(Yt)?a.home.residents.push(a):a.home=null);o=t.bytes.getInt32(t.readStart);t.readStart+=4,-1!=o&&(a.school=this.city.findPermanentByID(o),null!=a.school&&a.school.is(bi)?a.school.students.push(a):a.school=null),a.afterLoadingInPermanent()}if(this.jobAssigner.buildingsHaveWork=!0,this.houseAssigner.shouldUpdateHouses=!0,this.schoolAssigner.schoolsShouldBeUpdated=!0,this.happiness.load(t),this.bonuses.load(t),this.jobAssigner.load(t),this.eating.load(t),2<=t.version&&this.stats.load(t),3<=t.version)for(this.initPossibleHobbies();;){e=t.bytes.getInt32(t.readStart);if(t.readStart+=4,-1==(s=e))break;var l=t.readString(),l=[V[l]];this.citizens[s].setHobby(X.createInstance(l[0],[this.citizens[s]])),Y.remove(this.possibleCitizenHobbies,tt.find(this.possibleCitizenHobbies,function(e){return function(t){return t.hobbyClass==e[0]}}(l)))}9<=t.version&&this.babyMaker.load(t),10<=t.version&&this.resourcePriorityManager.load(t),16<=t.version&&this.boostManager.load(t),17<=t.version&&this.houseAssigner.load(t),19<=t.version&&this.fishes.load(t),21<=t.version&&this.festivalManager.load(t),37<=t.version&&this.operatingCost.load(t),this.time.lastLoadTime=this.time.timeSinceStart},afterLoad:function(){this.festivalManager.afterLoad()},uncull:function(){for(var t=0,e=this.citizens;t<e.length;){var i=e[t];++t,i.uncull()}},__class__:a};var u=function(t,e){this.skyColors=[{color:2626656,time:0},{color:2626656,time:4},{color:12541833,time:6},{color:12541833,time:6.5},{color:11389183,time:8.5},{color:11389183,time:11},{color:12247804,time:13},{color:12247804,time:17},{color:8872356,time:20.5},{color:8872356,time:21},{color:2626656,time:23},{color:2626656,time:24}],this.showTimeBasedAdOnNextInput=!1,this.lastLoadTime=0,this.minutesPerTick=.5,this.city=t,this.simulation=e,this.timeSinceStart=120,this.shownTimeBasedAdThisCycle=!0};(V.CityTime=u).__name__="CityTime",u.getBasicTimeString=function(t){return 2880<t?kn.lo("n_days",[Math.floor(t/1440)]):1440<t?kn.lo("one_day"):60<t?kn.lo("n_hours",[Math.floor(t/60)]):kn.lo("one_hour")},u.prototype={update:function(t){var e=this;this.timeSinceStart+=t*this.minutesPerTick,this.updateSky(),this.showTimeBasedAdOnNextInput?this.city.game.onClick=function(){bn.showNonRewardedInterstitialIfAllowed(),e.showTimeBasedAdOnNextInput=!1}:((0|this.timeSinceStart)/60|0)%24==5?this.shownTimeBasedAdThisCycle||(this.showTimeBasedAdOnNextInput=!0,this.shownTimeBasedAdThisCycle=!0):this.shownTimeBasedAdThisCycle&&(this.shownTimeBasedAdThisCycle=!1),(23<this.timeSinceStart/60%24||this.timeSinceStart/60%24<4)&&this.city.progress.story.get_speedUpStartNights()&&(1+((0|this.timeSinceStart)/1440|0)==1||1+((0|this.timeSinceStart)/1440|0)==2||1+((0|this.timeSinceStart)/1440|0)==3&&this.timeSinceStart/60%24<4?this.timeSinceStart+=t*this.minutesPerTick*2.75:1+((0|this.timeSinceStart)/1440|0)==3?this.timeSinceStart+=t*this.minutesPerTick:1+((0|this.timeSinceStart)/1440|0)==4&&(this.timeSinceStart+=t*this.minutesPerTick*.5))},updateSky:function(){var t=this.getCurrentColor(this.skyColors);null!=t&&this.city.updateSky(t)},getCurrentColor:function(t){for(var e=function(t){return{r:t/65536|0,g:(t/256|0)%256,b:t%256}},i=0,n=t.length;i<n;){var s=i++,r=t[s],o=t[1+s];if(this.timeSinceStart/60%24<o.time){var a=e(r.color),l=e(o.color),s=(this.timeSinceStart/60%24-r.time)/(o.time-r.time),o=a.r,r=a.g,a=a.b;return 256*(o+s*(l.r-o)|0)*256+256*(r+s*(l.g-r)|0)+(a+s*(l.b-a)|0)}}return null},save:function(t,e){null==e&&(e=!0),e&&t.addString(u.saveDefinition);var i=this.timeSinceStart;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"timeSinceStart")&&(this.timeSinceStart=t.h.timeSinceStart)},__class__:u};var d=function(t){this.remZoomScrollBarMovement=0,this.isDraggingViewTwoPointer=!1,this.isDraggingView=!1,this.city=t,this.dragPreviousMousePos=new In(0,0),this.dragDir=new In(0,0),this.dragDirRemaining=new In(0,0),this.dragPointerIdentifiers=[0,1],this.dragPreviousCityPointerPositions=[null,null],this.dragInitialPointerPositions=[null,null]};(V.CityView=d).__name__="CityView",d.prototype={get_game:function(){return this.city.game},handleEarlyMouse:function(t){return!(!t.weakClaimForScroll("doCityViewScroll")||t.disableCityMovement)&&(this.startViewDrag(),!0)},handleMouse:function(t){if((isNaN(this.city.viewPos.x)||isNaN(this.city.viewPos.y))&&(this.city.viewPos.x=0,this.city.viewPos.y=0),!this.isDraggingView&&!t.disableCityMovement){if(t.down)return this.startViewDrag(),!0;if(2<=t.pointerDown.length)return this.startViewDrag(),!0}return!1},handleKeyboardMove:function(t){var e=0,i=0,n=2+12/this.city.zoomScale;this.get_game().keyboard.down[37]&&(e-=n*t),this.get_game().keyboard.down[39]&&(e+=n*t),this.get_game().keyboard.down[38]&&(i-=n*t),this.get_game().keyboard.down[40]&&(i+=n*t),0==e&&0==i||(this.city.viewPos.x+=e,this.city.viewPos.y+=i,this.updateMovingView()),(this.get_game().keyboard.pressed[187]||this.get_game().keyboard.pressed[61])&&this.zoomIn(),(this.get_game().keyboard.pressed[189]||this.get_game().keyboard.pressed[173])&&this.zoomOut()},updateMovingView:function(){var t=this.city.getCityEdges(),e=t.minX,i=t.maxX,n=t.minY,s=t.maxY,t=this.city.viewPos.x-this.get_game().addX;this.city.viewPos.x=(t<e?e:i<t?i:t)+this.get_game().addX,t=null==this.city.fixViewBottomYOn?((t=this.city.viewPos.y-this.get_game().addY)<n?n:s<t?s:t)+this.get_game().addY:this.city.fixViewBottomYOn-(this.get_game().rect.height/2|0)+this.get_game().addY,this.city.viewPos.y=t,this.updateMovingViewStagePosition()},updateMovingViewStagePosition:function(){this.city.viewIsControlled?this.city.movingViewStage.position.set((-this.city.viewPos.x+this.get_game().addX)*this.city.zoomScale+(this.get_game().rect.width/2|0)*this.get_game().scaling,(-this.city.viewPos.y+this.get_game().addY)*this.city.zoomScale+this.get_game().scaling*(this.get_game().rect.height/2|0)):this.city.movingViewStage.position.set(Math.floor((-this.city.viewPos.x+this.get_game().addX)*this.city.zoomScale+(this.get_game().rect.width/2|0)*this.get_game().scaling),Math.floor((-this.city.viewPos.y+this.get_game().addY)*this.city.zoomScale+this.get_game().scaling*(this.get_game().rect.height/2|0)))},handleMouseMovement:function(t){var e=this,i=this.get_game().mouse;if(!this.city.viewIsControlled||2<=i.pointerDown.length){if(i.middlePressed)this.city.viewIsControlled||this.startViewDrag();else if(this.isDraggingView){var n=2<=i.pointerDown.length;if(0!=i.pointerDown.length||i.middleDown||i.down)if(n!=this.isDraggingViewTwoPointer)this.startViewDrag();else if(this.isDraggingViewTwoPointer)if(vn.any(i.pointerDown,function(t){return-1==e.dragPointerIdentifiers.indexOf(t)})||vn.any(this.dragPointerIdentifiers,function(t){return-1==i.pointerDown.indexOf(t)}))this.startViewDrag();else{for(var s=[],r=0,o=this.dragPointerIdentifiers.length;r<o;){var a=r++;s.push(null)}for(var l=s,s=[],r=0,o=this.dragPointerIdentifiers.length;r<o;){a=r++;s.push(null)}for(var h=s,s=0,r=this.dragPointerIdentifiers.length;s<r;)l[a=s++]=i.pointerCityPosition.h[this.dragPointerIdentifiers[a]],h[a]=i.pointerPosition.h[this.dragPointerIdentifiers[a]];if(-1!=l.indexOf(null))this.startViewDrag();else{var u=vn.sumFPoint(h),d=1/l.length,c=new In(u.x*d,u.y*d),u=vn.sumFPoint(this.dragInitialPointerPositions),d=1/this.dragInitialPointerPositions.length,p=new In(u.x*d,u.y*d),g=Math.max(1,vn.sum(h,function(t){return In.distance(c,new In(t.x,t.y))}))/Math.max(1,vn.sum(this.dragInitialPointerPositions,function(t){return In.distance(p,new In(t.x,t.y))}))*this.originalTwoFingerDragZoom,m=this.get_game().scaling/2,n=Math.floor(m<1?1:2<m?2:m),m=this.get_game().scaling/2*7;if(this.setZoom(g<n?n:m<g?m:g,i),!this.city.viewIsControlled){for(s=0,r=this.dragPointerIdentifiers.length;s<r;)l[a=s++]=i.pointerCityPosition.h[this.dragPointerIdentifiers[a]];var u=vn.sumFPoint(l),d=1/l.length,f=u.x*d,y=u.y*d,u=vn.sumFPoint(this.dragPreviousCityPointerPositions),d=1/this.dragPreviousCityPointerPositions.length,f=u.x*d-f,y=u.y*d-y;this.dragDir.x=.4*this.dragDir.x+.6*f,this.dragDir.y=.4*this.dragDir.y+.6*y;var u=this.city.viewPos,g=new In(u.x+f,u.y+y);this.city.viewPos=g,this.updateMovingView()}for(s=0,r=this.dragPointerIdentifiers.length;s<r;){a=s++;this.dragPreviousCityPointerPositions[a]=i.calcCityFPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[a])}}}else{var _=!i.down&&0<i.pointerDown.length?i.pointerCityScaledPosition.h[i.pointerDown[0]]:i.cityScaledPosition,f=(u=this.dragPreviousMousePos).x-_.x,y=u.y-_.y;this.dragDir.x=.4*this.dragDir.x+.6*f,this.dragDir.y=.4*this.dragDir.y+.6*y;u=this.city.viewPos,g=new In(u.x+f,u.y+y);this.city.viewPos=g,this.dragPreviousMousePos=_,this.updateMovingView()}else this.isDraggingView=!1,this.isDraggingViewTwoPointer=!1}this.isDraggingView||(i.pressed||this.dragDir.get_length()<.5?(this.dragDir.x=0,this.dragDir.y=0,this.dragDirRemaining.x=0,this.dragDirRemaining.y=0):(y=i.isTouch?.933:.8,this.dragDir.x*=y,this.dragDir.y*=y,_=this.dragDir.x+this.dragDirRemaining.x,y=this.dragDir.y+this.dragDirRemaining.y,this.dragDirRemaining.x+=this.dragDir.x-_,this.dragDirRemaining.y+=this.dragDir.y-y,u=this.city.viewPos,g=new In(u.x+_,u.y+y),this.city.viewPos=g,this.updateMovingView()))}else this.isDraggingView=!1,this.isDraggingViewTwoPointer=!1},startViewDrag:function(){var t=this.get_game().mouse;if(2<=t.pointerDown.length){this.dragPointerIdentifiers=t.pointerDown.slice();for(var e=[],i=0,n=this.dragPointerIdentifiers.length;i<n;){var s=i++;e.push(null)}this.dragPreviousCityPointerPositions=e;for(e=[],i=0,n=this.dragPointerIdentifiers.length;i<n;){s=i++;e.push(null)}this.dragInitialPointerPositions=e;for(e=0,i=this.dragPointerIdentifiers.length;e<i;){s=e++;this.dragPreviousCityPointerPositions[s]=t.pointerCityPosition.h[this.dragPointerIdentifiers[s]],this.dragInitialPointerPositions[s]=t.pointerPosition.h[this.dragPointerIdentifiers[s]]}this.isDraggingViewTwoPointer=!0,this.originalTwoFingerDragZoom=this.city.zoomScale}else!t.down&&0<t.pointerDown.length?this.dragPreviousMousePos=t.pointerCityScaledPosition.h[t.pointerDown[0]]:this.dragPreviousMousePos=t.cityScaledPosition,this.isDraggingViewTwoPointer=!1;this.dragDir=new In(0,0),this.isDraggingView=!0},zoomIn:function(t){this.city.zoomScale<Math.max(7,this.get_game().scaling/2*7)&&this.setZoom(Math.round(this.city.zoomScale+1),t)},zoomOut:function(t){1<this.city.zoomScale&&this.setZoom(Math.max(Math.round(this.city.zoomScale-1),1),t)},setZoom:function(t,e){new In(0,0);null!=e&&this.isDraggingView&&this.isDraggingViewTwoPointer&&Cn.mean(e.calcCityPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[0]),e.calcCityPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[1]));this.city.zoomScale;if(this.city.zoomScale=t,this.city.resize(),null!=e)if(this.isDraggingView&&this.isDraggingViewTwoPointer)for(var i=0,n=this.dragPointerIdentifiers.length;i<n;){var s=i++,r=e.pointerCityPosition,o=this.dragPointerIdentifiers[s],s=e.calcCityFPositionForPointer(this.get_game(),this.city,this.dragPointerIdentifiers[s]);r.h[o]=s}else{t=e.calcCityPosition(this.get_game(),this.city);this.city.viewPos.x+=e.cityPosition.x-t.x,this.city.viewPos.y+=e.cityPosition.y-t.y}this.updateMovingView()},handleScrollbarZoom:function(t){var e;t.isTouch||(Math.abs(this.remZoomScrollBarMovement)<.75?this.remZoomScrollBarMovement=0:(e=this.remZoomScrollBarMovement,this.remZoomScrollBarMovement-=.75*(0<e?1:e<0?-1:0)),this.remZoomScrollBarMovement+=t.scrollBarMovement+t.scrollBarMovementPages*this.get_game().rect.height*this.get_game().scaling,15<=this.remZoomScrollBarMovement?(this.zoomOut(t),this.remZoomScrollBarMovement=0):this.remZoomScrollBarMovement<=-15&&(this.zoomIn(t),this.remZoomScrollBarMovement=0))},__class__:d};var k=function(){};function c(t,e){this.r=new RegExp(t,e.split("u").join(""))}function f(t,e){this.guiTimer=0,this.windowCapturesAllInput=!1,this.windowReloadOnResize=!1,this.windowShowingBanner=!1,this.windowPosition=nr.Center,this.overlayElements=[],this.windowSimpleButtonContainer=null,this.game=t,this.outerStage=e,this.stage=new PIXI.Container,e.addChild(this.stage),this.windowStage=new PIXI.Container,e.addChild(this.windowStage),this.prevWindowStack=[],this.windowStackMeta=[],this.gameHelpStage=new PIXI.Container,e.addChild(this.gameHelpStage),this.tooltipStage=new PIXI.Container,e.addChild(this.tooltipStage),this.notificationStage=new PIXI.Container,e.addChild(this.notificationStage),this.tooltip=new tr(t,null,this.tooltipStage),this.notifications=[]}(V.Config=k).__name__="Config",k.get_enableCrossPromo=function(){return!1},k.get_allowUnlimitedResources=function(){return k.hasPremium()},k.init=function(){0},k.checkSitelock=function(){return null==k.siteLockUrls||vn.any(k.siteLockUrls,function(t){return-1!=window.location.hostname.indexOf(t)})},k.gameInit=function(t){bn.init(t)},k.doPlay=function(){0},k.showSplashScreen=function(t){k.splashScreenDone=!0},k.resizeSplash=function(t){},k.update=function(t){null!=k.splashScreen&&k.splashScreen.update(t),bn.update(t),k.lastInput+=t},k.onCitySwitch=function(t){null==t&&(t=!1)},k.waitForInitialization=function(t,e,i){var n=window.createLoadingTextP("Loading...");jsFunctions.loadJS("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/load.js",function(){gd__initGameDistribution(e,i),window.removeLoadingTextP(n),t()})},k.handleInput=function(t,e){k.hadFullStepWithInput=!0},k.callLoadStart=function(){0},k.callLoadFinish=function(){0},k.callLoadProgress=function(t){0},k.has=function(t){return!1},k.hasPremium=function(){return!k.isAdsTest&&k.has("premium")},k.canHavePremium=function(){return k.has("premium")},k.hasRemoveAds=function(){return!k.isAdsTest&&k.has("remove_ads")},(V.EReg=c).__name__="EReg",c.prototype={match:function(t){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(t),this.r.s=t,null!=this.r.m},split:function(t){var e="#__delim__#";return t.replace(this.r,e).split(e)},__class__:c},(V.GUI=f).__name__="GUI",f.prototype={get_windowHeight:function(){return this.game.rect.height-(this.windowPosition==nr.CenterWithBanner?Math.floor(35+50/this.game.scaling*this.game.get_pixelRatio()):40)},get_keyboard:function(){return this.game.keyboard},update:function(t){this.guiTimer+=t,this.tooltip.update(t);for(var e=0,i=this.overlayElements;e<i.length;){var n=i[e];++e,n.update(t)}this.game.keyboard.anyBack()&&(null!=this.window?this.goPreviousWindow():null==window.document.fullscreenElement&&this.onEscapePressWithoutWindow()),null!=this.window&&this.window.update(),this.game.keyboard.down[17]&&this.game.keyboard.pressed[121]&&(this.stage.visible=!this.stage.visible);for(var s=this.notifications.length;0<=--s;)this.notifications[s].update(t);!this.windowShowingBanner||null!=this.window&&this.windowPosition==nr.CenterWithBanner||(bn.hideBanner(),this.windowShowingBanner=!1)},onEscapePressWithoutWindow:function(){},lateUpdate:function(){null!=this.windowOnLateUpdate&&null!=this.window&&this.windowOnLateUpdate()},handleMouse:function(t){return!(null==this.window||!this.window.handleMouse(t))||!!this.windowCapturesAllInput},createWindowInCurrentContext:function(t,e){this.createWindow(t,e)},notify:function(t,e,i){null==i&&(i=600);i=new er(this.game,this,this.notificationStage,t,e,i);this.notifications.push(i)},createWindow:function(t,e){this.closeWindow(!0),this.game.mouse.releaseAllClaims(!0);e=new Hs(null==e?H.getTexture("spr_9p_window"):e,1,4,4);this.window=new ds(this,this.windowStage,null,new Cn(this.game.rect.width/2|0,this.game.rect.height/2|0),new In(.5,.5),null,e),this.window.direction=vs.Vertical,this.windowPosition=nr.Center,this.windowScrollableOuter=new cs(500,this.get_windowHeight(),this,this.windowStage,this.window),this.window.addChild(this.windowScrollableOuter),this.windowInner=new ds(this,this.innerWindowStage,this.windowScrollableOuter,new Cn(0,0),null,null,null,{top:2,right:2,bottom:2,left:2}),this.windowInner.direction=vs.Vertical,this.windowScrollableOuter.setInnerContainer(this.windowInner),this.innerWindowStage=this.windowScrollableOuter.scrollable.stage,this.windowRelatedTo=t,this.windowOnLateUpdate=null,this.windowTitleElem=null,this.windowReloadOnResize=!1,this.windowCapturesAllInput=!1,this.windowIsOnStack=!1,this.windowSimpleButtonContainer=null},windowAllowBanner:function(){bn.canShowBanner()&&(this.setWindowPositioning(nr.CenterWithBanner),bn.showBanner(),this.windowShowingBanner=!0)},addWindowToStack:function(t,e,i){null==i&&(i=""),null==e&&(e=!0),0!=this.prevWindowStack.length&&this.prevWindowStack[this.prevWindowStack.length-1]==t||(this.prevWindowStack.push(t),this.windowStackMeta.push(i)),this.windowIsOnStack=!0},clearWindowStack:function(){this.prevWindowStack=[],this.windowStackMeta=[],this.windowIsOnStack=!1},setWindowReload:function(t){this.windowReload=t},windowAddBottomButtons:function(t,e,i){if(null==e&&(e="lo_close"),"lo_close"==e&&(e=kn.lo("close")),!f.closeButtonEnabled&&(null==t||0==t.length))return[];var n=new ds(this,this.innerWindowStage,this.windowInner);n.fillSecondarySize=!0,this.windowInner.addChild(n);var s=[];if(null!=t)for(var r=0;r<t.length;){var o=t[r];++r,s.push(n.addChild(new Ks(this,this.innerWindowStage,n,o.action,o.text,null,o.onHover))),n.addChild(new Cs(n,new Cn(2,2)))}return n.addChild(new Ps(n,0)),!f.closeButtonEnabled&&null==i||(null==i&&(i=fa(this,this.goPreviousWindow)),n.addChild(new Ks(this,this.innerWindowStage,n,i,e))),s},goPreviousWindow:function(){this.closeWindow(),0<this.prevWindowStack.length&&this.windowIsOnStack&&(this.prevWindowStack.pop(),this.windowStackMeta.pop(),0<this.prevWindowStack.length&&(this.windowStackMeta.pop(),this.prevWindowStack.pop()()))},closeWindow:function(t){null==t&&(t=!1),null!=this.window&&(this.window.destroy(),null!=this.windowOnDestroy&&this.windowOnDestroy(),this.windowOnDestroy=null,this.window=null,this.windowRelatedTo=null,this.windowReload=null,this.windowOnLateUpdate=null,this.windowTitleElem=null,this.windowReloadOnResize=!1,this.windowCapturesAllInput=!1,this.windowSimpleButtonContainer=null)},windowAddTitleText:function(t,e,i){null==t&&(t="");var n=this;if(null!=this.windowTitleElem)return this.windowTitleElem.setTextAndTextUpdate(t,e),this.windowTitleElem;var s=this.windowStage,r=this.window,o=new Cs(this.windowInner,new Cn(0,0));this.windowInner.addChild(o);var a=new xs(this,s,r);a.fillSecondarySize=!0,a.setSizeCallback(function(){o.rect.width=a.rect.width-6,o.updateSize()}),a.addChild(new Cs(a,new Cn(3,0))),null!=i&&(i=new PIXI.Sprite(i),a.addChild(new Cs(a,new Cn(1,0))),a.addChild(new us(r,this.windowStage,i,{top:4,bottom:0,left:0,right:0})),a.addChild(new Cs(a,new Cn(2,0))));e=new Qs(a,s,t,e,"Arial16",{left:0,top:3,right:0,bottom:-3},null,!0);a.addChild(e),a.addChild(new Ps(a));s=new Fs(this,s,a,function(){null!=n.window&&n.goPreviousWindow()},H.getTexture("spr_icon_close"),null,null,null,this.game.isMobile?"spr_button_windowheader_mobi":"spr_button_windowheader",this.game.isMobile?2:1);return a.addChild(s),r.insertChild(a,0),this.windowTitleElem=e,this.game.isMobile&&(this.windowInner.padding.top=0),e},windowAddInfoText:function(t,e,i){return null==i&&(i="Arial"),null==t&&(t=""),this.windowInner.addChild(new Qs(this.windowInner,this.innerWindowStage,t,e,i,null,null,!0))},windowAddSimpleButton:function(t,e,i,n,s){null==s&&(s="Arial"),null==i&&(i=""),null==this.windowSimpleButtonContainer?(this.windowSimpleButtonContainer=new ds(this,this.innerWindowStage,this.windowInner),this.windowInner.addChild(this.windowSimpleButtonContainer),this.windowInner.addChild(new Cs(this.windowInner,new Cn(2,4)))):this.windowSimpleButtonContainer.addChild(new Cs(this.windowSimpleButtonContainer,new Cn(4,2)));var r=new ls(this,this.innerWindowStage,this.windowSimpleButtonContainer,e),o=r.container;o.padding={left:2,right:3,top:2,bottom:-1},o.addChild(new us(o,this.innerWindowStage,new PIXI.Sprite(t)));var a=new Qs(o,this.innerWindowStage,i,n,s,{left:1,top:1,bottom:0,right:0},null,!0);return a.handleMouseFunction=function(t){if(a.rect.contains(t.position))switch(t.claimMouse(a)._hx_index){case 0:return!0;case 1:return e(),!0;default:return!1}return!1},o.addChild(a),this.windowSimpleButtonContainer.addChild(r)},resize:function(){this.outerStage.scale.x=this.outerStage.scale.y=this.game.scaling,null!=this.window&&(this.windowReloadOnResize&&null!=this.windowReload?this.windowReload():(this.updateWindowPosition(),this.windowUpdateSize()))},windowUpdateSize:function(){this.windowScrollableOuter.scrollable.maxHeight=this.get_windowHeight(),this.windowScrollableOuter.maxHeight=this.get_windowHeight(),this.windowScrollableOuter.scrollable.updateSize()},showSimpleWindow:function(t,e,i,n){if(null==n&&(n=!1),null==i&&(i=!1),null==e&&(e=""),null==t&&(t=""),null!=this.window){if(!i)return!1;this.closeWindow()}return n?this.createWindowInCurrentContext():this.createWindow(),""!=e&&this.windowAddTitleText(e),this.windowAddInfoText(t),this.windowAddBottomButtons(),!0},reloadWindow:function(t){var e,i,n,s;null==t&&(t=this.windowReload),null!=t&&(s=this.windowScrollableOuter.scrollable.scrollPosition,e=new Cn(s.x,s.y),s=n=i=null,this.windowIsOnStack&&1<=this.windowStackMeta.length&&(i=this.prevWindowStack.length,n=this.prevWindowStack.pop(),s=this.windowStackMeta.pop()),t(),this.prevWindowStack.length<i&&(this.prevWindowStack.push(n),this.windowStackMeta.push(s),this.windowIsOnStack=!0),this.windowScrollableOuter.forceSetScrollPosition(e))},setWindowPositioning:function(t){this.windowPosition=t,this.updateWindowPosition()},updateWindowPosition:function(){var t=this.windowPosition;switch(t._hx_index){case 0:this.window.origin.x=.5,this.window.origin.y=0,this.window.updatePosition(new Cn(this.game.rect.width/2|0,10));break;case 1:this.window.origin.x=.5,this.window.origin.y=.5,this.window.updatePosition(new Cn(this.game.rect.width/2|0,this.game.rect.height/2|0));break;case 2:var e=t.offsetToTop;this.window.origin.x=.5,this.window.origin.y=.5,this.window.updatePosition(new Cn(this.game.rect.width/2|0,(this.game.rect.height/2|0)-e));break;case 3:this.window.origin.x=0,this.window.origin.y=0,this.window.updatePosition(new Cn(10,10));break;case 4:this.window.origin.x=.5,this.window.origin.y=.5;e=Math.ceil(25/this.game.scaling*this.game.get_pixelRatio());this.window.updatePosition(new Cn(this.game.rect.width/2|0,(this.game.rect.height/2|0)+e)),this.windowUpdateSize()}},onLanguageChange:function(){this.reloadWindow(),this.tooltip=new tr(this.game,null,this.tooltipStage)},__class__:f};var _=function(t,e,i,n,s,r,o){this.tempSavedState=null,this.tapToContinue=null,this.gamePausedFor=0,this.isLargeMobile=!1,this.isMobile=!1,this.setOnClickTo=null,this.onClick=null,this.state=null;var a=this;this.application=t,this.stage=e,this.keyboard=new b,this.audio=new C(this),this.isMobile=o,this.currentlyPausedForReasons=[],this.resize(i,n,s,r),this.initInteraction(e),o&&(this.mouse.isTouch=!0),this.textHelper=new Rn(this),kn.init(this),_.isLoading||(this.metaGame=new ho(function(){Or.init(a,function(){a.createMainMenu()})}),this.addImportHandler()),k.gameInit(this)};function w(t,e){this.finalizedLoad=!1,this.hasError=!1;var p=this;R.load(),k.callLoadStart(),this.loader=new PIXI.loaders.Loader,this.loadingGraphics=new PIXI.Graphics,e.addChild(this.loadingGraphics);var g="?cache=20210613164939";this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/sprites.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/fonts/standard.fnt"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/fonts/standard10.fnt"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/fonts/standard16.fnt"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/fonts/standard15.fnt"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/fonts/standard18.fnt"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildinginfo.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildingUpgradesInfo.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildingCategoriesInfo.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/decorationsInfo.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildableWorldResourcesInfo.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/cityUpgradesInfo.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/policiesInfo.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/stories.json"+g),this.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/js/pathfinder.js"+g);var m=Object.create(null),e="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/stories/theLostShip.json";m["https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/stories/theLostShip.json"]="theLostShip",p.loader.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/stories/theLostShip.json"),m[e="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/stories/displayCity.json"]="displayCity",p.loader.add(e),this.loader.use(function(t,e){var i,n;if(t.error)return console.log("FloatingSpaceCities/GameLoader.hx:65:",t.error),p.hasError||(n="Unfortunately, something went wrong while loading the game. Please check your internet connection and reload the page. If your internet connection is working fine, please report the technical details below. Technical details:\n"+q.string(t.error),window.alert(q.string(n))),void(p.hasError=!0);if(t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildingUpgradesInfo.json"+g){H.buildingUpgradesInfo=new zr;for(var s=t.data,r=0;r<s.length;){var o=s[r];++r,H.buildingUpgradesInfo.h["buildingUpgrades."+o.className]=o}}else if(t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildinginfo.json"+g){H.buildingInfo=new zr,H.buildingInfoArray=t.data;for(var r=0,a=H.buildingInfoArray;r<a.length;){var l=a[r];++r,H.buildingInfo.h["buildings."+l.className]=l}}else if(t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildableWorldResourcesInfo.json"+g)H.worldResourcesInfo=t.data;else if(t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/buildingCategoriesInfo.json"+g)H.buildingCategoriesInfo=t.data;else if(t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/decorationsInfo.json"+g)H.decorationsInfo=t.data;else if(t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/cityUpgradesInfo.json"+g){H.cityUpgradesInfo=new zr;for(var h=t.data,r=0;r<h.length;){var u=h[r];++r,H.cityUpgradesInfo.h["cityUpgrades."+u.className]=u}}else if(t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/policiesInfo.json"+g){H.policiesInfo=new zr;for(var d=t.data,r=0;r<d.length;){var c=d[r];++r,H.policiesInfo.h["policies."+c.className]=c}}else t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/stories.json"+g?H.allStoriesInfo=t.data:t.name=="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/js/pathfinder.js"+g?H.pathfinderCodeUrl=URL.createObjectURL(new Blob([t.data])):Object.prototype.hasOwnProperty.call(m,t.name)?(i=m[t.name],n=t.data,H.storiesInfo.h[i]=n):"shader.glsl"==t.name&&(H.shader=new PIXI.Filter("",t.data));e()}),this.loader.load(function(){jsFunctions.fontsPrepareVietnamese(),p.resourcesLoaded=!0,R.settingsLoaded&&k.splashScreenDone&&p.postLoad()}),this.loaderThen=t}(V.Game=_).__name__="Game",_.prototype={get_preDPIAdjustScaling:function(){return this.scaling/this.application.pixelRatio},get_pixelRatio:function(){return this.application.pixelRatio},createMainMenu:function(t){this.stopState();var e=new P(this,this.stage);null!=t&&e.showError(t),this.state=e,this.afterStateSwitch()},tempSaveState:function(){this.savedStateStages=this.stage.children.slice(),this.tempSavedState=this.state,this.stage.removeChildren()},restoreState:function(){this.stopState();for(var t=0,e=this.savedStateStages;t<e.length;){var i=e[t];++t,this.stage.addChild(i)}this.state=this.tempSavedState,this.state.refocus(),this.state.resize(),this.afterStateSwitch()},switchState:function(t,e){null==e&&(e=!1),e&&this.stopState(),this.state=t,this.afterStateSwitch()},createNewGameState:function(t){var e=this;this.tempSaveState();function i(){e.state=new F(e,e.stage,t),e.afterStateSwitch(),e.mouse.releaseAllClaims(!0)}Object.prototype.hasOwnProperty.call(H.storiesInfo.h,t)?i():new go(t,function(){i()},function(){e.createMainMenu(kn.lo("game_load_error")),p.sendEvent("game","newGameFailed",null,t)})},newCity:function(t,e,i){null==i&&(i=!1);var n=this;this.stopState();function s(){n.state=new g(n,n.stage,t,i,e),n.afterStateSwitch(),n.mouse.releaseAllClaims(!0),k.doPlay(),p.sendEvent("game","newGame",null,t)}Object.prototype.hasOwnProperty.call(H.storiesInfo.h,t)?s():new go(t,function(){s()},function(){n.createMainMenu(kn.lo("game_load_error")),p.sendEvent("game","newGameFailed",null,t)}),k.onCitySwitch()},loadFromString:function(t,e){try{var i=Ln.fromBase64(t);this.load(i,e)}catch(t){this.createMainMenu(kn.lo("game_inport_error"))}},loadFromTypedArray:function(t,e){t=Ln.fromData(t);this.load(t,e)},loadFromStorage:function(i){var n=this;this.stopState(),On.getItem(i,function(t,e){null==t&&null!=e?n.loadFromTypedArray(e,i):n.createMainMenu(kn.lo("game_load_save_error"))},!0)},load:function(t,e){var i=this;this.stopState();var n="theLostShip";_.isLoading=!0;function s(){42<t.bytes.getInt32(t.readStart)?i.createMainMenu(kn.lo("game_load_save_error_version")):(i.newCity(n,e),i.state.load(t),_.isLoading=!1)}-1234==t.bytes.getInt32(t.readStart)?(t.bytes.getInt32(t.readStart),t.readStart+=4,n=t.readString(),Object.prototype.hasOwnProperty.call(H.storiesInfo.h,n)?s():new go(n,function(){s()},function(){i.createMainMenu(kn.lo("game_load_error"))})):s()},resize:function(t,e,i,n){this.rect=t,this.addX=e,this.addY=i,this.scaling=n;this.stage.hitArea=new PIXI.Rectangle(0,0,1/0,1/0),this.stage.interactiveChildren=!1,null!=this.state&&this.state.resize()},update:function(t){this.mouseBeginStep(),this.mouse.timeMod=t,this.keyboard.update(),jsFunctions.crossPromoIsVisible()&&this.keyboard.anyBack()&&(jsFunctions.crossPromoClose(),this.keyboard.pressed[27]=!1),k.handleInput(this.mouse,this.keyboard),this.mouse.preHandling(),(this.setOnClickTo=null)==this.state||this.isMobile&&this.mouse.hasStrongClaim||this.state.handleMouse(this.mouse),this.onClick=this.setOnClickTo,this.mouse.afterHandling(),null!=this.state&&this.state.update(t),this.updateForceUnpause(t),this.mouseEndStep(t),this.keyboard.postUpdate(),p.update(t),R.update()},updateForceUnpause:function(t){this.gamePausedFor=0,null!=this.tapToContinue&&null!=this.tapToContinue.parent&&(this.tapToContinue.destroy(),this.tapToContinue=null)},postDraw:function(){null!=this.state&&this.state.postDraw()},mouseBeginStep:function(){var t=this.mouse.nextStepReleased;this.mouse.nextStepReleased&&(this.mouse.down=!1,this.mouse.nextStepReleased=!1,this.mouse.released=!0),this.mouse.nextStepQuietReleased&&(this.mouse.down=!1,this.mouse.nextStepQuietReleased=!1,this.mouse.released=!1,this.mouse.releaseAllClaims(!0)),this.mouse.nextStepDown&&(t||(this.mouse.down=!0),this.mouse.pressed=!0,this.mouse.nextStepDown=!1);t=this.mouse.nextStepRightReleased;this.mouse.nextStepRightReleased&&(this.mouse.rightDown=!1,this.mouse.nextStepRightReleased=!1,this.mouse.rightReleased=!0),this.mouse.nextStepRightDown&&(t||(this.mouse.rightDown=!0),this.mouse.rightPressed=!0,this.mouse.nextStepRightDown=!1);t=this.mouse.nextStepMiddleReleased;this.mouse.nextStepMiddleReleased&&(this.mouse.middleDown=!1,this.mouse.nextStepMiddleReleased=!1,this.mouse.middleReleased=!0),this.mouse.nextStepMiddleDown&&(t||(this.mouse.middleDown=!0),this.mouse.middlePressed=!0,this.mouse.nextStepMiddleDown=!1),this.mouse.scrollBarMovement=this.mouse.scrollBarNextMovement,this.mouse.scrollBarMovementPages=this.mouse.scrollBarNextMovementPages,this.mouse.scrollBarNextMovementPages=0,this.mouse.scrollBarNextMovement=0,!this.isMobile||this.mouse.down||this.mouse.released||0!=this.mouse.pointerDown.length||null==this.state||this.state.get_publicGUI().tooltip.shown()||(this.mouse.position=new Cn(-1e5,-1e5),this.mouse.unscaledPosition=new Cn(-1e5,-1e5),this.mouse.cityScaledPosition=new In(-1e5,-1e5),this.mouse.cityPosition=new Cn(-1e5,-1e5)),null==this.mouse.prevPosition||this.mouse.position.x==this.mouse.prevPosition.x&&this.mouse.position.y==this.mouse.prevPosition.y?this.mouse.moved=!1:this.mouse.moved=!0},mouseEndStep:function(t){this.mouse.pressed=!1,this.mouse.released=!1,this.mouse.rightPressed=!1,this.mouse.rightReleased=!1,this.mouse.middlePressed=!1,this.mouse.middleReleased=!1,0<this.mouse.mouseDownTick&&(this.mouse.mouseDownTick-=t);var e=this.mouse.position,t=new Cn(e.x,e.y);this.mouse.prevPosition=t;e=this.mouse.cityPosition,t=new Cn(e.x,e.y);this.mouse.prevCityPosition=t},initInteraction:function(r){function t(t){var e=t.data.originalEvent;l.isMobile||"touch"==e.pointerType?(1==l.mouse.pointerDown.length&&(l.mouse.down||l.mouse.nextStepDown)&&(l.mouse.nextStepReleased=!0),Y.remove(l.mouse.pointerDown,t.data.identifier),l.mouse.pointerUnscaledPosition.remove(t.data.identifier)):(null==(t=t.data.originalEvent.button)&&(t=0),1==t?l.mouse.nextStepMiddleReleased=!0:2==t?l.mouse.nextStepRightReleased=!0:0==t&&(l.mouse.nextStepReleased=!0))}function o(t){l.mouse.unscaledPosition=t;var e=l.scaling,e=new Cn(t.x/e|0,t.y/e|0);l.mouse.position=e,l.state instanceof g&&(e=l.state,l.mouse.cityScaledPosition=new In(t.x/e.zoomScale,t.y/e.zoomScale),l.mouse.cityPosition=l.mouse.calcCityPosition(l,e))}function a(t,e){l.mouse.pointerUnscaledPosition.h[e]=t;var i=l.mouse.pointerPosition,n=l.scaling,s=new Cn(t.x/n|0,t.y/n|0);i.h[e]=s,l.state instanceof g&&(n=l.state,i=l.mouse.pointerCityScaledPosition,s=new In(t.x/n.zoomScale,t.y/n.zoomScale),i.h[e]=s,i=l.mouse.pointerCityPosition,s=l.mouse.calcCityFPositionForPointer(l,n,e),i.h[e]=s)}var l=this;this.mouse=new W,r.interactive=!0,r.on("pointermove",function(t){var e=t.data.originalEvent;!l.isMobile&&"touch"!=e.pointerType||(i=a,n=t.data.getLocalPosition(r),i(new Cn(Math.floor(n.x),Math.floor(n.y)),t.data.identifier));var i=o,n=t.data.getLocalPosition(r);i(new Cn(Math.floor(n.x),Math.floor(n.y)));t=t.data.originalEvent.buttons;null!=t&&"number"==typeof t&&(0|t)===t&&(1!=(1&t)&&l.mouse.down&&(l.mouse.nextStepReleased=!0),2!=(2&t)&&l.mouse.rightDown&&(l.mouse.nextStepRightReleased=!0),4!=(4&t)&&l.mouse.middleDown&&(l.mouse.nextStepMiddleReleased=!0))}),this.isMobile?r.on("touchend",function(t){null!=l.onClick?l.onClick():l.mouse.isTouch&&(l.rect.width<500||l.rect.height<230)&&!jsFunctions.isAnyApple()&&jsFunctions.goFullscreen(!1,function(){l.mouse.nextStepReleased=!0})}):r.on("click",function(t){null!=l.onClick&&l.onClick()}),r.on("pointerdown",function(t){var e,i,n,s=t.data.originalEvent;l.isMobile||"touch"==s.pointerType?-1==l.mouse.pointerDown.indexOf(t.data.identifier)&&(l.mouse.pointerDown.push(t.data.identifier),e=a,n=t.data.getLocalPosition(r),e(new Cn(Math.floor(n.x),Math.floor(n.y)),t.data.identifier),1==l.mouse.pointerDown.length?(i=o,n=t.data.getLocalPosition(r),i(new Cn(Math.floor(n.x),Math.floor(n.y))),l.mouse.nextStepDown=!0):(l.mouse.down&&(l.mouse.nextStepQuietReleased=!0),l.mouse.nextStepDown=!1),l.mouse.nextStepReleased=!1):(i=o,n=t.data.getLocalPosition(r),i(new Cn(Math.floor(n.x),Math.floor(n.y))),null==(s=s.button)&&(s=0),1==s?(l.mouse.nextStepMiddleDown=!0,l.mouse.nextStepMiddleReleased=!1,t.data.originalEvent.preventDefault()):2==s?(l.mouse.nextStepRightReleased=!1,l.mouse.nextStepRightDown=!0):0==s&&(l.mouse.nextStepDown=!0,l.mouse.nextStepReleased=!1))}),window.document.addEventListener("mousedown",function(t){1==t.button&&t.preventDefault()},jsFunctions.getPassiveEventListenerVar()),window.document.addEventListener("dragstart",function(t){return t.preventDefault(),!1}),r.on("pointerup",t),r.on("pointerupoutside",t),r.on("pointercancel",function(t){var e=t.data.originalEvent;!l.isMobile&&"touch"!=e.pointerType||((l.mouse.down||l.mouse.nextStepDown)&&1==l.mouse.pointerDown.length&&(l.mouse.nextStepReleased=!0),Y.remove(l.mouse.pointerDown,t.data.identifier),l.mouse.pointerUnscaledPosition.remove(t.data.identifier))}),window.addEventListener("wheel",function(t){switch(t.deltaMode){case 0:l.mouse.scrollBarNextMovement+=t.deltaY/l.scaling;break;case 1:l.mouse.scrollBarNextMovement+=10*t.deltaY;break;case 2:l.mouse.scrollBarNextMovementPages+=t.deltaY}t.preventDefault()},jsFunctions.getPassiveEventListenerVar())},refocus:function(){null!=this.state&&this.state.refocus(),this.mouse.pointerDown.splice(0,this.mouse.pointerDown.length),this.mouse.pointerUnscaledPosition=new Ir,this.mouse.releaseAllClaims(!0),this.mouse.down=!1,this.mouse.middleDown=!1,this.mouse.rightDown=!1},addImportHandler:function(i){var n=this,s=window.document.getElementById("importFile");s.addEventListener("change",function(){var t=s.files[0],e=new FileReader;e.addEventListener("load",function(t){var e=t.target.result;Vs.createSaveWindow(n,n.state.get_publicGUI(),kn.lo("save_slot_import"),function(t){n.loadFromString(e,t)},function(){null!=i&&i()}),s.value=""}),e.readAsText(t)}),s.addEventListener("click",function(){})},stopState:function(){if(null!=this.state){this.state.stop();for(var t=0,e=this.stage.children;t<e.length;){var i=e[t];++t,i.destroy({children:!0})}this.stage.removeChildren()}this.state=null},pause:function(t){0==this.currentlyPausedForReasons.length&&this.actuallyPauseState(),-1==this.currentlyPausedForReasons.indexOf(t)&&this.currentlyPausedForReasons.push(t)},actuallyPauseState:function(){null!=this.state&&this.state.pause(),this.audio.pauseMusic()},resume:function(t){Y.remove(this.currentlyPausedForReasons,t),0==this.currentlyPausedForReasons.length&&(null!=this.state&&this.state.resume(),this.audio.resumeMusic())},afterStateSwitch:function(){0<this.currentlyPausedForReasons.length&&this.actuallyPauseState()},onContextRestored:function(){null!=this.state&&this.state.onContextRestored(),null!=this.tempSavedState&&this.tempSavedState.onContextRestored()},__class__:_},(V.GameLoader=w).__name__="GameLoader",w.prototype={postLoad:function(){this.finalizedLoad=!0,k.callLoadFinish(),null!=window.removeLoadingExplainer&&window.removeLoadingExplainer(),this.loadOptionals(),kn.translateFiles(),this.loaderThen(),this.loadingGraphics.destroy()},loadOptionals:function(){var t=new PIXI.loaders.Loader;t.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/citizenNames.txt"),t.use(function(t,e){t.error?console.log("FloatingSpaceCities/GameLoader.hx:160:","error loading optionals"):("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/citizenNames.txt"==t.name&&((t=t.data.split("\r\n")).splice(0,1+t.indexOf("START")),H.citizenNames=t),e())}),t.load(function(){})},update:function(t,e){var i,n,s,r,o;k.splashScreenDone&&(this.loadingGraphics.scale.x=this.loadingGraphics.scale.y=e,k.callLoadProgress(this.loader.progress/100),n=2*(i=(o=t.width/3|0)<100?o:100),this.resourcesLoaded?this.loadingGraphics.clear():(r=this.hasError?6303792:6316128,s=this.loadingGraphics.clear().beginFill(r),r=t.get_center().x-i,e=t.get_center().y-5,o=this.hasError?16711680:16777215,s.drawRect(r,e,n,10).endFill().beginFill(o).drawRect(t.get_center().x-i,t.get_center().y-5,n*(this.loader.progress/100),10).endFill())),this.resourcesLoaded&&!this.finalizedLoad&&R.settingsLoaded&&k.splashScreenDone&&this.postLoad()},__class__:w};var Y=function(){};(V.HxOverrides=Y).__name__="HxOverrides",Y.strDate=function(t){switch(t.length){case 8:var e=t.split(":"),i=new Date;return i.setTime(0),i.setUTCHours(e[0]),i.setUTCMinutes(e[1]),i.setUTCSeconds(e[2]),i;case 10:e=t.split("-");return new Date(e[0],e[1]-1,e[2],0,0,0);case 19:i=(e=t.split(" "))[0].split("-"),e=e[1].split(":");return new Date(i[0],i[1]-1,i[2],e[0],e[1],e[2]);default:throw cr.thrown("Invalid date format : "+t)}},Y.cca=function(t,e){e=t.charCodeAt(e);if(e==e)return e},Y.substr=function(t,e,i){if(null==i)i=t.length;else if(i<0){if(0!=e)return"";i=t.length+i}return t.substr(e,i)},Y.remove=function(t,e){e=t.indexOf(e);return-1!=e&&(t.splice(e,1),!0)},Y.now=function(){return Date.now()};var b=function(){this.inputs=[];for(var i=this,t=[],e=0;e<256;){e++;t.push(!1)}this.nextPressed=t;for(t=[],e=0;e<256;){e++;t.push(!1)}this.nextDown=t;for(t=[],e=0;e<256;){e++;t.push(!1)}this.pressed=t;for(t=[],e=0;e<256;){e++;t.push(!1)}this.down=t,b.mobileBackPressed=!1,window.addEventListener("keydown",function(t){var e=t.keyCode;vn.any(i.inputs,function(t){return t==window.document.activeElement})&&27!=e||(null!=t.key&&("Delete"==t.key&&(e=46),"Control"==t.key&&(e=17)),e<256&&(i.nextDown[e]||(i.nextPressed[e]=!0,i.nextDown[e]=!0)),t.preventDefault())},jsFunctions.getPassiveEventListenerVar()),window.addEventListener("keyup",function(t){var e=t.keyCode;e<256&&(i.nextDown[e]=!1),122==e&&jsFunctions.goFullscreen(!0),t.preventDefault()},jsFunctions.getPassiveEventListenerVar()),window.document.addEventListener("visibilitychange",function(){if("hidden"==window.document.visibilityState)for(var t=0;t<256;){var e=t++;i.nextDown[e]=!1}}),window.addEventListener("focus",function(){for(var t=0;t<256;){var e=t++;i.nextDown[e]=!1}b.mobileBackPressed=!1},!1),window.addEventListener("blur",function(){for(var t=0;t<256;){var e=t++;i.nextDown[e]=!1}b.mobileBackPressed=!1},!1)};(V.Keyboard=b).__name__="Keyboard",b.getLetterCode=function(t){t=Y.cca(t,0);return 97<=t&&t<=122&&(t-=32),t},b.prototype={anyKey:function(){for(var t=0;t<256;){var e=t++;if(this.pressed[e])return!0}return!1},anyBack:function(){return!!this.pressed[27]||b.mobileBackPressed},update:function(){for(var t=0;t<256;){var e=t++;this.nextDown[e]?this.down[e]=!0:this.down[e]=!1,this.nextPressed[e]&&(this.pressed[e]=!0,this.nextPressed[e]=!1)}},postUpdate:function(){for(var t=0;t<256;){var e=t++;this.pressed[e]=!1}b.mobileBackPressed=!1},__class__:b};var tt=function(){};function v(){this._animationFrameId=null,this.pixelRatio=1,this.autoResize=!0,this.transparent=!1,this.antialias=!1,this.forceFXAA=!1,this.roundPixels=!1,this.clearBeforeRender=!0,this.preserveDrawingBuffer=!1,this.backgroundColor=16777215,this.width=Math.max(window.innerWidth*this.pixelRatio,3*this.pixelRatio),this.height=Math.max(window.innerHeight*this.pixelRatio,3*this.pixelRatio),this.position="static"}(V.Lambda=tt).__name__="Lambda",tt.array=function(t){for(var e=[],i=ma(t);i.hasNext();){var n=i.next();e.push(n)}return e},tt.exists=function(t,e){for(var i=ma(t);i.hasNext();)if(e(i.next()))return!0;return!1},tt.iter=function(t,e){for(var i=ma(t);i.hasNext();)e(i.next())},tt.count=function(t,e){var i=0;if(null==e)for(var n=ma(t);n.hasNext();){n.next();++i}else for(var s=ma(t);s.hasNext();)e(s.next())&&++i;return i},tt.find=function(t,e){for(var i=ma(t);i.hasNext();){var n=i.next();if(e(n))return n}return null},(V["common.PixiApplication"]=v).__name__="common.PixiApplication",v.prototype={start:function(t,e,i){var n;null==t&&(t="auto"),null==i?(this.canvas=window.document.createElement("canvas"),n=q.string(window.innerWidth),this.canvas.style.width=n+"px",n=q.string(window.innerHeight),this.canvas.style.height=n+"px",this.canvas.style.position=this.position):this.canvas=i,window.onresize=fa(this,this._onWindowResize);i={};i.width=this.width,i.height=this.height,i.view=this.canvas,i.backgroundColor=this.backgroundColor,i.resolution=1,i.antialias=this.antialias,i.forceFXAA=this.forceFXAA,i.autoResize=this.autoResize,i.transparent=this.transparent,i.clearBeforeRender=this.clearBeforeRender,i.preserveDrawingBuffer=this.preserveDrawingBuffer,i.roundPixels=this.roundPixels,i.powerPreference="high-performance",i.legacy=this.useLegacyRenderer,null==t||"canvas"==t&&(i.noWebGL=!0),this.app=new PIXI.Application(i),this.stage=this.app.stage,this.renderer=this.app.renderer,(null==e?window.document.body:e).appendChild(this.app.view),this.app.ticker.add(fa(this,this._onRequestAnimationFrame))},addPostDraw:function(t){fa(B=this.app.ticker,B.add)(t,null,-100)},_onWindowResize:function(t){var e=window.innerWidth,i=window.innerHeight;this.width=Math.max(e*this.pixelRatio,3*this.pixelRatio),this.height=Math.max(i*this.pixelRatio,3*this.pixelRatio),this.app.renderer.resize(this.width,this.height),this.canvas.style.width=e+"px",this.canvas.style.height=i+"px",jsFunctions.isAnyApple()&&window.scrollTo(0,0),null!=this.onResize&&this.onResize()},_onRequestAnimationFrame:function(){null!=this.onUpdate&&this.onUpdate(this.app.ticker.deltaTime)},__class__:v};var S=function(){this.knownInnerH=-1,this.rotationAsker=null,this.askForRotation=!1,this.setScalingIn=-1,this.scaling=1,this.maxScaling=2;var t=this;S.isMobile=k.canBeMobile&&(k.forceMobile||jsFunctions.isAnyMobile()),v.call(this),k.waitForInitialization(function(){t.init()},function(){null!=t.game&&t.game.pause("ConfigBasedPause")},function(){null!=t.game&&t.game.resume("ConfigBasedPause")})};(V.Main=S).__name__="Main",S.main=function(){new S},S.__super__=v,S.prototype=e(v.prototype,{init:function(){var e=this;if(k.checkSitelock()){this.autoResize=!1,this.onUpdate=fa(this,this.update),window.addEventListener("resize",fa(this,this.setGameScaleSoon)),this.backgroundColor=0,this.pixelRatio=1,S.isMobile&&(this.pixelRatio=window.devicePixelRatio),(null==this.pixelRatio||this.pixelRatio<=0)&&(this.pixelRatio=1),this.knownInnerH=window.innerHeight;var t=window.innerWidth,i=window.innerHeight;this.width=Math.max(t*this.pixelRatio,3*this.pixelRatio),this.height=Math.max(i*this.pixelRatio,3*this.pixelRatio);try{this.preserveDrawingBuffer=jsFunctions.maliDetect()}catch(t){i=cr.caught(t);console.log("FloatingSpaceCities/Main.hx:86:",i)}PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,this.initConfig(),v.prototype.start.call(this),this.setGameScale(),this.loader=new w(function(){e.loader.update(e.gameRect,e.scaling),e.loader=null;var t=e.stage.addChild(new PIXI.Container);e.game=new _(e,t,e.gameRect,e.addX,e.addY,e.scaling,S.isMobile),e.game.isLargeMobile=e.game.isMobile&&S.isLargeMobile,e.askForRotation&&null==e.rotationAsker&&(e.rotationAsker=new Wn(e.stage),e.game.pause("pleaseRotateFirst"))},this.stage),S.isCanvasRenderer=this.renderer.type==PIXI.RENDERER_TYPE.CANVAS,this.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1},jsFunctions.getPassiveEventListenerVar()),this.canvas.addEventListener("webglcontextrestored",fa(this,this.onContextRestored)),k.init(),k.showSplashScreen(this),p.init(),k.get_enableCrossPromo()&&jsFunctions.initCrossPromo("gamedistribution"),this.addPostDraw(fa(this,this.postDraw)),null!=window.document.hidden&&window.addEventListener("visibilitychange",function(){window.document.hidden?e.onWindowBlur():e.onWindowFocus()});try{window.addEventListener("error",function(t){t="1.0.14+: "+t.message+" - "+t.filename+" - line "+t.lineno+" - col "+t.colno;p.sendErrorEvent(t)})}catch(t){}}else window.alert("This version of The Final Earth 2 has not been licensed for this site. If you're seeing this in error or need a new domain added to an existing sitelock, just contact me and I'll fix it. Otherwise, please contact me (e.g. from florianvanstrien.nl) for licensing options.")},onContextRestored:function(){null!=this.game&&this.game.onContextRestored()},onWindowBlur:function(){null!=this.game&&this.game.pause("windowBlur")},onWindowFocus:function(){null!=this.game&&(this.game.resume("windowBlur"),this.game.refocus())},getWebRequestParams:function(){for(var t=Y.substr(o.location.search,1,null),e=new zr,i=0,n=new c("[&;]","g").split(t);i<n.length;){var s=n[i];++i;var r=s.split("=");r.length<2||(s=r.shift(),s=decodeURIComponent(s.split("+").join(" ")),r=r.join("="),r=decodeURIComponent(r.split("+").join(" ")),e.h[s]=r)}return e},initConfig:function(){try{var t=this.getWebRequestParams();null!=t.h.maxScale&&(this.maxScaling=q.parseInt(t.h.maxScale)),null!=t.h.kv_maxScale&&(this.maxScaling=q.parseInt(t.h.kv_maxScale)),0==this.maxScaling&&(this.maxScaling=2)}catch(t){}},update:function(t){An.registerFrame(),-1!=this.setScalingIn?(this.setScalingIn--,0==this.setScalingIn&&(this.setGameScale(),this.setScalingIn=-1)):window.innerHeight!=this.knownInnerH?jsFunctions.isAnyApple()&&(this._onWindowResize(null),this.setGameScaleSoon(),this.knownInnerH=window.innerHeight):S.isMobile&&jsFunctions.isAnyApple()&&0!=window.scrollY&&window.scrollTo(0,0),null!=this.rotationAsker?this.rotationAsker.update(this.width/this.scaling,this.height/this.scaling,this.scaling):null!=this.game?this.game.update(t):null!=this.loader&&this.loader.update(this.gameRect,this.scaling),k.update(t)},postDraw:function(){null!=this.game&&this.game.postDraw()},setGameScale:function(){var t,e,i=this.pixelRatio*(k.mobileTrailerMode?k.mobileTrailerModeMultiplier:1),n=2;n*=i,this.scaling=n/i>this.maxScaling?Math.floor(this.maxScaling*i):Math.floor(n),S.isMobile&&this.width<this.height&&Math.floor(this.width/this.scaling)<300?(this.askForRotation=!0,null==this.loader&&null!=this.game&&null==this.rotationAsker&&(this.rotationAsker=new Wn(this.stage),this.game.pause("pleaseRotateFirst"))):(this.width/this.scaling<300&&(t=Math.floor(this.width/300),e=this.scaling,this.scaling=t<1?1:e<t?e:t),this.height/this.scaling<150&&(t=Math.floor(this.height/150),e=this.scaling,this.scaling=t<1?1:e<t?e:t),this.askForRotation=!1,null!=this.rotationAsker&&(this.rotationAsker.destroy(),this.rotationAsker=null,this.game.resume("pleaseRotateFirst"))),S.isLargeMobile=450<=Math.floor(this.width/this.scaling),this.gameRect=new xn(0,0,Math.floor(this.width/this.scaling),Math.floor(this.height/this.scaling)),this.addX=0,this.addY=0,null!=this.game?(this.game.isLargeMobile=this.game.isMobile&&S.isLargeMobile,this.game.resize(this.gameRect,this.addX,this.addY,this.scaling)):k.resizeSplash(this)},setGameScaleSoon:function(){this.setScalingIn=5},__class__:S});var P=function(n,t){this.displayCityActivation=0,this.fullscreenButton=null,this.totalTimeOnMenu=0;var s=this;this.game=n,this.stage=t,this.language=R.language;var e=new PIXI.Container;t.addChild(e),this.bgCity=new g(n,e,"displayCity",!0,"___"),this.bottomButtonStage=new PIXI.Container,t.addChild(this.bottomButtonStage),this.visibilityGraphics=new PIXI.Graphics,this.bottomButtonStage.addChild(this.visibilityGraphics),this.visibilityGraphics.alpha=0,this.infoStage=new PIXI.Container,t.addChild(this.infoStage),this.unscaledStage=new PIXI.Container,this.unscaledStage.scale.set(n.scaling/n.get_preDPIAdjustScaling(),n.scaling/n.get_preDPIAdjustScaling()),t.parent.addChild(this.unscaledStage),this.titleSprite=new PIXI.Sprite(H.getTexture("spr_title")),this.titleSprite.anchor.x=.5,this.infoStage.addChild(this.titleSprite),this.versionText=new Hn("",{font:"Arial",tint:16777215}),this.versionText.alpha=.6,this.versionText.get_anchor().x=0,this.versionText.get_anchor().y=1,this.infoStage.addChild(this.versionText),this.bottomButtons=[],this.bottomButtonOnClick=new Mr,this.bottomButtonOnHover=new Mr,this.bottomButtonOnRight=new Mr,this.bottomButtonAttract=new Mr,this.otherButtons=[];var i=H.getTexturesByWidth("spr_music",14),r=new PIXI.Sprite(i[R.musicOn?0:1]);this.musicOffButton={theSprite:r,onClick:function(){n.audio.changeMusicEnabledness(!R.musicOn),r.texture=i[R.musicOn?0:1]},onHover:function(){s.gui.tooltip.setText(s.musicOffButton,R.musicOn?kn.lo("mute_music"):kn.lo("unmute_music"))}},this.bottomButtonStage.addChild(this.musicOffButton.theSprite),this.otherButtons.push(this.musicOffButton);var o=H.getTexturesByWidth("spr_sound",14),a=new PIXI.Sprite(o[R.soundOn?0:1]);this.soundOffButton={theSprite:a,onClick:function(){n.audio.changeSoundEnabledness(!R.soundOn),a.texture=o[R.soundOn?0:1]},onHover:function(){s.gui.tooltip.setText(s.soundOffButton,R.soundOn?kn.lo("mute_sfx"):kn.lo("unmute_sfx"))}},this.bottomButtonStage.addChild(this.soundOffButton.theSprite),this.otherButtons.push(this.soundOffButton),k.hasFullscreen&&!n.isMobile&&(u=H.getTexture("spr_fullscreen"),u=new PIXI.Sprite(u),this.fullscreenButton={theSprite:u,onClick:function(){},onHover:function(){s.gui.tooltip.setText(s.creditsButton,kn.lo("full_screen")),n.setOnClickTo=function(){jsFunctions.goFullscreen(!0)}}},this.bottomButtonStage.addChild(this.fullscreenButton.theSprite),this.otherButtons.push(this.fullscreenButton));var l="spr_button_small",h=2;n.isMobile&&(l="spr_button_medium",h=4);var u=H.getTexture("spr_moresettings"),u=new PIXI.Sprite(u),d=null,d=function(){s.gui.createWindow("moreSettingsWindow"),s.gui.addWindowToStack(d),Ls.create(s.bgCity,s.gui,s.gui.innerWindowStage,s.gui.windowInner,l,h,!1)};this.moreSettingsButton={theSprite:u,onClick:d,onHover:function(){s.gui.tooltip.setText(s.moreSettingsButton,kn.lo("advanced_settings"))}},this.bottomButtonStage.addChild(this.moreSettingsButton.theSprite),this.otherButtons.push(this.moreSettingsButton);var u=H.getTexture("spr_credits"),u=new PIXI.Sprite(u),c=null,c=function(){s.gui.createWindow("creditsWindow"),s.gui.addWindowToStack(c),fs.create(null,s.gui,s.gui.innerWindowStage,s.gui.windowInner)};this.creditsButton={theSprite:u,onClick:c,onHover:function(){s.gui.tooltip.setText(s.creditsButton,kn.lo("credits"))}},this.bottomButtonStage.addChild(u),this.otherButtons.push(this.creditsButton),this.rightBadges=[];u=new PIXI.Container;t.addChild(u),this.gui=new Ds(n,u),this.resize(),this.positionUIElements(),this.siteLogo=null,On.getItem("__meta__mostRecentlyPlayed",function(t,e){var i;t||null==e?(t=s.addBottomButton("- "+kn.lo("click_here_to_play")+" -",function(){n.newCity("theLostShip","0"),k.doPlay(),p.sendEvent("game","play_initial"),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},null,"Arial18"),s.bottomButtonAttract.set(t,!0),i=n.isMobile?"Arial18":"Arial16",(t=s.addBottomButton("- "+kn.lo("played_before")+" -",function(){s.gui.doCreatePlayedBeforeWindow(function(){})},null,i)).set_tint(10526896),On.storageSupported()||s.showErrorWithImportButton(kn.lo("no_saves_warning"))):(i=n.isMobile?"Arial18":"Arial16",s.addBottomButton("- "+kn.lo("continue")+" -",function(){n.loadFromStorage(e),k.doPlay(),p.sendEvent("game","continue"),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},null,i),s.addBottomButton("- "+kn.lo("new_city")+" -",function(){s.gui.createPlayWindow(function(){}),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},null,i),s.addBottomButton("- "+kn.lo("load_city")+" -",function(){Vs.createLoadWindow(n,s.gui,kn.lo("which_city_to_load"),fa(n,n.loadFromStorage)),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},null,i),k.get_enableCrossPromo()&&s.addBottomButton("- "+kn.lo("play_other")+" -",function(){jsFunctions.showCrossPromoDisplay(!0)})),s.positionUIElements()}),Fn.reportStopGameplay()};(V.MainMenu=P).__name__="MainMenu",P.__interfaces__=[s],P.prototype={get_publicGUI:function(){return this.gui},addBottomButton:function(t,e,i,n,s){null==n&&(n="Arial16"),null==i&&(i=!1);n=new Hn(t,{font:i?"Arial":n,tint:i?13684944:16777215});return this.bottomButtonStage.addChild(n),this.bottomButtons.push(n),this.bottomButtonOnClick.set(n,e),this.bottomButtonOnHover.set(n,s),this.bottomButtonOnRight.set(n,i),this.bottomButtonAttract.set(n,!1),n},positionUIElements:function(){this.visibilityGraphics.clear(),this.titleSprite.position.x=this.game.rect.width/2,this.titleSprite.position.y=10,this.visibilityGraphics.beginFill(0,.5),this.visibilityGraphics.drawRect(0,0,this.game.rect.width,20+this.titleSprite.height),this.visibilityGraphics.endFill();var t=this.game.rect.height;this.versionText.position.x=1,this.versionText.position.y=this.game.rect.height;for(var e=this.game.rect.height-10,i=16+(this.game.isMobile?3:0),n=[],s=0,r=this.bottomButtons;s<r.length;){var o=r[s];++s,this.bottomButtonOnRight.h[o.__id__]||n.push(o)}for(var a=e-i*n.length,n=[],s=0,r=this.bottomButtons;s<r.length;){o=r[s];++s,this.bottomButtonOnRight.h[o.__id__]||"Arial18"!=o.get_font().name||n.push(o)}for(var e=a-3*((y=n.length-1)<0?0:y),l=this.game.rect.height,n=[],s=0,r=this.bottomButtons;s<r.length;){o=r[s];++s,this.bottomButtonOnRight.h[o.__id__]&&n.push(o)}var h=l-14*n.length;if((y=e-7)<=t&&(t=y),null!=this.rightBadges&&0<this.rightBadges.length){var u=0;null==this.siteLogo?h=2:h-=3;for(n=0,s=this.rightBadges;n<s.length;){var d=s[n];++n,d.sprite.position.set((this.game.rect.width-10)*this.game.get_preDPIAdjustScaling()-d.sprite.width,(this.game.rect.height-10)*this.game.get_preDPIAdjustScaling()-d.sprite.height-u),u+=14+d.sprite.height,null!=this.siteLogo&&(h-=Math.ceil((14+d.sprite.height)/this.game.get_preDPIAdjustScaling()))}(y=this.game.rect.height-10-u/this.game.get_preDPIAdjustScaling()|0)<=t&&(t=y)}for(n=0,s=this.bottomButtons;n<s.length;){var c,p,g=s[n];++n,this.bottomButtonOnRight.h[g.__id__]?(f=this.game.rect.width-g.get_textWidth(),g.position.x=f-3,g.position.y=h,h+=16):(c=this.game.rect.width/2,p=g.get_textWidth()/2,g.position.x=c-p,g.position.y=e,this.game.isMobile&&(e+=3),"Arial18"==g.get_font().name?e+=19:e+=16)}var m=10,i=m,a=this.game.rect.height-24,f=new PIXI.Point(i,a);this.musicOffButton.theSprite.position=f;i=m+=22,a=this.game.rect.height-24,f=new PIXI.Point(i,a);this.soundOffButton.theSprite.position=f,m+=22,null!=this.fullscreenButton&&(i=m,a=this.game.rect.height-24,f=new PIXI.Point(i,a),this.fullscreenButton.theSprite.position=f,m+=22),null!=this.moreSettingsButton&&(i=m,a=this.game.rect.height-24,f=new PIXI.Point(i,a),this.moreSettingsButton.theSprite.position=f,m+=22),m+=10;l=0;this.game.isMobile&&(l=-24,m=10);var y,i=m,a=this.game.rect.height-24+l,f=new PIXI.Point(i,a);this.creditsButton.theSprite.position=f,m+=22,(y=this.game.rect.height-24+l-10)<=t&&(t=y),null!=this.siteLogo&&(i=this.game.rect.width*this.game.scaling-10,a=10,f=new PIXI.Point(i,a),this.siteLogo.position=f),this.visibilityGraphics.beginFill(0,.5),this.visibilityGraphics.drawRect(0,t,this.game.rect.width,this.game.rect.height),this.visibilityGraphics.endFill(),this.visibilityGraphicsYStart=20+this.titleSprite.height,this.visibilityGraphicsYEnd=t},showError:function(t){this.gui.showSimpleWindow(t)},showErrorWithImportButton:function(t){var e=this;this.gui.createWindow(),this.gui.windowAddInfoText(t),this.gui.windowAddBottomButtons([{text:kn.lo("import")+"...",onHover:function(){e.game.setOnClickTo=function(){var t=window.document.getElementById("importFile");t.value="",t.click(),e.game.onClick=null}},action:function(){}}])},handleMouse:function(t){if(this.gui.handleMouse(t)){for(var e=0,i=this.bottomButtons;e<i.length;){var n=i[e];++e,n.alpha=.7}for(e=0,i=this.otherButtons;e<i.length;){var s=i[e];++e,s.theSprite.alpha=.7}return!0}if(this.bottomButtonStage.visible){for(e=0,i=this.bottomButtons;e<i.length;){n=i[e];if(++e,t.get_x()>=n.position.x&&t.get_x()<=n.position.x+n.get_textWidth()&&t.get_y()>n.position.y+2&&t.get_y()<=n.position.y+n.get_textHeight()){switch(t.claimMouse(n)._hx_index){case 0:n.alpha=1;break;case 1:n.alpha=1,this.bottomButtonStage.visible=!1,this.bottomButtonOnClick.h[n.__id__](),C.get().playSound(C.get().buttonSound);break;case 2:n.alpha=.85}null!=this.bottomButtonOnHover.h[n.__id__]&&this.bottomButtonOnHover.h[n.__id__]()}else n.alpha=.7+(this.bottomButtonAttract.h[n.__id__]?.30000000000000004*Math.sin(.08*this.totalTimeOnMenu):0)}for(e=0,i=this.otherButtons;e<i.length;){s=i[e];if(++e,t.get_x()>=s.theSprite.position.x&&t.get_x()<s.theSprite.position.x+s.theSprite.width&&t.get_y()>=s.theSprite.position.y&&t.get_y()<s.theSprite.position.y+s.theSprite.height){switch(t.claimMouse(s)._hx_index){case 0:s.theSprite.alpha=1;break;case 1:s.theSprite.alpha=1,null!=s.onClick&&s.onClick(),C.get().playSound(C.get().buttonSound);break;case 2:s.theSprite.alpha=.85}null!=s.onHover&&s.onHover()}else s.theSprite.alpha=.7}for(e=0,i=this.rightBadges;e<i.length;){var r=[i[e]];++e,t.get_x()*this.game.get_preDPIAdjustScaling()>=r[0].sprite.position.x&&t.get_x()*this.game.get_preDPIAdjustScaling()<r[0].sprite.position.x+r[0].sprite.width&&t.get_y()*this.game.get_preDPIAdjustScaling()>=r[0].sprite.position.y&&t.get_y()*this.game.get_preDPIAdjustScaling()<r[0].sprite.position.y+r[0].sprite.height&&(this.game.setOnClickTo=function(t){return function(){t[0].url.indexOf("steam"),window.open(t[0].url,"_blank")}}(r))}}else null!=this.gui.window&&"privacyWindow"==this.gui.windowRelatedTo&&t.pressed&&(this.gui.goPreviousWindow(),C.get().playSound(C.get().buttonSound));null!=this.siteLogo&&this.siteLogo.visible&&this.siteLogo.parent;return t.pressed&&t.get_y()>this.visibilityGraphicsYStart&&t.get_y()<this.visibilityGraphicsYEnd&&(!this.game.isMobile||this.game.isLargeMobile)&&this.clickDisplayCity(),!1},update:function(t){this.game.keyboard.anyBack(),this.updateDisplayCity(t),this.gui.update(t),this.bgCity.update(t);var e=null==this.gui.window&&!jsFunctions.crossPromoIsVisible();this.bottomButtonStage.visible=e;e=null==this.gui.window&&!jsFunctions.crossPromoIsVisible();this.unscaledStage.visible=e,null!=this.siteLogo&&(e=null==this.gui.window&&!jsFunctions.crossPromoIsVisible(),this.siteLogo.visible=e),this.totalTimeOnMenu+=t},updateDisplayCity:function(t){0<this.displayCityActivation?(this.displayCityActivation=Math.min(1,this.displayCityActivation+.025*t),this.visibilityGraphics.alpha=this.displayCityActivation):this.bgCity.simulation.time.timeSinceStart=0},clickDisplayCity:function(){},postDraw:function(){this.bgCity.postDraw()},resize:function(){this.bottomButtonStage.scale.x=this.bottomButtonStage.scale.y=this.game.scaling,this.infoStage.scale.x=this.infoStage.scale.y=this.game.scaling;var t=this.game.scaling,e=this.game.get_preDPIAdjustScaling();this.unscaledStage.scale.x=this.unscaledStage.scale.y=t/e,this.bgCity.resize(),this.gui.resize(),this.positionUIElements()},refocus:function(){this.bgCity.refocus()},stop:function(){this.bgCity.stop(),this.unscaledStage.destroy()},pause:function(){},resume:function(){},onContextRestored:function(){this.bgCity.onContextRestored()},__class__:P};var M=function(t,e,i,n,s,r,o,a,l,h){null==h&&(h=0),null==l&&(l=0),null==a&&(a=0),null==o&&(o=0),null==r&&(r=0),null==s&&(s=0),null==n&&(n=0),null==i&&(i=0),null==e&&(e=0),null==t&&(t=0),this.set_food(i),this.wood=t,this.stone=e,this.machineParts=n,this.refinedMetal=r,this.computerChips=o,this.cacao=a,this.chocolate=l,this.graphene=h,this.knowledge=s};(V.Materials=M).__name__="Materials",M.fromBuildingInfo=function(t){var e=new M;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},M.fromBuildingUpgradesInfo=function(t){var e=new M;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},M.fromCityUpgradesInfo=function(t){var e=new M;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},M.fromPoliciesInfo=function(t){var e=new M;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},M.fromDecorationInfo=function(t){var e=new M;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},M.fromWorldResourceInfo=function(t){var e=new M;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},M.fromStoryMaterials=function(t){var e=new M;null!=t.food&&e.set_food(t.food),null!=t.wood&&(e.wood=t.wood),null!=t.stone&&(e.stone=t.stone),null!=t.machineParts&&(e.machineParts=t.machineParts),null!=t.refinedMetal&&(e.refinedMetal=t.refinedMetal),null!=t.computerChips&&(e.computerChips=t.computerChips),null!=t.cacao&&(e.cacao=t.cacao),null!=t.chocolate&&(e.chocolate=t.chocolate),null!=t.graphene&&(e.graphene=t.graphene);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;null!=t[s]&&(e[s]=t[s])}return null!=t.knowledge&&(e.knowledge=t.knowledge),e},M.prototype={set_food:function(t){this.food=t;var e,i=this.cacao+this.chocolate;return t<i&&(e=Math.min(this.cacao,i-t),this.cacao-=e,i-=e,e=Math.min(this.chocolate,i-t),this.chocolate-=e,0),t},canAfford:function(t){if(t.food>this.food)return!1;if(t.wood>this.wood)return!1;if(t.stone>this.stone)return!1;if(t.machineParts>this.machineParts)return!1;if(t.refinedMetal>this.refinedMetal)return!1;if(t.computerChips>this.computerChips)return!1;if(t.cacao>this.cacao)return!1;if(t.chocolate>this.chocolate)return!1;if(t.graphene>this.graphene)return!1;for(var e=0,i=z.modMaterials;e<i.length;){var n=i[e];++e;n=n.variableName;if(t[n]>this[n])return!1}return!(t.knowledge>this.knowledge)},canAffordNumber:function(t){var e=1e9;if(t.food>this.food)return 0;if(0<t.food&&(r=Math.floor(this.food/t.food))<e&&(e=r),t.wood>this.wood)return 0;if(0<t.wood&&(r=Math.floor(this.wood/t.wood))<e&&(e=r),t.stone>this.stone)return 0;if(0<t.stone&&(r=Math.floor(this.stone/t.stone))<e&&(e=r),t.machineParts>this.machineParts)return 0;if(0<t.machineParts&&(r=Math.floor(this.machineParts/t.machineParts))<e&&(e=r),t.refinedMetal>this.refinedMetal)return 0;if(0<t.refinedMetal&&(r=Math.floor(this.refinedMetal/t.refinedMetal))<e&&(e=r),t.computerChips>this.computerChips)return 0;if(0<t.computerChips&&(r=Math.floor(this.computerChips/t.computerChips))<e&&(e=r),t.cacao>this.cacao)return 0;if(0<t.cacao&&(r=Math.floor(this.cacao/t.cacao))<e&&(e=r),t.chocolate>this.chocolate)return 0;if(0<t.chocolate&&(r=Math.floor(this.chocolate/t.chocolate))<e&&(e=r),t.graphene>this.graphene)return 0;0<t.graphene&&(r=Math.floor(this.graphene/t.graphene))<e&&(e=r);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;var r,s=s.variableName;if(t[s]>this[s])return 0;0<t[s]&&(r=Math.floor(this[s]/t[s]))<e&&(e=r)}return t.knowledge>this.knowledge?0:(0<t.knowledge&&(r=Math.floor(this.knowledge/t.knowledge))<e&&(e=r),e)},remove:function(t){(e=this).set_food(e.food-t.food),this.wood-=t.wood,this.stone-=t.stone,this.machineParts-=t.machineParts,this.refinedMetal-=t.refinedMetal,this.computerChips-=t.computerChips,this.cacao-=t.cacao,this.chocolate-=t.chocolate,this.graphene-=t.graphene;for(var e=0,i=z.modMaterials;e<i.length;){var n=i[e];++e;n=n.variableName;this[n]-=t[n]}this.knowledge-=t.knowledge},add:function(t){(e=this).set_food(e.food+t.food),this.wood+=t.wood,this.stone+=t.stone,this.machineParts+=t.machineParts,this.refinedMetal+=t.refinedMetal,this.computerChips+=t.computerChips,this.cacao+=t.cacao,this.chocolate+=t.chocolate,this.graphene+=t.graphene;for(var e=0,i=z.modMaterials;e<i.length;){var n=i[e];++e;n=n.variableName;this[n]+=t[n]}this.knowledge+=t.knowledge},multiply:function(t){(e=this).set_food(e.food*t),this.wood*=t,this.stone*=t,this.machineParts*=t,this.refinedMetal*=t,this.computerChips*=t,this.cacao*=t,this.chocolate*=t,this.graphene*=t;for(var e=0,i=z.modMaterials;e<i.length;){var n=i[e];++e,this[n.variableName]*=t}this.knowledge*=t},roundAll:function(){this.set_food(Math.round(this.food)),this.wood=Math.round(this.wood),this.stone=Math.round(this.stone),this.machineParts=Math.round(this.machineParts),this.refinedMetal=Math.round(this.refinedMetal),this.computerChips=Math.round(this.computerChips),this.cacao=Math.round(this.cacao),this.chocolate=Math.round(this.chocolate),this.graphene=Math.round(this.graphene);for(var t=0,e=z.modMaterials;t<e.length;){var i=e[t];++t;i=i.variableName;this[i]=Math.round(this[i])}this.knowledge=Math.round(this.knowledge)},addToProduction:function(t){var e=z.findMaterialIndex("food");t.materialProduction[e][0]+=this.food;e=z.findMaterialIndex("wood");t.materialProduction[e][0]+=this.wood;e=z.findMaterialIndex("stone");t.materialProduction[e][0]+=this.stone;e=z.findMaterialIndex("machineParts");t.materialProduction[e][0]+=this.machineParts;e=z.findMaterialIndex("refinedMetal");t.materialProduction[e][0]+=this.refinedMetal;e=z.findMaterialIndex("computerChips");t.materialProduction[e][0]+=this.computerChips;e=z.findMaterialIndex("cacao");t.materialProduction[e][0]+=this.cacao;e=z.findMaterialIndex("chocolate");t.materialProduction[e][0]+=this.chocolate;e=z.findMaterialIndex("graphene");t.materialProduction[e][0]+=this.graphene;for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName,e=z.findMaterialIndex(s);t.materialProduction[e][0]+=this[s]}e=z.findMaterialIndex("knowledge");t.materialProduction[e][0]+=this.knowledge},addToConsumption:function(t){var e=z.findMaterialIndex("food");t.materialUsed[e][0]+=this.food;e=z.findMaterialIndex("wood");t.materialUsed[e][0]+=this.wood;e=z.findMaterialIndex("stone");t.materialUsed[e][0]+=this.stone;e=z.findMaterialIndex("machineParts");t.materialUsed[e][0]+=this.machineParts;e=z.findMaterialIndex("refinedMetal");t.materialUsed[e][0]+=this.refinedMetal;e=z.findMaterialIndex("computerChips");t.materialUsed[e][0]+=this.computerChips;e=z.findMaterialIndex("cacao");t.materialUsed[e][0]+=this.cacao;e=z.findMaterialIndex("chocolate");t.materialUsed[e][0]+=this.chocolate;e=z.findMaterialIndex("graphene");t.materialUsed[e][0]+=this.graphene;for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName,e=z.findMaterialIndex(s);t.materialUsed[e][0]+=this[s]}e=z.findMaterialIndex("knowledge");t.materialUsed[e][0]+=this.knowledge},any:function(){if(0<this.food)return!0;if(0<this.wood)return!0;if(0<this.stone)return!0;if(0<this.machineParts)return!0;if(0<this.refinedMetal)return!0;if(0<this.computerChips)return!0;if(0<this.cacao)return!0;if(0<this.chocolate)return!0;if(0<this.graphene)return!0;for(var t=0,e=z.modMaterials;t<e.length;){var i=e[t];if(++t,0<this[i.variableName])return!0}return 0<this.knowledge},anyMaterialDifferent:function(t){if(this.food!=t.food)return!0;if(this.wood!=t.wood)return!0;if(this.stone!=t.stone)return!0;if(this.machineParts!=t.machineParts)return!0;if(this.refinedMetal!=t.refinedMetal)return!0;if(this.computerChips!=t.computerChips)return!0;if(this.cacao!=t.cacao)return!0;if(this.chocolate!=t.chocolate)return!0;if(this.graphene!=t.graphene)return!0;for(var e=0,i=z.modMaterials;e<i.length;){var n=i[e];++e;n=n.variableName;if(this[n]!=t[n])return!0}return this.knowledge!=t.knowledge},copy:function(){var t=new M;return t.add(this),t},save:function(t,e){null==e&&(e=!0),this.saveBasics(t,e);var i=z.modMaterials.length;t.size+4>t.bytes.length&&(o=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,o,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;for(var n=0,s=z.modMaterials;n<s.length;){var r=s[n];++n,t.addString(r.variableName);var o,i=this[r.variableName];t.size+8>t.bytes.length&&(o=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,o,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8}},load:function(t,e){if(this.loadBasics(t,e),31<=t.version){e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var s=t.readString(),r=t.bytes.getDouble(t.readStart);t.readStart+=8,this[s]=r}}},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(M.saveDefinition);e=this.wood;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.stone;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.food;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.machineParts;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.knowledge;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.refinedMetal;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.computerChips;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.graphene;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.cacao;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.chocolate;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"wood")&&(this.wood=t.h.wood),Object.prototype.hasOwnProperty.call(t.h,"stone")&&(this.stone=t.h.stone),Object.prototype.hasOwnProperty.call(t.h,"food")&&this.set_food(t.h.food),Object.prototype.hasOwnProperty.call(t.h,"machineParts")&&(this.machineParts=t.h.machineParts),Object.prototype.hasOwnProperty.call(t.h,"knowledge")&&(this.knowledge=t.h.knowledge),Object.prototype.hasOwnProperty.call(t.h,"refinedMetal")&&(this.refinedMetal=t.h.refinedMetal),Object.prototype.hasOwnProperty.call(t.h,"computerChips")&&(this.computerChips=t.h.computerChips),Object.prototype.hasOwnProperty.call(t.h,"graphene")&&(this.graphene=t.h.graphene),Object.prototype.hasOwnProperty.call(t.h,"cacao")&&(this.cacao=t.h.cacao),Object.prototype.hasOwnProperty.call(t.h,"chocolate")&&(this.chocolate=t.h.chocolate)},__class__:M};var z=function(){};(V.MaterialsHelper=z).__name__="MaterialsHelper",z.findMaterialIndex=function(t){return z.materialNames.indexOf(t)},z.findMaterialName=function(t){return z.materialNames[t]},Math.__name__="Math";var A=x.MouseState={__ename__:"MouseState",__constructs__:["Active","Confirmed","None"],Active:{_hx_index:0,__enum__:"MouseState",toString:i},Confirmed:{_hx_index:1,__enum__:"MouseState",toString:i},None:{_hx_index:2,__enum__:"MouseState",toString:i}},W=function(){this.timeMod=0,this.scrollBarNextMovementPages=0,this.scrollBarMovementPages=0,this.scrollBarNextMovement=0,this.scrollBarMovement=0,this.nextTickReset=12,this.mouseDownTick=0,this.isTouch=!1,this.disableCityMovement=!1,this.strongClaimOnEnd=null,this.strongClaimOnUpdate=null,this.hasStrongClaim=!1,this.additionalClaimData=null,this.activeObject=null,this.nextStepQuietReleased=!1,this.nextStepMiddleReleased=!1,this.nextStepMiddleDown=!1,this.nextStepRightReleased=!1,this.nextStepRightDown=!1,this.nextStepReleased=!1,this.nextStepDown=!1,this.middleDown=!1,this.middleReleased=!1,this.middlePressed=!1,this.rightDown=!1,this.rightReleased=!1,this.rightPressed=!1,this.moved=!1,this.down=!1,this.released=!1,this.pressed=!1,this.position=new Cn(0,0),this.unscaledPosition=new Cn(0,0),this.cityPosition=new Cn(0,0),this.mouseDownTick=0,this.pointerDown=[],this.pointerUnscaledPosition=new Ir,this.pointerPosition=new Ir,this.pointerCityScaledPosition=new Ir,this.pointerCityPosition=new Ir};(V.Mouse=W).__name__="Mouse",W.prototype={get_x:function(){return this.position.x},get_y:function(){return this.position.y},get_cityX:function(){return this.cityPosition.x},get_cityY:function(){return this.cityPosition.y},claimMouse:function(t,e,i,n,s){return null==s&&(s=!1),null==n&&(n=!1),null==i&&(i=!0),this.pressed&&(this.activeObject=t,this.additionalClaimData=e,this.disableCityMovement=i,this.hasStrongClaim=!1),this.activeObject==t&&this.additionalClaimData==e?n?this.released?(this.releaseClaim(),A.None):this.down&&(this.mouseDownTick<=0||s)?(this.mouseDownTick+=this.nextTickReset,--this.nextTickReset,this.nextTickReset<=2&&(this.nextTickReset=2),A.Confirmed):A.Active:this.released?(this.releaseAllClaims(!0),A.Confirmed):A.Active:(this.releaseClaim(),A.None)},weakClaimForScroll:function(t){return(null==this.activeWeakObject||this.activeWeakObject==t)&&(!this.hasStrongClaim&&(this.activeWeakObject==t?10<=Cn.distance(this.weakClaimStartPos,this.position)&&(this.activeWeakObject=null,this.releaseAllClaims(),!0):(this.pressed&&(this.activeWeakObject=t,this.weakClaimStartPos=this.position),!1)))},hasNoClaim:function(){return null==this.activeObject},hasSpecificClaim:function(t){return this.activeObject==t},strongClaimMouse:function(t,e,i){return null==i&&(i=!0),!(this.activeObject!=t||!this.hasStrongClaim)||!(!this.pressed&&i)&&(this.activeObject=t,this.disableCityMovement=!0,this.hasStrongClaim=!0,this.strongClaimOnUpdate=e,!0)},preHandling:function(){this.released&&this.hasStrongClaim&&this.releaseAllClaims(!0),this.down||(this.disableCityMovement=!1)},afterHandling:function(){this.hasStrongClaim&&null!=this.strongClaimOnUpdate&&this.strongClaimOnUpdate()},releaseAllClaims:function(t){null==t&&(t=!1),this.releaseClaim(t),this.releaseWeakClaim()},releaseClaim:function(t){null==t&&(t=!1),!t&&this.hasStrongClaim||(null!=this.strongClaimOnEnd&&this.strongClaimOnEnd(),this.activeObject=null,this.additionalClaimData=null,this.mouseDownTick=0,this.nextTickReset=12,this.hasStrongClaim=!1,this.strongClaimOnEnd=null)},releaseWeakClaim:function(){this.activeWeakObject=null},calcCityPosition:function(t,e){var i=this.unscaledPosition,n=(t.rect.width/2|0)*t.scaling,s=(t.rect.height/2|0)*t.scaling,r=l=i.x-n,o=a=i.y-s,i=e.zoomScale,a=o/i,r=(l=r/i)-(n=t.addX),o=a-(s=t.addY),e=e.viewPos,l=r+e.x,a=o+e.y;return new Cn(Math.floor(l),Math.floor(a))},calcCityPositionForPointer:function(t,e,i){i=this.calcCityFPositionForPointer(t,e,i);return new Cn(Math.floor(i.x),Math.floor(i.y))},calcCityFPositionForPointer:function(t,e,i){var n=this.pointerUnscaledPosition.h[i],s=(t.rect.width/2|0)*t.scaling,r=(t.rect.height/2|0)*t.scaling,o=n.x-s,i=a=n.y-r,n=e.zoomScale,a=i/n,o=o/n-(s=t.addX),i=a-(r=t.addY),e=e.viewPos;return new In(o+e.x,i+e.y)},getActiveObject:function(){return this.activeObject},resetPosition:function(){this.position=new Cn(-1e5,-1e5),this.unscaledPosition=new Cn(-1e5,-1e5),this.cityScaledPosition=new In(-1e5,-1e5),this.cityPosition=new Cn(-1e5,-1e5)},__class__:W};var F=function(t,e,i){this.game=t,this.stage=e;var n=new PIXI.Container;e.addChild(n),this.bgCity=new g(t,n,i,!0,"___"),this.guiStage=new PIXI.Container,e.addChild(this.guiStage),this.gui=new f(t,this.guiStage),this.resize(),this.startUI(i),this.resize()};(V.NewGameCreator=F).__name__="NewGameCreator",F.__interfaces__=[s],F.prototype={get_publicGUI:function(){return this.gui},startUI:function(e){var t,i,n=tt.find(H.allStoriesInfo,function(t){return t.link==e}).freePlay;null!=n&&n?(t=fa(this,this.createSaveWindow),i=e,bs.createWindow(this.bgCity,this.gui,function(){t(i,!1)},fa(B=this.game,B.restoreState))):this.createSaveWindow(e)},createSaveWindow:function(e,t){null==t&&(t=!0);var i=this;this.gui.windowOnDestroy=null,Vs.createSaveWindow(this.game,this.gui,kn.lo("save_slot_choice"),function(t){i.bgCity.disableDisplayOnlyMode(t),i.bgCity.progress.unlocks.postInitialCreate(),k.doPlay(),p.sendEvent("game","newGame",null,e),i.game.switchState(i.bgCity),k.onCitySwitch(!0),i.guiStage.destroy()},function(){t&&i.game.restoreState()})},handleMouse:function(t){return!!this.gui.handleMouse(t)},update:function(t){this.bgCity.update(t),this.gui.update(t)},postDraw:function(){this.bgCity.postDraw()},resize:function(){this.bgCity.resize(),this.gui.resize()},refocus:function(){this.bgCity.refocus()},stop:function(){this.bgCity.stop()},pause:function(){},resume:function(){},onContextRestored:function(){this.bgCity.onContextRestored()},__class__:F};var O=t.Perf=function(t,e){null==e&&(e=0),null==t&&(t="TR"),this._perfObj=window.performance,null!=D.field(this._perfObj,"memory")&&(this._memoryObj=D.field(this._perfObj,"memory")),this._memCheck=null!=this._perfObj&&null!=this._memoryObj&&0<this._memoryObj.totalJSHeapSize,this._pos=t,this._offset=e,this.currentFps=60,this.currentMs=0,this.currentMem="0",this.lowFps=60,this.avgFps=60,this._measureCount=0,this._totalFps=0,this._time=0,this._ticks=0,this._fpsMin=60,this._fpsMax=60,this._startTime=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime(),this._prevTime=-O.MEASUREMENT_INTERVAL,this._createFpsDom(),this._createMsDom(),this._memCheck&&this._createMemoryDom(),null!=window.requestAnimationFrame?this.RAF=fa(B=window,B.requestAnimationFrame):null!=window.mozRequestAnimationFrame?this.RAF=window.mozRequestAnimationFrame:null!=window.webkitRequestAnimationFrame?this.RAF=window.webkitRequestAnimationFrame:null!=window.msRequestAnimationFrame&&(this.RAF=window.msRequestAnimationFrame),null!=window.cancelAnimationFrame?this.CAF=fa(B=window,B.cancelAnimationFrame):null!=window.mozCancelAnimationFrame?this.CAF=window.mozCancelAnimationFrame:null!=window.webkitCancelAnimationFrame?this.CAF=window.webkitCancelAnimationFrame:null!=window.msCancelAnimationFrame&&(this.CAF=window.msCancelAnimationFrame),null!=this.RAF&&(e=window,this._raf=this.RAF.apply(e,[fa(this,this._tick)]))};(V.Perf=O).__name__="Perf",O.prototype={_init:function(){this.currentFps=60,this.currentMs=0,this.currentMem="0",this.lowFps=60,this.avgFps=60,this._measureCount=0,this._totalFps=0,this._time=0,this._ticks=0,this._fpsMin=60,this._fpsMax=60,this._startTime=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime(),this._prevTime=-O.MEASUREMENT_INTERVAL},_now:function(){return null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime()},_tick:function(t){var e=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime();this._ticks++,null!=this._raf&&e>this._prevTime+O.MEASUREMENT_INTERVAL&&(this.currentMs=Math.round(e-this._startTime),this.ms.innerHTML="MS: "+this.currentMs,this.currentFps=Math.round(1e3*this._ticks/(e-this._prevTime)),0<this.currentFps&&t>O.DELAY_TIME&&(this._measureCount++,this._totalFps+=this.currentFps,this.lowFps=this._fpsMin=Math.min(this._fpsMin,this.currentFps),this._fpsMax=Math.max(this._fpsMax,this.currentFps),this.avgFps=Math.round(this._totalFps/this._measureCount)),this.fps.innerHTML="FPS: "+this.currentFps+" ("+this._fpsMin+"-"+this._fpsMax+")",30<=this.currentFps?this.fps.style.backgroundColor=O.FPS_BG_CLR:15<=this.currentFps?this.fps.style.backgroundColor=O.FPS_WARN_BG_CLR:this.fps.style.backgroundColor=O.FPS_PROB_BG_CLR,this._prevTime=e,this._ticks=0,this._memCheck&&(this.currentMem=this._getFormattedSize(this._memoryObj.usedJSHeapSize,2),this.memory.innerHTML="MEM: "+this.currentMem)),this._startTime=e,null!=this._raf&&(e=window,this._raf=this.RAF.apply(e,[fa(this,this._tick)]))},_createDiv:function(t,e){null==e&&(e=0);var i=window.document.createElement("div");switch(i.id=t,i.className=t,i.style.position="absolute",this._pos){case"BL":i.style.left=this._offset+"px",i.style.bottom=(this._memCheck?48:32)-e+"px";break;case"BR":i.style.right=this._offset+"px",i.style.bottom=(this._memCheck?48:32)-e+"px";break;case"TL":i.style.left=this._offset+"px",i.style.top=e+"px";break;case"TR":i.style.right=this._offset+"px",i.style.top=e+"px"}return i.style.width="80px",i.style.height="12px",i.style.lineHeight="12px",i.style.padding="2px",i.style.fontFamily=O.FONT_FAMILY,i.style.fontSize="9px",i.style.fontWeight="bold",i.style.textAlign="center",window.document.body.appendChild(i),i},_createFpsDom:function(){this.fps=this._createDiv("fps"),this.fps.style.backgroundColor=O.FPS_BG_CLR,this.fps.style.zIndex="995",this.fps.style.color=O.FPS_TXT_CLR,this.fps.innerHTML="FPS: 0"},_createMsDom:function(){this.ms=this._createDiv("ms",16),this.ms.style.backgroundColor=O.MS_BG_CLR,this.ms.style.zIndex="996",this.ms.style.color=O.MS_TXT_CLR,this.ms.innerHTML="MS: 0"},_createMemoryDom:function(){this.memory=this._createDiv("memory",32),this.memory.style.backgroundColor=O.MEM_BG_CLR,this.memory.style.color=O.MEM_TXT_CLR,this.memory.style.zIndex="997",this.memory.innerHTML="MEM: 0"},_getFormattedSize:function(t,e){null==e&&(e=0);if(0==t)return"0";var i=Math.pow(10,e),e=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t*i/Math.pow(1024,e))/i+" "+["Bytes","KB","MB","GB","TB"][e]},addInfo:function(t){this.info=this._createDiv("info",this._memCheck?48:32),this.info.style.backgroundColor=O.INFO_BG_CLR,this.info.style.color=O.INFO_TXT_CLR,this.info.style.zIndex="998",this.info.innerHTML=t},clearInfo:function(){null!=this.info&&(window.document.body.removeChild(this.info),this.info=null)},destroy:function(){var t=window;this.CAF.apply(t,[this._raf]),this._raf=null,this._perfObj=null,(this._memoryObj=null)!=this.fps&&(window.document.body.removeChild(this.fps),this.fps=null),null!=this.ms&&(window.document.body.removeChild(this.ms),this.ms=null),null!=this.memory&&(window.document.body.removeChild(this.memory),this.memory=null),this.clearInfo(),this.currentFps=60,this.currentMs=0,this.currentMem="0",this.lowFps=60,this.avgFps=60,this._measureCount=0,this._totalFps=0,this._time=0,this._ticks=0,this._fpsMin=60,this._fpsMax=60,this._startTime=null!=this._perfObj&&null!=this._perfObj.now?this._perfObj.now():(new Date).getTime(),this._prevTime=-O.MEASUREMENT_INTERVAL},_cancelRAF:function(){var t=window;this.CAF.apply(t,[this._raf]),this._raf=null},__class__:O};var $=function(){};(V.PermanentMetaHelper=$).__name__="PermanentMetaHelper",$.getClassIDLength=function(){return $.buildingClassesNumber},$.getClassID=function(t){var e=$.registeredClassNames.h[t];if(null!=e)return e;e=$.buildingClassesNumber;return $.registeredClassNames.h[t]=e,$.buildingClassesNumber++,$.buildingClassesNumber-1};var D=function(){};(V.Reflect=D).__name__="Reflect",D.field=function(t,e){try{return t[e]}catch(t){return null}},D.fields=function(t){var e=[];if(null!=t){var i,n=Object.prototype.hasOwnProperty;for(i in t)"__id__"!=i&&"hx__closures__"!=i&&n.call(t,i)&&e.push(i)}return e},D.isFunction=function(t){return"function"==typeof t&&!(t.__name__||t.__ename__)},D.deleteField=function(t,e){return!!Object.prototype.hasOwnProperty.call(t,e)&&(delete t[e],!0)},D.copy=function(t){if(null==t)return null;for(var e={},i=0,n=D.fields(t);i<n.length;){var s=n[i];++i,e[s]=D.field(t,s)}return e};var H=function(){};(V.Resources=H).__name__="Resources",H.getTextures=function(t,e,i){null==i&&(i=!1);var n=t+"%num%"+e;if(i&&(n+="%s%"),Object.prototype.hasOwnProperty.call(H.multiTextureCache.h,n))return H.multiTextureCache.h[n];for(var s=[],r=0,o=e;r<o;){var a=r++,l=PIXI.Texture.fromFrame(t+".png").clone(),h=((l.frame.width+2|0)/e|0)-(i?1:2);l.frame=new PIXI.Rectangle(l.frame.x+(h+(i?1:2))*a-(i&&a%2==1?1:0),l.frame.y,h,l.frame.height),s.push(l)}return H.multiTextureCache.h[n]=s},H.getTexturesByWidth=function(t,e,i){null==i&&(i=!1);var n=t+"%width%"+e;if(i&&(n+="%s%"),Object.prototype.hasOwnProperty.call(H.multiTextureCache.h,n))return H.multiTextureCache.h[n];i=H.getTextures(t,(PIXI.Texture.fromFrame(t+".png").width+2)/(e+(i?1:2))|0,i);return H.multiTextureCache.h[n]=i},H.getTexturesAsGrid=function(t,e,i,n,s){null==s&&(s=!1),null==n&&(n=0);var r=t+"%numW%"+e+"%numH%"+i;if(s&&(r+="%s%"),Object.prototype.hasOwnProperty.call(H.multiTextureCache2.h,r))return H.multiTextureCache2.h[r];for(var o=[],a=0,l=e;a<l;){var h=a++;o[h]=[];for(var u=0,d=i;u<d;){var c=u++,p=PIXI.Texture.fromFrame(t+".png").clone(),g=((p.frame.width+2|0)/e|0)-(s?1:n),m=(0|p.frame.height)/i|0;p.frame=new PIXI.Rectangle(p.frame.x+(g+(s?1:n))*h-(s&&h%2==1?1:0),p.frame.y+m*c,g,m),o[h].push(p)}}return H.multiTextureCache2.h[r]=o},H.getTexturesBySize=function(t,e,i,n,s){null==s&&(s=!1),null==n&&(n=0);var r=t+"%width%"+e+"%height%"+i;if(s&&(r+="%s%"),Object.prototype.hasOwnProperty.call(H.multiTextureCache2.h,r))return H.multiTextureCache2.h[r];s=H.getTexturesAsGrid(t,(PIXI.Texture.fromFrame(t+".png").width+n)/(e+(s?1:n))|0,PIXI.Texture.fromFrame(t+".png").height/i|0,null,s);return H.multiTextureCache2.h[r]=s},H.getTexture=function(t,e){var i=null!=e?t+"@"+e.x+","+e.y+","+e.width+","+e.height:t;if(Object.prototype.hasOwnProperty.call(H.singleTextureCache.h,i))return H.singleTextureCache.h[i];if(null==e&&-1!=t.indexOf("@")){var n=t.split("@");t=n[0];for(var s=n[1].split(","),r=new Array(s.length),o=0,a=s.length;o<a;){var l=o++;r[l]=q.parseInt(s[l])}e=new xn(r[0],r[1],r[2],r[3])}t=PIXI.Texture.fromFrame(t+".png").clone();return null!=e&&(t.frame=new PIXI.Rectangle(t.frame.x+e.x,t.frame.y+e.y,e.width,e.height)),H.singleTextureCache.h[i]=t},H.makeSprite=function(t,e){return new PIXI.Sprite(H.getTexture(t,e))},H.initializeCityResources=function(t){t.buildingInfoArray=[];for(var e=0,i=H.buildingInfoArray;e<i.length;){var n=i[e];++e,t.buildingInfoArray.push(D.copy(n))}t.buildingInfo=new zr;for(e=0,i=t.buildingInfoArray;e<i.length;){var s=i[e];++e,t.buildingInfo.h["buildings."+s.className]=s}};var R=function(){};(V.Settings=R).__name__="Settings",R.loadLanguages=function(){kn.loadLanguage("en",!0,function(){"en"!=R.language?kn.loadLanguage(R.language,!1,function(){R.settingsLoaded=!0},function(){}):R.settingsLoaded=!0},function(){})},R.load=function(){null==On.getItem("tfe2_settings",function(t,e){null==t&&null!=e&&(R.musicOn=e.musicOn,R.soundOn=e.soundOn,null!=e.pathfindingWorkers&&(R.pathfindingWorkers=e.pathfindingWorkers),null!=e.secretCodesEnabled&&(R.secretCodesEnabled=e.secretCodesEnabled),null!=e.boostHidden&&(R.boostHidden=e.boostHidden),null!=e.colorBlindMode&&(R.colorBlindMode=e.colorBlindMode),null!=e.musicVolume&&(R.musicVolume=e.musicVolume),null!=e.soundVolume&&(R.soundVolume=e.soundVolume),null!=e.language&&(R.language=e.language),R.fullscreen=e.isFullScreen),R.loadLanguages()})&&(R.language=R.getLanguage(),R.loadLanguages()),R.pathfindingWorkers<=0&&R.resetPathfindingWorkers()},R.getLanguage=function(){var t=o.navigator.language;if(null!=t&&""!=t&&"en"==t.split("-")[0])return"en";return"en"},R.resetPathfindingWorkers=function(){if(R.pathfindingWorkers=1,null!=o.navigator&&null!=o.navigator.hardwareConcurrency)try{var t=(o.navigator.hardwareConcurrency/2|0)-1;R.pathfindingWorkers=t<1?1:7<t?7:t}catch(t){R.pathfindingWorkers=1}return R.pathfindingWorkers},R.save=function(){var t={};t.musicOn=R.musicOn,t.soundOn=R.soundOn,t.boostHidden=R.boostHidden,t.colorBlindMode=R.colorBlindMode,t.pathfindingWorkers=R.pathfindingWorkers,t.secretCodesEnabled=R.secretCodesEnabled,t.musicVolume=R.musicVolume,t.soundVolume=R.soundVolume,t.language=R.language,On.setItem("tfe2_settings",t,function(){})},R.hasSecretCode=function(t){return-1!=R.secretCodesEnabled.indexOf(t)},R.unlockSecretCode=function(t){R.hasSecretCode(t)||(R.secretCodesEnabled.push(t),R.save())},R.loadFromCitySave=function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;R.unlockSecretCode(t.readString())}},R.saveToCitySave=function(t){var e,i=R.secretCodesEnabled.length;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;for(var n=0,s=R.secretCodesEnabled;n<s.length;){var r=s[n];++n,t.addString(r)}},R.update=function(){};var q=function(){};function U(){this.b=""}function N(){}(V.Std=q).__name__="Std",q.string=function(t){return Fr.__string_rec(t,"")},q.parseInt=function(t){if(null!=t)for(var e=0,i=t.length;e<i;){var n=e++,s=t.charCodeAt(n);if(s<=8||14<=s&&32!=s&&45!=s){n=t.charCodeAt(1+n),n=parseInt(t,120==n||88==n?16:10);return isNaN(n)?null:n}}return null},q.random=function(t){return t<=0?0:Math.floor(Math.random()*t)},(V.StringBuf=U).__name__="StringBuf",U.prototype={__class__:U},(V.StringTools=N).__name__="StringTools",N.startsWith=function(t,e){return t.length>=e.length&&0==t.lastIndexOf(e,0)},N.replace=function(t,e,i){return t.split(e).join(i)};var G=x.ValueType={__ename__:"ValueType",__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"],TNull:{_hx_index:0,__enum__:"ValueType",toString:i},TInt:{_hx_index:1,__enum__:"ValueType",toString:i},TFloat:{_hx_index:2,__enum__:"ValueType",toString:i},TBool:{_hx_index:3,__enum__:"ValueType",toString:i},TObject:{_hx_index:4,__enum__:"ValueType",toString:i},TFunction:{_hx_index:5,__enum__:"ValueType",toString:i},TClass:((B=function(t){return{_hx_index:6,c:t,__enum__:"ValueType",toString:i}}).__params__=["c"],B),TEnum:((B=function(t){return{_hx_index:7,e:t,__enum__:"ValueType",toString:i}}).__params__=["e"],B),TUnknown:{_hx_index:8,__enum__:"ValueType",toString:i}},X=function(){};(V.Type=X).__name__="Type",X.createInstance=function(t,e){return new(Function.prototype.bind.apply(t,[null].concat(e)))},X.createEnum=function(t,e,i){var n=D.field(t,e);if(null==n)throw cr.thrown("No such constructor "+e);if(D.isFunction(n)){if(null==i)throw cr.thrown("Constructor "+e+" need parameters");return n.apply(t,i)}if(null!=i&&0!=i.length)throw cr.thrown("Constructor "+e+" does not need parameters");return n},X.typeof=function(t){switch(typeof t){case"boolean":return G.TBool;case"function":return t.__name__||t.__ename__?G.TObject:G.TFunction;case"number":return Math.ceil(t)==t%2147483648?G.TInt:G.TFloat;case"object":if(null==t)return G.TNull;var e=t.__enum__;if(null!=e)return G.TEnum(x[e]);e=Fr.getClass(t);return null!=e?G.TClass(e):G.TObject;case"string":return G.TClass(String);case"undefined":return G.TNull;default:return G.TUnknown}},X.enumParameters=function(t){var e=x[t.__enum__],i=e[e.__constructs__[t._hx_index]].__params__;if(null==i)return[];for(var n=[],s=0;s<i.length;){var r=i[s];++s,n.push(t[r])}return n};var K=function(t,e,i,n,s,r,o,a){this.appearance=null,this.isProtectedKey=!1,this.isUnbuildableFromAliens=!1,this.hasTeleporterOnGroup=!1,this.stresstest=!1,this.knownResourceInavailabilityLastResetDay=0,this.relevantWorldsForDirectCityConnectionsCache=null,this.worldGroup=null,this.game=t,this.city=e,this.rect=r,this.stage=i,this.midStage=n,this.bgStage=s,this.seed=o,this.worldGlow=null,this.appearance=a;s=new vo(o);null==o&&(this.seed=s.seed),0!=r.height?(a=qn.makeWorldSprite(s,r.width,r.height,a),this.worldSprite=a.sprite,this.mask=a.mask,this.worldSprite.position.set(r.x,r.y),i.cacheableChildren.push(this.worldSprite),i.isInvalid=!0):this.worldSprite=null;for(var i=Math.ceil(r.width/20),l=[],h=0,u=i;h<u;){h++;l.push([])}this.permanents=l;for(l=[],h=0,u=i;h<u;){h++;l.push(null)}if(this.decorations=l,!_.isLoading&&0!=r.height)for(l=0,h=i;l<h;){var d=l++;this.setDecoration("spr_grass",d)}this.reachableWorlds=[],this.knownResourceInavailability=new zr};(V.World=K).__name__="World",K.fromLoad=function(t,e,i,n,s,r){var o=t.readRectangle(),a=t.bytes.getInt32(t.readStart);t.readStart+=4;var l=a,h="";41<=t.version&&(h=t.readString());for(var u,d=new K(e,i,n,s,r,o,l,h),c=0,p=0,g=d.permanents;p<g.length;){var m=g[p];++p;a=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var f,y=a,_=0,w=y;_<w;){var b=_++,v=t.bytes.getInt32(t.readStart);t.readStart+=4;var S,x,P=v;2==P?m.push(null):(S=1==P,x=t.bytes.getInt32(t.readStart),t.readStart+=4,v=x,P=t.readString(),x=V[P],P=new Cn(c,b),b=new Cn(o.x+20*c,o.y-20*(1+b)),P=null==x?new Ui(e,n,r,i,d,b,P,v):S?X.createInstance(x,[e,n,r,i,d,b,P,v]):X.createInstance(x,[e,v,i,d,b,P,n]),m.push(P),P.load(t))}0!=y||""!=(f=t.readString())&&(y=t.bytes.getInt32(t.readStart),t.readStart+=4,d.setDecoration(f,c,y)),++c}return 27<=t.version&&(u=t.bytes.b[t.readStart],t.readStart+=1,d.isUnbuildableFromAliens=1==u,d.isUnbuildableFromAliens&&d.setUnbuildableAliens()),42<=t.version&&(u=t.bytes.b[t.readStart],t.readStart+=1,d.isProtectedKey=0<u),d},K.prototype={update:function(t){this.knownResourceInavailabilityLastResetDay!=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)&&(this.knownResourceInavailability=new zr,this.knownResourceInavailabilityLastResetDay=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)),this.isUnbuildableFromAliens||null==this.worldGlow||(this.worldGlow.alpha-=.1*t,this.worldGlow.alpha<=0&&(this.worldGlow.destroy(),this.worldGlow=null))},canBuildOnSurface:function(){return!this.isProtectedKey&&(0!=this.rect.height&&!this.isUnbuildableFromAliens)},canBuildOnNotSurface:function(t){return!(this.isProtectedKey&&!t)},onCannotBuild:function(){this.isUnbuildableFromAliens&&this.city.gui.showSimpleWindow(kn.lo("building_prevented_strange_force"),null,!0),this.isProtectedKey&&this.city.gui.showSimpleWindow(kn.lo("secret_society_forbidden"),null,!0)},onCityChange:function(){this.knownResourceInavailability=new zr},build:function(t,e,i){null!=i&&0!=i||this.removeDecoration(e);var n=this.permanents[e].length,s=null==i?n:i;if(n<s)for(var r=0,o=s-n;r<o;){var a=r++;this.permanents[e].push(null)}t=X.createInstance(t,[this.game,this.stage,this.bgStage,this.city,this,new Cn(this.rect.x+20*e,this.rect.y-20*(1+s)),new Cn(e,s),this.city.maxPermanentID++]);if(s<this.permanents[e].length&&null==this.permanents[e][s])this.permanents[e][s]=t;else if(null==i)this.permanents[e].push(t);else{this.permanents[e].splice(i,0,t);for(r=s+1,o=n+1;r<o;){a=r++;if(null==this.permanents[e][a]){this.permanents[e].splice(a,1);break}}}return t.onBuild(),t},createWorldResource:function(t,e){this.removeDecoration(e);t=X.createInstance(t,[this.game,this.city.maxPermanentID++,this.city,this,new Cn(this.rect.x+20*e,this.rect.y-20),new Cn(e,0),this.stage]);return this.permanents[e][0]=t},setDecoration:function(t,e,i){this.removeDecoration(e),0<this.permanents[e].length&&null!=this.permanents[e][0]||(this.decorations[e]=new Xn(this.stage,new Cn(this.rect.x+20*e,this.rect.y-20),t,i))},removeDecoration:function(t){null!=this.decorations[t]&&(this.decorations[t].destroy(),this.decorations[t]=null)},handleMouse:function(t){var e,i;if(!!this.stresstest&&(i=(e=this.rect).x,e.y,0==i)){this.stresstest=!1;for(var n=0;n<1250;){n++;var s=bo.getInt(this.permanents.length);0!=this.permanents[s].length&&!this.permanents[s][this.permanents[s].length-1].isBuilding||this.build(hi,s);s=bo.getInt(this.permanents.length);0!=this.permanents[s].length&&!this.permanents[s][this.permanents[s].length-1].isBuilding||this.build($e,s)}this.city.connections.updateCityConnections(),this.city.simulation.updatePathfinder(!1)}if(t.get_cityX()>=this.rect.x&&t.get_cityX()<this.rect.x+this.rect.width&&t.get_cityY()<this.rect.y){var r=this.permanents[(t.get_cityX()-this.rect.x)/20|0],o=(this.rect.y-(t.get_cityY()+1))/20|0;if(o>=r.length&&o<=r.length+3&&0<r.length&&null!=r[r.length-1]&&r[r.length-1].is(yi)&&(o=r.length-1),o<r.length&&null!=r[o])switch(t.claimMouse(r[o],null,!1)._hx_index){case 0:return r[o].onHover(!0),!0;case 1:return r[o].onClick(),!0;case 2:return r[o].onHover(!1),!1}}return!1},save:function(t){t.addRectangle(this.rect);var e=this.seed;t.size+4>t.bytes.length&&(d=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,d,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,null==this.appearance?t.addString(""):t.addString(this.appearance);for(var i=0,n=this.permanents.length;i<n;){var s=i++,r=this.permanents[s],e=r.length;t.size+4>t.bytes.length&&(d=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,d,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var o,a=0;a<r.length;){var l,h,u=r[a];++a,null==u?(t.size+4>t.bytes.length&&(h=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,h,0,t.size)),t.bytes.setInt32(t.size,2),t.size+=4):(h=u.isBuilding?1:0,t.size+4>t.bytes.length&&(l=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,l,0,t.size)),t.bytes.setInt32(t.size,h),t.size+=4,l=u.id,t.size+4>t.bytes.length&&(h=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,h,0,t.size)),t.bytes.setInt32(t.size,l),t.size+=4,t.addString(u.className),u.save(t))}0==r.length&&(null!=this.decorations[s]?(t.addString(this.decorations[s].textureName),o=this.decorations[s].subImage,t.size+4>t.bytes.length&&(s=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,s,0,t.size)),t.bytes.setInt32(t.size,o),t.size+=4):t.addString(""))}e=this.isUnbuildableFromAliens?1:0;t.size+1>t.bytes.length&&(d=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,d,0,t.size)),t.bytes.b[t.size]=e,t.size+=1;var d,e=this.isProtectedKey;t.size+1>t.bytes.length&&(d=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,d,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},setUnbuildableAliens:function(){null==this.worldGlow&&(this.worldGlow=new PIXI.Sprite(H.getTexture("spr_blueworldglow")),this.worldGlow.width=this.rect.width,this.worldGlow.position.set(this.rect.x,this.rect.y-4),this.stage.addChild(this.worldGlow),this.isUnbuildableFromAliens=!0)},setProtectedKey:function(){this.isProtectedKey=!0},makeBuildableAliens:function(){this.isUnbuildableFromAliens=!1},cleanup:function(){var t,e;null!=this.worldSprite&&(t=this.stage,e=this.worldSprite,Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e),this.worldSprite.texture.destroy(!0),this.worldSprite.destroy())},__class__:K};var j=function(t,e,i,n,s,r,o,a){this.stage=o,this.sprite=new PIXI.Sprite(a),o.addChild(this.sprite),h.call(this,t,e,i,n,s,r),this.positionSprites()};function Q(t,e,i,n){r.call(this,i,n),n.extraQuality+=25,n.extraCapacity+=50}function J(t,e,i,n){r.call(this,i,n),n.stoneMinedPerActionBoost+=.3}function Z(t,e,i,n){r.call(this,null,n),n.regrowSpeedBoost+=2}function et(t,e,i,n){r.call(this,null,n),n.nightClubEntertainmentQuantity+=40,this.addedLasers=[],this.addedLasers.push({start:new In(7,4),end:new In(6,18),hue:90,speed:.5,targetLaserHue:-1,laserSprite:null}),this.addedLasers.push({start:new In(12,4),end:new In(6,18),hue:270,speed:-.5,targetLaserHue:-1,laserSprite:null}),tt.iter(this.addedLasers,function(t){n.lasers.push(t)})}function it(t,e,i,n){r.call(this,i,n),n.stoneMinedPerActionBoost+=.2}function nt(t,e,i,n){r.call(this,i,n)}function st(t,e,i,n){r.call(this,i,n),n.extraCapacity+=1}function rt(t,e,i,n){r.call(this,null,n),2!=n.materialType&&n.resetProgress(),n.setMaterialType(2)}function ot(t,e,i,n){r.call(this,null,n),0!=n.materialType&&n.resetProgress(),n.setMaterialType(0)}function at(t,e,i,n){r.call(this,null,n),1!=n.materialType&&n.resetProgress(),n.setMaterialType(1)}function lt(t,e,i,n){r.call(this,i,n)}function ht(t,e,i,n){r.call(this,null,n),n.adjecentBuildingEffects.push({name:"restaurantCapBoost",intensity:10}),n.drawer.changeMainTexture("spr_herbgarden"),n.drawer.changeTextureGroup("spr_restaurant"),n.changePlantsTexture(2*bo.getInt(n.herbTextures.length/2|0))}function ut(t,e,i,n){r.call(this,e,n),n.efficiency-=2,n.materialsMadePerStepPerWorker+=5e-5}function dt(t,e,i,n){r.call(this,null,n),n.buildingEnabled=!1}function ct(t,e,i,n){r.call(this,null,n),n.buildingEnabled=!0}function pt(t,e,i,n){r.call(this,e,n),this.myEffect={name:"increaseCropNumber",intensity:10},n.adjecentBuildingEffects.push(this.myEffect)}function gt(t,e,i,n){r.call(this,e,n)}function mt(t,e,i,n){r.call(this,i,n),n.city.upgrades.vars.stoneResearchCenterWithFossils=n}function ft(t,e,i,n){r.call(this,null,n),n.hasHeatedBed=!0,n.onCityChange()}function yt(t,e,i,n){r.call(this,i,n)}function _t(t,e,i,n){r.call(this,null,n),n.buildingEnabled=!1}function wt(t,e,i,n){r.call(this,null,n),n.buildingEnabled=!0}function bt(t,e,i,n){r.call(this,i,n)}function vt(t,e,i,n){r.call(this,null,n),--n.efficiency}function St(t,e,i,n){r.call(this,null,n),n.buildingEnabled=!0,n.efficiency+=2,n.materialsMadePerStepPerWorker+=.0015}function xt(t,e,i,n){r.call(this,null,n),n.medicalEducationPart=1}function Pt(t,e,i,n){r.call(this,null,n),n.drawer.changeMainTexture("spr_herbgarden_medic"),n.drawer.changeTextureGroup("spr_botanicalgardens"),n.isMedical=!0,n.changePlantsTexture(2*bo.getInt(n.herbTextures.length/2|0)+1)}function Ct(t,e,i,n){r.call(this,null,n),n.mode=si.Always}function It(t,e,i,n){r.call(this,null,n),n.mode=si.Disabled}function Tt(t,e,i,n){r.call(this,null,n),n.mode=si.MostlyDisabled}function Bt(t,e,i,n){r.call(this,null,n),n.mode=si.Normal}function kt(t,e,i,n){r.call(this,i,n)}function Mt(t,e,i,n){r.call(this,i,n),n.yearsToLiveLongerPerYearIfLivingHere+=.05}function zt(t,e,i,n){r.call(this,i,n),n.hasPickaxeTech=!0}function At(t,e,i,n){r.call(this,null,n),n.buildingEnabled=!0,n.efficiency+=1,n.materialsMadePerStepPerWorker+=5e-4}function Wt(t,e,i,n){dt.call(this,t,e,i,n)}function Ft(t,e,i,n){r.call(this,i,n)}function Ot(t,e,i,n){this.lightColor=[{color:14680064,time:0},{color:14680064,time:4},{color:16777215,time:6},{color:16777215,time:19},{color:16766023,time:21},{color:16766023,time:23},{color:14680064,time:24}];var s=this;r.call(this,i,n),this.set_onUpdate(function(t){s.sprite.tint=n.city.simulation.time.getCurrentColor(s.lightColor)})}function Dt(t,e,i,n){r.call(this,i,n)}function Rt(t,e,i,n){r.call(this,i,n)}function Ut(t,e,i,n){r.call(this,i,n),n.hasStarDatabase=!0}function Lt(t,e,i,n){r.call(this,i,n),n.hasRemoteControl=!0}function Et(t,e,i,n){dt.call(this,t,e,i,n)}function Ht(t,e,i,n){r.call(this,t,n),this.myEffect={name:"increaseTreeGrowth",intensity:.2},n.adjecentBuildingEffects.push(this.myEffect)}function Nt(t,e,i,n){r.call(this,i,n),n.efficiency-=.058}function Gt(t,e,i,n){r.call(this,i,n),n.isProducingKnowledge=!0}function Xt(t,e,i,n){r.call(this,i,n),n.isProducingKnowledge=!1}function jt(t,e,i,n,s,r,o,a){this.timeWorking=0,m.call(this,t,e,i,n,s,r,o,a)}(V.WorldResource=j).__name__="WorldResource",j.__super__=h,j.prototype=e(h.prototype,{destroy:function(){h.prototype.destroy.call(this),this.stage.removeChild(this.sprite),this.city.simulation.resourcePriorityManager.deprioritize(this)},positionSprites:function(){h.prototype.positionSprites.call(this),this.sprite.position.set(this.position.x,this.position.y)},__class__:j}),(V["buildingUpgrades.AIAssistedDiagnosis"]=Q).__name__="buildingUpgrades.AIAssistedDiagnosis",Q.__super__=r,Q.prototype=e(r.prototype,{get_textureName:function(){return"spr_smartdiagnose"},destroy:function(){r.prototype.destroy.call(this);var t=this.building;t.extraQuality-=25,t.extraCapacity-=50},__class__:Q}),(V["buildingUpgrades.AIMining"]=J).__name__="buildingUpgrades.AIMining",J.__super__=r,J.prototype=e(r.prototype,{get_textureName:function(){return"spr_aiMining"},destroy:function(){r.prototype.destroy.call(this),this.building.stoneMinedPerActionBoost-=.3},__class__:J}),(V["buildingUpgrades.AutomaticWaterManagement"]=Z).__name__="buildingUpgrades.AutomaticWaterManagement",Z.__super__=r,Z.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.regrowSpeedBoost-=2},__class__:Z}),(V["buildingUpgrades.BetterLightShow"]=et).__name__="buildingUpgrades.BetterLightShow",et.__super__=r,et.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this);var e=this.building;e.nightClubEntertainmentQuantity-=40,tt.iter(this.addedLasers,function(t){null!=t.laserSprite&&t.laserSprite.destroy(),Y.remove(e.lasers,t)})},__class__:et}),(V["buildingUpgrades.BetterPickaxes"]=it).__name__="buildingUpgrades.BetterPickaxes",it.__super__=r,it.prototype=e(r.prototype,{get_textureName:function(){return"spr_improvedpickaxes"},destroy:function(){r.prototype.destroy.call(this),this.building.stoneMinedPerActionBoost-=.2},__class__:it}),(V["buildingUpgrades.BetterTools"]=nt).__name__="buildingUpgrades.BetterTools",nt.__super__=r,nt.prototype=e(r.prototype,{get_textureName:function(){return"spr_tinkerershouse_bettertools"},get_bonusAttractiveness:function(){return 20},__class__:nt}),(V["buildingUpgrades.BiggerTV"]=st).__name__="buildingUpgrades.BiggerTV",st.__super__=r,st.prototype=e(r.prototype,{get_textureName:function(){return"spr_biggertv"},get_bonusAttractiveness:function(){return 5},destroy:function(){r.prototype.destroy.call(this),--this.building.extraCapacity},__class__:st}),(V["buildingUpgrades.CHProduceFood"]=rt).__name__="buildingUpgrades.CHProduceFood",rt.__super__=r,rt.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this)},__class__:rt}),(V["buildingUpgrades.CHProduceStone"]=ot).__name__="buildingUpgrades.CHProduceStone",ot.__super__=r,ot.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this)},__class__:ot}),(V["buildingUpgrades.CHProduceWood"]=at).__name__="buildingUpgrades.CHProduceWood",at.__super__=r,at.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this)},__class__:at}),(V["buildingUpgrades.ComfortableCouch"]=lt).__name__="buildingUpgrades.ComfortableCouch",lt.__super__=r,lt.prototype=e(r.prototype,{get_textureName:function(){return"spr_comfortablecouch"},get_bonusAttractiveness:function(){return 15},destroy:function(){r.prototype.destroy.call(this)},__class__:lt}),(V["buildingUpgrades.CulinaryHerbs"]=ht).__name__="buildingUpgrades.CulinaryHerbs",ht.__super__=r,ht.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this);var t=tt.find(this.building.adjecentBuildingEffects,function(t){return"restaurantCapBoost"==t.name});Y.remove(this.building.adjecentBuildingEffects,t)},__class__:ht}),(V["buildingUpgrades.DieShrink"]=ut).__name__="buildingUpgrades.DieShrink",ut.__super__=r,ut.prototype=e(r.prototype,{get_textureName:function(){return"spr_dieshrink"},destroy:function(){r.prototype.destroy.call(this);var t=this.building;t.efficiency+=2,t.materialsMadePerStepPerWorker-=5e-5},__class__:ut}),(V["buildingUpgrades.FactoryDisabled"]=dt).__name__="buildingUpgrades.FactoryDisabled",dt.__super__=r,dt.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.buildingEnabled=!0},__class__:dt}),(V["buildingUpgrades.FactoryWorking"]=ct).__name__="buildingUpgrades.FactoryWorking",ct.__super__=r,ct.prototype=e(r.prototype,{__class__:ct}),(V["buildingUpgrades.FarmingResearch"]=pt).__name__="buildingUpgrades.FarmingResearch",pt.__super__=r,pt.prototype=e(r.prototype,{get_textureName:function(){return"spr_upgrade_farmboost"},destroy:function(){r.prototype.destroy.call(this),Y.remove(this.building.adjecentBuildingEffects,this.myEffect)},__class__:pt}),(V["buildingUpgrades.Flowers"]=gt).__name__="buildingUpgrades.Flowers",gt.__super__=r,gt.prototype=e(r.prototype,{get_textureName:function(){return"spr_upgrade_flowers"},get_bonusAttractiveness:function(){return 5},__class__:gt}),(V["buildingUpgrades.FossilScanner"]=mt).__name__="buildingUpgrades.FossilScanner",mt.__super__=r,mt.prototype=e(r.prototype,{get_textureName:function(){return"spr_stoneresearchcentre_computer"},destroy:function(){r.prototype.destroy.call(this),this.building.city.upgrades.vars.stoneResearchCenterWithFossils=null},__class__:mt}),(V["buildingUpgrades.HeatedBed"]=ft).__name__="buildingUpgrades.HeatedBed",ft.__super__=r,ft.prototype=e(r.prototype,{get_bonusAttractiveness:function(){return 20},destroy:function(){r.prototype.destroy.call(this),this.building.hasHeatedBed=!1},__class__:ft}),(V["buildingUpgrades.IndoorPond"]=yt).__name__="buildingUpgrades.IndoorPond",yt.__super__=r,yt.prototype=e(r.prototype,{get_textureName:function(){return"spr_communityhouse_indoorpond"},get_bonusAttractiveness:function(){return 15},__class__:yt}),(V["buildingUpgrades.LabDisabled"]=_t).__name__="buildingUpgrades.LabDisabled",_t.__super__=r,_t.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.buildingEnabled=!0},__class__:_t}),(V["buildingUpgrades.LabWorking"]=wt).__name__="buildingUpgrades.LabWorking",wt.__super__=r,wt.prototype=e(r.prototype,{__class__:wt}),(V["buildingUpgrades.LivingComputer"]=bt).__name__="buildingUpgrades.LivingComputer",bt.__super__=r,bt.prototype=e(r.prototype,{get_textureName:function(){return"spr_alienhouse_livingcomputer"},get_bonusAttractiveness:function(){return 20},__class__:bt}),(V["buildingUpgrades.MachinePartsFactoryEfficiency"]=vt).__name__="buildingUpgrades.MachinePartsFactoryEfficiency",vt.__super__=r,vt.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.efficiency+=1},__class__:vt}),(V["buildingUpgrades.MachinePartsFactoryTurbo"]=St).__name__="buildingUpgrades.MachinePartsFactoryTurbo",St.__super__=r,St.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this);var t=this.building;t.efficiency-=2,t.materialsMadePerStepPerWorker-=.0015},__class__:St}),(V["buildingUpgrades.MedicalEducation"]=xt).__name__="buildingUpgrades.MedicalEducation",xt.__super__=r,xt.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.medicalEducationPart=0},__class__:xt}),(V["buildingUpgrades.MedicalHerbs"]=Pt).__name__="buildingUpgrades.MedicalHerbs",Pt.__super__=r,Pt.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.isMedical=!1},__class__:Pt}),(V["buildingUpgrades.MisdirectorAlways"]=Ct).__name__="buildingUpgrades.MisdirectorAlways",Ct.__super__=r,Ct.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.mode=si.Always},__class__:Ct}),(V["buildingUpgrades.MisdirectorDisabled"]=It).__name__="buildingUpgrades.MisdirectorDisabled",It.__super__=r,It.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.mode=si.Disabled},__class__:It}),(V["buildingUpgrades.MisdirectorMostlyDisabled"]=Tt).__name__="buildingUpgrades.MisdirectorMostlyDisabled",Tt.__super__=r,Tt.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.mode=si.Normal},__class__:Tt}),(V["buildingUpgrades.MisdirectorNormal"]=Bt).__name__="buildingUpgrades.MisdirectorNormal",Bt.__super__=r,Bt.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this),this.building.mode=si.Normal},__class__:Bt}),(V["buildingUpgrades.ModernConveniences"]=kt).__name__="buildingUpgrades.ModernConveniences",kt.__super__=r,kt.prototype=e(r.prototype,{get_textureName:function(){return"spr_modernconveniences"},get_bonusAttractiveness:function(){return 15},__class__:kt}),(V["buildingUpgrades.ModernHomePlant"]=Mt).__name__="buildingUpgrades.ModernHomePlant",Mt.__super__=r,Mt.prototype=e(r.prototype,{get_textureName:function(){return"spr_modernhomeplant"},get_bonusAttractiveness:function(){return 10},get_availableTextures:function(){return this.textures.length-(R.hasSecretCode("orchid")?0:3)},destroy:function(){r.prototype.destroy.call(this),this.building.yearsToLiveLongerPerYearIfLivingHere-=.05},__class__:Mt}),(V["buildingUpgrades.PickaxeTech"]=zt).__name__="buildingUpgrades.PickaxeTech",zt.__super__=r,zt.prototype=e(r.prototype,{get_textureName:function(){return"spr_stoneresearchcentre_pickaxetech"},destroy:function(){r.prototype.destroy.call(this),this.building.hasPickaxeTech=!1},__class__:zt}),(V["buildingUpgrades.RefinedMetalsFactoryHack"]=At).__name__="buildingUpgrades.RefinedMetalsFactoryHack",At.__super__=r,At.prototype=e(r.prototype,{destroy:function(){r.prototype.destroy.call(this);var t=this.building;--t.efficiency,t.materialsMadePerStepPerWorker-=5e-4},__class__:At}),(V["buildingUpgrades.RefinedStoneUsingFactoryDisabled"]=Wt).__name__="buildingUpgrades.RefinedStoneUsingFactoryDisabled",Wt.__super__=dt,Wt.prototype=e(dt.prototype,{__class__:Wt}),(V["buildingUpgrades.SmartChairs"]=Ft).__name__="buildingUpgrades.SmartChairs",Ft.__super__=r,Ft.prototype=e(r.prototype,{get_textureName:function(){return"spr_smartchairs"},get_bonusAttractiveness:function(){return 10},__class__:Ft}),(V["buildingUpgrades.SmartLights"]=Ot).__name__="buildingUpgrades.SmartLights",Ot.__super__=r,Ot.prototype=e(r.prototype,{get_textureName:function(){return"spr_smartlights"},get_bonusAttractiveness:function(){return 15},get_canCacheSprite:function(){return!1},__class__:Ot}),(V["buildingUpgrades.SmartSpeaker"]=Dt).__name__="buildingUpgrades.SmartSpeaker",Dt.__super__=r,Dt.prototype=e(r.prototype,{get_textureName:function(){return"spr_smartspeaker"},get_bonusAttractiveness:function(){return 10},destroy:function(){r.prototype.destroy.call(this)},__class__:Dt}),(V["buildingUpgrades.SofterBeds"]=Rt).__name__="buildingUpgrades.SofterBeds",Rt.__super__=r,Rt.prototype=e(r.prototype,{get_textureName:function(){return"spr_softerbeds"},get_bonusAttractiveness:function(){return 10},__class__:Rt}),(V["buildingUpgrades.StarDatabase"]=Ut).__name__="buildingUpgrades.StarDatabase",Ut.__super__=r,Ut.prototype=e(r.prototype,{get_textureName:function(){return"spr_computer_observatory"},destroy:function(){r.prototype.destroy.call(this),this.building.hasStarDatabase=!1},__class__:Ut}),(V["buildingUpgrades.StoneTeleporterRemote"]=Lt).__name__="buildingUpgrades.StoneTeleporterRemote",Lt.__super__=r,Lt.prototype=e(r.prototype,{get_textureName:function(){return"spr_stoneteleporter_remote"},destroy:function(){r.prototype.destroy.call(this),this.building.hasRemoteControl=!1},__class__:Lt}),(V["buildingUpgrades.StoneUsingFactoryDisabled"]=Et).__name__="buildingUpgrades.StoneUsingFactoryDisabled",Et.__super__=dt,Et.prototype=e(dt.prototype,{__class__:Et}),(V["buildingUpgrades.TreePlantationResearch"]=Ht).__name__="buildingUpgrades.TreePlantationResearch",Ht.__super__=r,Ht.prototype=e(r.prototype,{get_textureName:function(){return"spr_treegrowthboost"},destroy:function(){r.prototype.destroy.call(this),Y.remove(this.building.adjecentBuildingEffects,this.myEffect)},__class__:Ht}),(V["buildingUpgrades.UltimateScrewdriver"]=Nt).__name__="buildingUpgrades.UltimateScrewdriver",Nt.__super__=r,Nt.prototype=e(r.prototype,{get_textureName:function(){return"spr_experimentationlab_screwdriver"},get_canCacheSprite:function(){return!1},destroy:function(){r.prototype.destroy.call(this),this.building.efficiency+=.058},__class__:Nt}),(V["buildingUpgrades.WorkshopKnowledge"]=Gt).__name__="buildingUpgrades.WorkshopKnowledge",Gt.__super__=r,Gt.prototype=e(r.prototype,{get_textureName:function(){return"spr_workshop_petprojects"},destroy:function(){r.prototype.destroy.call(this)},__class__:Gt}),(V["buildingUpgrades.WorkshopMachineParts"]=Xt).__name__="buildingUpgrades.WorkshopMachineParts",Xt.__super__=r,Xt.prototype=e(r.prototype,{get_textureName:function(){return"spr_workshop_makemachineparts"},destroy:function(){r.prototype.destroy.call(this)},__class__:Xt}),(V["buildings.AlienDecryptor"]=jt).__name__="buildings.AlienDecryptor",jt.__super__=m,jt.prototype=e(m.prototype,{update:function(t){this.timeWorking+=t*this.city.simulation.time.minutesPerTick},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(jt.saveDefinition);var i=this.timeWorking;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"timeWorking")&&(this.timeWorking=t.h.timeWorking)},__class__:jt});var Vt=function(){};(V["buildings.IHousing"]=Vt).__name__="buildings.IHousing",Vt.__isInterface__=!0,Vt.prototype={__class__:Vt};var Yt=function(t,e,i,n,s,r,o,a){this.yearsToLiveLongerPerYearIfLivingHere=0,this.residents=[],this.extraCapacity=0,m.call(this,t,e,i,n,s,r,o,a)};function $t(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a)}function qt(){}(V["buildings.House"]=Yt).__name__="buildings.House",Yt.__interfaces__=[Vt],Yt.__super__=m,Yt.prototype=e(m.prototype,{get_residentCapacity:function(){return null==this.info.residents?0:this.info.residents+this.extraCapacity},get_baseAttractiveness:function(){return this.info.quality},get_possibleUpgrades:function(){return[]},get_remainingCapacity:function(){return this.get_residentCapacity()-this.residents.length},get_fixedCapacityForWorkers:function(){return 0},get_hasPrivateTeleporter:function(){return!1},destroy:function(){for(m.prototype.destroy.call(this);0!=this.residents.length;)this.residents[this.residents.length-1].evictFromHome()},addWindowInfoLines:function(){var t=this;m.prototype.addWindowInfoLines.call(this);var e=this.city.gui,i=H.getTexture("spr_housing"),n=this.city,s=this.residents,r=kn.lo("residents_of",[this.get_name()]),o=this,a=kn.lo("no_residents");e.windowAddSimpleButton(i,function(){Es.createWindow(n,s,r,o,a)},null,function(){return kn.lo("residents",[t.residents.length,t.get_residentCapacity()])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("quality",[t.get_baseAttractiveness()+t.bonusAttractiveness])})},walkAround:function(t,e){var i=bo.getInt(4);0==i&&120<e?t.changeFloorAndWaitRandom(30,60):1==i?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},__class__:Yt}),(V["buildings.AlienHouse"]=$t).__name__="buildings.AlienHouse",$t.__super__=Yt,$t.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[bt]},__class__:$t}),(V["buildings.IWaterFilled"]=qt).__name__="buildings.IWaterFilled",qt.__isInterface__=!0,qt.prototype={__class__:qt};var Kt=function(){};function Qt(t,e,i,n,s,r,o,a){this.justBuilt=!1,this.citizenDivingTextures=null,this.currentTexture=0,m.call(this,t,e,i,n,s,r,o,a),this.isEntertainment=!0,this.currentTexture=0,this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1}),this.leftIsWaterFilled=!1,this.rightIsWaterFilled=!1,this.topIsWaterFilled=!1,this.bottomIsWaterFilled=!1}(V["buildings.IEntertainmentBuilding"]=Kt).__name__="buildings.IEntertainmentBuilding",Kt.__isInterface__=!0,Kt.prototype={__class__:Kt},(V["buildings.Aquarium"]=Qt).__name__="buildings.Aquarium",Qt.__interfaces__=[qt,Kt],Qt.__super__=m,Qt.prototype=e(m.prototype,{get_baseEntertainmentCapacity:function(){return 50},get_isOpen:function(){return!1},get_entertainmentType:function(){return 3},get_minimumNormalTimeToSpend:function(){return 3},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_drawerType:function(){return ji},get_mergingDrawer:function(){return this.drawer},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_hasLeftAquarium:function(){return null!=this.leftBuilding&&this.leftBuilding.is(Qt)},get_hasRightAquarium:function(){return null!=this.rightBuilding&&this.rightBuilding.is(Qt)},get_hasTopAquarium:function(){return null!=this.topBuilding&&this.topBuilding.is(Qt)},get_hasBottomAquarium:function(){return null!=this.bottomBuilding&&this.bottomBuilding.is(Qt)},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postCreate:function(){var t;m.prototype.postCreate.call(this),this.updateGardenTexture(),this.justBuilt&&((t=null)!=this.bottomBuilding&&this.bottomBuilding.is(Qt)&&(t=this.bottomBuilding),null!=this.topBuilding&&this.topBuilding.is(Qt)&&(t=this.topBuilding),null!=t?this.get_mergingDrawer().setGroupOfSecondaryTextureForThisBuilding(this.get_mergingDrawer().getSecondaryTextureGroup(t.currentTexture)):this.currentTexture=bo.getInt(vn.isum(Qt.gardenTextureSets)),this.justBuilt=!1,this.updateGardenTexture()),this.positionSprites()},destroy:function(){m.prototype.destroy.call(this);for(var t=this.city.simulation.fishes.fishes,e=t.length;0<=--e;)t[e].inPermanent==this&&t[e].destroy()},onCityChange:function(){this.leftIsWaterFilled=null!=this.leftBuilding&&Fr.__implements(this.leftBuilding,qt),this.rightIsWaterFilled=null!=this.rightBuilding&&Fr.__implements(this.rightBuilding,qt),this.topIsWaterFilled=null!=this.topBuilding&&Fr.__implements(this.topBuilding,qt),this.bottomIsWaterFilled=null!=this.bottomBuilding&&Fr.__implements(this.bottomBuilding,qt),this.leftIsWaterFilled?this.leftAsWaterFilled=this.leftBuilding:this.leftAsWaterFilled=null,this.rightIsWaterFilled?this.rightAsWaterFilled=this.rightBuilding:this.rightAsWaterFilled=null,this.topIsWaterFilled?this.topAsWaterFilled=this.topBuilding:this.topAsWaterFilled=null,this.bottomIsWaterFilled?this.bottomAsWaterFilled=this.bottomBuilding:this.bottomAsWaterFilled=null},postLoad:function(){this.updateGardenTexture()},onBuild:function(){m.prototype.onBuild.call(this),this.justBuilt=!0},updateGardenTexture:function(){var e=this;this.get_mergingDrawer().setSecondaryBackgroundImages("spr_botanicalgardens_plants",Qt.gardenTextureSets,this.currentTexture,function(t){e.currentTexture=t})},beEntertained:function(t,e){},createWindowAddBottomButtons:function(){var t=this;ur.create(this.city.gui,function(){return t.get_mergingDrawer().getCurrentSecondaryTextureGroup()},fa(B=this.get_mergingDrawer(),B.setGroupOfSecondaryTexture),function(){return Qt.gardenTextureSets.length},kn.lo("change_plants")),ur.create(this.city.gui,function(){return t.currentTexture-t.get_mergingDrawer().getFirstSecondaryTextureOfGroup(t.get_mergingDrawer().getCurrentSecondaryTextureGroup())},fa(B=this.get_mergingDrawer(),B.setSecondaryTextureWithinGroup),function(){return Qt.gardenTextureSets[t.get_mergingDrawer().getCurrentSecondaryTextureGroup()]},kn.lo("change_plants_variant")),m.prototype.createWindowAddBottomButtons.call(this)},onCitizenLeave:function(t,e){null!=e&&e.is(Qt)||(t.dynamicUnsavedVars.buildingInited=null)},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(Qt.saveDefinition);var i=this.currentTexture;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture),this.postLoad()},__class__:Qt});var Jt=function(t,e,i,n,s,r,o,a){this.workTimePreferenceMod=1,this.endTime=19,this.startTime=6,this.workers=[],m.call(this,t,e,i,n,s,r,o,a)};function Zt(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=12,this.endTime=23.5,this.workTimePreferenceMod=.1,this.isEntertainment=!0}function te(t,e,i,n,s,r,o,a){this.yearsToLiveLongerPerYearIfLivingHere=0,this.residents=[],this.extraCapacity=0,Jt.call(this,t,e,i,n,s,r,o,a)}function ee(t,e,i,n,s,r,o,a){this.artSprite=null,this.currentWorkProgress=0,this.currentTexture=0,te.call(this,t,e,i,n,s,r,o,a),this.startTime=10,this.endTime=22,this.workTimePreferenceMod=.3,this.isEntertainment=!0,this.artTextures=H.getTexturesByWidth("spr_artcolonywork",20),this.currentTexture=0,this.artSprite=new PIXI.Sprite(this.artTextures[this.currentTexture]),this.artSprite.position.set(r.x,r.y),i.addChild(this.artSprite)}function ie(t,e,i,n,s,r,o,a){m.call(this,t,e,i,n,s,r,o,a),this.lightSpr=new PIXI.Sprite(H.getTexture("spr_beacon_light")),e.addChild(this.lightSpr),this.positionSprites()}function ne(t,e,i,n,s,r,o,a){this.canLeaveForBG=0,this.eventBotanicalGardens=null,this.timeToCheckBuildings=0,this.currentMission=0,this.eventPhase=0,this.doingEvent=-1,this.lastEventDoneOnDay=0,te.call(this,t,e,i,n,s,r,o,a),this.startTime=11,this.endTime=23,this.workTimePreferenceMod=.3}function se(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a),this.get_mergingDrawer().setBackgroundTextures("spr_bloomhouse")}(V["buildings.Work"]=Jt).__name__="buildings.Work",Jt.__super__=m,Jt.prototype=e(m.prototype,{get_jobs:function(){return null==this.info.jobs?0:this.info.jobs},get_remainingCapacity:function(){return this.get_jobs()-this.workers.length},get_firstBuildingToGoTo:function(){return this},destroy:function(){for(m.prototype.destroy.call(this);0!=this.workers.length;)this.workers[this.workers.length-1].loseJob()},work:function(t,e,i){i&&(t.currentAction=y.Nothing)},addWindowInfoLines:function(){var t=this;m.prototype.addWindowInfoLines.call(this);var e=this.city.gui,i=H.getTexture("spr_work"),n=this.city,s=this.workers,r=kn.lo("workers_of",[this.get_name()]),o=this,a=kn.lo("no_workers");e.windowAddSimpleButton(i,function(){Es.createWindow(n,s,r,o,a)},null,function(){return kn.lo("workers",[t.workers.length,t.get_jobs()])})},afterGiveJob:function(t){},__class__:Jt}),(V["buildings.Arcade"]=Zt).__name__="buildings.Arcade",Zt.__interfaces__=[Kt],Zt.__super__=Jt,Zt.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 120*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&this.workers[0].currentAction==y.Work&&this.city.simulation.time.timeSinceStart/60%24<23},get_entertainmentType:function(){return 4},get_minimumNormalTimeToSpend:function(){return 2.5},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 4},get_maximumEntertainmentGroupSatisfy:function(){return 7},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(e,t){function i(){var t=e.relativeY<5?5+4*bo.getInt(3):5+8*bo.getInt(2);e.moveAndWait(bo.getInt(t,1+t),bo.getInt(100,120),null,!1,!1)}1==bo.getInt(3)?e.changeFloor(i):i()},work:function(t,e,i){i?t.currentAction=y.Nothing:(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(6-t.relativeX)<i?t.relativeX=6:(e=6-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i))},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Zt.saveDefinition)},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Zt}),(V["buildings.WorkWithHome"]=te).__name__="buildings.WorkWithHome",te.__interfaces__=[Vt],te.__super__=Jt,te.prototype=e(Jt.prototype,{get_residentCapacity:function(){return null==this.info.residents?0:this.info.residents+this.extraCapacity},get_baseAttractiveness:function(){return this.info.quality},get_possibleUpgrades:function(){return[]},get_remainingCapacity:function(){return this.get_residentCapacity()-this.residents.length},get_fixedCapacityForWorkers:function(){return this.get_residentCapacity()},get_hasPrivateTeleporter:function(){return!1},destroy:function(){for(Jt.prototype.destroy.call(this);0!=this.residents.length;)this.residents[this.residents.length-1].evictFromHome()},addWindowInfoLines:function(){var t=this,e=this.city.gui,i=H.getTexture("spr_housing"),n=this.city,s=this.residents,r=kn.lo("residents_of",[this.get_name()]),o=this,a=kn.lo("no_residents");e.windowAddSimpleButton(i,function(){Es.createWindow(n,s,r,o,a)},null,function(){return kn.lo("residents",[t.residents.length,t.get_residentCapacity()])}),Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("quality",[t.get_baseAttractiveness()+t.bonusAttractiveness])})},walkAround:function(t,e){var i=bo.getInt(4);0==i&&120<e?t.changeFloorAndWaitRandom(30,60):1==i?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},__class__:te}),(V["buildings.ArtColony"]=ee).__name__="buildings.ArtColony",ee.__interfaces__=[Kt],ee.__super__=te,ee.prototype=e(te.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){return 0<this.workers.length&&this.workers[0].currentAction==y.Work&&(1+((0|this.city.simulation.time.timeSinceStart)/1440|0))%3==0&&this.city.simulation.time.timeSinceStart/60%24<21.5&&15<this.city.simulation.time.timeSinceStart/60%24},get_entertainmentType:function(){return 2},get_minimumNormalTimeToSpend:function(){return 1},get_maximumNormalTimeToSpend:function(){return 2},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postLoad:function(){this.artSprite.texture=this.artTextures[this.currentTexture]},positionSprites:function(){te.prototype.positionSprites.call(this),null!=this.artSprite&&this.artSprite.position.set(this.position.x,this.position.y)},destroy:function(){te.prototype.destroy.call(this),this.bgStage.removeChild(this.artSprite)},beEntertained:function(i,t){function e(){var t=!1,e=!0;null==e&&(e=!1),null==t&&(t=!1),i.moveAndWait(bo.getInt(3,16),bo.getInt(50,100),null,t,e)}i.relativeY<5?i.changeFloor(e):e()},get_possibleUpgrades:function(){return[]},addWindowInfoLines:function(){var t=this,e=this.city.gui,i=H.getTexture("spr_work_housing"),n=this.city,s=this.residents,r=kn.lo("resident_workers_of",[this.get_name()]),o=this,a=kn.lo("none");e.windowAddSimpleButton(i,function(){Es.createWindow(n,s,r,o,a)},null,function(){return kn.lo("resident_workers",[t.residents.length,t.get_residentCapacity()])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("quality",[t.get_baseAttractiveness()+t.bonusAttractiveness])})},walkAround:function(t,e){var i=bo.getInt(3);0==i&&120<e?t.changeFloorAndWaitRandom(30,60):1==i?(t.relativeY,t.moveAndWait(bo.getInt(3,15),bo.getInt(30,60),null,!1,!1)):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},work:function(t,e,i){i&&(t.currentAction=y.Nothing);var n=(this.workers.indexOf(t)+(1+((0|this.city.simulation.time.timeSinceStart)/1440|0)))%5;if(0==n||3==n?5<t.relativeY?t.changeFloor():0==n?(t.relativeX<3||6<t.relativeX||bo.getFloat()<.015*e)&&t.moveAndWait(bo.getInt(3,7),bo.getInt(5,10),null,!1,!1):3==n&&(t.relativeX<12||15<t.relativeX||bo.getFloat()<.015*e)&&t.moveAndWait(bo.getInt(12,16),bo.getInt(5,10),null,!1,!1):t.relativeY<5?t.changeFloor():1==n?(t.relativeX<3||6<t.relativeX||bo.getFloat()<.015*e)&&t.moveAndWait(bo.getInt(3,7),bo.getInt(5,10),null,!1,!1):2==n?(t.relativeX<12||15<t.relativeX||bo.getFloat()<.015*e)&&t.moveAndWait(bo.getInt(12,16),bo.getInt(5,10),null,!1,!1):4==n&&(t.relativeX<8||10<t.relativeX||bo.getFloat()<.015*e)&&t.moveAndWait(bo.getInt(8,11),bo.getInt(5,10),null,!1,!1),1<=this.currentWorkProgress){this.currentTexture+=1;for(var s=0,r=0,o=ee.unlockNewWorkAfter;r<o.length;){var a=o[r];++r,this.currentTexture>a&&++s}i=this.city.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked,n=4+s;this.city.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked=i<n?n:i,this.currentTexture%=this.artTextures.length,this.artSprite.texture=this.artTextures[this.currentTexture],this.currentWorkProgress=0}this.currentWorkProgress+=e*t.get_educationSpeedModifier()*this.city.simulation.happiness.actionSpeedModifier*2e-5},save:function(t,e){null==e&&(e=!0),te.prototype.save.call(this,t),e&&t.addString(ee.saveDefinition);e=this.currentTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.currentWorkProgress;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){te.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture),Object.prototype.hasOwnProperty.call(t.h,"currentWorkProgress")&&(this.currentWorkProgress=t.h.currentWorkProgress),this.postLoad()},__class__:ee}),(V["buildings.Beacon"]=ie).__name__="buildings.Beacon",ie.__interfaces__=[Kt],ie.__super__=m,ie.prototype=e(m.prototype,{get_isOpen:function(){return!0},get_entertainmentType:function(){return 2},get_minimumNormalTimeToSpend:function(){return 1.5},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_baseEntertainmentCapacity:function(){return 50},get_isOpenForExistingVisitors:function(){return!0},finishEntertainment:function(t,e){return!0},destroy:function(){m.prototype.destroy.call(this),null!=this.lightSpr&&this.lightSpr.destroy()},positionSprites:function(){m.prototype.positionSprites.call(this),this.lightSpr.position.set(this.position.x+8,this.position.y+1),this.lightSpr.alpha=0},update:function(t){m.prototype.update.call(this,t),((0|this.city.simulation.time.timeSinceStart)/60|0)%24<6||20.5<((0|this.city.simulation.time.timeSinceStart)/60|0)%24?this.lightSpr.alpha=1:((0|this.city.simulation.time.timeSinceStart)/60|0)%24<6.5?this.lightSpr.alpha=2*(6.5-this.city.simulation.time.timeSinceStart/60%24):20<((0|this.city.simulation.time.timeSinceStart)/60|0)%24?this.lightSpr.alpha=2*(this.city.simulation.time.timeSinceStart/60%24-20):this.lightSpr.alpha=0},beEntertained:function(t,e){bo.getFloat()<.5?t.moveAndWait(bo.getInt(4,8),bo.getInt(60,90),null,!1,!1):t.moveAndWait(bo.getInt(11,15),bo.getInt(60,90),null,!1,!1)},addWindowInfoLines:function(){m.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(kn.lo("beacon_credits"))},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(ie.saveDefinition)},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:ie}),(V["buildings.BlossomHippieHQ"]=ne).__name__="buildings.BlossomHippieHQ",ne.__super__=te,ne.prototype=e(te.prototype,{positionSprites:function(){te.prototype.positionSprites.call(this)},destroy:function(){te.prototype.destroy.call(this)},addWindowInfoLines:function(){var t=this;te.prototype.addWindowInfoLines.call(this),this.city.gui.windowInner.addChild(new Cs(this.city.gui.window,new Cn(4,4))),this.city.gui.windowAddInfoText(null,function(){return t.missionGetTitle()},"Arial15"),this.city.gui.windowAddInfoText(null,function(){return t.missionGetText()})},createMainWindowPart:function(){var e=this;te.prototype.createMainWindowPart.call(this);var t=!1,i=null,n=null,s=new ds(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner);s.direction=vs.Vertical,this.city.gui.windowInner.addChild(s),s.onUpdate=function(){2==e.currentMission?t||(t=!0,i=new Ks(e.city.gui,e.city.gui.innerWindowStage,s,function(){var t;2==e.currentMission&&e.city.materials.canAfford(new M(0,0,1e4))?(e.currentMission=3,e.city.progress.unlocks.unlock(We),(t=e.city.materials).set_food(t.food-1e4)):((t=function(){e.city.gui.showSimpleWindow(kn.lo("cannot_afford_hippie_bribe"),null,!0)})(),e.city.gui.addWindowToStack(t))},kn.lo("bribe_hippies_option")),s.addChild(i),n=s.addChild(new Cs(s,new Cn(4,4)))):t&&(i.destroy(),s.removeChild(i),t=!1,n.destroy(),s.removeChild(n))}},missionGetTitle:function(){return 8==this.currentMission?kn.lo("thank_you"):kn.lo("current_task")},missionGetText:function(){return 8<=this.currentMission?kn.lo("peace_out"):this.workers.length!=this.get_jobs()?kn.lo("flower_buds"):kn.lo("hippie_mission_"+this.currentMission)},checkMissionCompletions:function(){for(var t=!1;;){switch(t=!1,this.currentMission){case 0:for(var e=0,i=0,n=this.city.permanents;i<n.length;){var s=n[i];++i,!s.is(Ai)||null!=(s=s).leftBuilding&&null!=s.rightBuilding&&null!=s.topBuilding&&null!=s.bottomBuilding&&s.leftBuilding.is(he)&&s.rightBuilding.is(he)&&s.bottomBuilding.is(he)&&s.topBuilding.is(he)&&++e}2<=e&&(t=!0,this.city.progress.unlocks.unlock(re));break;case 2:for(var r=0,o=this.city.permanents;r<o.length;){var a=o[r];++r,a.is(ua)&&a.managementMode==pa.Protect&&(t=!0,this.city.progress.unlocks.unlock(We))}break;case 6:(t=vn.any(this.city.upgrades.upgrades,function(t){return t instanceof fn}))&&this.city.progress.unlocks.unlock(Oe)}if(this.timeToCheckBuildings<=0&&0!=this.currentMission&&2!=this.currentMission&&6!=this.currentMission&&8!=this.currentMission){var l=this.city.getAmountOfPermanentsPerType();switch(this.currentMission){case 1:t=3<=l.h["buildings.BlossomRestaurant"];break;case 3:t=20<=l.h["buildings.FarmHouse"];break;case 4:(t=30<=l.h["buildings.EcoFarm"])&&this.city.progress.unlocks.unlock(ze);break;case 5:(t=9<=l.h["buildings.FarmByProductProcessor"])&&this.city.progress.unlocks.unlock(fn);break;case 7:t=1<=l.h["buildings.FestivalHQ"]}this.timeToCheckBuildings=30}if(t&&(this.currentMission+=1,this.timeToCheckBuildings=0,this.city.progress.goalHelp.updateHasBuildingGoal()),!t)break}},update:function(t){te.prototype.update.call(this,t),this.checkMissionCompletions(),this.timeToCheckBuildings-=t,this.canLeaveForBG-=t},work:function(t,e,i){var n=this;if(null!=t.inPermanent&&t.inPermanent.is(he)&&t.inPermanent.isTree()){if(0==this.eventPhase){var s,r=t.pathWalkSpeed*e;return I.shouldUpdateDraw=!0,void((Math.abs(9-t.relativeX)<r?(t.relativeX=9,!0):(s=9-t.relativeX,t.relativeX+=(0<s?1:s<0?-1:0)*r,!1))&&(t.setRelativeY(t.relativeY+.4*e),10<=t.relativeY&&(null!=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).topBuilding&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).topBuilding.is(he)?(t.setRelativeY(t.relativeY-20),t.inPermanent=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).topBuilding):this.eventPhase=1)))}if(t.setRelativeY(t.relativeY-.4*e),!(t.relativeY<=0))return;if(null!=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).bottomBuilding&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).bottomBuilding.is(he))return t.setRelativeY(t.relativeY+20),void(t.inPermanent=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).bottomBuilding);t.setRelativeY(0),this.doingEvent=-1}else if(-1!=this.doingEvent){if(t.setRelativeY(0),null==this.eventBotanicalGardens&&(this.eventBotanicalGardens=this.city.simulation.permanentFinder.query(this,function(t){if(t.is(he)){t=t;return(null==t.bottomBuilding||!t.bottomBuilding.is(he))&&t.isTree()}return!1})),null!=this.eventBotanicalGardens)return void(this.canLeaveForBG<=0&&(t.simulation.pathfinder.findPath(t,this.eventBotanicalGardens),t.pathOnFail=function(){n.doingEvent=-1},this.canLeaveForBG=20));this.doingEvent=-1}if(i)t.currentAction=y.Nothing;else{if(t.inPermanent!=this)return t.setRelativeY(0),t.simulation.pathfinder.findPath(t,this),void(t.pathOnFail=null);this.doWalkAround(t),10<((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&1+((0|this.city.simulation.time.timeSinceStart)/1440|0)>this.lastEventDoneOnDay&&(this.doingEvent=1,this.eventPhase=0,this.lastEventDoneOnDay=1+((0|this.city.simulation.time.timeSinceStart)/1440|0))}},walkAround:function(t,e){this.doWalkAround(t)},doWalkAround:function(t){t.relativeX<7&&bo.getFloat()<.3?t.changeFloorAndWaitRandom(10,30):5<t.relativeY||.5<bo.getFloat()?t.moveAndWait(bo.getInt(3,7),bo.getInt(60,180),null,!1,!1):t.moveAndWait(bo.getInt(12,16),bo.getInt(60,180),null,!1,!1)},getGlobalGoal:function(){return 8==this.currentMission?null:{category:"hippie_mission",text:this.missionGetText()}},save:function(t,e){null==e&&(e=!0),te.prototype.save.call(this,t),e&&t.addString(ne.saveDefinition);e=this.lastEventDoneOnDay;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.doingEvent;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.eventPhase;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.currentMission;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){te.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"lastEventDoneOnDay")&&(this.lastEventDoneOnDay=t.h.lastEventDoneOnDay),Object.prototype.hasOwnProperty.call(t.h,"doingEvent")&&(this.doingEvent=t.h.doingEvent),Object.prototype.hasOwnProperty.call(t.h,"eventPhase")&&(this.eventPhase=t.h.eventPhase),Object.prototype.hasOwnProperty.call(t.h,"currentMission")&&(this.currentMission=t.h.currentMission)},__class__:ne}),(V["buildings.BlossomHut"]=se).__name__="buildings.BlossomHut",se.__super__=Yt,se.prototype=e(Yt.prototype,{get_drawerType:function(){return ji},get_mergingDrawer:function(){return this.drawer},postCreate:function(){Yt.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){Yt.prototype.positionSprites.call(this)},walkAround:function(t,e){var i;9==t.relativeX?t.canViewSelfInBuilding=!1:((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=9,t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},__class__:se});var re=function(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=16,this.endTime=1,this.workTimePreferenceMod=.5,this.isEntertainment=!0,this.get_mergingDrawer().setForegroundTextures("spr_bloomrestaurant_foreground")};function oe(t,e,i,n,s,r,o,a){this.hasNotSearchedForResourceGatherPlaceThisStep=!0,this.nearestResourceGatherPlace=null,Jt.call(this,t,e,i,n,s,r,o,a)}function ae(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=11,this.endTime=23.5,this.workTimePreferenceMod=.1,this.isEntertainment=!0}function le(){}(V["buildings.BlossomRestaurant"]=re).__name__="buildings.BlossomRestaurant",re.__interfaces__=[Kt],re.__super__=Jt,re.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){var t=50;return t+=this.getEffectsOfAdjecentBuildingsLR("restaurantCapBoost"),this.workers.length*t|0},get_isOpen:function(){if(1<=this.workers.length&&this.workers[0].currentAction==y.Work){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<.5?e<=t&&t<.5:e<=t||t<.5}return!1},get_entertainmentType:function(){return 1},get_minimumNormalTimeToSpend:function(){return 1},get_maximumNormalTimeToSpend:function(){return 2},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return ji},get_mergingDrawer:function(){return this.drawer},beEntertained:function(t,e){if(t.hasBuildingInited)(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,n[1]=bo.getInt(30,60),t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;else{var i,n;if(null!=this.bottomBuilding&&this.bottomBuilding.is(re))switch(bo.getInt(4)){case 0:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=1,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 1:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=4,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 2:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=12,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 3:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=17,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}else switch(bo.getInt(6)){case 0:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=1,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 1:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=2,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 2:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=5,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 3:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=13,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 4:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=14,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 5:(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=17,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}t.hasBuildingInited=!0}},work:function(t,e,i){var n;i&&.5<this.city.simulation.time.timeSinceStart/60%24?t.currentAction=y.Nothing:(null==(i=!(n=!1))&&(i=!1),null==n&&(n=!1),t.moveAndWait(bo.getInt(3,18),bo.getInt(60,120),null,n,i))},__class__:re}),(V["buildings.BlueCollarWork"]=oe).__name__="buildings.BlueCollarWork",oe.__super__=Jt,oe.prototype=e(Jt.prototype,{doBlueCollarJob:function(t,e,i,n,s,r,o){var a=this;if(i)t.hasWorkTools?t.inPermanent==this?t.moveAndWait(4,20,function(){t.hasWorkTools=!1}):(t.simulation.pathfinder.findPath(t,this),t.pathOnFail=null):t.currentAction=y.Nothing;else if(t.hasWorkTools){for(var l,h,u,d,c=!1,p=0;p<n.length;){var g=n[p];if(++p,Fr.__instanceof(t.inPermanent,g)){c=!0;break}}c&&(0<t.inPermanent.materialsLeft||t.inPermanent.get_stayIfEmpty())&&!t.inPermanent.get_doNotGather()?0<(l=t.inPermanent).materialsLeft&&(null==(h=!0)&&(h=!1),t.moveAndWait(bo.getInt(l.minCitizenX,l.maxCitizenX),bo.getInt(r,o),function(){l.get_doNotGather()?a.nearestResourceGatherPlace=null:(s(l),l.materialsLeft<=0&&!l.get_stayIfEmpty()?(a.nearestResourceGatherPlace=null,l.get_destroyedOnEmpty()&&l.destroy()):l.updateTexture())},h,!1)):(o=!0,(null==this.nearestResourceGatherPlace||this.nearestResourceGatherPlace.materialsLeft<=0&&!this.nearestResourceGatherPlace.get_stayIfEmpty()||this.nearestResourceGatherPlace.get_doNotGather())&&(this.nearestResourceGatherPlace=null,(h=this.city.simulation.permanentFinder.canPerformQuery())||(o=!1),!(!h||!this.hasNotSearchedForResourceGatherPlaceThisStep)&&(u=this.world.knownResourceInavailability,h=n[0].__name__,!Object.prototype.hasOwnProperty.call(u.h,h))&&(this.city.simulation.resourcePriorityManager.hasResourcePrioritiesFor(n[0])&&(d=0==n.length?function(t){return!(!(t.is(n[0])&&0<t.materialsLeft)||t.get_doNotGather())&&a.city.simulation.resourcePriorityManager.isPrioritized(t)}:function(e){return!(!(vn.any(n,function(t){return e.is(t)})&&0<e.materialsLeft)||e.get_doNotGather())&&a.city.simulation.resourcePriorityManager.isPrioritized(e)},this.nearestResourceGatherPlace=this.city.simulation.permanentFinder.query(this,d)),null==this.nearestResourceGatherPlace&&(d=0==n.length?function(t){return!!(t.is(n[0])&&0<t.materialsLeft)&&!t.get_doNotGather()}:function(e){return!!(vn.any(n,function(t){return e.is(t)})&&0<e.materialsLeft)&&!e.get_doNotGather()},this.nearestResourceGatherPlace=this.city.simulation.permanentFinder.query(this,d)),null==this.nearestResourceGatherPlace&&(u=this.world.knownResourceInavailability,d=n[0].__name__,u.h[d]=!0),this.hasNotSearchedForResourceGatherPlaceThisStep=!1)),o&&(null!=this.nearestResourceGatherPlace?(t.simulation.pathfinder.findPath(t,this.nearestResourceGatherPlace),t.pathOnFail=null):t.wander(e)))}else t.inPermanent==this?t.moveAndWait(4,20,function(){t.hasWorkTools=!0}):(t.simulation.pathfinder.findPath(t,this),t.pathOnFail=null)},update:function(t){Jt.prototype.update.call(this,t),this.hasNotSearchedForResourceGatherPlaceThisStep=!0},invalidatePathfindingRelatedInfo:function(){Jt.prototype.invalidatePathfindingRelatedInfo.call(this),this.nearestResourceGatherPlace=null},__class__:oe}),(V["buildings.BoardGameStore"]=ae).__name__="buildings.BoardGameStore",ae.__interfaces__=[Kt],ae.__super__=Jt,ae.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 90*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&this.workers[0].currentAction==y.Work&&this.city.simulation.time.timeSinceStart/60%24<23},get_entertainmentType:function(){return 4},get_minimumNormalTimeToSpend:function(){return 3},get_maximumNormalTimeToSpend:function(){return 3.5},get_minimumEntertainmentGroupSatisfy:function(){return 4},get_maximumEntertainmentGroupSatisfy:function(){return 8},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(n,t){function e(){var t=n.relativeY<5?bo.getInt(8,16):0==bo.getInt(2)?bo.fromArray(ae.firstFloorChairs):bo.getInt(3,14),e=!1,i=!0;null==i&&(i=!1),null==e&&(e=!1),n.moveAndWait(bo.getInt(t,t+1),bo.getInt(100,120),null,e,i)}0==bo.getInt(3-n.relativeY<10?1:0)?n.changeFloor(e):e()},work:function(t,e,i){i?t.currentAction=y.Nothing:(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(4-t.relativeX)<i?t.relativeX=4:(e=4-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i),t.setRelativeY(1))},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(ae.saveDefinition)},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:ae}),(V["buildings.IBuildingWithFestivalSpecials"]=le).__name__="buildings.IBuildingWithFestivalSpecials",le.__isInterface__=!0,le.prototype={__class__:le};var he=function(t,e,i,n,s,r,o,a){this.justBuilt=!1,this.festivalJobs=2,this.currentTexture=0,this.currentMainTexture=0,m.call(this,t,e,i,n,s,r,o,a),this.isEntertainment=!0,this.currentTexture=0,this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1})};function ue(t,e,i,n,s,r,o,a){this.percentCleaned=0,this.foodLeft=0,this.percentGrown=0,this.farmStage=de.Growing,Jt.call(this,t,e,i,n,s,r,o,a),this.textures=H.getTexturesByWidth("spr_cacaofarm_trees",20),this.growthSprite=new PIXI.Sprite,i.addChild(this.growthSprite),this.updateTexture(),this.positionSprites(),this.doorX=12,this.adjecentBuildingEffects.push({name:"farm",intensity:1})}(V["buildings.BotanicalGardens"]=he).__name__="buildings.BotanicalGardens",he.__interfaces__=[le,Kt],he.__super__=m,he.prototype=e(m.prototype,{get_baseEntertainmentCapacity:function(){return 40},get_isOpen:function(){if(null!=this.bottomBuilding&&this.bottomBuilding.is(he))return!1;var t=this.city.simulation.time.timeSinceStart/60%24;return 6<=t&&t<22},get_entertainmentType:function(){return 3},get_minimumNormalTimeToSpend:function(){return 2.5},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_drawerType:function(){return ji},get_mergingDrawer:function(){return this.drawer},get_walkThroughCanViewSelfInThisBuilding:function(){return null==this.bottomBuilding||!this.bottomBuilding.is(he)},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postCreate:function(){var t;m.prototype.postCreate.call(this),this.updateGardenTexture(),this.justBuilt&&((t=null)!=this.bottomBuilding&&this.bottomBuilding.is(he)&&(t=this.bottomBuilding),null!=this.topBuilding&&this.topBuilding.is(he)&&(t=this.topBuilding),null!=t?this.get_mergingDrawer().setGroupOfSecondaryTextureForThisBuilding(this.get_mergingDrawer().getSecondaryTextureGroup(t.currentTexture)):this.currentTexture=bo.getInt(vn.isum(he.gardenTextureSets)),this.justBuilt=!1,this.updateGardenTexture()),this.positionSprites()},postLoad:function(){this.updateGardenTexture(),this.changeMainTexture(he.mainTextures[this.currentMainTexture])},onBuild:function(){m.prototype.onBuild.call(this),this.justBuilt=!0},updateGardenTexture:function(){var e=this;this.get_mergingDrawer().setSecondaryBackgroundImages("spr_botanicalgardens_plants",he.gardenTextureSets,this.currentTexture,function(t){e.currentTexture=t})},beEntertained:function(t,e){Gi.beEntertainedPark(this.leftBuilding,this.rightBuilding,t)},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.currentMainTexture},function(t){e.currentMainTexture=t,e.changeMainTexture(he.mainTextures[e.currentMainTexture])},function(){return he.mainTextures.length},kn.lo("change_building_color")),ur.create(this.city.gui,function(){return e.get_mergingDrawer().getCurrentSecondaryTextureGroup()},fa(B=this.get_mergingDrawer(),B.setGroupOfSecondaryTexture),function(){return he.gardenTextureSets.length},kn.lo("change_plants")),ur.create(this.city.gui,function(){return e.currentTexture-e.get_mergingDrawer().getFirstSecondaryTextureOfGroup(e.get_mergingDrawer().getCurrentSecondaryTextureGroup())},fa(B=this.get_mergingDrawer(),B.setSecondaryTextureWithinGroup),function(){return he.gardenTextureSets[e.get_mergingDrawer().getCurrentSecondaryTextureGroup()]},kn.lo("change_plants_variant")),m.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){m.prototype.destroy.call(this),null!=this.festivalEntertainment&&this.festivalEntertainment.destroy()},initFestival:function(){null==this.festivalEntertainment&&(this.festivalEntertainment=new Ni(this,this.bgStage))},stopFestival:function(){null!=this.festivalEntertainment&&(this.festivalEntertainment.stop(),this.festivalEntertainment.destroy(),this.festivalEntertainment=null)},doFestivalWork:function(t,e,i,n){this.festivalEntertainment.doFestivalWork(t,e,i,0,n)},beEntertainedFestival:function(t,e,i){this.festivalEntertainment.beEntertainedFestival(t,e,i)},endFestivalWork:function(t,e){e.setRelativeY(0)},isTree:function(){return 7<=this.currentTexture&&this.currentTexture<=10},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(he.saveDefinition);e=this.currentMainTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.currentTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"currentMainTexture")&&(this.currentMainTexture=t.h.currentMainTexture),Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture),this.postLoad()},__class__:he});var de=x["buildings.CacaoFarmStage"]={__ename__:"buildings.CacaoFarmStage",__constructs__:["Growing","Harvesting"],Growing:{_hx_index:0,__enum__:"buildings.CacaoFarmStage",toString:i},Harvesting:{_hx_index:1,__enum__:"buildings.CacaoFarmStage",toString:i}};function ce(t,e,i,n,s,r,o,a,l,h){this.activeWorkersTotalEducation=0,this.activeWorkers=0,this.buildingEnabled=!0,Jt.call(this,t,e,i,n,s,r,o,a),this.activeBgTextures=H.getTexturesByWidth(l,20),this.idleBgTextures=H.getTexturesByWidth(h,20),this.bgTexture=0,this.backSprite=new PIXI.Sprite(this.idleBgTextures[0]),this.backSprite.position.set(r.x,r.y),i.addChild(this.backSprite)}function pe(t,e,i,n,s,r,o,a,l,h){this.materialMade=0,this.totalMaterialUsed=0,this.efficiency=this.get_normalEfficiency(),ce.call(this,t,e,i,n,s,r,o,a,l,h)}function ge(t,e,i,n,s,r,o,a){this.materialsMadePerStepPerWorker=8e-4,pe.call(this,t,e,i,n,s,r,o,a,"spr_chocolatefactory_frames","spr_chocolatefactory_idle")}function me(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a)}(V["buildings.CacaoFarm"]=ue).__name__="buildings.CacaoFarm",ue.__super__=Jt,ue.prototype=e(Jt.prototype,{postLoad:function(){this.updateTexture()},work:function(t,e,i){var n,s=this;i?t.currentAction=y.Nothing:this.farmStage==de.Growing?(t.setRelativeY(0),null==(n=1<this.city.materials.food||1<this.city.simulation.happiness.actionSpeedModifier)&&(n=!1),t.moveAndWait(bo.getInt(5,13),bo.getInt(50,100),function(){var t,e;s.percentGrown+=.75,100<=s.percentGrown&&(s.farmStage=de.Harvesting,t=35+s.city.simulation.bonuses.extraFoodFromFarms,e=s.getEffectsOfAdjecentBuildings("increaseCropNumber"),s.foodLeft=t+e),s.updateTexture()},n,!1)):t.relativeY<=1?0==this.workers.indexOf(t)?t.setPath(new Int32Array([4,6,9,7]),0,4,!0):t.setPath(new Int32Array([4,12,9,5]),0,4,!0):(n=.025*this.city.simulation.boostManager.currentGlobalBoostAmount/this.city.simulation.happiness.actionSpeedModifier,this.foodLeft-=n,(t=this.city.materials).set_food(t.food+n),this.city.simulation.stats.materialProduction[0][0]+=n,this.city.materials.cacao+=n,this.city.simulation.stats.materialProduction[6][0]+=n,this.foodLeft<=0&&(this.farmStage=de.Growing,this.percentGrown=0),this.updateTexture())},destroy:function(){Jt.prototype.destroy.call(this),this.bgStage.removeChild(this.growthSprite)},update:function(t){var e,i,n;this.farmStage==de.Growing&&(e=this.city.simulation.time.timeSinceStart/60%24,((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)?(this.percentGrown+=.012*t,100<=this.percentGrown&&(this.farmStage=de.Harvesting,this.foodLeft=35+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture()):(e=this.city.simulation.time.timeSinceStart/60%24,((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.percentGrown+=.006*t,100<=this.percentGrown&&(this.farmStage=de.Harvesting,this.foodLeft=35+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture())))},grow:function(t){this.percentGrown+=t,100<=this.percentGrown&&(this.farmStage=de.Harvesting,this.foodLeft=35+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture()},updateTexture:function(){var t;switch(this.farmStage._hx_index){case 0:t=this.textures[Math.floor(this.percentGrown/100*(this.textures.length-1))];break;case 1:t=this.textures[this.textures.length-1]}this.growthSprite.texture=t},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.growthSprite&&this.growthSprite.position.set(this.position.x,this.position.y)},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){switch(t.farmStage._hx_index){case 0:return kn.lo("beans_grown",[Math.floor(t.percentGrown)]);case 1:return kn.lo("cacao_left",[Math.floor(t.foodLeft)])}})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(ue.saveDefinition);e=this.farmStage;t.addString(x[e.__enum__].__constructs__[e._hx_index]);e=this.percentGrown;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.foodLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.percentCleaned;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"farmStage")&&(this.farmStage=t.h.farmStage),Object.prototype.hasOwnProperty.call(t.h,"percentGrown")&&(this.percentGrown=t.h.percentGrown),Object.prototype.hasOwnProperty.call(t.h,"foodLeft")&&(this.foodLeft=t.h.foodLeft),Object.prototype.hasOwnProperty.call(t.h,"percentCleaned")&&(this.percentCleaned=t.h.percentCleaned),this.postLoad()},__class__:ue}),(V["buildings.Factory"]=ce).__name__="buildings.Factory",ce.__super__=Jt,ce.prototype=e(Jt.prototype,{work:function(t,e,i){i?t.currentAction=y.Nothing:(this.workAnimation(t,e),this.activeWorkers+=1,this.activeWorkersTotalEducation+=t.get_educationSpeedModifier())},workAnimation:function(t,e){},update:function(t){var e=!1;0<this.activeWorkers&&this.buildingEnabled&&(e=this.possiblyBeActive(t));e=e&&this.canShowActiveTextures()?this.activeBgTextures:this.idleBgTextures;this.bgTexture+=t/4,this.bgTexture>=e.length&&(this.bgTexture=0),this.backSprite.texture=e[0|this.bgTexture],this.activeWorkers=0,this.activeWorkersTotalEducation=0},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.backSprite&&this.backSprite.position.set(this.position.x,this.position.y)},destroy:function(){Jt.prototype.destroy.call(this),null!=this.backSprite&&this.bgStage.removeChild(this.backSprite)},possiblyBeActive:function(t){return!1},canShowActiveTextures:function(){return!1},__class__:ce}),(V["buildings.MaterialConvertingFactory"]=pe).__name__="buildings.MaterialConvertingFactory",pe.__super__=ce,pe.prototype=e(ce.prototype,{get_normalEfficiency:function(){return 3},get_materialFrom:function(){return 0},set_materialFrom:function(t){return t},get_materialTo:function(){return 0},set_materialTo:function(t){return t},get_bonusSpeed:function(){return 1},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},possiblyBeActive:function(t){if(1<=this.get_materialFrom()){t=t*this.materialsMadePerStepPerWorker*this.activeWorkers*this.city.simulation.happiness.actionSpeedModifier*this.get_bonusSpeed()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.set_materialTo(this.get_materialTo()+t),this.materialMade+=t;t=t*this.efficiency;return this.set_materialFrom(this.get_materialFrom()-t),this.totalMaterialUsed+=t,!0}return!1},canShowActiveTextures:function(){return 3<=this.get_materialFrom()},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(pe.saveDefinition);e=this.totalMaterialUsed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.materialMade;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalMaterialUsed")&&(this.totalMaterialUsed=t.h.totalMaterialUsed),Object.prototype.hasOwnProperty.call(t.h,"materialMade")&&(this.materialMade=t.h.materialMade)},__class__:pe}),(V["buildings.ChocolateFactory"]=ge).__name__="buildings.ChocolateFactory",ge.__super__=pe,ge.prototype=e(pe.prototype,{get_normalEfficiency:function(){return 1},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[]},get_possibleBuildingModes:function(){return[ct,dt]},get_materialFrom:function(){return this.city.materials.cacao},set_materialFrom:function(t){return this.city.materials.cacao=t},get_materialTo:function(){return this.city.materials.chocolate},set_materialTo:function(t){t-=this.city.materials.chocolate;return this.city.materials.chocolate+=t,this.city.simulation.stats.materialProduction[7][0]+=t,this.city.materials.chocolate},workAnimation:function(t,e){var i,n;1==this.workers.indexOf(t)?(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i?t.relativeX=3:(n=3-t.relativeX,t.relativeX+=(0<n?1:n<0?-1:0)*i)):(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(7-t.relativeX)<i?t.relativeX=7:(n=7-t.relativeX,t.relativeX+=(0<n?1:n<0?-1:0)*i))},addWindowInfoLines:function(){var t=this;pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("chocolate_production",[0|t.totalMaterialUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),pe.prototype.save.call(this,t),e&&t.addString(ge.saveDefinition)},load:function(t,e){pe.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:ge}),(V["buildings.CityHall"]=me).__name__="buildings.CityHall",me.sanitizeCityName=function(t){return Y.substr(t,0,1e3)},me.__super__=Jt,me.prototype=e(Jt.prototype,{get_possiblePolicies:function(){return[Vr,Kr,Yr]},update:function(t){},work:function(t,e,i){i&&(t.currentAction=y.Nothing);i=bo.getInt(7);t.relativeY<5?i<3?t.changeFloorAndWaitRandom(20,30):i<5?t.moveAndWait(bo.getInt(3,7),bo.getInt(90,180),null,!1,!1):t.moveAndWait(bo.getInt(12,15),bo.getInt(90,180),null,!1,!1):i<1?t.changeFloorAndWaitRandom(20,30):i<3?t.moveAndWait(bo.getInt(3,4),bo.getInt(90,180),null,!1,!1):i<5?t.moveAndWait(bo.getInt(9,10),bo.getInt(90,180),null,!1,!1):t.moveAndWait(bo.getInt(15,16),bo.getInt(90,180),null,!1,!1)},createWindowAddBottomButtons:function(){var e=this;rs.createSettingButton(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner,function(){e.city.simulation.happiness.ignoreUnhappyCitizens=!e.city.simulation.happiness.ignoreUnhappyCitizens},function(){return e.city.simulation.happiness.ignoreUnhappyCitizens},kn.lo("ignore_unhappy_citizens")),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,4))),ir.createHeader(this.city.gui,kn.lo("city_name")),this.city.gui.windowInner.addChild(new Js(this.city.gui.windowInner,this.city.gui.innerWindowStage,null,function(){return""==e.city.cityName?kn.lo("unnamed_city"):e.city.cityName},"Arial, sans-serif",null,300,null,15));dr.create(this.city.gui,function(){var t;e.game.isMobile?null!=(t=window.prompt(kn.lo("give_city_name"),e.city.cityName))&&(e.city.cityName=me.sanitizeCityName(t)):ss.createWindow(e.city)},this.city.gui.windowInner,function(){return kn.lo("change_city_name")},this.city.gui.innerWindowStage);this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,4))),Jt.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(me.saveDefinition)},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:me});var fe=function(){};function ye(t,e,i,n,s,r,o,a){this.currentTexture=0,m.call(this,t,e,i,n,s,r,o,a)}function _e(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a)}function we(t,e,i,n,s,r,o,a){this.materialsMadePerStepPerWorker=1e-4,pe.call(this,t,e,i,n,s,r,o,a,"spr_computerchipfactory_frames","spr_computerchipfactory_idle")}function be(t,e,i,n,s,r,o,a){this.totalKnowledgeGenerated=0,ce.call(this,t,e,i,n,s,r,o,a,"spr_computerresearchcenter_frames","spr_computerresearchcenter_idle")}(V["buildings.ICustomizableOnBuild"]=fe).__name__="buildings.ICustomizableOnBuild",fe.__isInterface__=!0,(V["buildings.ColoredBlock"]=ye).__name__="buildings.ColoredBlock",ye.__interfaces__=[fe],ye.__super__=m,ye.prototype=e(m.prototype,{get_drawerType:function(){return Ki},get_decorationDrawer:function(){return this.drawer},customize:function(t,e){this.currentTexture=t},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Fr.getClass(this),!0,this.currentTexture)},postCreate:function(){this.get_decorationDrawer().changeSubImage(this.currentTexture)},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()},kn.lo("change_building_color")),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),m.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(ye.saveDefinition);var i=this.currentTexture;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture)},__class__:ye}),(V["buildings.ComfortableHouse"]=_e).__name__="buildings.ComfortableHouse",_e.__super__=Yt,_e.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[lt,Dt]},__class__:_e}),(V["buildings.ComputerChipFactory"]=we).__name__="buildings.ComputerChipFactory",we.__super__=pe,we.prototype=e(pe.prototype,{get_normalEfficiency:function(){return 7},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[ut]},get_possibleBuildingModes:function(){return[ct,Wt]},get_materialFrom:function(){return this.city.materials.refinedMetal},set_materialFrom:function(t){t=this.city.materials.refinedMetal-t;return this.city.materials.refinedMetal-=t,this.city.simulation.stats.materialUsed[4][0]+=t,this.city.materials.refinedMetal},get_materialTo:function(){return this.city.materials.computerChips},set_materialTo:function(t){t-=this.city.materials.computerChips;return this.city.materials.computerChips+=t,this.city.simulation.stats.materialProduction[5][0]+=t,this.city.materials.computerChips},get_bonusSpeed:function(){return(0==this.workers.length?1:this.activeWorkersTotalEducation/this.activeWorkers)*this.city.upgrades.vars.computerChipFactorySpeed},onBuild:function(){this.city.progress.unlocks.unlock(J),this.city.progress.unlocks.unlock(ft),this.city.progress.unlocks.unlock(zi),this.city.progress.unlocks.unlock(Ze),this.city.progress.unlocks.unlock(Ai),this.city.progress.unlocks.unlock(ve),this.city.progress.unlocks.fullyUnlock(Zt),this.city.progress.unlocks.unlock(ln),this.city.progress.unlocks.unlock(zt),this.city.progress.unlocks.unlock(mt)},workAnimation:function(t,e){var i,n;10!=t.relativeY&&(1==this.workers.indexOf(t)?t.setRelativePos(3,10):(0==this.workers.indexOf(t)?(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i?t.relativeX=3:(n=3-t.relativeX,t.relativeX+=(0<n?1:n<0?-1:0)*i)):(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(13-t.relativeX)<i?t.relativeX=13:(n=13-t.relativeX,t.relativeX+=(0<n?1:n<0?-1:0)*i)),t.setRelativeY(0)))},addWindowInfoLines:function(){var t=this;pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("computer_chip_production",[0|t.totalMaterialUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),pe.prototype.save.call(this,t),e&&t.addString(we.saveDefinition)},load:function(t,e){pe.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:we}),(V["buildings.ComputerResearchCenter"]=be).__name__="buildings.ComputerResearchCenter",be.__super__=ce,be.prototype=e(ce.prototype,{get_possibleCityUpgrades:function(){return[ln]},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},workAnimation:function(t,e){switch(this.workers.indexOf(t)){case 0:t.setRelativePos(13,10);break;case 1:t.setRelativePos(6,0);break;case 2:t.setRelativePos(6,10);break;case 3:t.setRelativePos(15,0);break;case 4:t.setRelativePos(8,0)}},possiblyBeActive:function(t){t=.0014*t*this.city.simulation.happiness.actionSpeedModifier*this.activeWorkersTotalEducation*this.city.simulation.boostManager.currentGlobalBoostAmount;return this.city.materials.knowledge+=t,this.city.simulation.stats.materialProduction[9][0]+=t,this.totalKnowledgeGenerated+=t,!0},canShowActiveTextures:function(){return!0},addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(be.saveDefinition);var i=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated)},__class__:be});var ve=function(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a)};(V["buildings.CuttingEdgeHome"]=ve).__name__="buildings.CuttingEdgeHome",ve.__super__=Yt,ve.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[st,Mt,Ft]},walkAround:function(t,e){var i=bo.getInt(3);0==i&&120<e?t.changeFloorAndWaitRandom(30,60):1==i?t.relativeY<5?t.moveAndWait(bo.getInt(3,15),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(5,15),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},__class__:ve});var Se=function(t,e,i,n,s,r,o,a){this.crop3Sprite=0,this.crop2Sprite=0,this.openDay=0,Jt.call(this,t,e,i,n,s,r,o,a),this.crop2Sprite=bo.getInt(Se.crop2Sprites.length),this.crop3Sprite=bo.getInt(Se.crop3Sprites.length),this.growthAreas=[new Ae(i,this,new Cn(3,3),n,"spr_ecofarm_crop1",6,15,.7,0,6),new Ae(i,this,new Cn(9,3),n,Se.crop2Sprites[this.crop2Sprite],8,7,1.4,10),new Ae(i,this,new Cn(9,12),n,Se.crop3Sprites[this.crop3Sprite],8,8,.6,7)],this.isEntertainment=!0,this.openDay=bo.getInt(7),this.positionSprites(),this.adjecentBuildingEffects.push({name:"farm",intensity:1})};function xe(t,e,i,n,s,r,o,a){this.graphicsDrawn=!1,this.escapeRoomPhaseProgress=0,this.escapeRoomPhase=Pe.Start,Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=13,this.endTime=3,this.workTimePreferenceMod=.1,this.isEntertainment=!0,this.registeredCitizens=[],this.graphics=new PIXI.Graphics,i.addChild(this.graphics),this.graphics.position.set(r.x,r.y)}(V["buildings.EcoFarm"]=Se).__name__="buildings.EcoFarm",Se.__interfaces__=[Kt],Se.__super__=Jt,Se.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 5*this.workers.length},get_isOpen:function(){return 0<this.workers.length&&this.workers[0].currentAction==y.Work&&(1+((0|this.city.simulation.time.timeSinceStart)/1440|0))%7==this.openDay&&this.city.simulation.time.timeSinceStart/60%24<20.5&&12<this.city.simulation.time.timeSinceStart/60%24},get_entertainmentType:function(){return 3},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.5},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(t,e){var i=!1,n=!0;null==n&&(n=!1),null==i&&(i=!1),t.moveAndWait(bo.getInt(3,16),bo.getInt(50,100),null,i,n)},postLoad:function(){this.growthAreas[1].setTexture(Se.crop2Sprites[this.crop2Sprite],8),this.growthAreas[2].setTexture(Se.crop3Sprites[this.crop3Sprite],8);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.updateTexture()}},update:function(t){(1+((0|this.city.simulation.time.timeSinceStart)/1440|0))%7==this.openDay?this.endTime=21:this.endTime=19,Jt.prototype.update.call(this,t);for(var e=0,i=this.growthAreas;e<i.length;){var n=i[e];++e,n.update(t)}},work:function(t,e,i){var n,s;i?t.currentAction=y.Nothing:1==(n=this.workers.indexOf(t))?t.relativeY<5?(s=t,(i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=18,s.setPath(i,0,2,!0),t.pathEndFunction=function(){t.changeFloor()},t.pathOnlyRelatedTo=t.inPermanent):this.growthAreas[n].doCitizenWork(t):0==n&&this.growthAreas[0].farmStage==Fe.Harvesting?t.relativeY<=1||t.relativeX<4||6<t.relativeX?t.setPath(new Int32Array([4,5,9,8]),0,4,!0):this.growthAreas[n].doCitizenWorkNoMove(t):5<t.relativeY?t.changeFloor():this.growthAreas[n].doCitizenWork(t)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t,e),this.saveBasics(t);for(var i=0,n=this.growthAreas;i<n.length;){var s=n[i];++i,s.save(t)}},load:function(t,e){Jt.prototype.load.call(this,t,e),this.loadBasics(t,e);for(var i=0,n=this.growthAreas;i<n.length;){var s=n[i];++i,s.load(t)}this.postLoad()},destroy:function(){Jt.prototype.destroy.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.destroy()}},positionSprites:function(){Jt.prototype.positionSprites.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.positionSprites()}},addWindowInfoLines:function(){Jt.prototype.addWindowInfoLines.call(this),this.growthAreas[0].showInfoText(kn.lo("left_plot")+" "),this.growthAreas[1].showInfoText(kn.lo("top_right_plot")+" "),this.growthAreas[2].showInfoText(kn.lo("bottom_right_plot")+" ")},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Se.saveDefinition);e=this.openDay;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.crop2Sprite;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.crop3Sprite;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"openDay")&&(this.openDay=t.h.openDay),Object.prototype.hasOwnProperty.call(t.h,"crop2Sprite")&&(this.crop2Sprite=t.h.crop2Sprite),Object.prototype.hasOwnProperty.call(t.h,"crop3Sprite")&&(this.crop3Sprite=t.h.crop3Sprite),this.postLoad()},__class__:Se});var Pe=x["buildings.EscapeRoomPhase"]={__ename__:"buildings.EscapeRoomPhase",__constructs__:["Start","First","Second","Third","Lasers","Last","Done"],Start:{_hx_index:0,__enum__:"buildings.EscapeRoomPhase",toString:i},First:{_hx_index:1,__enum__:"buildings.EscapeRoomPhase",toString:i},Second:{_hx_index:2,__enum__:"buildings.EscapeRoomPhase",toString:i},Third:{_hx_index:3,__enum__:"buildings.EscapeRoomPhase",toString:i},Lasers:{_hx_index:4,__enum__:"buildings.EscapeRoomPhase",toString:i},Last:{_hx_index:5,__enum__:"buildings.EscapeRoomPhase",toString:i},Done:{_hx_index:6,__enum__:"buildings.EscapeRoomPhase",toString:i}};function Ce(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.growthAreas=[new Ae(i,this,new Cn(3,3),n,"spr_experimentalfarm_crop1",5,12,1,5),new Ae(i,this,new Cn(12,3),n,"spr_experimentalfarm_crop2",5,10,1.2,10),new Ae(i,this,new Cn(12,12),n,"spr_experimentalfarm_crop3",5,6,1.5,10)],this.positionSprites(),this.adjecentBuildingEffects.push({name:"farm",intensity:1})}function Ie(t,e,i,n,s,r,o,a){this.bottomPipeSprite=null,this.topPipeSprite=null,this.materialsMadePerStepPerWorker=.0023,pe.call(this,t,e,i,n,s,r,o,a,this.get_idleFrames(),this.get_idleFrames())}function Te(t,e,i,n,s,r,o,a){this.hasSearchedForRuinsThisStep=!1,this.currentAction=Be.Unknown,this.nearestRuins=null,Jt.call(this,t,e,i,n,s,r,o,a)}(V["buildings.EscapeRoom"]=xe).__name__="buildings.EscapeRoom",xe.__interfaces__=[Kt],xe.__super__=Jt,xe.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 120*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&this.workers[0].currentAction==y.Work&&this.city.simulation.time.timeSinceStart/60%24<23.99&&this.registeredCitizens.length<10},get_entertainmentType:function(){return 4},get_minimumNormalTimeToSpend:function(){return 2.5},get_maximumNormalTimeToSpend:function(){return 3.5},get_minimumEntertainmentGroupSatisfy:function(){return 4},get_maximumEntertainmentGroupSatisfy:function(){return 7},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return 1==this.workers.length&&this.workers[0].currentAction==y.Work},finishEntertainment:function(t,e){return this.registeredCitizens.length<5||-1==this.registeredCitizens.indexOf(t)||this.escapeRoomPhase==Pe.Done||!this.get_isOpenForExistingVisitors()},beEntertained:function(t,e){if(!t.hasBuildingInited||null==t.dynamicUnsavedVars.buildingInited){if(-1==this.registeredCitizens.indexOf(t)){if(10<this.registeredCitizens.length)return void t.entertainment.stop();this.registeredCitizens.push(t)}t.hasBuildingInited=!0,t.dynamicUnsavedVars.buildingInited=!0}var i;this.escapeRoomPhase!=Pe.Done?this.registeredCitizens.length<5?5<t.relativeY?t.changeFloor():t.moveAndWait(bo.getInt(7,16),bo.getInt(50,70),null,!1,!1):this.escapeRoomPhase==Pe.Start?(5<t.relativeY?t.changeFloor():t.moveAndWait(bo.getInt(7,16),bo.getInt(50,70),null,!1,!1),this.registeredCitizens.length<8&&this.escapeRoomPhaseProgress<1?this.escapeRoomPhaseProgress+=.02*e:(this.escapeRoomPhase=Pe.First,this.escapeRoomPhaseProgress=0)):this.escapeRoomPhase==Pe.First?t.relativeY<5&&2<t.relativeX&&t.relativeX<7?t.changeFloor():(t.moveAndWait(bo.getInt(3,6),bo.getInt(30,60),null,!1,!1),bo.getFloat(1)<.2&&(this.escapeRoomPhaseProgress+=.2,1<this.escapeRoomPhaseProgress&&(this.escapeRoomPhase=Pe.Second,this.escapeRoomPhaseProgress=0))):this.escapeRoomPhase==Pe.Second?this.registeredCitizens.indexOf(t)%2==0?5<t.relativeY?t.changeFloor():(t.moveAndWait(bo.getInt(3,16),bo.getInt(50,120),null,!1,!1),bo.getFloat(1)<.3&&(this.escapeRoomPhaseProgress+=.34,1<this.escapeRoomPhaseProgress&&(this.escapeRoomPhase=Pe.Third,this.escapeRoomPhaseProgress=0))):t.relativeY<5&&2<t.relativeX&&t.relativeX<7?t.changeFloor():t.moveAndWait(bo.getInt(3,6),bo.getInt(30,60),null,!1,!1):this.escapeRoomPhase==Pe.Third?5<t.relativeY?t.changeFloor():4<t.relativeX&&(i=bo.getInt(3,5),(e=0<(e=io.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,e[1]=i,t.setPath(e,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent):this.escapeRoomPhase==Pe.Last&&(t.relativeY<5&&11<t.relativeX&&t.relativeX<16?t.changeFloor():t.moveAndWait(bo.getInt(11,16),bo.getInt(20,60),null,!1,!1)):t.entertainment.stop()},update:function(t){for(var e=this.registeredCitizens.length;0<--e;){var i=this.registeredCitizens[e];!i.hasDied&&(null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null)==this||this.registeredCitizens.splice(e,1)}this.escapeRoomPhase==Pe.Done?(this.escapeRoomPhaseProgress+=.02*t,1<=this.escapeRoomPhaseProgress&&this.resetEscapeRoom()):this.escapeRoomPhase==Pe.Third?vn.all(this.registeredCitizens,function(t){return t.relativeY<5&&t.relativeX<5})&&(this.escapeRoomPhase=Pe.Lasers,this.escapeRoomPhaseProgress=0):this.escapeRoomPhase==Pe.Last&&vn.all(this.registeredCitizens,function(t){return 5<t.relativeY&&11<t.relativeX})&&(this.escapeRoomPhase=Pe.Done,this.escapeRoomPhaseProgress=0),this.escapeRoomPhase==Pe.Lasers?(this.graphics.clear(),this.graphics.beginFill(16711680,.7),this.graphics.drawRect(7,13,1,1),this.graphics.drawRect(8,13,1,1),this.graphics.drawRect(9,13,1,1),this.graphics.drawRect(10,13,1,1),this.graphics.drawRect(11,13,1,1),this.graphics.drawRect(12,13,1,1),this.graphics.drawRect(13,13,1,1),this.graphics.drawRect(14,13,1,1),this.graphics.drawRect(15,13,1,1),this.graphics.drawRect(16,13,1,1),this.graphics.endFill(),this.graphicsDrawn=!0,this.escapeRoomPhaseProgress+=.01*t,1<=this.escapeRoomPhaseProgress&&(this.escapeRoomPhaseProgress=0,this.escapeRoomPhase=Pe.Last)):this.graphicsDrawn&&(this.graphics.clear(),this.graphicsDrawn=!1)},postLoad:function(){this.graphics.position.set(this.position.x,this.position.y)},positionSprites:function(){Jt.prototype.positionSprites.call(this),this.graphics.position.set(this.position.x,this.position.y)},onCitizenLeave:function(t,e){Y.remove(this.registeredCitizens,t)},work:function(t,e,i){i?(t.currentAction=y.Nothing,this.resetEscapeRoom()):(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i?t.relativeX=3:(e=3-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i))},resetEscapeRoom:function(){this.escapeRoomPhase=Pe.Start,this.escapeRoomPhaseProgress=0},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(xe.saveDefinition)},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t);this.postLoad()},__class__:xe}),(V["buildings.ExperimentalFarm"]=Ce).__name__="buildings.ExperimentalFarm",Ce.__super__=Jt,Ce.prototype=e(Jt.prototype,{onBuild:function(){this.city.simulation.bonuses.indoorFarmSpeed+=.1},postLoad:function(){for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.updateTexture()}},update:function(t){Jt.prototype.update.call(this,t);for(var e=0,i=this.growthAreas;e<i.length;){var n=i[e];++e,n.update(t)}},work:function(t,e,i){var n,s;i?t.currentAction=y.Nothing:1==(n=this.workers.indexOf(t))?t.relativeY<5?(s=t,(i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=18,s.setPath(i,0,2,!0),t.pathEndFunction=function(){t.changeFloor()},t.pathOnlyRelatedTo=t.inPermanent):this.growthAreas[n].doCitizenWork(t):5<t.relativeY?t.changeFloor():this.growthAreas[n].doCitizenWork(t)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t,e),this.saveBasics(t);for(var i=0,n=this.growthAreas;i<n.length;){var s=n[i];++i,s.save(t)}},load:function(t,e){Jt.prototype.load.call(this,t,e),this.loadBasics(t,e);for(var i=0,n=this.growthAreas;i<n.length;){var s=n[i];++i,s.load(t)}this.postLoad()},destroy:function(){Jt.prototype.destroy.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.destroy()}this.city.simulation.bonuses.indoorFarmSpeed-=.1},positionSprites:function(){Jt.prototype.positionSprites.call(this);for(var t=0,e=this.growthAreas;t<e.length;){var i=e[t];++t,i.positionSprites()}},addWindowInfoLines:function(){Jt.prototype.addWindowInfoLines.call(this),this.growthAreas[0].showInfoText(kn.lo("left_plot")+" "),this.growthAreas[1].showInfoText(kn.lo("top_right_plot")+" "),this.growthAreas[2].showInfoText(kn.lo("bottom_right_plot")+" ")},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Ce.saveDefinition)},loadBasics:function(t,e){null==e&&(e=t.readString());Un.makeLoadMap(e,t);this.postLoad()},__class__:Ce}),(V["buildings.ExperimentationLab"]=Ie).__name__="buildings.ExperimentationLab",Ie.__super__=pe,Ie.prototype=e(pe.prototype,{get_normalEfficiency:function(){return.2},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[Nt]},get_possibleBuildingModes:function(){return[wt,_t]},get_materialFrom:function(){return this.city.materials.machineParts},set_materialFrom:function(t){t=this.city.materials.machineParts-t;return this.city.materials.machineParts-=t,this.city.simulation.stats.materialUsed[3][0]+=t,this.city.materials.machineParts},get_materialTo:function(){return this.city.materials.knowledge},set_materialTo:function(t){t-=this.city.materials.knowledge;return this.city.materials.knowledge+=t,this.city.simulation.stats.materialProduction[9][0]+=t,this.city.materials.knowledge},get_idleFrames:function(){return"spr_experimentationlab_idle"},get_bonusSpeed:function(){return 0==this.workers.length?1:this.activeWorkersTotalEducation/this.activeWorkers},destroy:function(){pe.prototype.destroy.call(this),null!=this.topPipeSprite&&this.topPipeSprite.destroy(),null!=this.bottomPipeSprite&&this.bottomPipeSprite.destroy()},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(4,10):t.setRelativePos(3,0))},addWindowInfoLines:function(){var t=this;pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_production_from_machine_parts",[0|t.totalMaterialUsed,0|t.materialMade])})},canShowActiveTextures:function(){return!1},onCityChange:function(){null!=this.bottomBuilding&&this.bottomBuilding.is(ke)&&!this.bottomBuilding.is(Me)?(null==this.bottomPipeSprite&&(this.bottomPipeSprite=new PIXI.Sprite(H.getTexture("spr_experimentationlab_pipe_bottom")),this.city.justAboveCityStage.addChild(this.bottomPipeSprite)),this.bottomPipeSprite.position.set(this.position.x+7,this.position.y+17)):null!=this.bottomPipeSprite&&(this.bottomPipeSprite.destroy(),this.bottomPipeSprite=null),null!=this.topBuilding&&this.topBuilding.is(ke)&&!this.topBuilding.is(Me)?(null==this.topPipeSprite&&(this.topPipeSprite=new PIXI.Sprite(H.getTexture("spr_experimentationlab_pipe_top")),this.city.justAboveCityStage.addChild(this.topPipeSprite)),this.topPipeSprite.position.set(this.position.x+10,this.position.y-11)):null!=this.topPipeSprite&&(this.topPipeSprite.destroy(),this.topPipeSprite=null)},save:function(t,e){null==e&&(e=!0),pe.prototype.save.call(this,t),e&&t.addString(Ie.saveDefinition)},load:function(t,e){pe.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Ie});var Be=x["buildings.CurrentExplorationCentreAction"]={__ename__:"buildings.CurrentExplorationCentreAction",__constructs__:["Unknown","Exploring","Investigating"],Unknown:{_hx_index:0,__enum__:"buildings.CurrentExplorationCentreAction",toString:i},Exploring:{_hx_index:1,__enum__:"buildings.CurrentExplorationCentreAction",toString:i},Investigating:{_hx_index:2,__enum__:"buildings.CurrentExplorationCentreAction",toString:i}};(V["buildings.ExplorationCentre"]=Te).__name__="buildings.ExplorationCentre",Te.__super__=Jt,Te.prototype=e(Jt.prototype,{addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){switch(t.currentAction._hx_index){case 0:return kn.lo("current_task_looking");case 1:return kn.lo("current_task_exploring");case 2:return kn.lo("current_task_investigating")}})},work:function(t,e,i){if(i)t.currentAction=y.Nothing,t.hasWorkTools=!1;else if(t.hasWorkTools)if(t.inPermanent instanceof la)this.exploreTheseRuins(t);else{if(null==this.nearestRuins&&!this.hasSearchedForRuinsThisStep&&!Object.prototype.hasOwnProperty.call(this.world.knownResourceInavailability.h,"AlienRuins")){if(!this.city.simulation.permanentFinder.canPerformQuery())return;this.nearestRuins=this.city.simulation.permanentFinder.query(this,function(t){return!!t.is(la)&&t.explored<100}),this.hasSearchedForRuinsThisStep=!0,null==this.nearestRuins&&(this.world.knownResourceInavailability.h.AlienRuins=!0)}this.exploreOrInvestigate(t,e)}else t.inPermanent==this?t.moveAndWait(4,30,function(){t.hasWorkTools=!0},!0):(t.simulation.pathfinder.findPath(t,this),t.pathOnFail=null)},exploreTheseRuins:function(i){var n=this,s=i.inPermanent,t=0==s.standingPlaces.length?bo.getInt(1,17):bo.fromArray(s.standingPlaces);i.moveAndWait(t,bo.getInt(90,180),function(){var t,e;s.explored<100?(s.explored+=.25,t=n.city.simulation,t=.25*(k.earlyGameFix1&&t.citizens.length<30?1.3-t.citizens.length/60*.3:1)*n.city.simulation.boostManager.currentGlobalBoostAmount,n.city.materials.knowledge+=t,n.city.simulation.stats.materialProduction[9][0]+=t,s.awardAnyBonuses(),100<=s.explored&&(s.explored=100,null!=i.inPermanent&&i.inPermanent.isBuilding?(e=null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null,i.relativeX=20*e.worldPosition.x+e.doorX):i.relativeX+=20*i.inPermanent.worldPosition.x,null!=i.inPermanent&&i.inPermanent.onCitizenLeave(i,null),i.inBuildingSince=i.city.simulation.time.timeSinceStart,i.set_drawOnStage(i.foregroundStage),i.inPermanent=null,i.relativeY=0,I.shouldUpdateDraw=!0,n.nearestRuins=null)):(null!=i.inPermanent&&i.inPermanent.isBuilding?(e=null!=i.inPermanent&&i.inPermanent.isBuilding?i.inPermanent:null,i.relativeX=20*e.worldPosition.x+e.doorX):i.relativeX+=20*i.inPermanent.worldPosition.x,null!=i.inPermanent&&i.inPermanent.onCitizenLeave(i,null),i.inBuildingSince=i.city.simulation.time.timeSinceStart,i.set_drawOnStage(i.foregroundStage),i.inPermanent=null,i.relativeY=0,I.shouldUpdateDraw=!0,n.nearestRuins=null)},!0)},exploreOrInvestigate:function(t,e){var i,n;null!=this.nearestRuins?(t.simulation.pathfinder.findPath(t,this.nearestRuins),t.pathOnFail=null,this.currentAction=Be.Exploring):(this.currentAction=Be.Investigating,t.inPermanent==this?1!=(n=this.workers.indexOf(t))&&2!=n||!t.isAtGroundLevel()?(i=2==n?12:3,n=2==n?16:7,t.relativeX>=i&&t.relativeX<n?(e=.001*e*this.city.simulation.happiness.actionSpeedModifier*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount,this.city.materials.knowledge+=e,this.city.simulation.stats.materialProduction[9][0]+=e):(i=bo.getInt(i,n),(n=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=i,t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)):t.changeFloor():(t.simulation.pathfinder.findPath(t,this),t.pathOnFail=null))},update:function(t){Jt.prototype.update.call(this,t),this.hasSearchedForRuinsThisStep=!1},invalidatePathfindingRelatedInfo:function(){Jt.prototype.invalidatePathfindingRelatedInfo.call(this),this.nearestRuins=null},__class__:Te});var ke=function(t,e,i,n,s,r,o,a){this.materialsMadePerStepPerWorker=.001,pe.call(this,t,e,i,n,s,r,o,a,this.get_animationFrames(),this.get_idleFrames())};(V["buildings.RefinedMetalFactory"]=ke).__name__="buildings.RefinedMetalFactory",ke.__super__=pe,ke.prototype=e(pe.prototype,{get_normalEfficiency:function(){return 5},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[]},get_possibleBuildingModes:function(){return[ct,At,Et]},get_materialFrom:function(){return this.city.materials.stone},set_materialFrom:function(t){t=this.city.materials.stone-t;return this.city.materials.stone-=t,this.city.simulation.stats.materialUsed[2][0]+=t,this.city.materials.stone},get_materialTo:function(){return this.city.materials.refinedMetal},set_materialTo:function(t){t-=this.city.materials.refinedMetal;return this.city.materials.refinedMetal+=t,this.city.simulation.stats.materialProduction[4][0]+=t,this.city.materials.refinedMetal},get_animationFrames:function(){return"spr_refinedmetalfactory_frames"},get_idleFrames:function(){return"spr_refinedmetalfactory_idle"},onBuild:function(){this.city.progress.unlocks.unlock(Ye),this.city.progress.unlocks.unlock(be),this.city.progress.unlocks.fullyUnlock(ni),this.city.progress.unlocks.fullyUnlock(oi),this.city.progress.unlocks.unlock(Pi),this.city.progress.unlocks.unlock(ki)},workAnimation:function(t,e){var i;10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(3,10):(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i?t.relativeX=3:(e=3-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i),t.setRelativeY(0)))},addWindowInfoLines:function(){var t=this;pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("refinded_metals_made",[0|t.totalMaterialUsed,0|t.materialMade])})},onCityChange:function(){this.efficiency=5,this.materialsMadePerStepPerWorker=.001,null!=this.bottomBuilding&&this.bottomBuilding.is(Ie)&&(this.efficiency-=.5,this.materialsMadePerStepPerWorker+=1e-4),null!=this.topBuilding&&this.topBuilding.is(Ie)&&(this.efficiency-=.5,this.materialsMadePerStepPerWorker+=1e-4)},save:function(t,e){null==e&&(e=!0),pe.prototype.save.call(this,t),e&&t.addString(ke.saveDefinition)},load:function(t,e){pe.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:ke});var Me=function(t,e,i,n,s,r,o,a){ke.call(this,t,e,i,n,s,r,o,a),this.materialsMadePerStepPerWorker=75e-5,this.startTime=16.5,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(V["buildings.FactoryPub"]=Me).__name__="buildings.FactoryPub",Me.__interfaces__=[Kt],Me.__super__=ke,Me.prototype=e(ke.prototype,{get_baseEntertainmentCapacity:function(){return 25*this.workers.length},get_isOpen:function(){if(1<=this.workers.length&&this.workers[0].currentAction==y.Work){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<4.5?e<=t&&t<4.5:e<=t||t<4.5}return!1},get_entertainmentType:function(){return 1},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_animationFrames:function(){return"spr_refinedmetalfactorypub_frames"},get_idleFrames:function(){return"spr_refinedmetalfactorypub_idle"},get_drawerType:function(){return Vi},destroy:function(){ke.prototype.destroy.call(this)},positionSprites:function(){ke.prototype.positionSprites.call(this)},beEntertained:function(n,t){var e,i;n.relativeY<5?n.changeFloor(function(){var t=bo.getInt(8,16),e=n,i=io.pool,i=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2);i[0]=4,i[1]=t,e.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}):(e=n,(i=0<(i=io.pool)[4].length?i[4].splice(i[4].length-1,1)[0]:new Int32Array(4))[0]=4,i[1]=bo.getInt(8,null!=this.rightBuilding&&this.rightBuilding.is(Me)?19:16),i[2]=8,i[3]=bo.getInt(60,120),e.setPath(i,0,4,!0)),n.hasBuildingInited||(n.wantsNightEntertainmentIn=bo.getInt(1,5),n.hasBuildingInited=!0)},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(8,10):t.setRelativePos(3,1))},save:function(t,e){null==e&&(e=!0),ke.prototype.save.call(this,t),e&&t.addString(Me.saveDefinition)},load:function(t,e){ke.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Me});var ze=function(t,e,i,n,s,r,o,a){this.cachedAdjacencyExpiration=0,this.cachedAdjacencyValue=0,this.woodMade=0,ce.call(this,t,e,i,n,s,r,o,a,"spr_farmbyproductprocessor_frames","spr_farmbyproductprocessor_idle")};(V["buildings.FarmByProductProcessor"]=ze).__name__="buildings.FarmByProductProcessor",ze.__super__=ce,ze.prototype=e(ce.prototype,{get_walkThroughCanViewSelfInThisBuilding:function(){return!1},possiblyBeActive:function(t){this.cachedAdjacencyExpiration--;var e=this.cachedAdjacencyValue;this.cachedAdjacencyExpiration<=0&&(e=this.adjacentFarmNumber(!0),this.cachedAdjacencyValue=e,this.cachedAdjacencyExpiration=72);e=.0014*this.activeWorkersTotalEducation*this.city.simulation.happiness.actionSpeedModifier*this.city.simulation.boostManager.currentGlobalBoostAmount*t*e;return this.city.materials.wood+=e,this.city.simulation.stats.materialProduction[1][0]+=e,this.woodMade+=e,0<e},adjacentFarmNumber:function(t){var e="farm",i=0;if(null!=this.leftBuilding){for(var n=0,s=0,r=this.leftBuilding.adjecentBuildingEffects;s<r.length;){var o=r[s];++s,o.name==e&&(n+=o.intensity)}.5<n&&(t?this.leftBuilding.is(Jt)?i+=(a=this.leftBuilding).workers.length/a.get_jobs():i+=(l=this.leftBuilding).residents.length/l.get_residentCapacity():++i)}if(null!=this.rightBuilding&&(null==this.rightBuilding.rightBuilding||!this.rightBuilding.rightBuilding.is(ze))){for(n=0,s=0,r=this.rightBuilding.adjecentBuildingEffects;s<r.length;){o=r[s];++s,o.name==e&&(n+=o.intensity)}.5<n&&(t?this.rightBuilding.is(Jt)?i+=(a=this.rightBuilding).workers.length/a.get_jobs():i+=(l=this.rightBuilding).residents.length/l.get_residentCapacity():++i)}if(!(null==this.topBuilding||null!=this.topBuilding.leftBuilding&&this.topBuilding.leftBuilding.is(ze)||null!=this.topBuilding.rightBuilding&&this.topBuilding.rightBuilding.is(ze))){for(n=0,s=0,r=this.topBuilding.adjecentBuildingEffects;s<r.length;){o=r[s];++s,o.name==e&&(n+=o.intensity)}.5<n&&(t?this.topBuilding.is(Jt)?i+=(a=this.topBuilding).workers.length/a.get_jobs():i+=(l=this.topBuilding).residents.length/l.get_residentCapacity():++i)}if(!(null==this.bottomBuilding||null!=this.bottomBuilding.leftBuilding&&this.bottomBuilding.leftBuilding.is(ze)||null!=this.bottomBuilding.rightBuilding&&this.bottomBuilding.rightBuilding.is(ze)||null!=this.bottomBuilding.bottomBuilding&&this.bottomBuilding.bottomBuilding.is(ze))){for(var a,l,n=0,s=0,r=this.bottomBuilding.adjecentBuildingEffects;s<r.length;){o=r[s];++s,o.name==e&&(n+=o.intensity)}.5<n&&(t?this.bottomBuilding.is(Jt)?i+=(a=this.bottomBuilding).workers.length/a.get_jobs():i+=(l=this.bottomBuilding).residents.length/l.get_residentCapacity():++i)}return i},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(12,10):t.setRelativePos(15,10))},canShowActiveTextures:function(){return!0},addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return 1==(0|t.adjacentFarmNumber(!1))?kn.lo("producing_by_products_for_1_farm"):kn.lo("producing_by_products_for_n_farms",[0|t.adjacentFarmNumber(!1)])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("wood_produced",[0|t.woodMade])})},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(ze.saveDefinition);var i=this.woodMade;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){ce.prototype.load.call(this,t),t.version<22||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"woodMade")&&(this.woodMade=t.h.woodMade))},__class__:ze});var Ae=function(t,e,i,n,s,r,o,a,l,h){null==h&&(h=1),this.percentCleaned=0,this.originalFoodLeft=1,this.foodLeft=0,this.percentGrown=0,this.farmStage=Fe.Growing,this.harvestSpritePart=1,this.passiveGrowSpeedBadLight=.006,this.passiveGrowSpeed=.012,this.cleanSpeed=5,this.harvestAmount=.25,this.growSpeed=.85,this.foodPerHarvest=25,this.partOf=e,this.city=n,this.relativePosition=i,this.stage=t,this.foodPerHarvest=o,this.growSpeed*=a,this.passiveGrowSpeed*=a,this.passiveGrowSpeedBadLight*=a,this.cleanSpeed=l,this.harvestSpritePart=h,this.textures=H.getTexturesByWidth(s,r),this.growthSprite=new PIXI.Sprite,t.addChild(this.growthSprite),this.positionSprites(),this.updateTexture()};(V["buildings.FarmGrowArea"]=Ae).__name__="buildings.FarmGrowArea",Ae.prototype={destroy:function(){this.stage.removeChild(this.growthSprite)},update:function(t){var e,i,n;this.farmStage==Fe.Growing&&(e=this.city.simulation.time.timeSinceStart/60%24,((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)?(this.percentGrown+=t*this.passiveGrowSpeed,100<=this.percentGrown&&(this.farmStage=Fe.Harvesting,this.foodLeft=this.foodPerHarvest+this.city.simulation.bonuses.extraFoodFromFarms+this.partOf.getEffectsOfAdjecentBuildings("increaseCropNumber"),this.originalFoodLeft=this.foodLeft),this.updateTexture()):(e=this.city.simulation.time.timeSinceStart/60%24,((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.percentGrown+=t*this.passiveGrowSpeedBadLight,100<=this.percentGrown&&(this.farmStage=Fe.Harvesting,this.foodLeft=this.foodPerHarvest+this.city.simulation.bonuses.extraFoodFromFarms+this.partOf.getEffectsOfAdjecentBuildings("increaseCropNumber"),this.originalFoodLeft=this.foodLeft),this.updateTexture())))},doCitizenWork:function(t){var e=this,i=(this.farmStage==Fe.Harvesting?15:30)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,n=(this.farmStage==Fe.Harvesting?30:60)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,s=!1;null==s&&(s=!1),t.moveAndWait(bo.getInt(this.relativePosition.x,this.relativePosition.x+(0|this.growthSprite.texture.width)-2+1),bo.getInt(i,n),function(){e.onCitizenWork(t)},s,!1)},doCitizenWorkNoMove:function(t){var e=this,i=this.farmStage==Fe.Harvesting?15:30,n=this.farmStage==Fe.Harvesting?30:60,s=t,r=io.pool,r=0<r[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2);r[0]=8,r[1]=bo.getInt(i,n),s.setPath(r,0,2,!0),t.pathEndFunction=function(){e.onCitizenWork(t)},t.pathOnlyRelatedTo=t.inPermanent},onCitizenWork:function(t){switch(this.farmStage._hx_index){case 0:this.percentGrown+=this.growSpeed,100<=this.percentGrown&&(this.farmStage=Fe.Harvesting,this.foodLeft=this.foodPerHarvest+this.city.simulation.bonuses.extraFoodFromFarms+this.partOf.getEffectsOfAdjecentBuildings("increaseCropNumber"),this.originalFoodLeft=this.foodLeft),this.updateTexture();break;case 1:var e=this.harvestAmount*this.city.simulation.boostManager.currentGlobalBoostAmount;this.foodLeft-=e;var i=this.city.materials;i.set_food(i.food+e),this.city.simulation.stats.materialProduction[0][0]+=e,this.foodLeft<=0&&(this.cleanSpeed<=0?(this.farmStage=Fe.Growing,this.percentGrown=0):(this.percentCleaned=0,this.farmStage=Fe.Cleaning)),this.updateTexture();break;case 2:this.percentCleaned+=this.cleanSpeed,100<=this.percentCleaned&&(this.farmStage=Fe.Growing,this.percentGrown=0),this.updateTexture()}},setTexture:function(t,e){this.textures=H.getTexturesByWidth(t,e)},updateTexture:function(){switch(this.farmStage._hx_index){case 0:i=this.textures[Math.floor(this.percentGrown/100*(this.textures.length-1-this.harvestSpritePart))];break;case 1:var t=this.textures.length-1-Math.ceil(this.foodLeft/this.originalFoodLeft*.9999*this.harvestSpritePart),e=this.textures.length-2,i=this.textures[t<1?1:e<t?e:t];break;case 2:i=this.textures[this.textures.length-1]}this.growthSprite.texture=i},positionSprites:function(){null!=this.growthSprite&&this.growthSprite.position.set(this.partOf.position.x+this.relativePosition.x,this.partOf.position.y+this.relativePosition.y)},showInfoText:function(i){var n=this;this.city.gui.windowAddInfoText(null,function(){var t,e=i;switch(n.farmStage._hx_index){case 0:t=kn.lo("crops_grow_pct",[Math.floor(n.percentGrown)]);break;case 1:t=kn.lo("food_left_to_harvest",[Math.floor(n.foodLeft)]);break;case 2:t=kn.lo("old_crops_cleaned",[Math.floor(n.percentCleaned)])}return e+t})},save:function(t,e){null==e&&(e=!0),e&&t.addString(Ae.saveDefinition);e=this.farmStage;t.addString(x[e.__enum__].__constructs__[e._hx_index]);e=this.percentGrown;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.foodLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.originalFoodLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.percentCleaned;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"farmStage")&&(this.farmStage=t.h.farmStage),Object.prototype.hasOwnProperty.call(t.h,"percentGrown")&&(this.percentGrown=t.h.percentGrown),Object.prototype.hasOwnProperty.call(t.h,"foodLeft")&&(this.foodLeft=t.h.foodLeft),Object.prototype.hasOwnProperty.call(t.h,"originalFoodLeft")&&(this.originalFoodLeft=t.h.originalFoodLeft),Object.prototype.hasOwnProperty.call(t.h,"percentCleaned")&&(this.percentCleaned=t.h.percentCleaned)},__class__:Ae};var We=function(t,e,i,n,s,r,o,a){this.totalMaterialsProduced=0,this.materialPhase=0,this.stageProgress=0,this.resourceSprite=null,this.resourceSprite=new PIXI.Sprite,Yt.call(this,t,e,i,n,s,r,o,a),this.buildingMode=X.createInstance(this.get_possibleBuildingModes()[bo.getInt(3)],[e,n.cityMidStage,i,this]),this.currentMaterialTextures=this.get_materialTextures(),this.resourceSprite.position.set(r.x+3,r.y+3),i.addChild(this.resourceSprite)};(V["buildings.FarmHouse"]=We).__name__="buildings.FarmHouse",We.__super__=Yt,We.prototype=e(Yt.prototype,{get_originalMaterials:function(){switch(this.materialType){case 0:return 20;case 1:return 25;case 2:default:return 10}},get_materialTextures:function(){var t;switch(this.materialType){case 0:t="spr_communityhouse_rock";break;case 1:t="spr_communityhouse_tree";break;case 2:t="spr_communityhouse_crop";break;default:t=""}return H.getTexturesByWidth(t,5)},get_possibleUpgrades:function(){return[yt]},get_possibleBuildingModes:function(){return[rt,ot,at]},destroy:function(){Yt.prototype.destroy.call(this),this.resourceSprite.destroy()},postLoad:function(){this.resourceSprite.alpha=1,this.setResourceSpriteTexture()},positionSprites:function(){Yt.prototype.positionSprites.call(this),null!=this.resourceSprite&&this.resourceSprite.position.set(this.position.x+3,this.position.y+3)},update:function(t){if(0==this.materialPhase)switch(this.materialType){case 0:this.stageProgress+=.05*t,1<=this.stageProgress&&(this.materialPhase=1,this.stageProgress=this.get_originalMaterials(),this.resourceSprite.alpha=1),this.setResourceSpriteTexture();break;case 1:var e=this.city.simulation.time.timeSinceStart/60%24;((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)&&(this.stageProgress+=18e-5*t,1<=this.stageProgress&&(this.materialPhase=1,this.stageProgress=this.get_originalMaterials()),this.setResourceSpriteTexture());break;case 2:var i,n,e=this.city.simulation.time.timeSinceStart/60%24;((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)&&(this.stageProgress+=8e-5*t,1<=this.stageProgress&&(this.materialPhase=1,this.stageProgress=this.get_originalMaterials()),this.setResourceSpriteTexture())}},walkAround:function(t,e){var i,n,s=this;e<180?5<t.relativeY?t.changeFloor():(i=2==this.materialPhase?20:50,n=2==this.materialPhase?30:80,null==(e=!0)&&(e=!1),t.moveAndWait(bo.getInt(3,7),bo.getInt(i,n),function(){switch(s.materialType){case 0:1==s.materialPhase&&(t=.1*s.city.simulation.boostManager.currentGlobalBoostAmount,s.stageProgress-=t,s.city.materials.stone+=t,s.city.simulation.stats.materialProduction[2][0]+=t,s.totalMaterialsProduced+=t,s.stageProgress<=0&&(s.stageProgress=0,s.materialPhase=0));break;case 1:0==s.materialPhase?(s.stageProgress+=.005,1<=s.stageProgress&&(s.stageProgress=s.get_originalMaterials(),s.materialPhase+=1)):(t=.2*s.city.simulation.boostManager.currentGlobalBoostAmount,s.stageProgress-=t,s.city.materials.wood+=t,s.city.simulation.stats.materialProduction[1][0]+=t,s.totalMaterialsProduced+=t,s.stageProgress<=0&&(s.stageProgress=0,s.materialPhase=0));break;case 2:var t,e;1==s.materialPhase?(t=.25*s.city.simulation.boostManager.currentGlobalBoostAmount,s.stageProgress-=t,(e=s.city.materials).set_food(e.food+t),s.city.simulation.stats.materialProduction[0][0]+=t,s.totalMaterialsProduced+=t,s.stageProgress<=0&&(s.stageProgress=0,s.materialPhase=2)):0==s.materialPhase?(s.stageProgress+=.01,1<=s.stageProgress&&(s.stageProgress=s.get_originalMaterials(),s.materialPhase+=1)):2==s.materialPhase&&(s.stageProgress+=.1,1<=s.stageProgress&&(s.stageProgress=0,s.materialPhase=0))}s.setResourceSpriteTexture()},e,!1)):11<t.relativeX&&1==bo.getInt(3)?t.changeFloorAndWaitRandom(60,90):t.moveAndWait(bo.getInt(12,16),bo.getInt(60,90),null,!1,!1)},setMaterialType:function(t){this.materialType=t,this.currentMaterialTextures=this.get_materialTextures(),We.treeGrowTextures=H.getTexturesByWidth("spr_communityhouse_tree_grow",5),2==this.materialType?this.adjecentBuildingEffects.push({name:"farm",intensity:1}):(t=tt.find(this.adjecentBuildingEffects,function(t){return"farm"==t.name}),Y.remove(this.adjecentBuildingEffects,t)),this.resourceSprite.alpha=1,this.setResourceSpriteTexture()},resetProgress:function(){this.materialPhase=0,this.stageProgress=0},setResourceSpriteTexture:function(){var t,e;0!=this.materialType&&1!=this.materialType||1!=this.materialPhase?0==this.materialType?(this.resourceSprite.texture=this.currentMaterialTextures[0],this.resourceSprite.alpha=this.stageProgress):2==this.materialType&&0==this.materialPhase?this.resourceSprite.texture=this.currentMaterialTextures[this.stageProgress*(this.currentMaterialTextures.length-2)|0]:1==this.materialType&&0==this.materialPhase?this.resourceSprite.texture=We.treeGrowTextures[this.stageProgress*We.treeGrowTextures.length|0]:2==this.materialType&&(1==this.materialPhase?this.resourceSprite.texture=this.currentMaterialTextures[this.currentMaterialTextures.length-2]:2==this.materialPhase&&(this.resourceSprite.texture=this.currentMaterialTextures[this.currentMaterialTextures.length-1])):(t=this.currentMaterialTextures,e=1-this.stageProgress/this.get_originalMaterials(),this.resourceSprite.texture=t[Math.ceil(e*(this.currentMaterialTextures.length-1))])},addWindowInfoLines:function(){var t=this;Yt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("resources_produced",[0|t.totalMaterialsProduced])})},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(We.saveDefinition);e=this.stageProgress;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.materialPhase;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.totalMaterialsProduced;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){Yt.prototype.load.call(this,t),t.version<23||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"stageProgress")&&(this.stageProgress=t.h.stageProgress),Object.prototype.hasOwnProperty.call(t.h,"materialPhase")&&(this.materialPhase=t.h.materialPhase),Object.prototype.hasOwnProperty.call(t.h,"totalMaterialsProduced")&&(this.totalMaterialsProduced=t.h.totalMaterialsProduced),this.postLoad())},__class__:We});var Fe=x["buildings.FarmStage"]={__ename__:"buildings.FarmStage",__constructs__:["Growing","Harvesting","Cleaning"],Growing:{_hx_index:0,__enum__:"buildings.FarmStage",toString:i},Harvesting:{_hx_index:1,__enum__:"buildings.FarmStage",toString:i},Cleaning:{_hx_index:2,__enum__:"buildings.FarmStage",toString:i}},Oe=function(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.doorX=14,this.festivalCoolDown=0};function De(t,e,i,n,s,r,o,a){this.timesUsedTo=0,this.timesUsed=0,this.mirrored=!1,this.teleportX=15,this.topFlower=null,Yt.call(this,t,e,i,n,s,r,o,a),this.doorX=14,this.yearsToLiveLongerPerYearIfLivingHere=.05,this.updateTopFlower()}function Re(t,e,i,n,s,r,o,a){this.totalKnowledgeGenerated=0,Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=14,this.endTime=23,this.workTimePreferenceMod=.5,this.isEntertainment=!0}(V["buildings.FestivalHQ"]=Oe).__name__="buildings.FestivalHQ",Oe.__super__=Jt,Oe.prototype=e(Jt.prototype,{work:function(i,t,e){e?i.currentAction=y.Nothing:5<i.relativeY?bo.getFloat(1)<.5?i.changeFloor(function(){var t=i,e=io.pool,e=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);e[0]=8,e[1]=bo.getInt(50,100),t.setPath(e,0,2,!0),i.pathEndFunction=null,i.pathOnlyRelatedTo=i.inPermanent}):i.moveAndWait(bo.fromArray([3,4,5,6,12,13,14,15]),bo.getInt(50,100)):bo.getFloat(1)<.3?i.changeFloor(function(){var t=i,e=io.pool,e=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);e[0]=8,e[1]=bo.getInt(50,100),t.setPath(e,0,2,!0),i.pathEndFunction=null,i.pathOnlyRelatedTo=i.inPermanent}):i.moveAndWait(bo.fromArray([3,8,13,14]),bo.getInt(50,100))},update:function(t){-1<this.festivalCoolDown&&(this.festivalCoolDown-=t*(this.workers.length/this.get_jobs())*this.city.simulation.time.minutesPerTick)},getMusicFestivalMTP:function(){return new M(this.city.simulation.citizens.length,0,3*this.city.simulation.citizens.length)},getHundredFestivalMTP:function(){return new M(0,0,2*this.city.simulation.citizens.length)},addWindowInfoLines:function(){function t(){return!!(s.city.simulation.festivalManager.hasNoPlannedFestival()&&s.festivalCoolDown<0)&&s.city.simulation.festivalManager.festivalCoolDown<0}var s=this;Jt.prototype.addWindowInfoLines.call(this);var r=this.city.gui,o=new ds(r,r.innerWindowStage,r.windowInner);o.fillSecondarySize=!0,o.direction=vs.Vertical,r.windowInner.addChild(o);function a(){o.clear(),o.addChild(new Cs(o,new Cn(0,3))),o.addChild(new Qs(o,r.innerWindowStage,null,function(){var t=s.city.simulation.festivalManager;return t.hasFestival()?kn.lo("current_festival"):null!=t.plannedFestival()?kn.lo("planned_festival"):kn.lo("preparing")},"Arial15")),o.addChild(new Qs(o,r.innerWindowStage,null,function(){var t=s.city.simulation.festivalManager;if(t.hasFestival())return t.currentFestival().getText();if(null!=t.plannedFestival())return t.plannedFestival().getText();if(0==s.workers.length)return kn.lo("assign_workers_to_prepare");t="";return s.workers.length<s.get_jobs()&&(t=" "+kn.lo("assign_more_to_speed_up")),Dn.firstToUpper(u.getBasicTimeString(Math.max(s.festivalCoolDown,s.city.simulation.festivalManager.festivalCoolDown)*(s.get_jobs()/s.workers.length)))+" of preparation left."+t})),r.window.onUpdate=function(){t()&&e()}}var e=function(){o.clear();ir.createHeader(r,kn.lo("organize_a_festival"),o);var t=ir.createActivatableButton(s.city.gui,!1,function(){var t,e=s.getMusicFestivalMTP();s.city.materials.canAfford(e)&&s.city.simulation.festivalManager.hasNoPlannedFestival()&&ia.canDo(s.city,s.city.simulation,s)?(s.city.materials.remove(e),(t=new ia(s.city,s.city.simulation,s.city.simulation.festivalManager,s)).plan(),s.city.simulation.festivalManager.addFestival(t),s.festivalCoolDown+=8783.999999999998,s.city.simulation.festivalManager.festivalCoolDown=s.festivalCoolDown,a()):((t=function(){s.city.gui.showSimpleWindow(kn.lo("cant_organize"),null,!0)})(),s.city.gui.addWindowToStack(t))},kn.lo("music_festival"),kn.lo("music_festival_help"),o),e=s.getMusicFestivalMTP(),i=t.container,t=new ds(r,r.innerWindowStage,i),n=new Rs(s.city,e,"");t.addChild(new us(t,r.innerWindowStage,n,{left:0,right:0,top:0,bottom:ir.hasMultiUpgradeModeOn?0==e.knowledge?0:1:2},fa(n,n.updateCostDisplay))),r.window.onUpdate=function(){var t=s.getMusicFestivalMTP();n.setCost(t)},i.addChild(t),o.addChild(new Cs(o,new Cn(0,3)))};(t()?e:a)()},destroy:function(){Jt.prototype.destroy.call(this);for(var t=0,e=this.city.simulation.festivalManager.festivals;t<e.length;){var i=e[t];++t,this.city.simulation.festivalManager.endFestival(i)}},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Oe.saveDefinition);var i=this.festivalCoolDown;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"festivalCoolDown")&&(this.festivalCoolDown=t.h.festivalCoolDown)},__class__:Oe}),(V["buildings.FlowerPenthouse"]=De).__name__="buildings.FlowerPenthouse",De.__super__=Yt,De.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[]},get_baseAttractiveness:function(){return 100},get_hasPrivateTeleporter:function(){return!0},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},mirror:function(){this.mirrored=!this.mirrored,this.updateTopFlower(),this.teleportX=19-this.teleportX,this.drawer.mirror(),this.mirrored?this.doorX=4:this.doorX=14},updateTopFlower:function(){this.world.permanents[this.worldPosition.x].length==this.worldPosition.y+1||null==this.world.permanents[this.worldPosition.x][this.worldPosition.y+1]?(null==this.topFlower&&(this.topFlower=new PIXI.Sprite(H.getTexture("spr_flower_up")),this.stage.addChild(this.topFlower),this.topFlower.anchor.y=1),this.mirrored?(this.topFlower.position.set(this.position.x+20,this.position.y),this.topFlower.scale.x=-1):(this.topFlower.position.set(this.position.x,this.position.y),this.topFlower.scale.x=1)):null!=this.topFlower&&(this.topFlower.destroy(),this.topFlower=null)},onCityChange:function(){Yt.prototype.onCityChange.call(this),this.updateTopFlower()},destroy:function(){Yt.prototype.destroy.call(this),null!=this.topFlower&&this.topFlower.destroy()},walkAround:function(t,e){var i;this.mirrored?t.relativeY<5?5<=t.relativeX||bo.getFloat()<.5?t.moveAndWait(bo.getInt(3,16),bo.getInt(60,90),null,!1,!1):t.changeFloorAndWait(60):5<=t.relativeX||bo.getFloat()<.8?(i=bo.getFloat())<.5?t.moveAndWait(bo.getInt(15,18),bo.getInt(40,60),null,!1,!1):i<.8?t.moveAndWait(bo.getInt(10,12),bo.getInt(60,90),null,!1,!1):t.moveAndWait(bo.getInt(3,5),bo.getInt(60,90),null,!1,!1):t.changeFloorAndWait(60):t.relativeY<5?t.relativeX<14||bo.getFloat()<.5?t.moveAndWait(bo.getInt(3,16),bo.getInt(60,90),null,!1,!1):t.changeFloorAndWait(60):t.relativeX<14||bo.getFloat()<.8?(i=bo.getFloat())<.5?t.moveAndWait(bo.getInt(1,4),bo.getInt(40,60),null,!1,!1):i<.8?t.moveAndWait(bo.getInt(7,9),bo.getInt(60,90),null,!1,!1):t.moveAndWait(bo.getInt(14,16),bo.getInt(60,90),null,!1,!1):t.changeFloorAndWait(60)},addWindowInfoLines:function(){var t=this;Yt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("teleported_from",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("teleported_to",[t.timesUsedTo])})},createWindowAddBottomButtons:function(){dr.create(this.city.gui,fa(this,this.mirror),this.city.gui.windowInner,function(){return kn.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),Ai.createUpkeepInfo(this.city,this.city.gui),Yt.prototype.createWindowAddBottomButtons.call(this)},createTeleportParticle:function(t){null==t&&(t="unused"),this.city.particles.addParticle(H.getTexturesByWidth(this.mirrored?"spr_smallteleporter_ray_penthouse_mirror":"spr_smallteleporter_ray_penthouse",3),new Cn(this.position.x+(this.mirrored?3:14),this.position.y+12))},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(De.saveDefinition);e=this.mirrored;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.timesUsed;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.timesUsedTo;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){Yt.prototype.load.call(this,t),t.version<26||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"mirrored")&&(this.mirrored=t.h.mirrored),Object.prototype.hasOwnProperty.call(t.h,"timesUsed")&&(this.timesUsed=t.h.timesUsed),Object.prototype.hasOwnProperty.call(t.h,"timesUsedTo")&&(this.timesUsedTo=t.h.timesUsedTo),this.postLoad())},__class__:De}),(V["buildings.FossilMuseum"]=Re).__name__="buildings.FossilMuseum",Re.__interfaces__=[Kt],Re.__super__=Jt,Re.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){if(1<=this.workers.length&&vn.any(this.workers,function(t){return t.currentAction==y.Work})){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<23?e<=t&&t<23:e<=t||t<23}return!1},get_entertainmentType:function(){return 5},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},positionSprites:function(){Jt.prototype.positionSprites.call(this)},beEntertained:function(r,t){function e(){var t,e,i,n,s;r.relativeY<5?bo.getFloat()<1?(null==(t=!0)&&(t=!1),e=bo.getInt(12,16),t?(i=r,(s=0<(n=io.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,s[1]=50,s[2]=4,s[3]=e,i.setPath(s,0,4,!0)):(i=r,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=e,i.setPath(s,0,2,!0))):(null==(t=!0)&&(t=!1),t?(i=r,(s=0<(n=io.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,s[1]=50,s[2]=4,s[3]=6,i.setPath(s,0,4,!0)):(i=r,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=6,i.setPath(s,0,2,!0))):(null==(t=!0)&&(t=!1),e=bo.getInt(4,15),t?(i=r,(s=0<(n=io.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=12,s[1]=50,s[2]=4,s[3]=e,i.setPath(s,0,4,!0)):(i=r,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=e,i.setPath(s,0,2,!0))),r.pathEndFunction=null,r.pathOnlyRelatedTo=r.inPermanent}var i,n;1==bo.getInt(2)?r.changeFloor(e):(i=r,(n=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,n[1]=bo.getInt(120,180),i.setPath(n,0,2,!0),r.pathEndFunction=e,r.pathOnlyRelatedTo=r.inPermanent),r.hasBuildingInited||(r.educationLevel=Math.max(Math.min(r.educationLevel+.035,1.61),r.educationLevel),r.hasBuildingInited=!0)},work:function(t,e,i){if(i)t.currentAction=y.Nothing;else switch(this.workers.indexOf(t)){case 0:var n,s=t.pathWalkSpeed*e;I.shouldUpdateDraw=!0,Math.abs(6-t.relativeX)<s?t.relativeX=6:(n=6-t.relativeX,t.relativeX+=(0<n?1:n<0?-1:0)*s);s=.001*this.city.simulation.bonuses.fossilsCollected*e*this.city.simulation.happiness.actionSpeedModifier*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount*this.workers.length;this.city.materials.knowledge+=s,this.city.simulation.stats.materialProduction[9][0]+=s,this.totalKnowledgeGenerated+=s;break;case 1:t.moveAndWait(bo.getInt(12,16),bo.getInt(120,180),null,!1,!1);break;case 2:t.relativeY<5?t.changeFloor():t.moveAndWait(bo.getInt(4,16),bo.getInt(120,180),null,!1,!1)}},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Re.saveDefinition);var i=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated)},__class__:Re});var Ue=function(){};function Le(t,e,i,n,s,r,o,a){this.interior=0,this.mirrored=!1,Yt.call(this,t,e,i,n,s,r,o,a),this.isMedical=!0,this.interiorSprites=H.getTexturesByWidth("spr_futuristichome_interiors",20),this.interior=bo.getInt(this.interiorSprites.length)}function Ee(t,e,i,n,s,r,o,a){this.usesNoStone=!1,this.materialMade=0,this.totalKnowledgeUsed=0,this.totalStoneUsed=0,this.materialsMadePerStepPerWorker=125e-6,this.efficiency=this.get_normalEfficiencyKnowledge(),ce.call(this,t,e,i,n,s,r,o,a,"spr_graphenefactory_frames","spr_graphenefactory_idle"),this.connectionSprite=null}function He(t,e,i,n,s,r,o,a){this.totalGrapheneProduced=0,this.totalStoneUsed=0,this.totalKnowledgeGenerated=0,Jt.call(this,t,e,i,n,s,r,o,a)}function Ne(t,e,i,n,s,r,o,a){this.timeToCheckBuildings=0,this.currentMission=0,this.manyTeleportAlpha=0,this.eventPhase=0,this.doingEvent=-1,this.lastEventDoneOnDay=0,te.call(this,t,e,i,n,s,r,o,a),this.startTime=14,this.endTime=3,this.workTimePreferenceMod=.3,this.boltSprite=new PIXI.Sprite(H.getTexture("spr_hackers_bolt")),this.boltSprite.position.set(r.x+12,r.y+11),e.addChild(this.boltSprite),0==o.y&&(this.boltSprite.visible=!1)}function Ge(t,e,i,n,s,r,o,a){this.herbSprite=null,this.currentTexture=0,this.herbCapPerWorker=50,this.herbTextures=H.getTexturesByWidth(this.get_myHerbTextures(),20),this.currentTexture=2*bo.getInt(this.herbTextures.length/2|0),Jt.call(this,t,e,i,n,s,r,o,a),this.drawer.changeTextureGroup("spr_restaurant"),this.herbSprite=new PIXI.Sprite(this.herbTextures[this.currentTexture]),this.herbSprite.position.set(r.x,r.y),i.cacheableChildren.push(this.herbSprite),i.isInvalid=!0}(V["buildings.IMedicalBuilding"]=Ue).__name__="buildings.IMedicalBuilding",Ue.__isInterface__=!0,Ue.prototype={__class__:Ue},(V["buildings.FuturisticHome"]=Le).__name__="buildings.FuturisticHome",Le.__interfaces__=[Ue],Le.__super__=Yt,Le.prototype=e(Yt.prototype,{get_medicalQuality:function(){return 100},get_medicalCapacity:function(){return this.residents.length},get_medicalTypeLimit:function(){return 1},get_medicalTypeID:function(){return 0},get_drawerType:function(){return qi},get_customizableDrawer:function(){return this.drawer},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},postCreate:function(){Yt.prototype.postCreate.call(this),this.get_customizableDrawer().setCustomTextures(null,null,this.interiorSprites[this.interior])},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror()},createWindowAddBottomButtons:function(){var e=this;dr.create(this.city.gui,fa(this,this.mirror),this.city.gui.windowInner,function(){return kn.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),ur.create(this.city.gui,function(){return e.interior},function(t){e.interior=t,e.get_customizableDrawer().setCustomTextures(null,null,e.interiorSprites[e.interior])},function(){return e.interiorSprites.length},kn.lo("change_interior")),Yt.prototype.createWindowAddBottomButtons.call(this)},walkAround:function(t,e){t.hasBuildingInited||(t.educationLevel=Math.max(Math.min(t.educationLevel+.005,1.2),t.educationLevel),t.hasBuildingInited=!0)},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(Le.saveDefinition);e=this.mirrored;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.interior;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){Yt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"mirrored")&&(this.mirrored=t.h.mirrored),Object.prototype.hasOwnProperty.call(t.h,"interior")&&(this.interior=t.h.interior),this.postLoad()},__class__:Le}),(V["buildings.GrapheneFactory"]=Ee).__name__="buildings.GrapheneFactory",Ee.__super__=ce,Ee.prototype=e(ce.prototype,{get_normalEfficiencyKnowledge:function(){return 10},get_normalEfficiencyStone:function(){return 1},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[]},get_possibleBuildingModes:function(){return[ct,dt]},get_bonusSpeed:function(){return 0==this.workers.length?1:this.activeWorkersTotalEducation/this.activeWorkers},possiblyBeActive:function(t){if(1<=this.city.materials.knowledge&&(this.usesNoStone||1<=this.city.materials.stone)){var e=t*this.materialsMadePerStepPerWorker*this.activeWorkers*this.city.simulation.happiness.actionSpeedModifier*this.get_bonusSpeed()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.graphene+=e,this.materialMade+=e;t=e*this.efficiency;return this.city.materials.knowledge-=t,this.totalKnowledgeUsed+=t,this.usesNoStone||(e=e,this.city.materials.stone-=e,this.totalStoneUsed+=e),!0}return!1},canShowActiveTextures:function(){return!!(this.usesNoStone||3<=this.city.materials.stone)&&3<=this.city.materials.knowledge},workAnimation:function(t,e){var i=this.workers.indexOf(t);1==i?t.setRelativePos(3,0):0==i?t.setRelativePos(15,0):2==i?t.setRelativePos(11,10):t.setRelativePos(15,10)},onCityChange:function(){null!=this.leftBuilding&&this.leftBuilding.is(Mi)?(null==this.connectionSprite&&(this.connectionSprite=new PIXI.Sprite(H.getTexture("spr_stoneteleporter_graphenefactory_connection")),this.city.justAboveCityStage.addChild(this.connectionSprite)),this.connectionSprite.position.set(this.position.x-3,this.position.y+1),this.usesNoStone=!0):null!=this.connectionSprite&&(this.connectionSprite.destroy(),this.connectionSprite=null,this.usesNoStone=!1)},destroy:function(){null!=this.connectionSprite&&(this.connectionSprite.destroy(),this.connectionSprite=null)},addWindowInfoLines:function(){var t=this;ce.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("graphene_sheets_production",[0|t.totalKnowledgeUsed,0|t.totalStoneUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),ce.prototype.save.call(this,t),e&&t.addString(Ee.saveDefinition);e=this.totalStoneUsed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.totalKnowledgeUsed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.materialMade;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){ce.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalStoneUsed")&&(this.totalStoneUsed=t.h.totalStoneUsed),Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeUsed")&&(this.totalKnowledgeUsed=t.h.totalKnowledgeUsed),Object.prototype.hasOwnProperty.call(t.h,"materialMade")&&(this.materialMade=t.h.materialMade)},__class__:Ee}),(V["buildings.GrapheneLab"]=He).__name__="buildings.GrapheneLab",He.__super__=Jt,He.prototype=e(Jt.prototype,{onBuild:function(){this.city.progress.unlocks.unlockMaterial("graphene")},work:function(t,e,i){var n;i?t.currentAction=y.Nothing:(i=this.city.simulation.happiness.actionSpeedModifier*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount,1<this.city.materials.stone&&(n=.0015*i*2,this.city.materials.stone-=n,this.city.simulation.stats.materialUsed[2][0]+=n,n=.0015*i,this.city.materials.graphene+=n,this.city.simulation.stats.materialProduction[8][0]+=n,this.totalStoneUsed+=.0015*i*2,this.totalGrapheneProduced+=.0015*i),n=.0375*i,this.city.materials.knowledge+=n,this.city.simulation.stats.materialProduction[9][0]+=n,this.totalKnowledgeGenerated+=.0375*i,0==(i=bo.getInt(4))&&50<t.get_stepsInBuilding()?t.changeFloorAndWaitRandom(60,90):1==i?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent))},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("graphene_sheets_made",[0|t.totalStoneUsed,0|t.totalGrapheneProduced])})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(He.saveDefinition);e=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.totalStoneUsed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.totalGrapheneProduced;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated),Object.prototype.hasOwnProperty.call(t.h,"totalStoneUsed")&&(this.totalStoneUsed=t.h.totalStoneUsed),Object.prototype.hasOwnProperty.call(t.h,"totalGrapheneProduced")&&(this.totalGrapheneProduced=t.h.totalGrapheneProduced)},__class__:He}),(V["buildings.HackerHQ"]=Ne).__name__="buildings.HackerHQ",Ne.__super__=te,Ne.prototype=e(te.prototype,{positionSprites:function(){te.prototype.positionSprites.call(this),this.boltSprite.position.set(this.position.x+12,this.position.y+11),0==this.worldPosition.y&&(this.boltSprite.visible=!1)},destroy:function(){this.boltSprite.destroy(),te.prototype.destroy.call(this)},addWindowInfoLines:function(){var t=this;te.prototype.addWindowInfoLines.call(this),this.city.gui.windowInner.addChild(new Cs(this.city.gui.window,new Cn(4,4))),this.city.gui.windowAddInfoText(null,function(){return t.missionGetTitle()},"Arial15"),this.city.gui.windowAddInfoText(null,function(){return t.missionGetText()})},missionGetTitle:function(){return 11==this.currentMission?kn.lo("thank_you"):kn.lo("current_task")},missionGetText:function(){return 11<=this.currentMission?kn.lo("hackers_done"):this.workers.length!=this.get_jobs()?kn.lo("hackers_gather"):kn.lo("hacker_mission_"+this.currentMission)},checkMissionCompletions:function(){for(var t=!1;;){switch(t=!1,this.currentMission){case 3:(t=this.city.progress.unlocks.getUnlockState(At)==mo.Researched)&&this.city.progress.unlocks.unlock(Me);break;case 5:(t=vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("computerChips")],function(t){return 20<=t}))&&this.city.progress.unlocks.unlock(vi);break;case 8:(t=this.city.progress.unlocks.getUnlockState(Z)==mo.Researched)&&this.city.progress.unlocks.unlock(je)}if(this.timeToCheckBuildings<=0&&3!=this.currentMission&&5!=this.currentMission&&8!=this.currentMission&&11!=this.currentMission){var e=this.city.getAmountOfPermanentsPerType();switch(this.currentMission){case 0:null==e.h["buildings.ExperimentationLab"]&&(e.h["buildings.ExperimentationLab"]=0),(t=20<=e.h["buildings.Laboratory"]+e.h["buildings.ExperimentationLab"])&&this.city.progress.unlocks.unlock(Je);break;case 1:(t=3<=e.h["buildings.Library"])&&this.city.progress.unlocks.unlock(Fi);break;case 2:(t=5<=e.h["buildings.TinkerersHome"])&&this.city.progress.unlocks.unlock(At);break;case 4:t=1<=e.h["buildings.FactoryPub"];break;case 6:(t=7<=e.h["buildings.ScrapyardNightClub"])&&this.city.progress.unlocks.unlock(xe);break;case 7:(t=1<=e.h["buildings.EscapeRoom"])&&this.city.progress.unlocks.unlock(Z);break;case 9:(t=2<=e.h["buildings.HoloGameHall"])&&this.city.progress.unlocks.unlock(ri);break;case 10:t=1<=e.h["buildings.Misdirector"]}this.timeToCheckBuildings=30}if(t&&(this.currentMission+=1,this.timeToCheckBuildings=0,this.city.progress.goalHelp.updateHasBuildingGoal()),!t)break}},update:function(t){te.prototype.update.call(this,t),this.checkMissionCompletions(),this.timeToCheckBuildings-=t,0<=((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&((0|this.city.simulation.time.timeSinceStart)/60|0)%24<4?(t=4-4*Math.abs(1-this.city.simulation.time.timeSinceStart/60%24/2),this.boltSprite.alpha=t<0?0:1<t?1:t):this.boltSprite.alpha=0},work:function(t,e,i){i?t.currentAction=y.Nothing:this.doWalkAround(t)},walkAround:function(t,e){this.doWalkAround(t)},doWalkAround:function(t){5<t.relativeY?1==bo.getInt(4)&&5<t.relativeX?t.changeFloor():t.moveAndWait(bo.fromArray(Ne.walkAroundPositions),bo.getInt(60,120)):1==bo.getInt(4)?t.changeFloor():1==bo.getInt(3)?t.moveAndWait(bo.getInt(5,7),bo.getInt(90,150),null,!1,!1):t.moveAndWait(bo.getInt(9,15),bo.getInt(60,150),null,!1,!1)},getGlobalGoal:function(){return 11==this.currentMission?null:{category:kn.lo("hackers_mission"),text:this.missionGetText()}},save:function(t,e){null==e&&(e=!0),te.prototype.save.call(this,t),e&&t.addString(Ne.saveDefinition);e=this.lastEventDoneOnDay;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.doingEvent;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.eventPhase;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.currentMission;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){te.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"lastEventDoneOnDay")&&(this.lastEventDoneOnDay=t.h.lastEventDoneOnDay),Object.prototype.hasOwnProperty.call(t.h,"doingEvent")&&(this.doingEvent=t.h.doingEvent),Object.prototype.hasOwnProperty.call(t.h,"eventPhase")&&(this.eventPhase=t.h.eventPhase),Object.prototype.hasOwnProperty.call(t.h,"currentMission")&&(this.currentMission=t.h.currentMission)},__class__:Ne}),(V["buildings.HerbGarden"]=Ge).__name__="buildings.HerbGarden",Ge.__interfaces__=[Ue],Ge.__super__=Jt,Ge.prototype=e(Jt.prototype,{get_drawerType:function(){return Yi},get_possibleBuildingModes:function(){return[ht,Pt]},get_medicalQuality:function(){return 100},get_medicalCapacity:function(){return this.buildingMode instanceof Pt?100:0},get_medicalTypeLimit:function(){return.2},get_medicalTypeID:function(){return 1},get_myHerbTextures:function(){return"spr_herbgarden_plants"},postLoad:function(){this.herbSprite.texture=this.herbTextures[this.currentTexture],this.bgStage.isInvalid=!0},work:function(t,e,i){var n;i?t.currentAction=y.Nothing:t.relativeY<5&&1==this.workers.indexOf(t)?t.changeFloor():(null==(i=!(n=!1))&&(i=!1),null==n&&(n=!1),t.moveAndWait(bo.getInt(3,16),bo.getInt(30,60),null,n,i))},getHerbCapacity:function(){return this.herbCapPerWorker*this.workers.length},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.herbSprite&&(this.herbSprite.position.set(this.position.x,this.position.y),this.bgStage.isInvalid=!0)},changePlantsTexture:function(t){this.currentTexture=t,null!=this.herbSprite&&(this.herbSprite.texture=this.herbTextures[this.currentTexture],this.bgStage.isInvalid=!0)},destroy:function(){Jt.prototype.destroy.call(this);var t=this.bgStage,e=this.herbSprite;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e)},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("herb_reduction",[Math.round(.2*t.city.simulation.eating.currentFoodSaveByHerbsPct*100),20])+"\n"+kn.lo("herb_medical_happiness",[Math.round(t.city.simulation.happiness.healthCapacityByType[1]/t.city.simulation.citizens.length*100)])})},createWindowAddBottomButtons:function(){var t=this;ur.create(this.city.gui,function(){return t.currentTexture},fa(this,this.changePlantsTexture),function(){return t.herbTextures.length},kn.lo("change_herb_plants"),null,2),Jt.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Ge.saveDefinition);var i=this.currentTexture;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){Jt.prototype.load.call(this,t),t.version<32||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture),this.postLoad())},__class__:Ge});var Xe=function(t,e,i,n,s,r,o,a){this.lowestNightClub=null,Jt.call(this,t,e,i,n,s,r,o,a),this.positionSprites(),this.startTime=20,this.endTime=7.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0,null==Xe.citizenClothesTexture&&(Xe.citizenClothesTexture=H.getTexture("spr_tech_nightclub_hoverer")),this.lowestNightClub=this};(V["buildings.HighTechNightClub"]=Xe).__name__="buildings.HighTechNightClub",Xe.__interfaces__=[Kt],Xe.__super__=Jt,Xe.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 100*this.workers.length},get_isOpen:function(){if(null!=this.bottomBuilding&&this.bottomBuilding.is(Xe)||1!=this.workers.length||this.workers[0].currentAction!=y.Work)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_entertainmentType:function(){return 0},get_minimumNormalTimeToSpend:function(){return 5},get_maximumNormalTimeToSpend:function(){return 7},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_drawerType:function(){return ji},get_mergingDrawer:function(){return this.drawer},get_walkThroughCanViewSelfInThisBuilding:function(){return null==this.bottomBuilding||!this.bottomBuilding.is(Xe)},get_hasLeftNightClub:function(){return null!=this.leftBuilding&&this.leftBuilding.is(Xe)},get_hasRightNightClub:function(){return null!=this.rightBuilding&&this.rightBuilding.is(Xe)},get_hasTopNightClub:function(){return null!=this.topBuilding&&this.topBuilding.is(Xe)},get_hasBottomNightClub:function(){return null!=this.bottomBuilding&&this.bottomBuilding.is(Xe)},get_firstBuildingToGoTo:function(){return this.lowestNightClub},postCreate:function(){Jt.prototype.postCreate.call(this),this.updateLowestNightClub()},onCityChange:function(){this.updateLowestNightClub()},updateLowestNightClub:function(){for(this.lowestNightClub=this;this.lowestNightClub.get_hasBottomNightClub();)this.lowestNightClub=this.lowestNightClub.bottomBuilding},onCitizenLeave:function(t,e){null==e||e.is(Xe)||null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null)},beEntertained:function(t,e){if(null==t.accessorySprite){var i=t.pathWalkSpeed*e;return I.shouldUpdateDraw=!0,(Math.abs(9-t.relativeX)<i?(t.relativeX=9,!0):(s=9-t.relativeX,t.relativeX+=(0<s?1:s<0?-1:0)*i,!1))?(t.setRelativeY(t.relativeY+e/2),4<=t.relativeY&&(t.accessorySprite=new PIXI.Sprite(Xe.citizenClothesTexture),t.accessorySprite.anchor.set(0,0),t.accessorySprite.position.set(-1,-1),t.sprite.addChild(t.accessorySprite),t.setRelativeY(4),t.addToWithAccessoryStage())):t.setRelativeY(0),t.dynamicUnsavedVars.xMoveLeft=0,t.dynamicUnsavedVars.yMoveLeft=0,void(t.dynamicUnsavedVars.waitTime=0)}var n,s,r,o=this.get_hasLeftNightClub(),a=this.leftBuilding,l=this.get_hasRightNightClub(),h=this.rightBuilding,u=this.get_hasTopNightClub(),d=this.topBuilding,c=this.get_hasBottomNightClub(),p=this.bottomBuilding;0<Math.abs(t.dynamicUnsavedVars.xMoveLeft)&&((n=0<(s=t.dynamicUnsavedVars.xMoveLeft)?1:s<0?-1:0)*(i=e*n)>n*t.dynamicUnsavedVars.xMoveLeft?(t.setRelativeX(t.relativeX+t.dynamicUnsavedVars.xMoveLeft),t.dynamicUnsavedVars.xMoveLeft=0):(t.setRelativeX(t.relativeX+i),t.dynamicUnsavedVars.xMoveLeft-=i),0<n&&20<t.relativeX&&(l?(t.inPermanent=h,t.setRelativeX(t.relativeX-20)):t.dynamicUnsavedVars.xMoveLeft=0),n<0&&t.relativeX<0&&(o?(t.setRelativeX(t.relativeX+20),t.inPermanent=a):t.dynamicUnsavedVars.xMoveLeft=0)),0<Math.abs(t.dynamicUnsavedVars.yMoveLeft)&&((a=0<(s=t.dynamicUnsavedVars.yMoveLeft)?1:s<0?-1:0)*(s=e*a)>a*t.dynamicUnsavedVars.yMoveLeft?(t.setRelativeY(t.relativeY+t.dynamicUnsavedVars.yMoveLeft),t.dynamicUnsavedVars.yMoveLeft=0):(t.setRelativeY(t.relativeY+s),t.dynamicUnsavedVars.yMoveLeft-=s),0<a&&20<t.relativeY&&(u?(t.inPermanent=d,t.setRelativeY(t.relativeY-20)):t.dynamicUnsavedVars.yMoveLeft=0),a<0&&t.relativeY<0&&(c?(t.setRelativeY(t.relativeY+20),t.inPermanent=p):t.dynamicUnsavedVars.yMoveLeft=0)),0==t.dynamicUnsavedVars.yMoveLeft&&0==t.dynamicUnsavedVars.xMoveLeft&&(t.dynamicUnsavedVars.waitTime<1?t.dynamicUnsavedVars.waitTime+=e:(t.dynamicUnsavedVars.waitTime=0)==(p=bo.getInt(2))?(r=20-t.relativeY-t.actualSpriteHeight-4,this.get_hasTopNightClub()&&(this.topBuilding.get_hasLeftNightClub()||4<=t.relativeX)&&(this.topBuilding.get_hasRightNightClub()||t.relativeX<=14)&&(r+=20),e=0,(r<10||0==bo.getInt(2))&&(e=t.relativeY-4,this.get_hasBottomNightClub()&&(this.bottomBuilding.get_hasLeftNightClub()||4<=t.relativeX)&&(this.bottomBuilding.get_hasRightNightClub()||t.relativeX<=14)&&(e+=20)),t.dynamicUnsavedVars.yMoveLeft=bo.getFloat(-e,r)):1==p&&(r=20-t.relativeX-2-4,this.get_hasRightNightClub()&&(this.rightBuilding.get_hasBottomNightClub()||2<t.relativeY)&&(this.rightBuilding.get_hasTopNightClub()||t.relativeY<20-t.actualSpriteHeight-4)&&(r+=20),p=t.relativeX-4,this.get_hasLeftNightClub()&&(this.leftBuilding.get_hasBottomNightClub()||2<t.relativeY)&&(this.leftBuilding.get_hasTopNightClub()||t.relativeY<20-t.actualSpriteHeight-4)&&(p+=20),t.dynamicUnsavedVars.xMoveLeft=bo.getFloat(-p,r)))},work:function(t,e,i){if(i&&6<this.city.simulation.time.timeSinceStart/60%24)return t.inPermanent.is(Xe)?void(t.inPermanent.exitBuilding(t,e)&&(t.currentAction=y.Nothing)):(t.setRelativeY(0),null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null),void(t.currentAction=y.Nothing));t.inPermanent!=this&&t.inPermanent.is(Xe)&&t.inPermanent.get_hasTopNightClub()},createWindowAddBottomButtons:function(){Jt.prototype.createWindowAddBottomButtons.call(this)},exitBuilding:function(t,e){if(null==t.accessorySprite&&t.relativeY<=0)return!0;if(t.relativeX<3&&(p=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,!(Math.abs(3-t.relativeX)<p?(t.relativeX=3,!0):(c=3-t.relativeX,t.relativeX+=(0<c?1:c<0?-1:0)*p,!1))))return!1;if(16<t.relativeX&&(p=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,!(Math.abs(16-t.relativeX)<p?(t.relativeX=16,!0):(c=16-t.relativeX,t.relativeX+=(0<c?1:c<0?-1:0)*p,!1))))return!1;var i,n,s=this.get_hasLeftNightClub(),r=this.leftBuilding,o=this.get_hasRightNightClub(),a=this.rightBuilding,l=this.get_hasTopNightClub(),h=this.topBuilding,u=this.get_hasBottomNightClub(),d=this.bottomBuilding;if(0<Math.abs(t.dynamicUnsavedVars.xMoveLeft)&&((i=0<(c=t.dynamicUnsavedVars.xMoveLeft)?1:c<0?-1:0)*(n=e*i)>i*t.dynamicUnsavedVars.xMoveLeft?(t.setRelativeX(t.relativeX+t.dynamicUnsavedVars.xMoveLeft),t.dynamicUnsavedVars.xMoveLeft=0):(t.setRelativeX(t.relativeX+n),t.dynamicUnsavedVars.xMoveLeft-=n),0<i&&20<t.relativeX&&(o?(t.inPermanent=a,t.setRelativeX(t.relativeX-20)):t.dynamicUnsavedVars.xMoveLeft=0),i<0&&t.relativeX<0&&(s?(t.setRelativeX(t.relativeX+20),t.inPermanent=r):t.dynamicUnsavedVars.xMoveLeft=0)),0<Math.abs(t.dynamicUnsavedVars.yMoveLeft)&&((s=0<(c=t.dynamicUnsavedVars.yMoveLeft)?1:c<0?-1:0)*(r=e*s)>s*t.dynamicUnsavedVars.yMoveLeft?(t.setRelativeY(t.relativeY+t.dynamicUnsavedVars.yMoveLeft),t.dynamicUnsavedVars.yMoveLeft=0):(t.setRelativeY(t.relativeY+r),t.dynamicUnsavedVars.yMoveLeft-=r),0<s&&20<t.relativeY&&(l?(t.inPermanent=h,t.setRelativeY(t.relativeY-20)):t.dynamicUnsavedVars.yMoveLeft=0),s<0&&t.relativeY<0&&(u?(t.setRelativeY(t.relativeY+20),t.inPermanent=d):t.dynamicUnsavedVars.yMoveLeft=0)),this.get_hasBottomNightClub())return t.dynamicUnsavedVars.yMoveLeft=-t.relativeY-15,!1;if(4<t.relativeY)return t.dynamicUnsavedVars.yMoveLeft=4-t.relativeY,!1;t.dynamicUnsavedVars.yMoveLeft=0,t.dynamicUnsavedVars.xMoveLeft=0;var c,p=t.pathWalkSpeed*e;return I.shouldUpdateDraw=!0,(Math.abs(9-t.relativeX)<p?(t.relativeX=9,!0):(c=9-t.relativeX,t.relativeX+=(0<c?1:c<0?-1:0)*p,!1))&&(null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null),!(0<t.relativeY)||(t.setRelativeY(Math.max(t.relativeY-.5*e,0)),!1))},finishEntertainment:function(t,e){return this.exitBuilding(t,e)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Xe.saveDefinition)},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Xe});var je=function(t,e,i,n,s,r,o,a){this.boostTeam2=0,this.boostTeam1=0,this.progressTeam2=0,this.progressTeam1=0,this.hasAtLeastOneVisitor=!1,this.totalWidth=18,this.coordinatorBuilding=null,this.gameInited=!1,this.boosters=[],this.monsterSpriteTeam2=null,this.monsterSpriteTeam1=null,this.currentGameType=null,m.call(this,t,e,i,n,s,r,o,a),this.isEntertainment=!0,this.currentGameType=0,null==je.citizenClothesTexture&&(je.citizenClothesTexture=H.getTexture("spr_hgh_citizenclothes_1"));a=[];a.push([]),a.push([]),a.push([]),a.push([]),a.push([]),this.blocks=a};function Ve(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a)}(V["buildings.HoloGameHall"]=je).__name__="buildings.HoloGameHall",je.__interfaces__=[Kt],je.__super__=m,je.prototype=e(m.prototype,{get_baseEntertainmentCapacity:function(){return 75},get_isOpen:function(){var t=this.city.simulation.time.timeSinceStart/60%24;return 12<=t||t<2},get_entertainmentType:function(){return 4},get_minimumNormalTimeToSpend:function(){return 4},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 5},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Vi},get_hasLeftHoloGameHall:function(){return null!=this.leftBuilding&&this.leftBuilding.is(je)},get_hasRightHoloGameHall:function(){return null!=this.rightBuilding&&this.rightBuilding.is(je)},postCreate:function(){m.prototype.postCreate.call(this),this.positionSprites(),this.calculateCoordinatorBuilding(),this.setGameType()},onCityChange:function(){if(this.calculateCoordinatorBuilding(),!this.get_hasRightHoloGameHall()){for(var t=0,e=this.blocks[4];t<e.length;){var i=e[t];++t,i.sprite.destroy()}this.blocks[4]=[]}},calculateCoordinatorBuilding:function(){var t=this.coordinatorBuilding;for(this.coordinatorBuilding=this;this.coordinatorBuilding.get_hasLeftHoloGameHall();)this.coordinatorBuilding=this.coordinatorBuilding.leftBuilding;if(this.coordinatorBuilding==this){this.totalWidth=18;for(var e=this;e.get_hasRightHoloGameHall();)this.totalWidth+=20,e=e.rightBuilding;t!=this&&this.resetSpaceShipGame()}this.get_hasLeftHoloGameHall()||this.get_hasRightHoloGameHall()||0!=this.currentGameType||(this.currentGameType=1,this.destroyHGHSprites(),this.boosters=[]),this.currentGameType!=this.coordinatorBuilding.currentGameType?(this.destroyHGHSprites(),this.currentGameType=this.coordinatorBuilding.currentGameType):t!=this.coordinatorBuilding&&this.coordinatorBuilding!=this&&0==this.currentGameType&&this.destroyHGHSprites()},destroy:function(){m.prototype.destroy.call(this),this.destroyHGHSprites()},destroyHGHSprites:function(){null!=this.monsterSpriteTeam1&&(this.monsterSpriteTeam1.destroy(),this.monsterSpriteTeam1=null),null!=this.monsterSpriteTeam2&&(this.monsterSpriteTeam2.destroy(),this.monsterSpriteTeam2=null);for(var t=0,e=this.boosters;t<e.length;){var i=e[t];++t,null!=i.sprite&&i.sprite.destroy()}this.boosters=[];for(t=0,e=this.blocks;t<e.length;){var n=e[t];++t;for(var s=0;s<n.length;){var r=n[s];++s,r.sprite.destroy()}}(t=[]).push([]),t.push([]),t.push([]),t.push([]),t.push([]),this.blocks=t},beEntertained:function(t,e){switch(this.coordinatorBuilding.currentGameType){case 0:this.beEntertainedSpaceShipBattle(t,e);break;case 1:this.beEntertainedBlockGame(t,e)}this.currentGameType=this.coordinatorBuilding.currentGameType},beEntertainedBlockGame:function(t,e){var i,n,s,r=this,o=bo.getInt(4+(this.get_hasRightHoloGameHall()?1:0)),a=bo.getInt(6);this.get_hasLeftHoloGameHall()&&0==a?(i=t,(s=0<(n=io.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=2,s[1]=0,s[2]=4,s[3]=19,i.setPathWithEnd(s,0,4,function(){t.hasBuildingInited=!0},!0)):this.get_hasRightHoloGameHall()&&1==a?(i=t,(s=0<(n=io.pool)[4].length?n[4].splice(n[4].length-1,1)[0]:new Int32Array(4))[0]=3,s[1]=0,s[2]=4,s[3]=0,i.setPathWithEnd(s,0,4,function(){t.hasBuildingInited=!0},!0)):t.moveAndWait(3+4*o,bo.getInt(45,90),function(){var t,e,i,n;1!=r.coordinatorBuilding.currentGameType||4==o&&!r.get_hasRightHoloGameHall()||(0==r.blocks[o].length||1<=r.blocks[o][r.blocks[o].length-1].sprite.alpha?r.blocks[o].length<4?(r.gameInited=!0,e=new PIXI.Sprite(H.getTexture("spr_hgh_block")),r.bgStage.addChild(e),t=i=[bo.getFloat(360),1,1],r.blocks[o].push({sprite:e,color:t}),e.alpha=.1,e.tint=Sn.toHexInt(ra.toRgb(t)),e.position.set(r.position.x+2+4*o,r.position.y+20-1-4*r.blocks[o].length)):(i=[((e=bo.fromArray(r.blocks[o])).color[0]+5)%360,1,1],e.color=i,n=ra.toRgb(e.color),e.sprite.tint=Sn.toHexInt(n)):(n=r.blocks[o][r.blocks[o].length-1].sprite).alpha=Math.min(n.alpha+.1,1))})},beEntertainedSpaceShipBattle:function(t,e){var i,n,s,r,o,a,l;t.hasBuildingInited&&null!=t.dynamicUnsavedVars.buildingInited||(t.dynamicUnsavedVars.hghTeam=bo.getInt(2),t.dynamicUnsavedVars.hghStarted=!1,t.hasBuildingInited=!0,t.dynamicUnsavedVars.focussingOnBoosters=bo.fromArray([!1,!1,!0]),t.dynamicUnsavedVars.focussingOnBooster=bo.getInt(2),t.dynamicUnsavedVars.buildingInited=!0),t.dynamicUnsavedVars.hghStarted?(i=this.coordinatorBuilding.totalWidth-2*je.monsterSize,n=this.coordinatorBuilding.boosters,!t.dynamicUnsavedVars.focussingOnBoosters&&0<n.length&&bo.getFloat(90)<e&&(t.dynamicUnsavedVars.focussingOnBoosters=!0,t.dynamicUnsavedVars.focussingOnBooster=bo.getInt(n.length)),t.dynamicUnsavedVars.focussingOnBoosters&&(n.length<=t.dynamicUnsavedVars.focussingOnBooster?t.dynamicUnsavedVars.focussingOnBoosters=!1:(n=n[t.dynamicUnsavedVars.focussingOnBooster],s=this.coordinatorBuilding.position.x+n.xPos,(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX>s&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX<s+je.boosterSpriteSize?(0==t.dynamicUnsavedVars.hghTeam?n.team1Ownership++:n.team2Ownership++,bo.getFloat(40)<e&&(t.dynamicUnsavedVars.focussingOnBoosters=!1)):t.moveTowardsRandomInWorldCoords(s,s+je.boosterSpriteSize-1,function(){t.hasBuildingInited=!0}))),t.dynamicUnsavedVars.focussingOnBoosters||(0==t.dynamicUnsavedVars.hghTeam?(s=this.coordinatorBuilding.position.x+1+Math.floor(this.coordinatorBuilding.progressTeam1*i),(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX>s&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX<s+je.monsterSize-1&&bo.getFloat(30)>e?(this.coordinatorBuilding.progressTeam1=Math.min(this.coordinatorBuilding.progressTeam1+e/(i*(10+(20-this.boostTeam1)*this.coordinatorBuilding.progressTeam1)),1),1<this.coordinatorBuilding.progressTeam1+this.coordinatorBuilding.progressTeam2&&(this.coordinatorBuilding.progressTeam2=1-this.coordinatorBuilding.progressTeam1)):t.moveTowardsRandomInWorldCoords(s,s+je.monsterSize-1,function(){t.hasBuildingInited=!0})):(r=this.coordinatorBuilding.position.x+this.coordinatorBuilding.totalWidth-je.monsterSize+1-Math.floor(this.coordinatorBuilding.progressTeam2*i),(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX>r&&(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).position.x+t.relativeX<r+je.monsterSize-1&&bo.getFloat(30)>e?(this.coordinatorBuilding.progressTeam2=Math.min(this.coordinatorBuilding.progressTeam2+e/(i*(10+(20-this.boostTeam2)*this.coordinatorBuilding.progressTeam2)),1),1<this.coordinatorBuilding.progressTeam1+this.coordinatorBuilding.progressTeam2&&(this.coordinatorBuilding.progressTeam1=1-this.coordinatorBuilding.progressTeam2)):t.moveTowardsRandomInWorldCoords(r,r+je.monsterSize-1,function(){t.hasBuildingInited=!0})))):(r=!1,0==t.dynamicUnsavedVars.hghTeam?this.get_hasLeftHoloGameHall()?(o=t,(l=0<(a=io.pool)[4].length?a[4].splice(a[4].length-1,1)[0]:new Int32Array(4))[0]=2,l[1]=0,l[2]=4,l[3]=bo.getInt(1,19),o.setPathWithEnd(l,0,4,function(){t.hasBuildingInited=!0},!0)):1<t.relativeX?t.setRelativeX(Math.max(1,t.relativeX-e)):(t.setRelativeX(1),r=!0):this.get_hasRightHoloGameHall()?(o=t,(l=0<(a=io.pool)[4].length?a[4].splice(a[4].length-1,1)[0]:new Int32Array(4))[0]=3,l[1]=0,l[2]=4,l[3]=bo.getInt(0,17),o.setPathWithEnd(l,0,4,function(){t.hasBuildingInited=!0},!0)):t.relativeX<17?t.setRelativeX(Math.min(17,t.relativeX+e)):(t.setRelativeX(17),r=!0),r&&(t.dynamicUnsavedVars.hghStarted=!0,this.coordinatorBuilding.hasAtLeastOneVisitor=!0,null==t.accessorySprite&&(t.accessorySprite=new PIXI.Sprite(je.citizenClothesTexture),t.accessorySprite.anchor.set(0,1),t.accessorySprite.alpha=.5,4==t.actualSpriteHeight&&t.accessorySprite.position.set(0,1),t.sprite.addChild(t.accessorySprite),t.addToWithAccessoryStage(),0==t.dynamicUnsavedVars.hghTeam?t.accessorySprite.tint=16711680:t.accessorySprite.tint=255)))},onCitizenLeave:function(t,e){null!=e&&e.is(je)||null!=t.accessorySprite&&(t.accessorySprite.destroy(),t.accessorySprite=null,t.addToCorrectStage())},positionSprites:function(){m.prototype.positionSprites.call(this),this.coordinatorBuilding==this&&this.positionHGHSprites()},createWindowAddBottomButtons:function(){m.prototype.createWindowAddBottomButtons.call(this)},update:function(t){switch(m.prototype.update.call(this,t),this.currentGameType){case 0:this.updateSpaceShipGame(t);break;case 1:this.updateBlockGame(t)}},updateBlockGame:function(t){this.get_isOpen()||this.gameInited&&4<this.city.simulation.time.timeSinceStart/60%24&&(this.destroyHGHSprites(),this.gameInited=!1,this.coordinatorBuilding==this&&this.setGameType())},updateSpaceShipGame:function(t){if(this.coordinatorBuilding==this)if(this.get_isOpen()){if(this.hasAtLeastOneVisitor){this.gameInited=!0,this.boostTeam1=0,this.boostTeam2=0,null==this.monsterSpriteTeam1&&(this.monsterSpriteTeam1=new PIXI.Sprite(H.getTexture("spr_hgh_monster_1")),this.monsterSpriteTeam1.tint=16711680,this.bgStage.addChild(this.monsterSpriteTeam1)),null==this.monsterSpriteTeam2&&(this.monsterSpriteTeam2=new PIXI.Sprite(H.getTexture("spr_hgh_monster_1")),this.monsterSpriteTeam2.scale.set(-1,1),this.monsterSpriteTeam2.tint=255,this.bgStage.addChild(this.monsterSpriteTeam2));for(var e=this.boosters.length;0<=--e;)(l=this.boosters[e]).xPos>this.totalWidth-je.boosterSpriteSize?(l.sprite.destroy(),this.boosters.splice(e,1)):(l.age+=t,l.team1Ownership>l.team2Ownership?(l.sprite.tint=16711680,this.boostTeam1+=11):l.team2Ownership>l.team1Ownership&&(l.sprite.tint=255,this.boostTeam2+=11),l.team1Ownership=0,l.team2Ownership=0,l.isFadingOut?(l.sprite.alpha-=.1*t,l.sprite.alpha<0&&(l.sprite.destroy(),this.boosters.splice(e,1))):200<=l.age&&bo.getFloat(50)<t&&e==this.boosters.length-1?l.isFadingOut=!0:l.sprite.alpha<1&&(l.sprite.alpha=Math.min(1,l.sprite.alpha+.1*t)));if(this.boosters.length<2&&bo.getFloat(100)<t){for(var i,n=-1,s=0;s<10;){n=bo.getInt(this.totalWidth-je.boosterSpriteSize);for(var r=!1,o=0,a=this.boosters;o<a.length;){var l=a[o];++o,n>l.xPos-je.boosterSpriteSize&&n<l.xPos+je.boosterSpriteSize&&(r=!0)}if(!r)break;++s}s<10&&((i=new PIXI.Sprite(H.getTexture("spr_hgh_booster"))).alpha=0,this.bgStage.addChild(i),this.boosters.push({xPos:n,team2Ownership:0,team1Ownership:0,sprite:i,isFadingOut:!1,age:0}))}this.positionHGHSprites()}}else this.gameInited&&this.stopSpaceShipGame()},resetSpaceShipGame:function(){this.progressTeam1=0,this.progressTeam2=0,this.gameInited=!1,this.destroyHGHSprites(),this.hasAtLeastOneVisitor=!1,this.boosters=[]},stopSpaceShipGame:function(){this.resetSpaceShipGame(),this.setGameType()},setGameType:function(){var t;switch(bo.getInt(1+(this.get_hasRightHoloGameHall()||this.get_hasLeftHoloGameHall()?1:0))){case 0:t=1;break;case 1:t=0;break;default:t=1}this.currentGameType=t},positionHGHSprites:function(){var t=this.totalWidth-2*je.monsterSize;null!=this.monsterSpriteTeam1&&this.monsterSpriteTeam1.position.set(this.position.x+1+Math.floor(this.progressTeam1*t),this.position.y+2),null!=this.monsterSpriteTeam2&&this.monsterSpriteTeam2.position.set(this.position.x+this.totalWidth+1-Math.ceil(this.progressTeam2*t),this.position.y+2);for(var e=0,i=this.boosters;e<i.length;){var n=i[e];++e,n.sprite.position.set(this.position.x+n.xPos,this.position.y+20-9)}for(e=0,i=this.blocks.length;e<i;)for(var s=e++,r=this.blocks[s],o=0,a=r.length;o<a;){var l=o++;r[l].sprite.position.set(this.position.x+2+4*s,this.position.y+20-5-4*l)}},__class__:je}),(V["buildings.HouseOfTheKeyFriends"]=Ve).__name__="buildings.HouseOfTheKeyFriends",Ve.__super__=Yt,Ve.prototype=e(Yt.prototype,{walkAround:function(t,e){var i=bo.getInt(5);0==i&&120<e?t.changeFloorAndWaitRandom(30,60):1==i||2==i&&t.relativeY<5?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},__class__:Ve});var Ye=function(t,e,i,n,s,r,o,a){this.timesUsedTo=0,this.timesUsed=0,m.call(this,t,e,i,n,s,r,o,a),this.doorX=8,this.doorTextures=H.getTexturesByWidth("spr_hyperelevator_door",10),this.doorSprite=new PIXI.Sprite(this.doorTextures[0]),i.addChild(this.doorSprite),this.doorSprite.position.set(r.x+5,r.y+10),this.doorFullyOpenFor=0,this.currentDoorTexture=0,this.relocateSprite()};(V["buildings.HyperElevator"]=Ye).__name__="buildings.HyperElevator",Ye.__super__=m,Ye.prototype=e(m.prototype,{get_typeID:function(){return 4},positionSprites:function(){m.prototype.positionSprites.call(this),this.relocateSprite()},relocateSprite:function(){this.doorSprite.parent.removeChild(this.doorSprite),(0==this.worldPosition.y?this.stage:this.bgStage).addChild(this.doorSprite),this.doorSprite.position.set(this.position.x+5,this.position.y+10)},update:function(t){var e;m.prototype.update.call(this,t),t=(e=0<this.doorFullyOpenFor?(this.doorFullyOpenFor-=t,this.currentDoorTexture+.5*t):this.currentDoorTexture-.5*t,this.doorTextures.length-1),this.currentDoorTexture=e<0?0:t<e?t:e,this.updateCurrentDoorTexture()},openDoor:function(){return this.doorFullyOpenFor=45,this.currentDoorTexture>=this.doorTextures.length-1.01},updateCurrentDoorTexture:function(){this.doorSprite.texture=this.doorTextures[Math.floor(this.currentDoorTexture)]},destroy:function(){m.prototype.destroy.call(this),this.doorSprite.destroy()},addWindowInfoLines:function(){var t=this;m.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("elevator_entered",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("elevator_left",[t.timesUsedTo])})},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(Ye.saveDefinition);e=this.timesUsed;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.timesUsedTo;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"timesUsed")&&(this.timesUsed=t.h.timesUsed),Object.prototype.hasOwnProperty.call(t.h,"timesUsedTo")&&(this.timesUsedTo=t.h.timesUsedTo)},__class__:Ye});var $e=function(t,e,i,n,s,r,o,a){this.percentCleaned=0,this.foodLeft=0,this.percentGrown=0,this.farmStage=Fe.Growing,Jt.call(this,t,e,i,n,s,r,o,a),this.textures=H.getTexturesByWidth("spr_indoorfarm_crops",20),this.growthSprite=new PIXI.Sprite,i.addChild(this.growthSprite),this.updateTexture(),this.positionSprites(),this.doorX=12,this.adjecentBuildingEffects.push({name:"farm",intensity:1})};function qe(t,e,i,n,s,r,o,a){this.anyoneHasWorkedHere=!1,this.totalKnowledgeGenerated=0,Jt.call(this,t,e,i,n,s,r,o,a),this.normalDrawer=this.drawer,this.originalBackTexture=H.getTexturesByWidth("spr_laboratory",20)[2],this.noLightBackTexture=H.getTexture("spr_laboratory_lightsoff"),this.backSprite=new PIXI.Sprite(this.originalBackTexture),this.backSprite.position.set(r.x,r.y),i.addChild(this.backSprite)}function Ke(t,e,i,n,s,r,o,a){this.mirrored=!1,Yt.call(this,t,e,i,n,s,r,o,a),this.doorX=4}(V["buildings.IndoorFarm"]=$e).__name__="buildings.IndoorFarm",$e.__super__=Jt,$e.prototype=e(Jt.prototype,{postLoad:function(){this.updateTexture()},work:function(t,e,i){var n,s,r=this;i?t.currentAction=y.Nothing:(n=(this.farmStage==Fe.Harvesting?15:30)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,s=(this.farmStage==Fe.Harvesting?30:60)/this.city.simulation.happiness.actionSpeedModifierWithoutPenalties|0,null==(i=!1)&&(i=!1),t.moveAndWait(bo.getInt(3,15),bo.getInt(n,s),function(){switch(r.farmStage._hx_index){case 0:r.percentGrown+=1.15*r.city.simulation.bonuses.indoorFarmSpeed,100<=r.percentGrown&&(r.farmStage=Fe.Harvesting,t=25+r.city.simulation.bonuses.extraFoodFromFarms,e=r.getEffectsOfAdjecentBuildings("increaseCropNumber"),r.foodLeft=t+e),r.updateTexture();break;case 1:var t=.25*r.city.simulation.boostManager.currentGlobalBoostAmount;r.foodLeft-=t;var e=r.city.materials;e.set_food(e.food+t),r.city.simulation.stats.materialProduction[0][0]+=t,r.foodLeft<=0&&(r.percentCleaned=0,r.farmStage=Fe.Cleaning),r.updateTexture();break;case 2:r.percentCleaned+=5,100<=r.percentCleaned&&(r.farmStage=Fe.Growing,r.percentGrown=0),r.updateTexture()}},i,!1))},destroy:function(){Jt.prototype.destroy.call(this),this.bgStage.removeChild(this.growthSprite)},update:function(t){var e,i,n;this.farmStage==Fe.Growing&&(e=this.city.simulation.time.timeSinceStart/60%24,((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)?(this.percentGrown+=.018*t*this.city.simulation.bonuses.indoorFarmSpeed,100<=this.percentGrown&&(this.farmStage=Fe.Harvesting,this.foodLeft=25+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture()):(e=this.city.simulation.time.timeSinceStart/60%24,((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.percentGrown+=.009*t*this.city.simulation.bonuses.indoorFarmSpeed,100<=this.percentGrown&&(this.farmStage=Fe.Harvesting,this.foodLeft=25+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture())))},grow:function(t){this.percentGrown+=t,100<=this.percentGrown&&(this.farmStage=Fe.Harvesting,this.foodLeft=25+this.city.simulation.bonuses.extraFoodFromFarms+this.getEffectsOfAdjecentBuildings("increaseCropNumber")),this.updateTexture()},updateTexture:function(){var t;switch(this.farmStage._hx_index){case 0:t=this.textures[Math.floor(this.percentGrown/100*(this.textures.length-2))];break;case 1:t=this.textures[this.textures.length-2];break;case 2:t=this.textures[this.textures.length-1]}this.growthSprite.texture=t},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.growthSprite&&this.growthSprite.position.set(this.position.x,this.position.y)},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){switch(t.farmStage._hx_index){case 0:return kn.lo("crops_grown",[Math.floor(t.percentGrown)]);case 1:return kn.lo("food_left",[Math.floor(t.foodLeft)]);case 2:return kn.lo("percent_cleaned",[Math.floor(t.percentCleaned)])}})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString($e.saveDefinition);e=this.farmStage;t.addString(x[e.__enum__].__constructs__[e._hx_index]);e=this.percentGrown;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.foodLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.percentCleaned;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"farmStage")&&(this.farmStage=t.h.farmStage),Object.prototype.hasOwnProperty.call(t.h,"percentGrown")&&(this.percentGrown=t.h.percentGrown),Object.prototype.hasOwnProperty.call(t.h,"foodLeft")&&(this.foodLeft=t.h.foodLeft),Object.prototype.hasOwnProperty.call(t.h,"percentCleaned")&&(this.percentCleaned=t.h.percentCleaned),this.postLoad()},__class__:$e}),(V["buildings.Laboratory"]=qe).__name__="buildings.Laboratory",qe.__super__=Jt,qe.prototype=e(Jt.prototype,{get_possibleUpgrades:function(){return[pt,Ht]},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.backSprite&&this.backSprite.position.set(this.position.x,this.position.y)},destroy:function(){Jt.prototype.destroy.call(this),null!=this.backSprite&&this.bgStage.removeChild(this.backSprite)},work:function(t,e,i){i?t.currentAction=y.Nothing:(this.anyoneHasWorkedHere=!0,t.isAtGroundLevel()?(i=this.workers.indexOf(t),t.setRelativePos(0==i?5:13,9)):(t=.00125*e*this.city.simulation.happiness.actionSpeedModifier*this.city.simulation.bonuses.labSpeed*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount,this.city.materials.knowledge+=t,this.city.simulation.stats.materialProduction[9][0]+=t,this.totalKnowledgeGenerated+=t))},update:function(t){this.backSprite.texture=this.anyoneHasWorkedHere?this.originalBackTexture:this.noLightBackTexture,this.anyoneHasWorkedHere=!1},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(qe.saveDefinition);var i=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated)},__class__:qe}),(V["buildings.LandedExplorationShip"]=Ke).__name__="buildings.LandedExplorationShip",Ke.__super__=Yt,Ke.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[]},get_baseAttractiveness:function(){return 50},walkAround:function(t,e){var i=bo.getInt(3),n=this.mirrored?-1:1,s=this.mirrored?20:0;t.relativeX*n>(s+11*n)*n&&t.setRelativeX(11),t.relativeX*n<=(s+n)*n&&t.setRelativeX(2),1==i?t.moveAndWait(bo.getInt(s+4*n,s+5*n),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(s+9*n,s+12*n),bo.getInt(30,60),null,!1,!1):((n=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,n[1]=bo.getInt(90,120),t.setPath(n,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},postLoad:function(){this.mirrored&&(this.mirror(),this.mirrored=!0)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){dr.create(this.city.gui,fa(this,this.mirror),this.city.gui.windowInner,function(){return kn.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),Yt.prototype.createWindowAddBottomButtons.call(this)},addWindowInfoLines:function(){this.city.gui.windowAddInfoText(null,function(){return kn.lo("used_as_house")}),Yt.prototype.addWindowInfoLines.call(this)},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(Ke.saveDefinition);var i=this.mirrored;t.size+1>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,e,0,t.size)),t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){Yt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"mirrored")&&(this.mirrored=t.h.mirrored),this.postLoad()},__class__:Ke});var Qe=function(t,e,i,n,s,r,o,a){this.saucerType=0,this.timesUsedStopOver=0,this.timesUsedTo=0,this.timesUsed=0,this.landingSiteGroup=0,this.currentlyLandedSaucer=null,this.hasFlyingSaucer=!0,m.call(this,t,e,i,n,s,r,o,a),n.landingSites.push(this),this.doorX=15,this.connectedWaypoint=null,this.flyingSaucerSprite=H.makeSprite("spr_flyingsaucer"),this.flyingSaucerSprite.position.set(r.x,r.y),e.addChild(this.flyingSaucerSprite)};(V["buildings.LandingSite"]=Qe).__name__="buildings.LandingSite",Qe.__super__=m,Qe.prototype=e(m.prototype,{get_typeID:function(){return 2},get_saucherTexture:function(){switch(this.saucerType){case 0:return"spr_flyingsaucer";case 1:return"spr_flyingsaucer_alt";case 2:return"spr_flowercraft";case 3:return"spr_flyingsaucer_cube";case 4:return"spr_flyingsaucer_deepblue";case 5:return"spr_flyingsaucer_shade";default:return"spr_flyingsaucer"}},get_mainTexture:function(){switch(this.saucerType){case 0:return Qe.spriteName;case 1:return"spr_landingplace_alt";case 4:return"spr_landingplace_deepblue";default:return Qe.spriteName}},postLoad:function(){var t=this.get_saucherTexture();this.flyingSaucerSprite.texture=H.getTexture(t),this.drawer.changeMainTexture(this.get_mainTexture())},positionSprites:function(){m.prototype.positionSprites.call(this),null!=this.flyingSaucerSprite&&this.flyingSaucerSprite.position.set(this.position.x,this.position.y)},update:function(t){m.prototype.update.call(this,t),0<this.timeUntilCanGetNewFlyingSaucer?this.timeUntilCanGetNewFlyingSaucer-=t:0<this.gettingNewFlyingSaucerStage&&(this.gettingNewFlyingSaucerStage-=t,this.flyingSaucerSprite.position.set(this.position.x,this.position.y-Math.max(0,.25*this.gettingNewFlyingSaucerStage)),this.flyingSaucerSprite.alpha=1-this.gettingNewFlyingSaucerStage/16,this.gettingNewFlyingSaucerStage<=0&&(this.hasFlyingSaucer=!0))},tryDestroy:function(t){return null==t&&(t=!0),"cityofthekey"!=this.city.progress.story.storyName||100!=this.position.x&&-100!=this.position.x?m.prototype.tryDestroy.call(this,t):(t&&this.city.gui.showSimpleWindow(kn.lo("secret_society_forbidden"),null,!0,!0),!1)},destroy:function(){Y.remove(this.city.landingSites,this),this.stage.removeChild(this.flyingSaucerSprite);for(var t=this.city.simulation.flyingSaucers.length;0<=--t;)this.city.simulation.flyingSaucers[t].destination==this&&this.city.simulation.flyingSaucers[t].cancel();m.prototype.destroy.call(this)},addFlyingSaucer:function(){this.hasFlyingSaucer||(this.hasFlyingSaucer=!0,this.flyingSaucerSprite.alpha=1,this.flyingSaucerSprite.position.set(this.position.x,this.position.y))},removeFlyingSaucer:function(){this.hasFlyingSaucer&&(this.hasFlyingSaucer=!1,this.flyingSaucerSprite.alpha=0,this.gettingNewFlyingSaucerStage=16,this.timeUntilCanGetNewFlyingSaucer=30)},estimatedFlyingDistanceTo:function(t){return(Math.abs(t.position.x-this.position.x)+Math.abs(t.position.y-this.position.y))/3},addWindowInfoLines:function(){var e=this;m.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){var t=e.timesUsed-e.timesUsedStopOver;return kn.lo("transported_from",[0<t?t:0])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("transported_to",[e.timesUsedTo])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("used_as_stopover",[e.timesUsedStopOver])})},createWindowAddBottomButtons:function(){var e=this;R.hasSecretCode("hangar")&&ur.create(this.city.gui,function(){return e.saucerType},function(t){e.saucerType=t;t=e.get_saucherTexture();e.flyingSaucerSprite.texture=H.getTexture(t),e.drawer.changeMainTexture(e.get_mainTexture())},function(){return 6},kn.lo("change_space_ship")),m.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(Qe.saveDefinition);e=this.timesUsed;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.timesUsedTo;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.timesUsedStopOver;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.saucerType;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"timesUsed")&&(this.timesUsed=t.h.timesUsed),Object.prototype.hasOwnProperty.call(t.h,"timesUsedTo")&&(this.timesUsedTo=t.h.timesUsedTo),Object.prototype.hasOwnProperty.call(t.h,"timesUsedStopOver")&&(this.timesUsedStopOver=t.h.timesUsedStopOver),Object.prototype.hasOwnProperty.call(t.h,"saucerType")&&(this.saucerType=t.h.saucerType),this.postLoad()},__class__:Qe});var Je=function(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=14,this.endTime=22,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(V["buildings.Library"]=Je).__name__="buildings.Library",Je.__interfaces__=[Kt],Je.__super__=Jt,Je.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){if(1!=this.workers.length||this.workers[0].currentAction!=y.Work)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<22?e<=t&&t<22:e<=t||t<22},get_entertainmentType:function(){return 5},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},positionSprites:function(){Jt.prototype.positionSprites.call(this)},beEntertained:function(n,t){function e(){var t,e,i;e=(t=n.relativeY<5?bo.getInt(3,7):bo.getInt(3,16),n),(i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=t,e.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}var i,s;1==bo.getInt(2)?n.changeFloor(e):(i=n,(s=0<(s=io.pool)[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=bo.getInt(120,180),i.setPath(s,0,2,!0),n.pathEndFunction=e,n.pathOnlyRelatedTo=n.inPermanent),n.hasBuildingInited||(n.educationLevel=Math.max(Math.min(n.educationLevel+.025,1.5),n.educationLevel),n.hasBuildingInited=!0)},work:function(t,e,i){i&&22<this.city.simulation.time.timeSinceStart/60%24?t.currentAction=y.Nothing:(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(12-t.relativeX)<i?t.relativeX=12:(e=12-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i))},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Je.saveDefinition)},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Je});var Ze=function(t,e,i,n,s,r,o,a){this.totalKnowledgeGenerated=0,te.call(this,t,e,i,n,s,r,o,a)};function ti(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=16,this.endTime=1,this.workTimePreferenceMod=.5,this.isEntertainment=!0}function ei(t,e,i,n,s,r,o,a){this.materialsMadePerStepPerWorker=.0015,pe.call(this,t,e,i,n,s,r,o,a,"spr_machinepartsfactory_frames","spr_machinepartsfactory_idle")}(V["buildings.LivingResearchCenter"]=Ze).__name__="buildings.LivingResearchCenter",Ze.__super__=te,Ze.prototype=e(te.prototype,{get_possibleCityUpgrades:function(){return[wn,mn,gn,pn,un,fn]},walkAround:function(t,e){var i=bo.getInt(3);t.relativeY<5?t.changeFloorAndWaitRandom(30,60):1==i?0==bo.getInt(2)?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},work:function(t,e,i){var n,s;i?t.currentAction=y.Nothing:(t.relativeY<2?0==bo.getInt(2)?(null==(s=!0)&&(s=!1),null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(3,6),bo.getInt(60,120),null,n,s)):(null==(s=!0)&&(s=!1),null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(13,14),bo.getInt(60,120),null,n,s)):0==bo.getInt(2)&&(null==(s=!0)&&(s=!1),null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(3,15),bo.getInt(60,120),null,n,s)),t=.10799999999999998*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount,this.city.materials.knowledge+=t,this.city.simulation.stats.materialProduction[9][0]+=t,this.totalKnowledgeGenerated+=t)},addWindowInfoLines:function(){var t=this;te.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},createMainWindowPart:function(){var t=this;te.prototype.createMainWindowPart.call(this);var e=null,e=function(){t.city.gui.createWindow(t),Xs.create(t.city,t.city.gui,t.city.gui.innerWindowStage,t.city.gui.windowInner),t.city.gui.addWindowToStack(e)},i=new ls(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner,e),n=this.city.game.isMobile?3:0;i.container.padding.top=3+n,i.container.padding.left=3,i.container.padding.right=3,i.container.padding.bottom=n,i.container.fillSecondarySize=!0,i.container.addChild(new Qs(i,this.city.gui.innerWindowStage,kn.lo("upgrade_basic_houses"))),this.city.gui.windowInner.addChild(i),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6)))},save:function(t,e){null==e&&(e=!0),te.prototype.save.call(this,t),e&&t.addString(Ze.saveDefinition);var i=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){te.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated)},__class__:Ze}),(V["buildings.LuxuryRestaurant"]=ti).__name__="buildings.LuxuryRestaurant",ti.__interfaces__=[Kt],ti.__super__=Jt,ti.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){var t=25;return t+=this.getEffectsOfAdjecentBuildingsLR("restaurantCapBoost"),this.workers.length*t|0},get_isOpen:function(){if(1<=this.workers.length&&this.workers[0].currentAction==y.Work){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<.5?e<=t&&t<.5:e<=t||t<.5}return!1},get_entertainmentType:function(){return 1},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 4},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 4},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},beEntertained:function(n,t){var e,i,s,r,o;n.hasBuildingInited?(s=n,(o=0<(r=io.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=8,o[1]=bo.getInt(30,60),s.setPath(o,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent):(null!=this.leftBuilding&&this.leftBuilding.is(fi),null!=this.rightBuilding&&this.rightBuilding.is(fi),e=function(){switch(bo.getInt(2)){case 0:var t=n;(i=0<(e=io.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=4,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 1:var e,i,t=n;(i=0<(e=io.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=14,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}},n.wantsNightEntertainmentIn=bo.getInt(1,5),n.hasBuildingInited=!0,n.relativeY<=5?0==bo.getInt(3)?(i=bo.getInt(4,6),s=n,(o=0<(r=io.pool)[2].length?r[2].splice(r[2].length-1,1)[0]:new Int32Array(2))[0]=4,o[1]=i,s.setPath(o,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent):n.changeFloor(e):e())},work:function(t,e,i){if(i&&.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=y.Nothing;else switch(this.workers.indexOf(t)){case 0:var n,s;5<t.relativeY?t.changeFloor():(n=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(12-t.relativeX)<n?t.relativeX=12:(s=12-t.relativeX,t.relativeX+=(0<s?1:s<0?-1:0)*n));break;case 1:t.relativeY<5?t.changeFloor():t.moveAndWait(bo.getInt(3,16),bo.getInt(60,90),null,!1,!1)}},__class__:ti}),(V["buildings.MachinePartsFactory"]=ei).__name__="buildings.MachinePartsFactory",ei.__super__=pe,ei.prototype=e(pe.prototype,{get_normalEfficiency:function(){return 3},get_walkThroughCanViewSelfInThisBuilding:function(){return!1},get_possibleUpgrades:function(){return[vt]},get_possibleBuildingModes:function(){return[ct,St,Et]},get_materialFrom:function(){return this.city.materials.stone},set_materialFrom:function(t){t=this.city.materials.stone-t;return this.city.materials.stone-=t,this.city.simulation.stats.materialUsed[2][0]+=t,this.city.materials.stone},get_materialTo:function(){return this.city.materials.machineParts},set_materialTo:function(t){t-=this.city.materials.machineParts;return this.city.materials.machineParts+=t,this.city.simulation.stats.materialProduction[3][0]+=t,this.city.materials.machineParts},get_bonusSpeed:function(){return this.city.simulation.bonuses.machinePartsFactorySpeed},onBuild:function(){pe.prototype.onBuild.call(this),this.city.progress.unlocks.unlock(ii)},workAnimation:function(t,e){10!=t.relativeY&&(0==this.workers.indexOf(t)?t.setRelativePos(12,10):t.setRelativePos(15,10))},addWindowInfoLines:function(){var t=this;pe.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return(0|t.totalMaterialUsed)+" stone used to make "+(0|t.materialMade)+" machine parts."})},save:function(t,e){null==e&&(e=!0),pe.prototype.save.call(this,t),e&&t.addString(ei.saveDefinition)},load:function(t,e){pe.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:ei});var ii=function(t,e,i,n,s,r,o,a){this.hasHeatedBed=!1,this.movementType=0,this.bgSprite2=null,this.currentAdjBonus=0,Yt.call(this,t,e,i,n,s,r,o,a)};(V["buildings.MechanicalHouse"]=ii).__name__="buildings.MechanicalHouse",ii.__super__=Yt,ii.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[ft]},destroy:function(){Yt.prototype.destroy.call(this),null!=this.spriteOverMachinePartsFactory&&this.spriteOverMachinePartsFactory.destroy(),null!=this.bgSprite&&this.bgSprite.destroy(),null!=this.bgSprite2&&this.bgSprite2.destroy(),this.spriteOverMachinePartsFactory=null,this.bgSprite=null},update:function(t){null!=this.bgSprite&&(this.bgTexture+=.25*t,this.bgTexture>=this.bgTextures.length&&(this.bgTexture=0),this.bgSprite.texture=this.bgTextures[0|this.bgTexture])},walkAround:function(t,e){var i,n,s;0==this.movementType?Yt.prototype.walkAround.call(this,t,e):1==this.movementType?0==(i=bo.getInt(4))&&120<e&&t.relativeX<11?t.changeFloorAndWaitRandom(30,60):1==i?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):2==i&&t.relativeY<5?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=bo.getInt(90,120),t.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent):2==this.movementType?0==(i=bo.getInt(4))&&120<e&&11<t.relativeX?t.changeFloorAndWaitRandom(30,60):i<=2&&t.relativeY<5?t.moveAndWait(bo.getInt(7,16),bo.getInt(30,60),null,!1,!1):i<=2?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=bo.getInt(90,120),t.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent):3==this.movementType&&(0==(i=bo.getInt(4))&&120<e&&11<t.relativeX?t.changeFloorAndWaitRandom(30,60):(1==i||2==i)&&t.relativeY<5?t.moveAndWait(bo.getInt(7,16),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=bo.getInt(90,120),t.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent))},onCityChange:function(){var t=this,e=0;this.movementType=0,null!=this.rightBuilding&&this.rightBuilding.is(ei)?(null!=this.leftBuilding&&this.leftBuilding.is(ei)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_leftright"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(H.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=H.getTexturesByWidth("spr_mechanicalhouse_leftright_bganim",20),this.spriteOverMachinePartsFactory.texture=H.getTexture(null==this.leftBuilding.bottomBuilding?"spr_mechanicalhouse_pipe_h3_bf":"spr_mechanicalhouse_pipe_h3"),this.spriteOverMachinePartsFactory.position.set(this.position.x-3,this.position.y)):(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_left"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(H.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=H.getTexturesByWidth("spr_mechanicalhouse_left_bganim",20),this.spriteOverMachinePartsFactory.texture=H.getTexture("spr_mechanicalhouse_pipe_h"),this.spriteOverMachinePartsFactory.position.set(this.position.x+20,this.position.y+4)),this.bgTexture=this.rightBuilding.bgTexture%this.bgTextures.length,this.movementType=1):null!=this.bottomBuilding&&this.bottomBuilding.is(ei)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_top"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(H.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=H.getTexturesByWidth("spr_mechanicalhouse_top_bganim",20),null!=this.topBuilding&&this.topBuilding.is(ei)?(this.spriteOverMachinePartsFactory.texture=H.getTexture("spr_mechanicalhouse_pipe_v3"),this.spriteOverMachinePartsFactory.position.set(this.position.x+1,this.position.y-3)):(this.spriteOverMachinePartsFactory.texture=H.getTexture("spr_mechanicalhouse_pipe_v1"),this.spriteOverMachinePartsFactory.position.set(this.position.x+1,this.position.y+20)),this.bgTexture=this.bottomBuilding.bgTexture%this.bgTextures.length,this.movementType=2):null!=this.leftBuilding&&this.leftBuilding.is(ei)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_right"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(H.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=H.getTexturesByWidth("spr_mechanicalhouse_right_bganim",20),this.spriteOverMachinePartsFactory.texture=H.getTexture(null==this.leftBuilding.bottomBuilding?"spr_mechanicalhouse_pipe_h2_bf":"spr_mechanicalhouse_pipe_h2"),this.spriteOverMachinePartsFactory.position.set(this.position.x-3,this.position.y+11-(null==this.leftBuilding.bottomBuilding?6:0)),this.bgTexture=this.leftBuilding.bgTexture%this.bgTextures.length):null!=this.topBuilding&&this.topBuilding.is(ei)?(e=50,this.drawer.changeMainTexture("spr_mechanicalhouse_bottom"),null==t.spriteOverMachinePartsFactory&&(t.spriteOverMachinePartsFactory=new PIXI.Sprite,t.city.justAboveCityStage.addChild(t.spriteOverMachinePartsFactory)),null==t.bgSprite&&(t.bgSprite=new PIXI.Sprite,t.bgStage.addChild(t.bgSprite)),null!=t.bgSprite2&&t.bgSprite2.destroy(),t.hasHeatedBed&&(t.bgSprite2=new PIXI.Sprite(H.getTexture("spr_mechanicalhouse_heatedbed")),t.bgStage.addChild(t.bgSprite2)),t.bgSprite.position.set(t.position.x,t.position.y),this.bgTextures=H.getTexturesByWidth("spr_mechanicalhouse_bottom_bganim",20),this.spriteOverMachinePartsFactory.texture=H.getTexture("spr_mechanicalhouse_pipe_v2"),this.spriteOverMachinePartsFactory.position.set(this.position.x+3,this.position.y-3),this.bgTexture=this.topBuilding.bgTexture%this.bgTextures.length,this.movementType=3):(this.drawer.changeMainTexture("spr_mechanicalhouse"),null!=this.spriteOverMachinePartsFactory&&(this.spriteOverMachinePartsFactory.destroy(),this.spriteOverMachinePartsFactory=null),null!=this.bgSprite&&(this.bgSprite.destroy(),this.bgSprite=null),this.hasHeatedBed&&null==this.bgSprite2&&(this.bgSprite2=new PIXI.Sprite(H.getTexture("spr_mechanicalhouse_heatedbed")),this.bgStage.addChild(this.bgSprite2))),null!=this.bgSprite2&&this.bgSprite2.position.set(this.position.x,this.position.y),null!=this.bgSprite&&(this.bgSprite.texture=this.bgTextures[0|this.bgTexture]),this.bonusAttractiveness+=e-this.currentAdjBonus,e!=(0|this.currentAdjBonus)&&(this.city.simulation.houseAssigner.shouldUpdateHouses=!0),this.currentAdjBonus=0|e},__class__:ii});var ni=function(t,e,i,n,s,r,o,a){this.extraCapacity=0,this.extraQuality=0,this.medicalEducationPart=0,Jt.call(this,t,e,i,n,s,r,o,a),this.isMedical=!0};(V["buildings.MedicalClinic"]=ni).__name__="buildings.MedicalClinic",ni.__interfaces__=[Ue],ni.__super__=Jt,ni.prototype=e(Jt.prototype,{get_medicalQuality:function(){return 50+.25*this.city.simulation.happiness.schoolHappiness*this.medicalEducationPart+this.extraQuality},get_medicalCapacity:function(){return(50+this.extraCapacity)*(0==this.workers.length?0:vn.sum(this.workers,function(t){return t.get_educationSpeedModifier()}))},get_possibleUpgrades:function(){return[xt,Q]},get_possibleCityUpgrades:function(){return[sn]},get_medicalTypeLimit:function(){return 1},get_medicalTypeID:function(){return 0},work:function(t,e,i){i?t.currentAction=y.Nothing:t.relativeY<5&&1==this.workers.indexOf(t)?t.changeFloor():(i=t.relativeY<5?5:3,e=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(i-t.relativeX)<e?t.relativeX=i:(i=i-t.relativeX,t.relativeX+=(0<i?1:i<0?-1:0)*e))},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("capacity",[Math.floor(t.get_medicalCapacity())])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("quality",[Math.floor(t.get_medicalQuality())])})},createMainWindowPart:function(){var e=this;Jt.prototype.createMainWindowPart.call(this);var i=new ds(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner);this.city.gui.windowInner.addChild(i);function t(){i.padding.bottom=6;var t=null,t=function(){e.city.gui.createWindow("birthControlWindow"),e.city.gui.addWindowToStack(t),ts.create(e.city,e.city.gui,e.city.gui.innerWindowStage,e.city.gui.windowInner),e.city.gui.setWindowReload(t)};i.addChild(new Ks(e.city.gui,e.city.gui.innerWindowStage,i,t,kn.lo("manage_birth_control")))}var n;this.city.upgrades.vars.hasBirthControl?t():(n=!0,i.onUpdate=function(){n&&e.city.upgrades.vars.hasBirthControl&&(n=!1,t())})},__class__:ni});var si=x["buildings.MisdirectorMode"]={__ename__:"buildings.MisdirectorMode",__constructs__:["Normal","Disabled","Always","MostlyDisabled"],Normal:{_hx_index:0,__enum__:"buildings.MisdirectorMode",toString:i},Disabled:{_hx_index:1,__enum__:"buildings.MisdirectorMode",toString:i},Always:{_hx_index:2,__enum__:"buildings.MisdirectorMode",toString:i},MostlyDisabled:{_hx_index:3,__enum__:"buildings.MisdirectorMode",toString:i}},ri=function(t,e,i,n,s,r,o,a){this.mode=si.Normal,this.teleportX=9,this.timesUsedTo=0,this.knowledgeGenerated=0,m.call(this,t,e,i,n,s,r,o,a),this.doorX=12,n.misdirector=this};(V["buildings.Misdirector"]=ri).__name__="buildings.Misdirector",ri.__super__=m,ri.prototype=e(m.prototype,{get_misdirectChance:function(){switch(this.mode._hx_index){case 0:return.025;case 1:return 0;case 2:return 1;case 3:return.001}},get_possibleBuildingModes:function(){return[Bt,Ct,Tt,It]},giveReward:function(){var t=this.mode==si.Always?.05:.5;this.city.materials.knowledge+=t,this.city.simulation.stats.materialProduction[9][0]+=t,this.knowledgeGenerated+=t},destroy:function(){m.prototype.destroy.call(this),this.city.misdirector=null},addWindowInfoLines:function(){var t=this;m.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("misdirected",[t.timesUsedTo])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_generated",[Math.floor(t.knowledgeGenerated)])})},createTeleportParticle:function(t){null==t&&(t="spr_teleporter_ray_misdirect"),this.city.particles.addParticle(H.getTexturesByWidth(t,4),new Cn(this.position.x+8,this.position.y+4))},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(ri.saveDefinition);e=this.knowledgeGenerated;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.timesUsedTo;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"knowledgeGenerated")&&(this.knowledgeGenerated=t.h.knowledgeGenerated),Object.prototype.hasOwnProperty.call(t.h,"timesUsedTo")&&(this.timesUsedTo=t.h.timesUsedTo)},__class__:ri});var oi=function(t,e,i,n,s,r,o,a){this.artSprite=null,Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=9,this.endTime=22,this.workTimePreferenceMod=.1,this.isEntertainment=!0,this.artTextures=H.getTexturesByWidth("spr_modernart",20),this.currentTexture=bo.getInt(n.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked),this.artSprite=new PIXI.Sprite(this.artTextures[this.currentTexture]),this.artSprite.position.set(r.x,r.y),i.addChild(this.artSprite)};function ai(t,e,i,n,s,r,o,a){this.currentAdjBonus=0,Yt.call(this,t,e,i,n,s,r,o,a),this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1})}function li(t,e,i,n,s,r,o,a){this.knownEntertainedCitizenSet=0,this.knownEntertainedCitizen=null,this.nightClubColor=0,this.nightClubEntertainmentQuantity=0,this.laserImages=H.getTexturesByWidth("spr_nightclub_laser",18),this.lights=[],Jt.call(this,t,e,i,n,s,r,o,a),o=new PIXI.Sprite(H.getTexture("spr_nightclub_light")),i.addChild(o),this.lights.push({sprite:o,color:0,alpha:0,waiting:1,alphaDir:1}),o.alpha=.8,a=[150,1,.5],o.tint=oa.toInt(sa.toRgb(a)),o=new PIXI.Sprite(H.getTexture("spr_nightclub_light")),i.addChild(o),this.lights.push({sprite:o,color:0,alpha:0,waiting:1,alphaDir:1}),o.alpha=.8,a=[150,1,.5],o.tint=oa.toInt(sa.toRgb(a)),this.laserStage=new PIXI.Container,i.addChild(this.laserStage),this.laserStage.position.set(r.x,r.y),this.lasers=[],this.lasers.push({start:new In(2,3),end:new In(6,18),hue:180,speed:1,targetLaserHue:-1,laserSprite:null}),this.lasers.push({start:new In(17,3),end:new In(6,18),hue:0,speed:-1,targetLaserHue:-1,laserSprite:null}),this.positionSprites(),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0,this.lightsAreOn=-1}(V["buildings.ModernArtMuseum"]=oi).__name__="buildings.ModernArtMuseum",oi.__interfaces__=[Kt],oi.__super__=Jt,oi.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 100*this.workers.length},get_isOpen:function(){return 1==this.workers.length&&this.workers[0].currentAction==y.Work&&this.city.simulation.time.timeSinceStart/60%24<21.5},get_entertainmentType:function(){return 2},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 2},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},onBuild:function(){this.city.progress.unlocks.unlock(ee)},postLoad:function(){this.artSprite.texture=this.artTextures[this.currentTexture]},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.artSprite&&this.artSprite.position.set(this.position.x,this.position.y)},destroy:function(){Jt.prototype.destroy.call(this),this.bgStage.removeChild(this.artSprite)},beEntertained:function(i,t){function e(){var t=!1,e=!0;null==e&&(e=!1),null==t&&(t=!1),i.moveAndWait(bo.getInt(3,16),bo.getInt(100,120),null,t,e)}i.relativeY<5?i.changeFloor(e):e()},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.artSprite.texture=e.artTextures[e.currentTexture]},function(){return e.city.progress.unlocks.numberOfModernArtMuseumArtworksUnlocked},kn.lo("change_exhibition")),Jt.prototype.createWindowAddBottomButtons.call(this)},work:function(r,t,e){var i,n,s;e?r.currentAction=y.Nothing:4<=r.relativeX&&r.relativeX<6?0==bo.getInt(10)?r.changeFloorAndWaitRandom(30,60,function(){var t=!0;null==t&&(t=!1);var e,i,n,s=bo.getInt(14,15);t?(e=r,(n=0<(i=io.pool)[4].length?i[4].splice(i[4].length-1,1)[0]:new Int32Array(4))[0]=12,n[1]=50,n[2]=4,n[3]=s,e.setPath(n,0,4,!0)):(e=r,(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=s,e.setPath(n,0,2,!0)),r.pathEndFunction=function(){var t=r,e=io.pool,e=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);e[0]=8,e[1]=bo.getInt(30,60),t.setPath(e,0,2,!0),r.pathEndFunction=function(){var t=!0;null==t&&(t=!1);var e,i,n,s=bo.getInt(4,6);t?(e=r,(n=0<(i=io.pool)[4].length?i[4].splice(i[4].length-1,1)[0]:new Int32Array(4))[0]=12,n[1]=50,n[2]=4,n[3]=s,e.setPath(n,0,4,!0)):(e=r,(n=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=s,e.setPath(n,0,2,!0)),r.pathEndFunction=function(){var t=r,e=io.pool,e=0<e[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2);e[0]=8,e[1]=bo.getInt(30,60),t.setPath(e,0,2,!0),r.pathEndFunction=function(){r.changeFloor()},r.pathOnlyRelatedTo=r.inPermanent},r.pathOnlyRelatedTo=r.inPermanent},r.pathOnlyRelatedTo=r.inPermanent},r.pathOnlyRelatedTo=r.inPermanent}):(i=r,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=bo.getInt(30,60),i.setPath(s,0,2,!0),r.pathEndFunction=null,r.pathOnlyRelatedTo=r.inPermanent):(e=bo.getInt(4,6),i=r,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=e,i.setPath(s,0,2,!0),r.pathEndFunction=null,r.pathOnlyRelatedTo=r.inPermanent)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(oi.saveDefinition);var i=this.currentTexture;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture),this.postLoad()},__class__:oi}),(V["buildings.ModernRusticHome"]=ai).__name__="buildings.ModernRusticHome",ai.__super__=Yt,ai.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[kt]},onCityChange:function(){var t=0;3<=this.getEffectsOfAdjecentBuildings("modernRusticHomeCommunityFeeling")&&(t=15),this.bonusAttractiveness+=t-this.currentAdjBonus,t!=(0|this.currentAdjBonus)&&(this.city.simulation.houseAssigner.shouldUpdateHouses=!0),this.currentAdjBonus=0|t},__class__:ai}),(V["buildings.NightClub"]=li).__name__="buildings.NightClub",li.__interfaces__=[Kt],li.__super__=Jt,li.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return this.workers.length*(40+this.nightClubEntertainmentQuantity)},get_isOpen:function(){if(1!=this.workers.length||this.workers[0].currentAction!=y.Work)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_entertainmentType:function(){return 0},get_minimumNormalTimeToSpend:function(){return 5},get_maximumNormalTimeToSpend:function(){return 7},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_possibleUpgrades:function(){return[et]},get_drawerType:function(){return Vi},get_hasLeftNightClub:function(){return null!=this.leftBuilding&&this.leftBuilding.is(li)},get_hasRightNightClub:function(){return null!=this.rightBuilding&&this.rightBuilding.is(li)},postLoad:function(){for(var t=0,e=this.lights;t<e.length;){var i=e[t];++t,3==this.nightClubColor&&(i.sprite.texture=H.getTexture("spr_nightclub_light_rainbow"))}},postCreate:function(){Jt.prototype.postCreate.call(this),this.positionSprites()},destroy:function(){for(var t=0,e=this.lights;t<e.length;){var i=e[t];++t,this.bgStage.removeChild(i.sprite)}this.laserStage.destroy(),Jt.prototype.destroy.call(this)},work:function(t,e,i){i&&6<this.city.simulation.time.timeSinceStart/60%24?t.currentAction=y.Nothing:this.get_hasLeftNightClub()?(t.moveAndWait(bo.getInt(0,this.get_hasRightNightClub()?19:17),bo.getInt(20,50),null,!1,!1),this.lightsAreOn=60):(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(1-t.relativeX)<i?t.relativeX=1:(e=1-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i),this.lightsAreOn=3)},beEntertained:function(t,e){var i;switch(null==this.knownEntertainedCitizen?(this.knownEntertainedCitizen=t,this.knownEntertainedCitizenSet=60):this.knownEntertainedCitizen==t&&(this.knownEntertainedCitizenSet=60),this.nightClubColor){case 1:i=-3;break;case 2:case 4:i=3;break;default:i=0}var n,s,r=bo.getInt(2+(this.get_hasLeftNightClub()?1:0)+(this.get_hasRightNightClub()?1:0)),o=4!=this.nightClubColor||this.knownEntertainedCitizen!=t;this.get_hasLeftNightClub()&&o&&0==r&&this.leftBuilding.get_isOpen()?((s=0<(n=io.pool)[6].length?n[6].splice(n[6].length-1,1)[0]:new Int32Array(6))[0]=2,s[1]=0,s[2]=4,s[3]=bo.getInt(5,19),s[4]=8,s[5]=bo.getInt(5,6),t.setPath(s,0,6,!0)):this.get_hasRightNightClub()&&o&&1==r&&this.rightBuilding.get_isOpen()?((s=0<(n=io.pool)[6].length?n[6].splice(n[6].length-1,1)[0]:new Int32Array(6))[0]=3,s[1]=0,s[2]=4,s[3]=bo.getInt(0,17),s[4]=8,s[5]=bo.getInt(5,6),t.setPath(s,0,6,!0)):(o=this.get_hasLeftNightClub()?0:5,r=this.get_hasRightNightClub()?19:17,n=!1,null==(s=2==this.nightClubColor||4==this.nightClubColor)&&(s=!1),null==n&&(n=!1),t.moveAndWait(bo.getInt(o,r),bo.getInt(5+i,6+i),null,n,s)),t.hasBuildingInited||(t.wantsNightEntertainmentIn=bo.getInt(1,5),t.hasBuildingInited=!0)},positionSprites:function(){Jt.prototype.positionSprites.call(this),2<=this.lights.length&&(this.lights[0].sprite.position.set(this.position.x+5,this.position.y+4),this.lights[1].sprite.position.set(this.position.x+10,this.position.y+4)),this.laserStage.position.set(this.position.x,this.position.y)},createWindowAddBottomButtons:function(){var r=this;R.hasSecretCode("nightClubColors")&&ur.create(this.city.gui,function(){return r.nightClubColor},function(t){r.nightClubColor=t,0==r.nightClubColor&&(r.lasers[0].hue=0,r.lasers[1].hue=180,4<=r.lasers.length&&(r.lasers[2].hue=90,r.lasers[3].hue=270));for(var e=0,i=r.lasers;e<i.length;){var n=i[e];++e,n.targetLaserHue=-1}for(e=0,i=r.lights;e<i.length;){var s=i[e];++e,3==r.nightClubColor?s.sprite.texture=H.getTexture("spr_nightclub_light_rainbow"):s.sprite.texture=H.getTexture("spr_nightclub_light")}},function(){return 5},null,function(){var t,e=kn.lo("change_light_show")+" (";switch(r.nightClubColor){case 0:t=kn.lo("colorful");break;case 1:t=kn.lo("fast_red");break;case 2:t=kn.lo("slow_blue");break;case 3:t=kn.lo("rainbow_light");break;case 4:t=kn.lo("romantic_pink");break;default:t=""}return e+t+")"}),Jt.prototype.createWindowAddBottomButtons.call(this)},update:function(t){if(Jt.prototype.update.call(this,t),this.lightsAreOn-=Math.min(1,t),!(this.lightsAreOn<=0)||1<=this.workers.length&&this.workers[0].inPermanent==this&&this.workers[0].currentAction==y.Work){for(g=0,m=this.lasers;g<m.length;){var e=m[g];switch(++g,4==this.nightClubColor&&0<this.workers.length&&this.workers[0].inPermanent==this&&this.get_hasLeftNightClub()?0<=this.knownEntertainedCitizenSet?null==this.knownEntertainedCitizen||this.knownEntertainedCitizen.inPermanent!=this||this.knownEntertainedCitizen.hasDied||(e.end.x=this.knownEntertainedCitizen.relativeX):e.end.x=this.workers[0].relativeX:(e.end.x+=t*e.speed,0<e.speed?18<e.end.x&&(e.end.x=18,e.speed=-e.speed):e.end.x<(this.get_hasLeftNightClub()?1:6)&&(d=this.get_hasLeftNightClub()?1:6,e.end.x=d,e.speed=-e.speed)),this.nightClubColor){case 0:e.hue+=t,360<e.hue&&(e.hue-=360);break;case 1:e.hue=0;break;case 2:(-1==e.targetLaserHue||Math.abs(e.hue-e.targetLaserHue)<t/2)&&(e.targetLaserHue=bo.getInt(170,245));var i=1;(245<e.hue||e.hue<170)&&(i=12);var n=e.targetLaserHue-e.hue;e.hue+=.5*(0<n?1:n<0?-1:0)*t*i;break;case 3:(-1==e.targetLaserHue||Math.abs(e.hue-e.targetLaserHue)<t)&&(e.targetLaserHue=bo.getInt(360));var s=e.targetLaserHue-e.hue;e.hue+=(0<s?1:s<0?-1:0)*t;break;case 4:(-1==e.targetLaserHue||Math.abs(e.hue-e.targetLaserHue)<t/2)&&(e.targetLaserHue=bo.getInt(270,330));i=1;(330<e.hue||e.hue<270)&&(i=12);s=e.targetLaserHue-e.hue;e.hue+=.5*(0<s?1:s<0?-1:0)*t*i}if(0==bo.getInt(20))switch(this.nightClubColor){case 1:var r=e.speed;e.speed=(0<r?1:r<0?-1:0)*bo.getFloat(1,2);break;case 2:r=e.speed;e.speed=(0<r?1:r<0?-1:0)*bo.getFloat(.5,.8);break;case 4:var o=e.speed;e.speed=(0<o?1:o<0?-1:0)*bo.getFloat(.5,.8);break;default:o=e.speed;e.speed=(0<o?1:o<0?-1:0)*bo.getFloat(.5,1.5)}null==e.laserSprite&&(e.laserSprite=new PIXI.Sprite,this.laserStage.addChild(e.laserSprite));var a=Math.floor(Math.abs(e.end.x-e.start.x));e.laserSprite.texture=this.laserImages[a<0?0:17<a?17:a],e.laserSprite.position.y=e.start.y;var l=[e.hue,.7,1],h=ra.toRgb(l);e.laserSprite.tint=Sn.toHexInt(h),e.end.x<e.start.x?(e.laserSprite.position.set(e.start.x+1,e.start.y),e.laserSprite.scale.x=-1):(e.laserSprite.position.set(e.start.x,e.start.y),e.laserSprite.scale.x=1)}for(g=0,m=this.lights;g<m.length;){var u=m[g];if(++g,0<u.alpha)u.alpha+=.1*u.alphaDir*(4==this.nightClubColor?.25:1),1<u.alpha?(u.alpha=1,u.alphaDir=-1):u.alpha<=0&&(u.alpha=0,1==this.nightClubColor||3==this.nightClubColor?u.waiting=bo.getInt(30):u.waiting=bo.getInt(60)),u.sprite.alpha=u.alpha;else if(0<u.waiting)u.waiting-=t;else switch(u.waiting=0,u.alpha=.01,u.alphaDir=1,this.nightClubColor){case 0:var l=[bo.getInt(360),.8,.5],d=sa.toRgb(l);u.sprite.tint=oa.toInt(d);break;case 1:var c=[bo.getInt(60),.8,.6],h=sa.toRgb(c);u.sprite.tint=oa.toInt(h);break;case 2:var p=[bo.getInt(170,245),.8,.7],p=sa.toRgb(p);u.sprite.tint=oa.toInt(p);break;case 3:u.sprite.tint=16777215;break;case 4:p=[bo.getInt(270,330),.8,.7],p=sa.toRgb(p);u.sprite.tint=oa.toInt(p)}}0<=this.knownEntertainedCitizenSet&&(this.knownEntertainedCitizenSet-=t,this.knownEntertainedCitizenSet<0&&(this.knownEntertainedCitizen=null))}else{for(var g=0,m=this.lights;g<m.length;){var f=m[g];++g,f.sprite.alpha=0}for(var g=0,m=this.lasers;g<m.length;){f=m[g];++g,null!=f.laserSprite&&(f.laserSprite.destroy(),f.laserSprite=null)}}},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(li.saveDefinition);var i=this.nightClubColor;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){Jt.prototype.load.call(this,t),t.version<15||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"nightClubColor")&&(this.nightClubColor=t.h.nightClubColor),this.postLoad())},__class__:li});var hi=function(t,e,i,n,s,r,o,a){this.doorMainTexture=0,Yt.call(this,t,e,i,n,s,r,o,a),this.doorTextures=H.getTexturesByWidth("spr_coloreddoors",20),this.makeDoorSpriteIfNeeded()};function ui(t,e,i,n,s,r,o,a){this.hasStarDatabase=!1,this.totalKnowledgeGenerated=0,Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=21,this.endTime=4}function di(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a)}function ci(t,e,i,n,s,r,o,a){this.festivalJobs=2,this.parkSprite=null,this.currentMainTexture=0,m.call(this,t,e,i,n,s,r,o,a),this.isEntertainment=!0,this.parkTextures=H.getTexturesByWidth(this.get_myParkTextures(),20),this.currentTexture=bo.getInt(this.parkTextures.length-this.get_numberOfLockedParkTextures()),this.parkSprite=new PIXI.Sprite(this.parkTextures[this.currentTexture]),this.parkSprite.position.set(r.x,r.y),i.cacheableChildren.push(this.parkSprite),i.isInvalid=!0,this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1}),this.festivalEntertainment=null}function pi(t,e,i,n,s,r,o,a){this.parkSprite=null,this.currentMainTexture=0,Yt.call(this,t,e,i,n,s,r,o,a),this.parkTextures=H.getTexturesByWidth("spr_parkpod",20),this.currentTexture=bo.getInt(this.parkTextures.length),this.parkSprite=new PIXI.Sprite(this.parkTextures[this.currentTexture]),this.parkSprite.position.set(r.x,r.y),i.addChild(this.parkSprite),this.adjecentBuildingEffects.push({name:"modernRusticHomeCommunityFeeling",intensity:1})}function gi(t,e,i,n,s,r,o,a){this.markingTexture="",this.marking=null,Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0}function mi(t,e,i,n,s,r,o,a){this.timeWorking=0,this.waiting=0,this.flyingSaucerTargetX=0,this.flyingSaucerY=0,this.flyingSaucerXI=0,this.flyingSaucerXProg=0,this.returning=!1,this.flying=!1,Jt.call(this,t,e,i,n,s,r,o,a),this.doorX=15,this.flyingSaucerSprite=H.makeSprite("spr_researchbot"),this.flyingSaucerSprite.position.set(r.x,r.y),e.addChild(this.flyingSaucerSprite)}(V["buildings.NormalHouse"]=hi).__name__="buildings.NormalHouse",hi.__super__=Yt,hi.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[gt]},positionSprites:function(){Yt.prototype.positionSprites.call(this),null!=this.doorSprite?(this.doorSprite.position.set(this.position.x,this.position.y),0!=this.worldPosition.y&&(this.stage.removeChild(this.doorSprite),this.doorSprite=null)):this.makeDoorSpriteIfNeeded()},postLoad:function(){null!=this.doorSprite&&(this.doorSprite.texture=this.doorTextures[this.doorMainTexture])},makeDoorSpriteIfNeeded:function(){null==this.doorSprite&&0==this.worldPosition.y&&(this.doorSprite=new PIXI.Sprite(this.doorTextures[this.doorMainTexture]),this.doorSprite.position.set(this.position.x,this.position.y),this.stage.addChild(this.doorSprite))},createWindowAddBottomButtons:function(){var t,e=this;null!=this.doorSprite&&((t=ur.create(this.city.gui,function(){return e.doorMainTexture},function(t){null!=e.doorSprite&&(e.doorMainTexture=t,e.doorSprite.texture=e.doorTextures[e.doorMainTexture])},function(){return e.doorTextures.length},kn.lo("change_door_color"))).onUpdate=function(){null==e.doorSprite&&e.city.gui.windowInner.removeChild(t)}),Yt.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){null!=this.doorSprite&&this.stage.removeChild(this.doorSprite),Yt.prototype.destroy.call(this)},addWindowInfoLines:function(){Yt.prototype.addWindowInfoLines.call(this)},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(hi.saveDefinition);var i=this.doorMainTexture;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t,e){Yt.prototype.load.call(this,t),t.version<18||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"doorMainTexture")&&(this.doorMainTexture=t.h.doorMainTexture),this.postLoad())},__class__:hi}),(V["buildings.Observatory"]=ui).__name__="buildings.Observatory",ui.__super__=Jt,ui.prototype=e(Jt.prototype,{get_possibleUpgrades:function(){return[Ut]},work:function(t,e,i){if(i)t.currentAction=y.Nothing;else{switch(this.workers.indexOf(t)){case 0:var n=t.pathWalkSpeed*e;I.shouldUpdateDraw=!0,Math.abs(5-t.relativeX)<n?t.relativeX=5:(s=5-t.relativeX,t.relativeX+=(0<s?1:s<0?-1:0)*n);break;case 1:n=t.pathWalkSpeed*e;I.shouldUpdateDraw=!0,Math.abs(13-t.relativeX)<n?t.relativeX=13:(s=13-t.relativeX,t.relativeX+=(0<s?1:s<0?-1:0)*n);break;case 2:var s,n=t.pathWalkSpeed*e;I.shouldUpdateDraw=!0,Math.abs(9-t.relativeX)<n?t.relativeX=9:(s=9-t.relativeX,t.relativeX+=(0<s?1:s<0?-1:0)*n)}i=.002*(this.hasStarDatabase?this.city.upgrades.vars.starDatabaseIsMoreEffective?6:1.5:1)*e*this.city.simulation.happiness.actionSpeedModifier*this.city.simulation.bonuses.labSpeed*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=i,this.city.simulation.stats.materialProduction[9][0]+=i,this.totalKnowledgeGenerated+=i}},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(ui.saveDefinition);var i=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated)},__class__:ui}),(V["buildings.OutpostHouse"]=di).__name__="buildings.OutpostHouse",di.__super__=Yt,di.prototype=e(Yt.prototype,{destroy:function(){Yt.prototype.destroy.call(this)},addWindowInfoLines:function(){Yt.prototype.addWindowInfoLines.call(this)},__class__:di}),(V["buildings.Park"]=ci).__name__="buildings.Park",ci.__interfaces__=[le,Kt],ci.__super__=m,ci.prototype=e(m.prototype,{get_myParkTextures:function(){return"spr_park_plants"},get_changePlantsText:function(){return kn.lo("change_plants")},get_baseEntertainmentCapacity:function(){return 30},get_isOpen:function(){var t=this.city.simulation.time.timeSinceStart/60%24;return 6<=t&&t<22},get_entertainmentType:function(){return 3},get_minimumNormalTimeToSpend:function(){return 1.5},get_maximumNormalTimeToSpend:function(){return 2.5},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 1.75},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Vi},get_numberOfLockedParkTextures:function(){return R.hasSecretCode("orchid")?0:3},postLoad:function(){this.parkSprite.texture=this.parkTextures[this.currentTexture],this.bgStage.isInvalid=!0,this.changeMainTexture(ci.mainTextures[this.currentMainTexture])},postCreate:function(){m.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){m.prototype.positionSprites.call(this),null!=this.parkSprite&&(this.parkSprite.position.set(this.position.x,this.position.y),this.bgStage.isInvalid=!0)},beEntertained:function(t,e){Gi.beEntertainedPark(this.leftBuilding,this.rightBuilding,t)},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.currentMainTexture},function(t){e.currentMainTexture=t,e.changeMainTexture(ci.mainTextures[e.currentMainTexture])},function(){return ci.mainTextures.length},kn.lo("change_building_color")),ur.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.parkSprite.texture=e.parkTextures[e.currentTexture],e.bgStage.isInvalid=!0},function(){return e.parkTextures.length-e.get_numberOfLockedParkTextures()},this.get_changePlantsText()),m.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){m.prototype.destroy.call(this),null!=this.festivalEntertainment&&this.festivalEntertainment.destroy();var t=this.bgStage,e=this.parkSprite;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e)},initFestival:function(){null==this.festivalEntertainment&&(this.festivalEntertainment=new Ni(this,this.bgStage))},stopFestival:function(){null!=this.festivalEntertainment&&(this.festivalEntertainment.stop(),this.festivalEntertainment.destroy(),this.festivalEntertainment=null)},doFestivalWork:function(t,e,i,n){this.festivalEntertainment.doFestivalWork(t,e,i,this.currentMainTexture,n)},beEntertainedFestival:function(t,e,i){this.festivalEntertainment.beEntertainedFestival(t,e,i)},endFestivalWork:function(t,e){e.setRelativeY(0)},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(ci.saveDefinition);e=this.currentTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.currentMainTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture),Object.prototype.hasOwnProperty.call(t.h,"currentMainTexture")&&(this.currentMainTexture=t.h.currentMainTexture),this.postLoad()},__class__:ci}),(V["buildings.ParkPod"]=pi).__name__="buildings.ParkPod",pi.__super__=Yt,pi.prototype=e(Yt.prototype,{get_drawerType:function(){return Vi},postLoad:function(){this.parkSprite.texture=this.parkTextures[this.currentTexture],this.changeMainTexture(pi.mainTextures[this.currentMainTexture])},postCreate:function(){Yt.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){Yt.prototype.positionSprites.call(this),null!=this.parkSprite&&this.parkSprite.position.set(this.position.x,this.position.y)},beEntertained:function(t,e){var i,n,s=null!=this.leftBuilding&&this.leftBuilding.is(ci),r=null!=this.rightBuilding&&this.rightBuilding.is(ci),o=bo.getInt(1+(s?1:0)+(r?1:0));s&&0==o?((n=0<(i=io.pool)[8].length?i[8].splice(i[8].length-1,1)[0]:new Int32Array(8))[0]=12,n[1]=50,n[2]=2,n[3]=0,n[4]=4,n[5]=bo.getInt(0,18),n[6]=8,n[7]=bo.getInt(100,180),t.setPath(n,0,8,!0)):r&&1==o?((n=0<(i=io.pool)[8].length?i[8].splice(i[8].length-1,1)[0]:new Int32Array(8))[0]=12,n[1]=50,n[2]=3,n[3]=0,n[4]=4,n[5]=bo.getInt(0,18),n[6]=8,n[7]=bo.getInt(100,180),t.setPath(n,0,8,!0)):(null==(n=!(i=!1))&&(n=!1),null==i&&(i=!1),t.moveAndWait(bo.getInt(s?0:3,r?18:15),bo.getInt(100,180),null,i,n))},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.currentMainTexture},function(t){e.currentMainTexture=t,e.changeMainTexture(pi.mainTextures[e.currentMainTexture])},function(){return pi.mainTextures.length},kn.lo("change_building_color")),ur.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.parkSprite.texture=e.parkTextures[e.currentTexture]},function(){return e.parkTextures.length},kn.lo("change_variant")),Yt.prototype.createWindowAddBottomButtons.call(this)},destroy:function(){Yt.prototype.destroy.call(this),this.bgStage.removeChild(this.parkSprite)},walkAround:function(t,e){var i;9==t.relativeX?t.canViewSelfInBuilding=!1:((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=9,t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(pi.saveDefinition);e=this.currentTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.currentMainTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){Yt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture),Object.prototype.hasOwnProperty.call(t.h,"currentMainTexture")&&(this.currentMainTexture=t.h.currentMainTexture),this.postLoad()},__class__:pi}),(V["buildings.Pub"]=gi).__name__="buildings.Pub",gi.__interfaces__=[Kt],gi.__super__=Jt,gi.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 50*this.workers.length},get_isOpen:function(){var t,e;return!!(1==this.workers.length&&this.workers[0].currentAction==y.Work&&(t=this.city.simulation.time.timeSinceStart/60%24,(e=this.startTime-this.workTimePreferenceMod)<4.5?e<=t&&t<4.5:e<=t||t<4.5))&&null==this.marking},get_entertainmentType:function(){return 1},get_minimumNormalTimeToSpend:function(){return 2},get_maximumNormalTimeToSpend:function(){return 6},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},postLoad:function(){""!=this.markingTexture&&this.setMarking(this.markingTexture)},destroy:function(){Jt.prototype.destroy.call(this),null!=this.marking&&this.stage.removeChild(this.marking)},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.marking&&this.marking.position.set(this.position.x+2,this.position.y+10)},setMarking:function(t){this.markingTexture=t,null==this.marking&&(this.marking=new PIXI.Sprite(H.getTexture(t))),this.marking.texture=H.getTexture(t),this.marking.position.set(this.position.x+2,this.position.y+10),this.stage.addChild(this.marking)},beEntertained:function(n,t){function e(){var t=bo.getInt(7,16),e=n,i=io.pool;(i=0<i[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=t,e.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}var i,s;n.relativeY<5?n.changeFloor(e):(i=n,(s=0<(s=io.pool)[2].length?s[2].splice(s[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=bo.getInt(120,180),i.setPath(s,0,2,!0),n.pathEndFunction=e,n.pathOnlyRelatedTo=n.inPermanent),n.hasBuildingInited||(n.wantsNightEntertainmentIn=bo.getInt(1,5),n.hasBuildingInited=!0)},work:function(t,e,i){i&&4.5<this.city.simulation.time.timeSinceStart/60%24?t.currentAction=y.Nothing:t.relativeY<5?t.changeFloor():(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i?t.relativeX=3:(e=3-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i))},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(gi.saveDefinition),t.addString(this.markingTexture)},load:function(t,e){Jt.prototype.load.call(this,t),t.version<7||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"markingTexture")&&(this.markingTexture=t.h.markingTexture),this.postLoad())},__class__:gi}),(V["buildings.ResearchBot"]=mi).__name__="buildings.ResearchBot",mi.__super__=Jt,mi.prototype=e(Jt.prototype,{positionSprites:function(){Jt.prototype.positionSprites.call(this),this.flying?0<this.workers.length&&(this.workers[0].canViewSelfInBuilding=!1):(this.flyingSaucerXI=(this.position.x/20|0)-this.city.simulation.flyingPathfinder.gridIStart-1,this.flyingSaucerY=this.position.y,this.flyingSaucerSprite.position.set(this.position.x,this.position.y))},update:function(t){var e,i;Jt.prototype.update.call(this,t),this.flying&&(this.timeWorking+=t,0<this.waiting?this.waiting-=t:(0==(e=0<(e=this.flyingSaucerTargetX-this.flyingSaucerXI)?1:e<0?-1:0)?(i=this.city.simulation.flyingPathfinder.highestYPositions[this.flyingSaucerXI]-20,this.returning&&(i+=40),this.flyingSaucerY<i&&-1e6<=i?(this.flyingSaucerY+=3*t,this.flyingSaucerY>i&&(this.flyingSaucerY=i)):(-1e6<=i&&(this.flyingSaucerY=i),this.returning?(this.flying=!1,this.returning=!1):(this.flyingSaucerTargetX=(this.position.x/20|0)-this.city.simulation.flyingPathfinder.gridIStart-1,this.returning=!0),this.waiting=60)):(i=this.city.simulation.flyingPathfinder.highestYPositions[this.flyingSaucerXI+e]-20,this.flyingSaucerY>i&&-1e5<=i?(this.flyingSaucerY-=3*t,this.flyingSaucerY<i&&(this.flyingSaucerY=i)):(this.flyingSaucerXProg+=3*e*t,20<e*this.flyingSaucerXProg&&(this.flyingSaucerXProg=0,this.flyingSaucerXI+=e))),this.flyingSaucerSprite.position.set(20*(this.flyingSaucerXI+this.city.simulation.flyingPathfinder.gridIStart+1)+this.flyingSaucerXProg,this.flyingSaucerY),0<this.workers.length&&this.workers[0].inPermanent==this&&this.workers[0].setRelativePos(this.flyingSaucerSprite.position.x-this.position.x+9,3-(this.flyingSaucerSprite.position.y-this.position.y))))},work:function(t,e,i){if(!i||this.flying){if(this.flying){var n=.00125*e*this.city.simulation.happiness.actionSpeedModifier*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount;return this.city.materials.knowledge+=n,void(this.city.simulation.stats.materialProduction[9][0]+=n)}n=t.pathWalkSpeed*e;I.shouldUpdateDraw=!0,(Math.abs(9-t.relativeX)<n?(t.relativeX=9,!0):(e=9-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*n,!1))&&(t.canViewSelfInBuilding=!1,this.flying=!0,this.flyingSaucerTargetX=bo.getInt(this.city.simulation.flyingPathfinder.highestYPositions.length),this.flyingSaucerXI=(this.position.x/20|0)-this.city.simulation.flyingPathfinder.gridIStart-1,"hackersandaliens"==this.city.progress.story.storyName&&this.timeWorking<60&&(this.flyingSaucerTargetX=-36-this.city.simulation.flyingPathfinder.gridIStart-1),this.flyingSaucerY=this.position.y)}else t.currentAction=y.Nothing},destroy:function(){this.stage.removeChild(this.flyingSaucerSprite),Jt.prototype.destroy.call(this)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(mi.saveDefinition);e=this.flying;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.returning;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.flyingSaucerXProg;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.flyingSaucerXI;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.flyingSaucerY;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.flyingSaucerTargetX;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.waiting;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.timeWorking;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"flying")&&(this.flying=t.h.flying),Object.prototype.hasOwnProperty.call(t.h,"returning")&&(this.returning=t.h.returning),Object.prototype.hasOwnProperty.call(t.h,"flyingSaucerXProg")&&(this.flyingSaucerXProg=t.h.flyingSaucerXProg),Object.prototype.hasOwnProperty.call(t.h,"flyingSaucerXI")&&(this.flyingSaucerXI=t.h.flyingSaucerXI),Object.prototype.hasOwnProperty.call(t.h,"flyingSaucerY")&&(this.flyingSaucerY=t.h.flyingSaucerY),Object.prototype.hasOwnProperty.call(t.h,"flyingSaucerTargetX")&&(this.flyingSaucerTargetX=t.h.flyingSaucerTargetX),Object.prototype.hasOwnProperty.call(t.h,"waiting")&&(this.waiting=t.h.waiting),Object.prototype.hasOwnProperty.call(t.h,"timeWorking")&&(this.timeWorking=t.h.timeWorking)},__class__:mi});var fi=function(t,e,i,n,s,r,o,a){Jt.call(this,t,e,i,n,s,r,o,a),this.startTime=16,this.endTime=1,this.workTimePreferenceMod=.5,this.isEntertainment=!0};(V["buildings.Restaurant"]=fi).__name__="buildings.Restaurant",fi.__interfaces__=[Kt],fi.__super__=Jt,fi.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){var t=45;return t+=this.getEffectsOfAdjecentBuildingsLR("restaurantCapBoost"),this.workers.length*t|0},get_isOpen:function(){if(1<=this.workers.length&&this.workers[0].currentAction==y.Work){var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<.5?e<=t&&t<.5:e<=t||t<.5}return!1},get_entertainmentType:function(){return 1},get_minimumNormalTimeToSpend:function(){return 1},get_maximumNormalTimeToSpend:function(){return 3},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Vi},beEntertained:function(n,t){var e,s,i,r,o,a;n.hasBuildingInited?(r=n,(a=0<(o=io.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=8,a[1]=bo.getInt(30,60),r.setPath(a,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent):(e=null!=this.leftBuilding&&this.leftBuilding.is(fi),s=null!=this.rightBuilding&&this.rightBuilding.is(fi),i=function(){switch(bo.getInt(3+(s?1:0))){case 0:var t=n;(i=0<(e=io.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=4,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 1:t=n;(i=0<(e=io.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=7,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 2:t=n;(i=0<(e=io.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=14,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent;break;case 3:var e,i,t=n;(i=0<(e=io.pool)[2].length?e[2].splice(e[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=17,t.setPath(i,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent}},n.wantsNightEntertainmentIn=bo.getInt(1,5),n.hasBuildingInited=!0,n.relativeY<=5?bo.getInt(3)<=1?n.changeFloor(i):(e?0==bo.getInt(2)?(r=n,(a=0<(o=io.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=1):(r=n,(a=0<(o=io.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=6):0==bo.getInt(2)?(r=n,(a=0<(o=io.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=3):(r=n,(a=0<(o=io.pool)[2].length?o[2].splice(o[2].length-1,1)[0]:new Int32Array(2))[0]=4,a[1]=6),r.setPath(a,0,2,!0),n.pathEndFunction=null,n.pathOnlyRelatedTo=n.inPermanent):i())},work:function(t,e,i){if(i&&.5<this.city.simulation.time.timeSinceStart/60%24)t.currentAction=y.Nothing;else switch(this.workers.indexOf(t)){case 0:5<t.relativeY?t.changeFloor():(s=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(12-t.relativeX)<s?t.relativeX=12:(n=12-t.relativeX,t.relativeX+=(0<n?1:n<0?-1:0)*s));break;case 1:var n,s;t.relativeY<5?t.changeFloor():(n=null!=this.leftBuilding&&this.leftBuilding.is(fi),s=null!=this.rightBuilding&&this.rightBuilding.is(fi),t.moveAndWait(bo.getInt(n?0:3,s?19:16),bo.getInt(60,90),null,!1,!1))}},__class__:fi});var yi=function(t,e,i,n,s,r,o,a){this.rocketSprite=null,this.platformSprite=null,Jt.call(this,t,e,i,n,s,r,o,a),this.platformSprite=new PIXI.Sprite(H.getTexture("spr_rocketlaunchplatform")),this.platformSprite.position.set(r.x,r.y-80),e.addChild(this.platformSprite),this.rocketSprite=new PIXI.Sprite(H.getTexture("spr_rocket")),this.rocketSprite.position.set(r.x,r.y-60),e.addChild(this.rocketSprite)};function _i(t,e,i,n,s,r,o,a){this.currentTexture=0,this.mirrored=!1,m.call(this,t,e,i,n,s,r,o,a)}function wi(t,e,i,n,s,r,o,a){this.currentTexture=0,this.mirrored=!1,m.call(this,t,e,i,n,s,r,o,a)}(V["buildings.RocketLaunchPlatform"]=yi).__name__="buildings.RocketLaunchPlatform",yi.__super__=Jt,yi.prototype=e(Jt.prototype,{destroy:function(){Jt.prototype.destroy.call(this),null!=this.platformSprite&&this.platformSprite.destroy(),null!=this.rocketSprite&&this.rocketSprite.destroy()},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.platformSprite&&this.platformSprite.position.set(this.position.x,this.position.y-80),null!=this.rocketSprite&&this.platformSprite.position.set(this.position.x,this.position.y-60)},work:function(t,e,i){i&&(t.currentAction=y.Nothing)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(yi.saveDefinition)},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:yi}),(V["buildings.RooftopDecoration"]=_i).__name__="buildings.RooftopDecoration",_i.__interfaces__=[fe],_i.__super__=m,_i.prototype=e(m.prototype,{get_drawerType:function(){return Ki},get_decorationDrawer:function(){return this.drawer},customize:function(t,e){this.currentTexture=t,this.mirrored=e},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Fr.getClass(this),!0,this.currentTexture,this.mirrored)},postCreate:function(){this.mirrored&&(this.mirror(),this.mirrored=!0),this.get_decorationDrawer().changeSubImage(this.currentTexture)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()},kn.lo("change_building_color")),dr.create(this.city.gui,fa(this,this.mirror),this.city.gui.windowInner,function(){return kn.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),m.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(_i.saveDefinition);e=this.mirrored;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.currentTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"mirrored")&&(this.mirrored=t.h.mirrored),Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture)},__class__:_i}),(V["buildings.RooftopDecoration2"]=wi).__name__="buildings.RooftopDecoration2",wi.__interfaces__=[fe],wi.__super__=m,wi.prototype=e(m.prototype,{get_drawerType:function(){return Ki},get_decorationDrawer:function(){return this.drawer},customize:function(t,e){this.currentTexture=t,this.mirrored=e},createOrRemoveBuilderForThis:function(){this.city.createOrRemoveBuilder(Fr.getClass(this),!0,this.currentTexture,this.mirrored)},postCreate:function(){this.mirrored&&(this.mirror(),this.mirrored=!0),this.get_decorationDrawer().changeSubImage(this.currentTexture)},mirror:function(){this.mirrored=!this.mirrored,this.drawer.mirror(),this.mirrored?this.doorX=14:this.doorX=4},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.currentTexture},function(t){e.currentTexture=t,e.get_decorationDrawer().changeSubImage(t)},function(){return e.get_decorationDrawer().getSubImageNumber()},kn.lo("change_building_color")),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),m.prototype.createWindowAddBottomButtons.call(this)},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(wi.saveDefinition);e=this.mirrored;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.currentTexture;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"mirrored")&&(this.mirrored=t.h.mirrored),Object.prototype.hasOwnProperty.call(t.h,"currentTexture")&&(this.currentTexture=t.h.currentTexture)},__class__:wi});var bi=function(t,e,i,n,s,r,o,a){this.schoolEndTime=16,this.schoolStartTime=7,Jt.call(this,t,e,i,n,s,r,o,a),this.students=[]};(V["buildings.School"]=bi).__name__="buildings.School",bi.__super__=Jt,bi.prototype=e(Jt.prototype,{get_studentCapacity:function(){return Math.round(30*this.city.policies.vars.schoolClassSizeMod)},get_educationPerDay:function(){return.07*this.city.policies.vars.schoolMaxEdu},get_educationCap:function(){return this.city.policies.vars.schoolMaxEdu},work:function(t,e,i){i?t.currentAction=y.Nothing:(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<i?t.relativeX=3:(e=3-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i))},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("students",[t.students.length,t.get_studentCapacity()])})},destroy:function(){Jt.prototype.destroy.call(this);for(var t=this.students.length;0<=--t;)this.students[t].leaveSchool()},afterGiveJob:function(t){this.city.simulation.schoolAssigner.schoolsShouldBeUpdated=!0},beAtSchool:function(t,e){if(!t.hasBuildingInited){switch(this.students.indexOf(t)%3){case 0:var i=bo.getInt(6,7);(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=i,t.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent;break;case 1:t.changeFloorAndMoveRandom(3,7);break;case 2:var n,s,i=bo.getInt(12,16);(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=i,t.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent}var r=this.get_educationPerDay(),o=this.get_educationCap();t.educationLevel=Math.max(Math.min(t.educationLevel+r,o),t.educationLevel),t.hasBuildingInited=!0}},__class__:bi});var vi=function(t,e,i,n,s,r,o,a){this.isCurrentlyActive=!1,this.mainTextureOther=0,this.mainTextureLeft=0,this.lightsAreOn=-1,this.knownEntertainedCitizenSet=0,this.knownEntertainedCitizen=null,this.hadLeftNightClub=!1,this.nightClubEntertainmentQuantity=0,this.mainTexturesLeft=H.getTexturesByWidth("spr_synightclub_lefttextures",20),this.mainTextures=H.getTexturesByWidth("spr_synightclub_maintextures",20),this.secondaryBackgroundSprites=[],this.mainTextureLeft=bo.getInt(this.mainTexturesLeft.length),this.mainTextureOther=bo.getInt(this.mainTextures.length),Jt.call(this,t,e,i,n,s,r,o,a),this.mainSprite=new PIXI.Sprite(this.mainTextures[this.mainTextureOther]),this.mainSprite.position.set(r.x,r.y),i.addChild(this.mainSprite),this.positionSprites(),this.startTime=20,this.endTime=5.5,this.workTimePreferenceMod=.5,this.isEntertainment=!0};function Si(t,e,i,n,s,r,o,a){this.isScenarioVariant=!1,this.givenStatueReward=!1,this.timeToCheckBuildings=0,this.currentMission=0,this.ownPub=null,this.manyTeleportAlpha=0,this.eventPhase=0,this.doingEvent=-1,this.lastEventDoneOnDay=0,te.call(this,t,e,i,n,s,r,o,a),this.startTime=12,this.endTime=2,this.workTimePreferenceMod=.3,this.isScenarioVariant="cityofthekey"==n.progress.story.storyName}function xi(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a)}(V["buildings.ScrapyardNightClub"]=vi).__name__="buildings.ScrapyardNightClub",vi.__interfaces__=[Kt],vi.__super__=Jt,vi.prototype=e(Jt.prototype,{get_baseEntertainmentCapacity:function(){return 120*this.workers.length},get_isOpen:function(){if(1!=this.workers.length||this.workers[0].currentAction!=y.Work)return!1;var t=this.city.simulation.time.timeSinceStart/60%24,e=this.startTime-this.workTimePreferenceMod;return e<6?e<=t&&t<6:e<=t||t<6},get_entertainmentType:function(){return 0},get_minimumNormalTimeToSpend:function(){return 5},get_maximumNormalTimeToSpend:function(){return 7},get_minimumEntertainmentGroupSatisfy:function(){return 1},get_maximumEntertainmentGroupSatisfy:function(){return 3},get_entertainmentQuality:function(){return 100},get_isOpenForExistingVisitors:function(){return this.get_isOpen()},finishEntertainment:function(t,e){return!0},get_drawerType:function(){return Vi},get_hasLeftNightClub:function(){return null!=this.leftBuilding&&this.leftBuilding.is(vi)},get_hasRightNightClub:function(){return null!=this.rightBuilding&&this.rightBuilding.is(vi)},reRegisterSecondaryImages:function(){for(var t,e,i,n,s=0,r=this.secondaryBackgroundSprites;s<r.length;){var o=r[s];++s,o.destroy()}if(this.secondaryBackgroundSprites.splice(0,this.secondaryBackgroundSprites.length),this.get_hasLeftNightClub())switch(this.mainTextureOther){case 0:(t=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=1.1,this.secondaryBackgroundSprites.push(t),this.bgStage.addChild(t),(e=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=1,this.secondaryBackgroundSprites.push(e),this.bgStage.addChild(e),(i=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=1.1,this.secondaryBackgroundSprites.push(i),this.bgStage.addChild(i),(n=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=1.3,this.secondaryBackgroundSprites.push(n),this.bgStage.addChild(n);var a=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"));a.scale.y=1,this.secondaryBackgroundSprites.push(a),this.bgStage.addChild(a),(s=[]).push({sprite:this.secondaryBackgroundSprites[0],blend:0}),s.push({sprite:this.secondaryBackgroundSprites[1],blend:60}),s.push({sprite:this.secondaryBackgroundSprites[2],blend:120}),s.push({sprite:this.secondaryBackgroundSprites[3],blend:180}),s.push({sprite:this.secondaryBackgroundSprites[4],blend:240}),this.lightColumnData=s;break;case 1:this.miniLightData=[];for(s=0;s<9;){var l=s++;(o=new PIXI.Sprite(H.getTexture("spr_synightclub_minilight"))).alpha=0,this.bgStage.addChild(o),this.secondaryBackgroundSprites.push(o),this.miniLightData.push({waitTime:bo.getInt(50),stage:0,sprite:o,alpha:0})}break;case 2:this.lightColumnData=[];for(s=0;s<6;){l=s++,o=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"));l<2?o.scale.y=1.2:l<4&&(o.scale.y=.7),o.alpha=0,this.bgStage.addChild(o),this.secondaryBackgroundSprites.push(o),this.lightColumnData.push({sprite:o,blend:120*l})}}else switch(this.mainTextureLeft){case 0:(t=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=.8,this.secondaryBackgroundSprites.push(t),this.bgStage.addChild(t),(e=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=.4,this.secondaryBackgroundSprites.push(e),this.bgStage.addChild(e),(i=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=.8,this.secondaryBackgroundSprites.push(i),this.bgStage.addChild(i),(n=new PIXI.Sprite(H.getTexture("spr_synightclub_lights"))).scale.y=.5,this.secondaryBackgroundSprites.push(n),this.bgStage.addChild(n),(s=[]).push({sprite:this.secondaryBackgroundSprites[0],blend:0}),s.push({sprite:this.secondaryBackgroundSprites[1],blend:72}),s.push({sprite:this.secondaryBackgroundSprites[2],blend:144}),s.push({sprite:this.secondaryBackgroundSprites[3],blend:216}),this.lightColumnData=s;break;case 1:this.waterfallBaseHue=(60*this.position.x+75*this.position.y)%360;var o=new PIXI.Sprite(H.getTexture("spr_synightclub_waterfalllight"));this.secondaryBackgroundSprites.push(o),this.bgStage.addChild(o);var o=new PIXI.Sprite(H.getTexture("spr_synightclub_waterfalllight"));this.secondaryBackgroundSprites.push(o),this.bgStage.addChild(o);var o=new PIXI.Sprite(H.getTexture("spr_synightclub_waterfalllight"));this.secondaryBackgroundSprites.push(o),this.bgStage.addChild(o);var h=new PIXI.Sprite(H.getTexture("spr_synightclub_waterfalllight_last"));this.secondaryBackgroundSprites.push(h),this.bgStage.addChild(h);break;case 2:this.lightColumnDataH=[],(o=new PIXI.Sprite(H.getTexture("spr_synightclub_lights_h"))).alpha=0,this.bgStage.addChild(o),this.secondaryBackgroundSprites.push(o),this.lightColumnDataH.push({sprite:o,blend:0,targetBlend:bo.getFloat(360)}),(o=new PIXI.Sprite(H.getTexture("spr_synightclub_lights_h"))).alpha=0,this.bgStage.addChild(o),this.secondaryBackgroundSprites.push(o),this.lightColumnDataH.push({sprite:o,blend:120,targetBlend:bo.getFloat(360)}),(o=new PIXI.Sprite(H.getTexture("spr_synightclub_lights_h"))).alpha=0,this.bgStage.addChild(o),this.secondaryBackgroundSprites.push(o),this.lightColumnDataH.push({sprite:o,blend:240,targetBlend:bo.getFloat(360)}),this.secondaryBackgroundSprites[0].scale.x=1.4,this.secondaryBackgroundSprites[1].scale.x=1.5,this.secondaryBackgroundSprites[2].scale.x=1.2}this.positionSprites(),this.activateOrDeactivateSprites(0<=this.lightsAreOn)},positionSprites:function(){if(Jt.prototype.positionSprites.call(this),null!=this.mainSprite&&this.mainSprite.position.set(this.position.x,this.position.y),this.get_hasLeftNightClub())switch(this.mainTextureOther){case 0:null!=this.secondaryBackgroundSprites&&5<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+2,this.position.y+3),this.secondaryBackgroundSprites[1].position.set(this.position.x+6,this.position.y+2),this.secondaryBackgroundSprites[2].position.set(this.position.x+10,this.position.y+3),this.secondaryBackgroundSprites[3].position.set(this.position.x+14,this.position.y+4),this.secondaryBackgroundSprites[4].position.set(this.position.x+17,this.position.y+2));break;case 1:null!=this.secondaryBackgroundSprites&&9<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x-1+3,this.position.y-1+3),this.secondaryBackgroundSprites[1].position.set(this.position.x-1+2,this.position.y-1+8),this.secondaryBackgroundSprites[2].position.set(this.position.x-1+3,this.position.y-1+14),this.secondaryBackgroundSprites[3].position.set(this.position.x-1+9,this.position.y-1+4),this.secondaryBackgroundSprites[4].position.set(this.position.x-1+7,this.position.y-1+9),this.secondaryBackgroundSprites[5].position.set(this.position.x-1+9,this.position.y-1+14),this.secondaryBackgroundSprites[6].position.set(this.position.x-1+14,this.position.y-1+4),this.secondaryBackgroundSprites[7].position.set(this.position.x-1+14,this.position.y-1+9),this.secondaryBackgroundSprites[8].position.set(this.position.x-1+13,this.position.y-1+14));break;case 2:null!=this.secondaryBackgroundSprites&&6<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+3,this.position.y+3),this.secondaryBackgroundSprites[1].position.set(this.position.x+4,this.position.y+3),this.secondaryBackgroundSprites[2].position.set(this.position.x+9,this.position.y+8),this.secondaryBackgroundSprites[3].position.set(this.position.x+10,this.position.y+8),this.secondaryBackgroundSprites[4].position.set(this.position.x+15,this.position.y+5),this.secondaryBackgroundSprites[5].position.set(this.position.x+16,this.position.y+5))}else switch(this.mainTextureLeft){case 0:null!=this.secondaryBackgroundSprites&&4<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+3,this.position.y+2),this.secondaryBackgroundSprites[1].position.set(this.position.x+7,this.position.y+4),this.secondaryBackgroundSprites[2].position.set(this.position.x+12,this.position.y+3),this.secondaryBackgroundSprites[3].position.set(this.position.x+16,this.position.y+4));break;case 1:null!=this.secondaryBackgroundSprites&&4<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+2,this.position.y+1),this.secondaryBackgroundSprites[1].position.set(this.position.x+6,this.position.y+5),this.secondaryBackgroundSprites[2].position.set(this.position.x+10,this.position.y+9),this.secondaryBackgroundSprites[3].position.set(this.position.x+15,this.position.y+13));break;case 2:null!=this.secondaryBackgroundSprites&&3<=this.secondaryBackgroundSprites.length&&(this.secondaryBackgroundSprites[0].position.set(this.position.x+4,this.position.y+3),this.secondaryBackgroundSprites[1].position.set(this.position.x+3,this.position.y+7),this.secondaryBackgroundSprites[2].position.set(this.position.x+6,this.position.y+11))}},updateSecondaryImages:function(t){if(this.get_hasLeftNightClub())switch(this.mainTextureOther){case 0:for(r=0,o=this.lightColumnData;r<o.length;){a=o[r];++r;n=[a.blend,.65,1],s=ra.toRgb(n);a.sprite.tint=Sn.toHexInt(s),a.blend=(a.blend+t)%360}break;case 1:for(r=0,o=this.miniLightData;r<o.length;){var e=o[r];switch(++r,e.stage){case 0:e.waitTime-=t,e.waitTime<=0&&(e.waitTime=0,n=[bo.getInt(360),bo.getFloat(.6,.9),1],s=ra.toRgb(n),e.sprite.tint=Sn.toHexInt(s),e.stage=1);break;case 1:e.alpha+=.1*t,1<=e.alpha&&(e.alpha=1,e.stage=2,e.waitTime=bo.getFloat(20,90)),e.sprite.alpha=e.alpha;break;case 2:e.waitTime-=t,e.waitTime<=0&&(e.waitTime=0,e.stage=3);break;case 3:e.alpha-=.1*t,e.alpha<=0&&(e.alpha=0,e.stage=0,e.waitTime=bo.getFloat(5)),e.sprite.alpha=e.alpha}}break;case 2:for(r=0;r<6;){var i=r++,n=[(a=this.lightColumnData[i]).blend,.75-.01*i,1],s=ra.toRgb(n);a.sprite.tint=Sn.toHexInt(s),a.blend=(a.blend+t*(i%2==0?1.5:-1.5)+360)%360}}else switch(this.mainTextureLeft){case 0:for(var r=0,o=this.lightColumnData;r<o.length;){var a=o[r];++r;var n=[a.blend,.65,1],s=ra.toRgb(n);a.sprite.tint=Sn.toHexInt(s),a.blend=(a.blend+t)%360}break;case 1:this.waterfallBaseHue+=.5*t;for(var l=0,r=0,o=this.secondaryBackgroundSprites;r<o.length;){var h=o[r];++r;var n=[(this.waterfallBaseHue+l)%360,.7,1];h.tint=Sn.toHexInt(ra.toRgb(n)),l+=25}break;case 2:for(var r=0,o=this.lightColumnDataH;r<o.length;){var a=o[r];++r;var n=[a.blend,.65,1],s=ra.toRgb(n);a.sprite.tint=Sn.toHexInt(s);var u=a.targetBlend-a.blend,d=0<u?1:u<0?-1:0;a.blend=(a.blend+(180<Math.abs(u)?-d:d)*t+360)%360,Math.abs(u)<2&&(a.targetBlend=bo.getFloat(360))}}},activateOrDeactivateSprites:function(t){if(!this.get_hasLeftNightClub()&&0==this.mainTextureLeft||!this.get_hasLeftNightClub()&&1==this.mainTextureLeft||!this.get_hasLeftNightClub()&&2==this.mainTextureLeft||this.get_hasLeftNightClub()&&0==this.mainTextureOther||this.get_hasLeftNightClub()&&2==this.mainTextureOther)for(var e=0,i=this.secondaryBackgroundSprites;e<i.length;){var n=i[e];++e,n.alpha=t?1:0}else if(this.get_hasLeftNightClub()&&1==this.mainTextureOther)for(e=0,i=this.miniLightData;e<i.length;){var s=i[e];++e,s.sprite.alpha=t?1:0,t||(s.alpha=0,s.stage=0)}},onCityChange:function(){var t;this.hadLeftNightClub!=this.get_hasLeftNightClub()&&(t=this.get_hasLeftNightClub()?this.mainTextures[this.mainTextureOther]:this.mainTexturesLeft[this.mainTextureLeft],this.mainSprite.texture=t,this.hadLeftNightClub=this.get_hasLeftNightClub(),this.reRegisterSecondaryImages())},postCreate:function(){Jt.prototype.postCreate.call(this);var t=this.get_hasLeftNightClub()?this.mainTextures[this.mainTextureOther]:this.mainTexturesLeft[this.mainTextureLeft];this.mainSprite.texture=t,this.hadLeftNightClub=this.get_hasLeftNightClub(),this.reRegisterSecondaryImages(),this.positionSprites()},destroy:function(){if(Jt.prototype.destroy.call(this),this.bgStage.removeChild(this.mainSprite),null!=this.secondaryBackgroundSprites)for(var t=0,e=this.secondaryBackgroundSprites;t<e.length;){var i=e[t];++t,i.destroy()}},work:function(t,e,i){i&&6<this.city.simulation.time.timeSinceStart/60%24?t.currentAction=y.Nothing:this.get_hasLeftNightClub()?(t.moveAndWait(bo.getInt(0,this.get_hasRightNightClub()?19:17),bo.getInt(20,50),null,!1,!1),this.lightsAreOn=60):(i=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(1-t.relativeX)<i?t.relativeX=1:(e=1-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*i),this.lightsAreOn=3)},beEntertained:function(t,e){null==this.knownEntertainedCitizen?(this.knownEntertainedCitizen=t,this.knownEntertainedCitizenSet=60):this.knownEntertainedCitizen==t&&(this.knownEntertainedCitizenSet=60);var i,n,s=bo.getInt(2+(this.get_hasLeftNightClub()?1:0)+(this.get_hasRightNightClub()?1:0));this.get_hasLeftNightClub()&&0==s&&this.leftBuilding.get_isOpen()?((n=0<(i=io.pool)[6].length?i[6].splice(i[6].length-1,1)[0]:new Int32Array(6))[0]=2,n[1]=0,n[2]=4,n[3]=bo.getInt(5,19),n[4]=8,n[5]=bo.getInt(5,6),t.setPath(n,0,6,!0)):this.get_hasRightNightClub()&&1==s&&this.rightBuilding.get_isOpen()?((n=0<(i=io.pool)[6].length?i[6].splice(i[6].length-1,1)[0]:new Int32Array(6))[0]=3,n[1]=0,n[2]=4,n[3]=bo.getInt(0,17),n[4]=8,n[5]=bo.getInt(5,6),t.setPath(n,0,6,!0)):(s=this.get_hasLeftNightClub()?0:5,i=this.get_hasRightNightClub()?19:17,null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(s,i),bo.getInt(8,9),null,n,!1)),t.hasBuildingInited||(t.wantsNightEntertainmentIn=bo.getInt(1,5),t.hasBuildingInited=!0)},createWindowAddBottomButtons:function(){var e=this;ur.create(this.city.gui,function(){return e.get_hasLeftNightClub()?e.mainTextureOther:e.mainTextureLeft},function(t){t=e.get_hasLeftNightClub()?(e.mainTextureOther=t,e.mainTextures[e.mainTextureOther]):(e.mainTextureLeft=t,e.mainTexturesLeft[e.mainTextureLeft]);e.mainSprite.texture=t,e.reRegisterSecondaryImages()},function(){return(e.get_hasLeftNightClub()?e.mainTextures:e.mainTexturesLeft).length},kn.lo("change_machines")),Jt.prototype.createWindowAddBottomButtons.call(this)},update:function(t){Jt.prototype.update.call(this,t),this.lightsAreOn-=Math.min(1,t);var e=0<this.lightsAreOn||1<=this.workers.length&&this.workers[0].inPermanent==this&&this.workers[0].currentAction==y.Work;e!=this.isCurrentlyActive&&(this.isCurrentlyActive=e,this.activateOrDeactivateSprites(this.isCurrentlyActive)),this.isCurrentlyActive&&this.updateSecondaryImages(t)},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(vi.saveDefinition);e=this.mainTextureLeft;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.mainTextureOther;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){Jt.prototype.load.call(this,t),t.version<15||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"mainTextureLeft")&&(this.mainTextureLeft=t.h.mainTextureLeft),Object.prototype.hasOwnProperty.call(t.h,"mainTextureOther")&&(this.mainTextureOther=t.h.mainTextureOther))},__class__:vi}),(V["buildings.SecretSocietyHouse"]=Si).__name__="buildings.SecretSocietyHouse",Si.__super__=te,Si.prototype=e(te.prototype,{onBuild:function(){this.city.progress.unlocks.unlock(pn)},addWindowInfoLines:function(){var t=this;te.prototype.addWindowInfoLines.call(this),this.city.gui.windowInner.addChild(new Cs(this.city.gui.window,new Cn(4,4))),this.isScenarioVariant||(this.city.gui.windowAddInfoText(null,function(){return t.missionGetTitle()},"Arial15"),this.city.gui.windowAddInfoText(null,function(){return t.missionGetText()}))},missionGetTitle:function(){return 8==this.currentMission?kn.lo("thank_you"):kn.lo("current_task")},missionGetText:function(){return 8<=this.currentMission?kn.lo("forever_grateful"):this.workers.length!=this.get_jobs()?kn.lo("jobs_filled_secretsociety"):kn.lo("secret_society_mission_"+this.currentMission)},checkMissionCompletions:function(){for(var t=!1;;){switch(t=!1,this.currentMission){case 0:t=vn.any(this.city.upgrades.upgrades,function(t){return t instanceof pn});break;case 1:t=vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("wood")],function(t){return 1e3<=t});break;case 6:(t=vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("knowledge")],function(t){return 1e3<=t}))&&this.city.progress.unlocks.unlock(Wi)}if(0!=this.currentMission&&1!=this.currentMission&&6!=this.currentMission&&this.currentMission<8&&this.timeToCheckBuildings<=0){var e=this.city.getAmountOfPermanentsPerType();switch(this.currentMission){case 2:(t=50<=e.h["buildings.BotanicalGardens"])&&this.city.progress.unlocks.unlock(Ci);break;case 3:t=12<=e.h["buildings.StatueGarden"];break;case 4:(t=7<=e.h["buildings.Teleporter"])&&this.city.progress.unlocks.unlock(Li);break;case 5:t=5<=e.h["buildings.Villa"];break;case 7:t=1<=e.h["buildings.TheMachine"]}this.timeToCheckBuildings=30}if(t&&(this.currentMission+=1,this.timeToCheckBuildings=0,this.city.progress.goalHelp.updateHasBuildingGoal()),!t)break}},update:function(t){if(te.prototype.update.call(this,t),1==this.doingEvent&&1<=this.eventPhase)if(this.manyTeleportAlpha<1){this.manyTeleportAlpha+=.05;for(var e=0,i=this.workers;e<i.length;){var n=i[e];++e,n.sprite.alpha=this.manyTeleportAlpha}}else{this.doingEvent=-1;for(e=this.eventPhase=0,i=this.workers;e<i.length;){n=i[e];++e,n.sprite.alpha=1}}if(this.isScenarioVariant||this.checkMissionCompletions(),this.timeToCheckBuildings-=t,!this.givenStatueReward)for(e=0,i=this.workers;e<i.length;){n=i[e];++e,500<=n.get_age()&&(this.givenStatueReward||this.city.progress.unlocks.unlock(Ti),this.givenStatueReward=!0)}},work:function(t,e,i){var n,s,r=this;if(-1!=this.doingEvent){if(1==this.doingEvent){if(0==this.eventPhase)if(vn.all(this.workers,function(t){return!(null==t.inPermanent||!t.inPermanent.is(Ai)||t.relativeX!=t.inPermanent.teleportX||null!=t.path)&&!t.isRequestingPath})){this.eventPhase=1;for(var o=0,a=this.workers;o<a.length;){var l=a[o];++o;var h=l.inPermanent;null!=h&&(h.createTeleportParticle("spr_teleporter_ray_key"),h.timesUsed+=1),l.onWorld=this.world,l.setRelativePos(bo.getInt(this.world.rect.width-2),0),l.inPermanent=null,l.addToOnWorldStage(),l.sprite.alpha=0,this.manyTeleportAlpha=0}}else null!=t.inPermanent&&t.inPermanent.is(Ai)?(n=t.inPermanent.teleportX,s=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(n-t.relativeX)<s?t.relativeX=n:(n=n-t.relativeX,t.relativeX+=(0<n?1:n<0?-1:0)*s)):null==(s=this.city.simulation.permanentFinder.quickQueryForCitizen(t,function(t){return t.is(Ai)},"secretSocietyTeleporterQuery"+this.id,3))?this.doingEvent=-1:(t.simulation.pathfinder.findPath(t,s),t.pathOnFail=null);return}if(2==this.doingEvent){if(null!=t.inPermanent&&t.inPermanent==this.ownPub)return""==(d=t.inPermanent).markingTexture&&d.setMarking("spr_pub_marking_key"),void(5<=((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&((0|this.city.simulation.time.timeSinceStart)/60|0)%24<10?this.doingEvent=-1:d.beEntertained(t,e));var u=!0;if(null!=this.ownPub&&this.ownPub.destroyed&&(this.ownPub=null),null==this.ownPub)for(o=0,a=this.city.permanents;o<a.length;){var d,c=a[o];if(++o,c.is(gi)){if("spr_pub_marking_key"==(d=c).markingTexture){this.ownPub=d;break}u=!1}}return null!=this.ownPub||u||(null==(e=this.city.simulation.permanentFinder.quickQueryForCitizen(t,function(t){return!!t.is(gi)&&""==t.markingTexture},"secretSocietyPub"+this.id,3))?this.doingEvent=-1:this.ownPub=e),void(null!=this.ownPub&&(t.simulation.pathfinder.findPath(t,this.ownPub),t.pathOnFail=function(){r.doingEvent=-1}))}}if(t.inPermanent!=this)return t.simulation.pathfinder.findPath(t,this),void(t.pathOnFail=null);i?t.currentAction=y.Nothing:(this.walkAround(t,150),15<((0|this.city.simulation.time.timeSinceStart)/60|0)%24&&1+((0|this.city.simulation.time.timeSinceStart)/1440|0)>this.lastEventDoneOnDay&&(this.doingEvent=bo.getInt(1,3),this.eventPhase=0,this.lastEventDoneOnDay=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)))},walkAround:function(t,e){var i=bo.getInt(5);0==i&&120<e?t.changeFloorAndWaitRandom(30,60):1==i||2==i&&t.relativeY<5?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},getGlobalGoal:function(){return 8==this.currentMission||this.isScenarioVariant?null:{category:kn.lo("secret_society_mission"),text:this.missionGetText()}},save:function(t,e){null==e&&(e=!0),te.prototype.save.call(this,t),e&&t.addString(Si.saveDefinition);e=this.lastEventDoneOnDay;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.doingEvent;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.eventPhase;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.currentMission;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){te.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"lastEventDoneOnDay")&&(this.lastEventDoneOnDay=t.h.lastEventDoneOnDay),Object.prototype.hasOwnProperty.call(t.h,"doingEvent")&&(this.doingEvent=t.h.doingEvent),Object.prototype.hasOwnProperty.call(t.h,"eventPhase")&&(this.eventPhase=t.h.eventPhase),Object.prototype.hasOwnProperty.call(t.h,"currentMission")&&(this.currentMission=t.h.currentMission)},__class__:Si}),(V["buildings.ShadyHome"]=xi).__name__="buildings.ShadyHome",xi.__super__=Yt,xi.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[]},walkAround:function(t,e){var i,n=bo.getInt(3);0==n&&120<e?t.changeFloorAndWaitRandom(30,60):1==n?t.relativeY<5?0==(i=bo.getInt(3))?t.moveAndWait(bo.getInt(3,5),bo.getInt(30,60),null,!1,!1):1==i?t.moveAndWait(bo.getInt(9,10),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(14,15),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(5,15),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},__class__:xi});var Pi=function(t,e,i,n,s,r,o,a){Yt.call(this,t,e,i,n,s,r,o,a)};(V["buildings.SpaciousHouse"]=Pi).__name__="buildings.SpaciousHouse",Pi.__super__=Yt,Pi.prototype=e(Yt.prototype,{get_possibleUpgrades:function(){return[Ot,Rt]},walkAround:function(t,e){var i=bo.getInt(3);0==i&&120<e?t.changeFloorAndWaitRandom(30,60):1==i?t.relativeY<5?t.moveAndWait(bo.getInt(3,15),bo.getInt(30,60),null,!1,!1):1==bo.getInt(2)?t.moveAndWait(bo.getInt(3,7),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},update:function(t){Yt.prototype.update.call(this,t)},__class__:Pi});var Ci=function(t,e,i,n,s,r,o,a){this.mirrored=!1,ci.call(this,t,e,i,n,s,r,o,a)};function Ii(t,e,i,n,s,r,o,a){ci.call(this,t,e,i,n,s,r,o,a),this.currentTexture=0,this.parkSprite.texture=this.parkTextures[this.currentTexture]}(V["buildings.StatueGarden"]=Ci).__name__="buildings.StatueGarden",Ci.__super__=ci,Ci.prototype=e(ci.prototype,{get_myParkTextures:function(){return"spr_statuegarden_statues"},get_changePlantsText:function(){return kn.lo("change_sculptures")},get_entertainmentType:function(){return 2},get_baseEntertainmentCapacity:function(){return 40},get_numberOfLockedParkTextures:function(){return 0},postLoad:function(){ci.prototype.postLoad.call(this),this.mirrored&&this.mirrorSprite()},mirrorSprite:function(){this.mirrored?(this.parkSprite.anchor.set(1,0),this.parkSprite.scale.set(-1,1)):(this.parkSprite.anchor.set(0,0),this.parkSprite.scale.set(1,1)),this.bgStage.isInvalid=!0},createWindowAddBottomButtons:function(){var t=this;dr.create(this.city.gui,function(){t.mirrored=!t.mirrored,t.mirrorSprite()},this.city.gui.windowInner,function(){return kn.lo("mirror")},this.city.gui.innerWindowStage),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,4))),ci.prototype.createWindowAddBottomButtons.call(this)},addWindowInfoLines:function(){var e=this;ci.prototype.addWindowInfoLines.call(this);var i=!1,n=new ds(this.city.gui,this.city.gui.innerWindowStage,this.city.gui.windowInner),s=null;this.city.gui.windowInner.addChild(n),this.city.gui.windowInner.onUpdate=function(){var t;0==e.currentTexture?i||(i=!0,(s=new ds(e.city.gui,e.city.gui.innerWindowStage,n)).direction=vs.Vertical,s.addChild(new Cs(s,new Cn(2,6))),s.addChild(new Qs(s,e.city.gui.innerWindowStage,kn.lo("dev_message"),null,"Arial15")),s.addChild(new Qs(s,e.city.gui.innerWindowStage,kn.lo("climate_crisis_message_1"))),t=null,t=function(){e.city.gui.createWindow("climateCrisisWindow",H.getTexture("spr_9p_window_moreopaque")),e.city.gui.addWindowToStack(t),as.create(e.city,e.city.gui,e.city.gui.innerWindowStage,e.city.gui.windowInner)},s.addChild(new Ks(e.city.gui,e.city.gui.innerWindowStage,s,t,kn.lo("see_what_you_can_do"))),s.addChild(new Cs(s,new Cn(2,6))),n.addChild(s),e.city.gui.setWindowPositioning(nr.CenterOffset(s.rect.height/2|0))):i&&(i=!1,n.removeChild(s),e.city.gui.setWindowPositioning(nr.Center))}},save:function(t,e){null==e&&(e=!0),ci.prototype.save.call(this,t),e&&t.addString(Ci.saveDefinition);var i=this.mirrored;t.size+1>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,e,0,t.size)),t.bytes.b[t.size]=i?1:0,t.size+=1},load:function(t,e){ci.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"mirrored")&&(this.mirrored=t.h.mirrored),this.postLoad()},__class__:Ci}),(V["buildings.StatueOfHappiness"]=Ii).__name__="buildings.StatueOfHappiness",Ii.__super__=ci,Ii.prototype=e(ci.prototype,{get_myParkTextures:function(){return"spr_statueofhappiness"},get_changePlantsText:function(){return kn.lo("change_statue")},get_entertainmentType:function(){return 2},get_baseEntertainmentCapacity:function(){return 80},get_numberOfLockedParkTextures:function(){return 0},save:function(t,e){null==e&&(e=!0),ci.prototype.save.call(this,t),e&&t.addString(Ii.saveDefinition)},load:function(t,e){ci.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Ii});var Ti=function(t,e,i,n,s,r,o,a){ci.call(this,t,e,i,n,s,r,o,a),this.currentTexture=0,this.parkSprite.texture=this.parkTextures[this.currentTexture]};function Bi(t,e,i,n,s,r,o,a){this.stoneMinedPerActionBoost=1,oe.call(this,t,e,i,n,s,r,o,a)}(V["buildings.StatueOfTheKey"]=Ti).__name__="buildings.StatueOfTheKey",Ti.__super__=ci,Ti.prototype=e(ci.prototype,{get_myParkTextures:function(){return"spr_statueofthekey"},get_changePlantsText:function(){return kn.lo("change_statue")},get_entertainmentType:function(){return 2},get_baseEntertainmentCapacity:function(){return 80},get_numberOfLockedParkTextures:function(){return 0},save:function(t,e){null==e&&(e=!0),ci.prototype.save.call(this,t),e&&t.addString(Ti.saveDefinition)},load:function(t,e){ci.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Ti}),(V["buildings.StoneMine"]=Bi).__name__="buildings.StoneMine",Bi.__super__=oe,Bi.prototype=e(oe.prototype,{get_stoneMinedPerAction:function(){return.2*this.stoneMinedPerActionBoost},get_possibleUpgrades:function(){return[it,J]},work:function(t,e,i){var n=this;this.doBlueCollarJob(t,e,i,[da,Mi],function(t){var e=n.get_stoneMinedPerAction(),i=n.city.simulation,i=e*(n.city.progress.story.hiddenBoost&&n.city.materials.stone<=4?k.earlyGameFix1?1.6:2:1)*n.city.upgrades.vars.stoneMiningSpeed*(k.earlyGameFix1&&i.citizens.length<30?1.3-i.citizens.length/60*.3:1)*n.city.simulation.boostManager.currentGlobalBoostAmount;n.city.materials.stone+=i,n.city.simulation.stats.materialProduction[2][0]+=i,t.materialsLeft-=i},90,120)},__class__:Bi});var ki=function(t,e,i,n,s,r,o,a){this.hasPickaxeTech=!1,this.currentBonus=0,this.totalKnowledgeGenerated=0,Jt.call(this,t,e,i,n,s,r,o,a)};(V["buildings.StoneResearchCenter"]=ki).__name__="buildings.StoneResearchCenter",ki.__super__=Jt,ki.prototype=e(Jt.prototype,{get_possibleUpgrades:function(){return[zt,mt]},postCreate:function(){this.recalculateBonus()},work:function(t,e,i){i?t.currentAction=y.Nothing:0==(i=bo.getInt(3))?t.changeFloorAndWait(50):1==i?t.moveAndWait(bo.getInt(3,7),bo.getInt(50,80),null,!1,!1):2==i&&t.moveAndWait(bo.getInt(12,16),bo.getInt(50,80),null,!1,!1)},update:function(t){this.recalculateBonus()},recalculateBonus:function(){this.currentBonus=0;var t=this.city.simulation.stats.materialProduction[z.findMaterialIndex("knowledge")],e=0;2<=t.length?e=t[1]:1<=t.length&&(e=t[0]);var i=this.hasPickaxeTech?195:200,n=this.hasPickaxeTech?.1:.075,t=this.hasPickaxeTech?1.65:2;this.currentBonus=e<i?e/i*.15:Math.log(e/i)/Math.log(t)*n+.15,this.hasPickaxeTech&&(this.currentBonus+=25e-6*e),this.currentBonus*=this.workers.length/this.get_jobs(),this.currentBonus=Math.max(0,this.currentBonus),this.city.upgrades.vars.stoneMiningSpeed=1+this.currentBonus},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return t.recalculateBonus(),kn.lo("stone_mining_boost",[100*t.currentBonus|0])}),this.city.gui.windowAddInfoText(kn.lo("stone_mining_boost_base")),this.city.upgrades.vars.stoneResearchCenterWithFossils==this&&this.city.gui.windowAddInfoText(null,function(){return kn.lo("fossils_found",[0|t.city.simulation.bonuses.fossilsCollected])})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(ki.saveDefinition);var i=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated)},__class__:ki}),s=function(){},(V["worldResources.ILimitedMaterialGatherPlace"]=s).__name__="worldResources.ILimitedMaterialGatherPlace",s.__isInterface__=!0,s.prototype={__class__:s};var Mi=function(t,e,i,n,s,r,o,a){this.hasBigStone=!1,this.hasRemoteControl=!1,this.teleportButtonNotPressedTime=0,this.teleportButtonPressed=!1,this.maxCitizenX=13,this.minCitizenX=5,this.initialMaterials=50,Jt.call(this,t,e,i,n,s,r,o,a),this.updateStoneTextures(),this.stoneSprite=new PIXI.Sprite(this.stoneTextures[0]),i.addChild(this.stoneSprite),this.positionSprites(),this.doorX=12,this.materialsLeft=0,this.regrowProgress=0,this.teleportButtonNotPressedTime=0,this.updateTexture()};(V["buildings.StoneTeleporter"]=Mi).__name__="buildings.StoneTeleporter",Mi.__interfaces__=[s],Mi.__super__=Jt,Mi.prototype=e(Jt.prototype,{get_destroyedOnEmpty:function(){return!1},get_resourceName:function(){return"stone"},get_doNotGather:function(){return!1},get_regrowSpeed:function(){return 0},get_stayIfEmpty:function(){return!0},get_possibleUpgrades:function(){return[Lt]},postLoad:function(){this.hasBigStone&&(this.initialMaterials=150,this.updateStoneTextures()),this.updateTexture()},work:function(t,e,i){var n,s=this;i?t.currentAction=y.Nothing:(this.hasRemoteControl||(n=t.pathWalkSpeed*e,I.shouldUpdateDraw=!0,Math.abs(3-t.relativeX)<n?t.relativeX=3:(e=3-t.relativeX,t.relativeX+=(0<e?1:e<0?-1:0)*n)),this.materialsLeft<=0?(this.teleportButtonPressed=!0,this.teleportButtonNotPressedTime=0):this.hasRemoteControl&&(null==(n=!0)&&(n=!1),t.moveAndWait(bo.getInt(this.minCitizenX,this.maxCitizenX),bo.getInt(90,120),function(){var t;0<s.materialsLeft&&(t=.2*s.city.simulation.boostManager.currentGlobalBoostAmount*s.city.upgrades.vars.stoneMiningSpeed,s.materialsLeft-=t,s.city.materials.stone+=t,s.city.simulation.stats.materialProduction[2][0]+=t),s.updateTexture()},n,!1)))},update:function(t){Jt.prototype.update.call(this,t),this.materialsLeft<=0&&(this.teleportButtonPressed?(0==this.regrowProgress&&(this.hasBigStone=this.city.upgrades.vars.stoneTeleporterHasBigStones,this.updateStoneTextures()),this.regrowProgress+=2*t,100<=this.regrowProgress&&(this.regrowProgress=0,this.hasBigStone&&(this.initialMaterials=150),this.materialsLeft=this.initialMaterials,this.teleportButtonPressed=!1,this.teleportButtonNotPressedTime=0,null!=this.city.upgrades.vars.stoneResearchCenterWithFossils&&bo.getFloat()<1e-5*this.initialMaterials&&(this.city.materials.knowledge+=1e4,this.city.simulation.stats.materialProduction[9][0]+=1e4,this.city.simulation.bonuses.fossilsCollected++)),this.updateTexture()):this.hasRemoteControl&&0<this.workers.length?(this.teleportButtonPressed=!0,this.teleportButtonNotPressedTime=0):this.teleportButtonNotPressedTime+=t)},destroy:function(){Jt.prototype.destroy.call(this),this.bgStage.removeChild(this.stoneSprite)},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.stoneSprite&&this.stoneSprite.position.set(this.position.x,this.position.y)},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return 0<t.materialsLeft||!t.teleportButtonPressed&&t.teleportButtonNotPressedTime<3?kn.lo("stone_left",[0|t.materialsLeft]):t.teleportButtonPressed?kn.lo("teleporting_meteroid"):kn.lo("waiting_for_worker_teleport")})},updateStoneTextures:function(){this.stoneTextures=H.getTexturesByWidth(this.hasBigStone?"spr_stoneteleporter_stone_big":"spr_stoneteleporter_stone",20)},updateTexture:function(){var t,e,i,n,s;this.materialsLeft<=0?(this.stoneSprite.texture=this.stoneTextures[0],this.stoneSprite.alpha=this.regrowProgress/100):(t=this.materialsLeft,e=this.initialMaterials,i=this.stoneTextures,n=this.stoneSprite,t<=1e-7?n.texture=i[i.length-1]:(s=Math.floor((e-t)/e*i.length),e!=t&&0==s&&1<i.length&&(s=1),n.texture=i[s]),this.stoneSprite.alpha=1),null==this.stoneSprite.texture&&console.log("FloatingSpaceCities/buildings/StoneTeleporter.hx:205:",kn.lo("something_went_wrong_stone"))},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Mi.saveDefinition);e=this.regrowProgress;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.materialsLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.hasBigStone;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"regrowProgress")&&(this.regrowProgress=t.h.regrowProgress),Object.prototype.hasOwnProperty.call(t.h,"materialsLeft")&&(this.materialsLeft=t.h.materialsLeft),Object.prototype.hasOwnProperty.call(t.h,"hasBigStone")&&(this.hasBigStone=t.h.hasBigStone),this.postLoad()},__class__:Mi});var zi=function(t,e,i,n,s,r,o,a){this.numberOfLabs=0,this.knowledgeSoFar=0,m.call(this,t,e,i,n,s,r,o,a)};(V["buildings.Supercomputer"]=zi).__name__="buildings.Supercomputer",zi.__super__=m,zi.prototype=e(m.prototype,{get_knowledgePerDay:function(){return 2*this.city.simulation.stats.peopleWorkingAtLabs},get_possibleCityUpgrades:function(){return[yn,cn,dn]},update:function(t){t=t*(this.get_knowledgePerDay()/(1440/this.city.simulation.time.minutesPerTick))*this.city.simulation.boostManager.currentGlobalBoostAmount;this.city.materials.knowledge+=t,this.city.simulation.stats.materialProduction[9][0]+=t,this.knowledgeSoFar+=t},onCityChange:function(){this.numberOfLabs=tt.count(this.city.permanents,function(t){return t.is(qe)})},addWindowInfoLines:function(){var t=this;m.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered_per_day",[0|t.get_knowledgePerDay()])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered_so_far",[0|t.knowledgeSoFar])})},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(zi.saveDefinition);var i=this.knowledgeSoFar;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"knowledgeSoFar")&&(this.knowledgeSoFar=t.h.knowledgeSoFar)},__class__:zi});var Ai=function(t,e,i,n,s,r,o,a){this.teleportX=9,this.timesUsedTo=0,this.timesUsed=0,m.call(this,t,e,i,n,s,r,o,a),this.doorX=12,n.teleporters.push(this)};(V["buildings.Teleporter"]=Ai).__name__="buildings.Teleporter",Ai.createUpkeepInfo=function(t,e){e.windowInner.addChild(new Cs(e.windowInner,new Cn(2,4))),e.windowAddInfoText(null,function(){return kn.lo("teleporters_operating_cost",[t.simulation.operatingCost.getWholeCityOperatingCostTeleporters().knowledge])});dr.create(e,function(){t.simulation.operatingCost.teleportersEnabled||!t.simulation.operatingCost.teleportersAreUserEnabled?t.simulation.operatingCost.changeTeleportersEnabledState(!t.simulation.operatingCost.teleportersEnabled,!0):t.simulation.operatingCost.teleportersAreUserEnabled?t.simulation.operatingCost.changeTeleportersEnabledState(!1,!0):e.showSimpleWindow(kn.lo("cant_enable_teleporters"),null,!0)},e.windowInner,function(){return t.simulation.operatingCost.teleportersEnabled?kn.lo("disable_all_teleporters"):t.simulation.operatingCost.teleportersAreUserEnabled?kn.lo("keep_teleporters_disabled"):kn.lo("enable_all_teleporters")},e.innerWindowStage);e.windowInner.addChild(new Cs(e.windowInner,new Cn(2,4)))},Ai.__super__=m,Ai.prototype=e(m.prototype,{get_typeID:function(){return 1},destroy:function(){Y.remove(this.city.teleporters,this),m.prototype.destroy.call(this)},addWindowInfoLines:function(){var t=this;m.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("teleported_from",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("teleported_to",[t.timesUsedTo])}),Ai.createUpkeepInfo(this.city,this.city.gui)},createTeleportParticle:function(t){null==t&&(t="spr_teleporter_ray"),this.city.particles.addParticle(H.getTexturesByWidth(t,4),new Cn(this.position.x+8,this.position.y+4))},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(Ai.saveDefinition);e=this.timesUsed;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.timesUsedTo;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"timesUsed")&&(this.timesUsed=t.h.timesUsed),Object.prototype.hasOwnProperty.call(t.h,"timesUsedTo")&&(this.timesUsedTo=t.h.timesUsedTo)},__class__:Ai}),Ue=function(t,e,i,n,s,r,o,a){m.call(this,t,e,i,n,s,r,o,a)},(V["buildings.TheContraption"]=Ue).__name__="buildings.TheContraption",Ue.__super__=m,Ue.prototype=e(m.prototype,{__class__:Ue});var Wi=function(t,e,i,n,s,r,o,a){this.totalMaterialReward=null,this.thisDayMaterialReward=null,this.lastDayReward=-1,this.animProgress=0,this.secretSocietyFriendsHouse=null,this.secretSocietyHouse=null,m.call(this,t,e,i,n,s,r,o,a),this.bgTextures=H.getTexturesByWidth("spr_secretsocietymachine_anim",20),this.backSprite=new PIXI.Sprite(this.bgTextures[0]),this.backSprite.position.set(r.x,r.y),i.addChild(this.backSprite),this.totalMaterialReward=new M};(V["buildings.TheMachine"]=Wi).__name__="buildings.TheMachine",Wi.__super__=m,Wi.prototype=e(m.prototype,{update:function(t){if(null!=this.secretSocietyHouse&&!this.secretSocietyHouse.destroyed||(this.secretSocietyHouse=tt.find(this.city.permanents,function(t){return t.is(Si)})),null!=this.secretSocietyHouse)for(var e=0,i=this.secretSocietyHouse.workers;e<i.length;){var n=i[e];++e,n.dieAgeModifier=n.get_age()-75+3}if(null!=this.secretSocietyFriendsHouse&&!this.secretSocietyFriendsHouse.destroyed||(this.secretSocietyFriendsHouse=tt.find(this.city.permanents,function(t){return t.is(Ve)})),null!=this.secretSocietyFriendsHouse)for(e=0,i=this.secretSocietyFriendsHouse.residents;e<i.length;){n=i[e];++e,n.dieAgeModifier=n.get_age()-75+3}var s,r,o=4*this.bgTextures.length*2+480+180;this.animProgress=(this.animProgress+t)%o,this.animProgress<480?this.backSprite.texture=this.bgTextures[(Math.floor(this.animProgress)/4|0)%2]:this.animProgress-480-180>4*this.bgTextures.length?(s=this.bgTextures.length-1-(Math.floor(this.animProgress-4*this.bgTextures.length-480-180)/4|0),r=this.bgTextures.length-1,this.backSprite.texture=this.bgTextures[s<0?0:r<s?r:s]):this.animProgress-480>4*this.bgTextures.length?this.backSprite.texture=this.bgTextures[this.bgTextures.length-1]:(s=Math.floor(this.animProgress-480)/4|0,r=this.bgTextures.length-1,this.backSprite.texture=this.bgTextures[s<0?0:r<s?r:s]),this.lastDayReward!=1+((0|this.city.simulation.time.timeSinceStart)/1440|0)&&this.setReward()},setReward:function(){var t;switch(bo.getInt(10)){case 0:t=new M(bo.getInt(150,301));break;case 1:t=new M(0,bo.getInt(100,501));break;case 2:t=new M(0,0,bo.getInt(200,2001));break;case 3:t=new M(bo.getInt(100,301),bo.getInt(50,301),bo.getInt(25,201));break;case 4:t=new M(bo.getInt(100,201),bo.getInt(150,251));break;case 5:t=new M(0,0,0,bo.getInt(20,31));break;case 6:t=new M(0,0,0,0,0,bo.getInt(40,81));break;case 7:t=new M(0,0,0,0,0,0,bo.getInt(5,11));break;case 8:t=new M(0,0,0,bo.getInt(15,31),0,bo.getInt(20,51));break;default:switch(bo.getInt(5)){case 0:t=new M(bo.getInt(500,1501),0,bo.getInt(1e3,2001));break;case 1:t=new M(0,0,0,0,bo.getInt(500,1501));break;case 2:t=new M(0,bo.getInt(1e3,2001),0,bo.getInt(50,101),0);break;case 3:t=new M(0,0,0,0,0,bo.getInt(200,301));break;default:switch(bo.getInt(5)){case 0:t=new M(1e3,0,1e3,20,0,40,16);break;case 1:t=new M(0,0,0,0,0,0,100);break;case 2:t=new M(0,0,0,0,0,1e3);break;case 3:t=new M(0,1e4);break;default:t=new M(1e3,1e3,1e3,500)}}}this.thisDayMaterialReward=t,this.thisDayMaterialReward.multiply(this.city.simulation.boostManager.currentGlobalBoostAmount),this.lastDayReward=1+((0|this.city.simulation.time.timeSinceStart)/1440|0),this.thisDayMaterialReward.addToProduction(this.city.simulation.stats),this.city.materials.add(this.thisDayMaterialReward),this.totalMaterialReward.add(this.thisDayMaterialReward)},addWindowInfoLines:function(){var t=this;null==this.thisDayMaterialReward&&this.setReward(),m.prototype.addWindowInfoLines.call(this);var e=this.lastDayReward,i=this.lastDayReward;this.city.gui.windowAddInfoText(kn.lo("today_production"));var n=new Us(this.thisDayMaterialReward),s=null,s=new us(this.city.gui.windowInner,this.city.gui.innerWindowStage,n,null,function(){t.lastDayReward!=e&&(n.setMaterials(t.thisDayMaterialReward),e=t.lastDayReward,s.updateSize())});this.city.gui.windowInner.addChild(s),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),this.city.gui.windowAddInfoText(kn.lo("total_production"));var r=new Us(this.totalMaterialReward),o=null,o=new us(this.city.gui.windowInner,this.city.gui.innerWindowStage,r,null,function(){t.lastDayReward!=i&&(r.setMaterials(t.totalMaterialReward),i=t.lastDayReward,o.updateSize())});this.city.gui.windowInner.addChild(o),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,6))),this.city.gui.windowAddInfoText(null,function(){return((0|t.city.simulation.time.timeSinceStart)/60|0)%24==23?kn.lo("next_production_in_1"):kn.lo("next_production_in_n",[24-((0|t.city.simulation.time.timeSinceStart)/60|0)%24])})},positionSprites:function(){m.prototype.positionSprites.call(this),null!=this.backSprite&&this.backSprite.position.set(this.position.x,this.position.y)},destroy:function(){m.prototype.destroy.call(this),null!=this.backSprite&&this.bgStage.removeChild(this.backSprite)},save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(Wi.saveDefinition);e=this.animProgress;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.lastDayReward;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,t.addString(fr.run(this.thisDayMaterialReward)),t.addString(fr.run(this.totalMaterialReward))},load:function(t,e){m.prototype.load.call(this,t),t.version<8||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"animProgress")&&(this.animProgress=t.h.animProgress),Object.prototype.hasOwnProperty.call(t.h,"lastDayReward")&&(this.lastDayReward=t.h.lastDayReward),Object.prototype.hasOwnProperty.call(t.h,"thisDayMaterialReward")&&(this.thisDayMaterialReward=t.h.thisDayMaterialReward),Object.prototype.hasOwnProperty.call(t.h,"totalMaterialReward")&&(this.totalMaterialReward=t.h.totalMaterialReward))},__class__:Wi});var Fi=function(t,e,i,n,s,r,o,a){this.backTextureUsed=0,this.frontTextureUsed=0,Yt.call(this,t,e,i,n,s,r,o,a),null==Fi.frontTextures&&(Fi.frontTextures=H.getTexturesByWidth("spr_tinkerershouse_front_alt",20),Fi.backTextures=H.getTexturesByWidth("spr_tinkerershouse_back_alt",20)),this.frontTextureUsed=bo.getInt(Fi.frontTextures.length),this.backTextureUsed=bo.getInt(Fi.backTextures.length),this.get_customizableDrawer().setCustomTextures(Fi.frontTextures[this.frontTextureUsed],null,Fi.backTextures[this.backTextureUsed])};function Oi(t,e,i,n,s,r,o,a){m.call(this,t,e,i,n,s,r,o,a)}function Di(t,e,i,n,s,r,o,a){this.parkSprite=null,Yt.call(this,t,e,i,n,s,r,o,a),this.parkSprite=new PIXI.Sprite(H.getTexture("spr_treehuggerbase")),this.parkSprite.position.set(r.x,r.y),i.addChild(this.parkSprite)}function Ri(t,e,i,n,s,r,o,a){this.regrowSpeedBoost=1,this.initialMaterials=100,this.regrowProgress=0,this.maxCitizenX=14,this.minCitizenX=4,Jt.call(this,t,e,i,n,s,r,o,a),this.materialsLeft=0,this.treesCutTextures=H.getTexturesByWidth("spr_treeplantation_trees",20),this.regrowTextures=H.getTexturesByWidth("spr_treeplantation_trees_grow",20),this.treesSprite=new PIXI.Sprite(this.regrowTextures[0]),this.treesSprite.position.set(r.x,r.y),i.addChild(this.treesSprite)}(V["buildings.TinkerersHome"]=Fi).__name__="buildings.TinkerersHome",Fi.__super__=Yt,Fi.prototype=e(Yt.prototype,{get_drawerType:function(){return qi},get_customizableDrawer:function(){return this.drawer},get_possibleUpgrades:function(){return[nt]},onBuild:function(){Yt.prototype.onBuild.call(this),this.city.progress.unlocks.unlock(un)},postLoad:function(){this.get_customizableDrawer().setCustomTextures(Fi.frontTextures[this.frontTextureUsed],null,Fi.backTextures[this.backTextureUsed])},walkAround:function(t,e){t.hasBuildingInited||(t.educationLevel=Math.max(Math.min(t.educationLevel+.01,1.25),t.educationLevel),t.hasBuildingInited=!0);var i=bo.getInt(6);i<2&&120<e?t.changeFloorAndWaitRandom(30,60):2==i||3==i||e<10?t.relativeY<5?2==i?t.moveAndWait(bo.getInt(3,6),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(15,16),bo.getInt(30,60),null,!1,!1):2==i?t.moveAndWait(bo.getInt(3,6),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(12,16),bo.getInt(30,60),null,!1,!1):((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=8,i[1]=bo.getInt(90,120),t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(Fi.saveDefinition);e=this.frontTextureUsed;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.backTextureUsed;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){Yt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"frontTextureUsed")&&(this.frontTextureUsed=t.h.frontTextureUsed),Object.prototype.hasOwnProperty.call(t.h,"backTextureUsed")&&(this.backTextureUsed=t.h.backTextureUsed),this.postLoad()},__class__:Fi}),(V["buildings.TrainStation"]=Oi).__name__="buildings.TrainStation",Oi.__super__=m,Oi.prototype=e(m.prototype,{save:function(t,e){null==e&&(e=!0),m.prototype.save.call(this,t),e&&t.addString(Oi.saveDefinition)},load:function(t,e){m.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Oi}),(V["buildings.TreeHuggerBase"]=Di).__name__="buildings.TreeHuggerBase",Di.__super__=Yt,Di.prototype=e(Yt.prototype,{get_drawerType:function(){return Vi},get_mergingDrawer:function(){return this.drawer},postCreate:function(){Yt.prototype.postCreate.call(this),this.positionSprites()},positionSprites:function(){Yt.prototype.positionSprites.call(this),null!=this.parkSprite&&this.parkSprite.position.set(this.position.x,this.position.y)},destroy:function(){Yt.prototype.destroy.call(this),this.bgStage.removeChild(this.parkSprite)},walkAround:function(t,e){var i;10==t.relativeX?t.canViewSelfInBuilding=!1:((i=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=4,i[1]=10,t.setPath(i,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},__class__:Di}),(V["buildings.TreePlantation"]=Ri).__name__="buildings.TreePlantation",Ri.__interfaces__=[s],Ri.__super__=Jt,Ri.prototype=e(Jt.prototype,{get_destroyedOnEmpty:function(){return!1},get_resourceName:function(){return"wood"},get_regrowSpeed:function(){return.008*this.getExtraTreeGrowth()*this.regrowSpeedBoost},get_doNotGather:function(){return!1},get_stayIfEmpty:function(){return!1},get_possibleUpgrades:function(){return[Z]},update:function(t){Jt.prototype.update.call(this,t);var e,i,n,s=this.city;this.materialsLeft<=0&&(e=s.simulation.time.timeSinceStart/60%24,((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)?this.regrowProgress+=this.get_regrowSpeed()*t:(e=s.simulation.time.timeSinceStart/60%24,((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.regrowProgress+=this.get_regrowSpeed()*t*.5)),100<=this.regrowProgress&&(this.materialsLeft=this.initialMaterials,this.regrowProgress=0),this.updateTexture())},updateTexture:function(){var t=this.materialsLeft,e=this.initialMaterials,i=this.treesCutTextures,n=this.regrowTextures,s=this.treesSprite;t<=1e-7?s.texture=null!=n?n[this.regrowProgress/100*n.length|0]:i[i.length-1]:(n=Math.floor((e-t)/e*i.length),e!=t&&0==n&&1<i.length&&(n=1),s.texture=i[n])},positionSprites:function(){Jt.prototype.positionSprites.call(this),null!=this.treesSprite&&this.treesSprite.position.set(this.position.x,this.position.y)},destroy:function(){Jt.prototype.destroy.call(this),this.bgStage.removeChild(this.treesSprite)},work:function(t,e,i){var n,s=this;i?t.currentAction=y.Nothing:(n=0<this.materialsLeft,null==(i=!0)&&(i=!1),t.moveAndWait(bo.getInt(this.minCitizenX,this.maxCitizenX),bo.getInt(n?60:120,n?90:180),function(){var t;n?(t=.2*s.city.simulation.boostManager.currentGlobalBoostAmount,s.materialsLeft-=t,s.city.materials.wood+=t,s.city.simulation.stats.materialProduction[1][0]+=t):s.regrowProgress+=.5*s.getExtraTreeGrowth(),s.updateTexture()},i,!1))},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return t.materialsLeft<=0?kn.lo("trees_grown",[0|t.regrowProgress]):kn.lo("wood_left",[0|t.materialsLeft,0|t.initialMaterials])})},getExtraTreeGrowth:function(){return 1+this.getEffectsOfAdjecentBuildings("increaseTreeGrowth")},postLoad:function(){this.updateTexture()},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Ri.saveDefinition);e=this.regrowProgress;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.materialsLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"regrowProgress")&&(this.regrowProgress=t.h.regrowProgress),Object.prototype.hasOwnProperty.call(t.h,"materialsLeft")&&(this.materialsLeft=t.h.materialsLeft),this.postLoad()},__class__:Ri});var Ui=function(t,e,i,n,s,r,o,a){m.call(this,t,e,i,n,s,r,o,a)};(V["buildings.UnknownBuilding"]=Ui).__name__="buildings.UnknownBuilding",Ui.__super__=m,Ui.prototype=e(m.prototype,{load:function(t,e){var i=t.bytes.getInt32(t.readStart);t.readStart+=4;t.readStart=i},save:function(t,e){null==e&&(e=!0);var i=t.size+4;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},__class__:Ui});var Li=function(t,e,i,n,s,r,o,a){this.teleportX=3,this.currentAdjBonus=0,this.timesUsedTo=0,this.timesUsed=0,Yt.call(this,t,e,i,n,s,r,o,a)};function Ei(t,e,i,n,s,r,o,a){oe.call(this,t,e,i,n,s,r,o,a)}function Hi(t,e,i,n,s,r,o,a){this.totalKnowledgeGenerated=0,this.totalMaterialUsed=0,this.materialMade=0,this.isProducingKnowledge=!0,Jt.call(this,t,e,i,n,s,r,o,a)}(V["buildings.Villa"]=Li).__name__="buildings.Villa",Li.__super__=Yt,Li.prototype=e(Yt.prototype,{get_hasPrivateTeleporter:function(){return!0},get_possibleUpgrades:function(){return[]},walkAround:function(t,e){var i,n,s,r=bo.getInt(3);0==r&&120<e?t.relativeX<5?(i=t,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=5,i.setPath(s,0,2,!0),t.pathEndFunction=function(){t.changeFloorAndWaitRandom(30,60)},t.pathOnlyRelatedTo=t.inPermanent):t.changeFloorAndWaitRandom(30,60):1==r||e<=10&&t.relativeX<this.teleportX+.5?t.relativeY<5?t.moveAndWait(bo.getInt(10,16),bo.getInt(30,60),null,!1,!1):1==bo.getInt(2)?t.moveAndWait(bo.getInt(5,8),bo.getInt(30,60),null,!1,!1):t.moveAndWait(bo.getInt(13,16),bo.getInt(30,60),null,!1,!1):(i=t,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=bo.getInt(90,120),i.setPath(s,0,2,!0),t.pathEndFunction=null,t.pathOnlyRelatedTo=t.inPermanent)},addWindowInfoLines:function(){var t=this;Yt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("teleported_from",[t.timesUsed])}),this.city.gui.windowAddInfoText(null,function(){return kn.lo("teleported_to",[t.timesUsedTo])}),Ai.createUpkeepInfo(this.city,this.city.gui)},createTeleportParticle:function(t){null==t&&(t="unused"),this.city.particles.addParticle(H.getTexturesByWidth("spr_smallteleporter_ray",3),new Cn(this.position.x+3,this.position.y+12))},save:function(t,e){null==e&&(e=!0),Yt.prototype.save.call(this,t),e&&t.addString(Li.saveDefinition);e=this.timesUsed;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.timesUsedTo;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){Yt.prototype.load.call(this,t),t.version<6||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"timesUsed")&&(this.timesUsed=t.h.timesUsed),Object.prototype.hasOwnProperty.call(t.h,"timesUsedTo")&&(this.timesUsedTo=t.h.timesUsedTo))},__class__:Li}),(V["buildings.WoodcuttingCentre"]=Ei).__name__="buildings.WoodcuttingCentre",Ei.__super__=oe,Ei.prototype=e(oe.prototype,{work:function(t,e,i){var n=this;this.doBlueCollarJob(t,e,i,[ua,Ri],function(t){var e=n.city.simulation,e=.2*(n.city.progress.story.hiddenBoost&&n.city.materials.wood<=6?1.75:1)*(k.earlyGameFix1&&e.citizens.length<30?1.3-e.citizens.length/60*.3:1)*n.city.simulation.boostManager.currentGlobalBoostAmount;n.city.materials.wood+=e,n.city.simulation.stats.materialProduction[1][0]+=e,t.materialsLeft-=e},60,90)},__class__:Ei}),(V["buildings.Workshop"]=Hi).__name__="buildings.Workshop",Hi.__super__=Jt,Hi.prototype=e(Jt.prototype,{onBuild:function(){this.city.simulation.bonuses.machinePartsFactorySpeed*=1.25},get_possibleBuildingModes:function(){return[Xt,Gt]},get_possibleCityUpgrades:function(){return[rn,on,an]},work:function(t,e,i){var n,s;i?t.currentAction=y.Nothing:(0==this.workers.indexOf(t)?bo.getInt(5)<4?(null==(s=!0)&&(s=!1),null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(4,8),bo.getInt(60,120),null,n,s)):(null==(s=!0)&&(s=!1),null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(11,14),bo.getInt(60,120),null,n,s)):t.relativeY<2?t.changeFloor():0==bo.getInt(2)?(null==(s=!0)&&(s=!1),null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(3,6),bo.getInt(60,120),null,n,s)):(null==(s=!0)&&(s=!1),null==(n=!1)&&(n=!1),t.moveAndWait(bo.getInt(13,14),bo.getInt(60,120),null,n,s)),this.isProducingKnowledge?(s=.15*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount,this.city.materials.knowledge+=s,this.city.simulation.stats.materialProduction[9][0]+=s,this.totalKnowledgeGenerated+=s):1<=this.city.materials.wood&&(t=.075*t.get_educationSpeedModifier()*this.city.simulation.boostManager.currentGlobalBoostAmount,this.city.materials.machineParts+=t,this.city.simulation.stats.materialProduction[3][0]+=t,this.materialMade+=t,t=2*t,this.city.materials.wood-=t,this.city.simulation.stats.materialUsed[1][0]+=t,this.totalMaterialUsed+=t))},update:function(t){Jt.prototype.update.call(this,t)},destroy:function(){Jt.prototype.destroy.call(this),this.city.simulation.bonuses.machinePartsFactorySpeed/=1.25},addWindowInfoLines:function(){var t=this;Jt.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return kn.lo("knowledge_gathered",[0|t.totalKnowledgeGenerated])+" "+kn.lo("wood_used_for_machine_parts",[0|t.totalMaterialUsed,0|t.materialMade])})},save:function(t,e){null==e&&(e=!0),Jt.prototype.save.call(this,t),e&&t.addString(Hi.saveDefinition);e=this.materialMade;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.totalMaterialUsed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.totalKnowledgeGenerated;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){Jt.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"materialMade")&&(this.materialMade=t.h.materialMade),Object.prototype.hasOwnProperty.call(t.h,"totalMaterialUsed")&&(this.totalMaterialUsed=t.h.totalMaterialUsed),Object.prototype.hasOwnProperty.call(t.h,"totalKnowledgeGenerated")&&(this.totalKnowledgeGenerated=t.h.totalKnowledgeGenerated)},__class__:Hi});var Ni=function(t,e){this.park=t,this.podiumSprite=null,this.bgStage=e};(V["buildings.buildingBehaviours.ParkFestivalEntertainment"]=Ni).__name__="buildings.buildingBehaviours.ParkFestivalEntertainment",Ni.prototype={doFestivalWork:function(t,e,i,n,s){var r=!0,o=3;null!=this.park.leftBuilding&&(r&&this.park.leftBuilding.is(ci)&&(r=!1),r&&this.park.leftBuilding.is(he)&&(r=!1,null!=this.park.leftBuilding.bottomBuilding&&this.park.leftBuilding.bottomBuilding.is(he)&&(0==n&&(o=-3),r=!0))),r?(null==this.podiumSprite&&(this.podiumSprite=new PIXI.Sprite(H.getTexture("spr_festival_podium_small")),this.bgStage.addChild(this.podiumSprite)),this.podiumSprite.position.set(this.park.position.x+o,this.park.position.y+20-this.podiumSprite.height-1),s=0==s?o+3:o,o=e.pathWalkSpeed*i,I.shouldUpdateDraw=!0,Math.abs(s-e.relativeX)<o?e.relativeX=s:(i=s-e.relativeX,e.relativeX+=(0<i?1:i<0?-1:0)*o),e.relativeX>=s&&e.relativeX<=s+1&&e.setRelativePos(s,4)):(null!=this.podiumSprite&&(this.podiumSprite.destroy(),this.podiumSprite=null),e.moveAndWait(bo.getInt(0,17),bo.getInt(60,90),null,!1,!1))},beEntertainedFestival:function(t,e,i){var n,s,r,o;null==this.podiumSprite?Gi.beEntertainedPark(this.park.leftBuilding,this.park.rightBuilding,e):(n=Math.ceil(this.podiumSprite.position.x+this.podiumSprite.width-this.park.position.x),s=null!=this.park.rightBuilding&&(this.park.rightBuilding.is(ci)||this.park.rightBuilding.is(he)),null==(o=!(r=!1))&&(o=!1),null==r&&(r=!1),e.moveAndWait(bo.getInt(n,s?19:16),bo.getInt(100,180),null,r,o))},destroy:function(){null!=this.podiumSprite&&this.podiumSprite.destroy()},stop:function(){},__class__:Ni};var Gi=function(){};function Xi(t,e,i,n){this.building=t,this.stage=e,this.bgStage=i,this.currentTextureName=n,this.currentTextureGroupName=n,this.canMergeH=!1,this.canMergeV=!1}(V["buildings.buildingBehaviours.ParkWalk"]=Gi).__name__="buildings.buildingBehaviours.ParkWalk",Gi.beEntertainedPark=function(t,e,i){var n=!1,s=!1;null!=t&&t.is(pi)&&(t=t.leftBuilding,n=!0),null!=e&&e.is(pi)&&(e=e.rightBuilding,s=!0);var r=null!=t&&t.is(he),o=null!=e&&e.is(he),a=r&&(null==t.bottomBuilding||!t.bottomBuilding.is(he)),l=o&&(null==e.bottomBuilding||!e.bottomBuilding.is(he));r||null!=t&&t.is(ci)&&(a=r=!0),o||null!=e&&e.is(ci)&&(l=o=!0);var h,u,d,c,t=!1,e=bo.getInt(1+(r?1:0)+(o?1:0));r&&0==e?n?a&&((u=0<(h=io.pool)[10].length?h[10].splice(h[10].length-1,1)[0]:new Int32Array(10))[0]=12,u[1]=50,u[2]=2,u[3]=0,u[4]=2,u[5]=0,u[6]=4,u[7]=bo.getInt(0,18),u[8]=8,u[9]=bo.getInt(100,180),i.setPath(u,0,8,!0),t=!0):a?((u=0<(h=io.pool)[8].length?h[8].splice(h[8].length-1,1)[0]:new Int32Array(8))[0]=12,u[1]=50,u[2]=2,u[3]=0,u[4]=4,u[5]=bo.getInt(0,18),u[6]=8,u[7]=bo.getInt(100,180),i.setPath(u,0,8,!0),t=!0):0==bo.getInt(2)&&(null==(c=!0)&&(c=!1),null==(d=!1)&&(d=!1),i.moveAndWait(bo.getInt(-3,-3),bo.getInt(70,90),null,d,c),t=!0):o&&1==e&&(s?l&&((u=0<(h=io.pool)[10].length?h[10].splice(h[10].length-1,1)[0]:new Int32Array(10))[0]=12,u[1]=50,u[2]=3,u[3]=0,u[4]=3,u[5]=0,u[6]=4,u[7]=bo.getInt(0,18),u[8]=8,u[9]=bo.getInt(100,180),i.setPath(u,0,8,!0),t=!0):l?((u=0<(h=io.pool)[8].length?h[8].splice(h[8].length-1,1)[0]:new Int32Array(8))[0]=12,u[1]=50,u[2]=3,u[3]=0,u[4]=4,u[5]=bo.getInt(0,18),u[6]=8,u[7]=bo.getInt(100,180),i.setPath(u,0,8,!0),t=!0):0==bo.getInt(2)&&(null==(c=!0)&&(c=!1),null==(d=!1)&&(d=!1),i.moveAndWait(bo.getInt(21,21),bo.getInt(70,90),null,d,c),t=!0)),t||(null==(c=!0)&&(c=!1),null==(d=!1)&&(d=!1),i.moveAndWait(bo.getInt(r?0:3,o?18:15),bo.getInt(100,180),null,d,c))},(V["buildings.buildingDrawers.BuildingDrawer"]=Xi).__name__="buildings.buildingDrawers.BuildingDrawer",Xi.prototype={positionSpritesMerging:function(){},positionSprites:function(){},changeMainTexture:function(t){this.currentTextureName=t,this.currentTextureGroupName=t},changeTextureGroup:function(t){this.currentTextureGroupName=t},destroy:function(){},__class__:Xi};var ji=function(t,e,i,n){this.fgTexturesSet=null,this.bgTexturesSet=null,this.currentSecondaryTexture=0,this.secondaryBackgroundTextureName=null,Xi.call(this,t,e,i,n),this.canMergeH=!0,this.canMergeV=!0,this.bgSpriteTopLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteTopLeft),i.isInvalid=!0,this.bgSpriteTopRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteTopRight),i.isInvalid=!0,this.spriteTopLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteTopLeft),e.isInvalid=!0,this.spriteTopRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteTopRight),e.isInvalid=!0,this.bgSpriteBottomLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteBottomLeft),i.isInvalid=!0,this.bgSpriteBottomRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteBottomRight),i.isInvalid=!0,this.spriteBottomLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteBottomLeft),e.isInvalid=!0,this.spriteBottomRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteBottomRight),e.isInvalid=!0,this.spriteSecondaryBackground=new PIXI.Sprite,i.cacheableChildren.push(this.spriteSecondaryBackground),i.isInvalid=!0,this.positionSprites(),this.secondaryBackgroundTextureName=null};(V["buildings.buildingDrawers.AllDirMergingBuildingDrawer"]=ji).__name__="buildings.buildingDrawers.AllDirMergingBuildingDrawer",ji.__super__=Xi,ji.prototype=e(Xi.prototype,{positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},setBackgroundTextures:function(t){this.bgTexturesSet=H.getTexturesAsGrid(t,10,2,2,!0)},setForegroundTextures:function(t){this.fgTexturesSet=H.getTexturesAsGrid(t,10,2,2,!0)},positionSpritesMerging:function(){this.spriteTopLeft.position.set(this.building.position.x,this.building.position.y),this.bgSpriteTopLeft.position.set(this.building.position.x,this.building.position.y),this.spriteTopRight.position.set(this.building.position.x+10,this.building.position.y),this.bgSpriteTopRight.position.set(this.building.position.x+10,this.building.position.y),this.spriteBottomLeft.position.set(this.building.position.x,this.building.position.y+10),this.bgSpriteBottomLeft.position.set(this.building.position.x,this.building.position.y+10),this.spriteBottomRight.position.set(this.building.position.x+10,this.building.position.y+10),this.bgSpriteBottomRight.position.set(this.building.position.x+10,this.building.position.y+10),this.spriteSecondaryBackground.position.set(this.building.position.x,this.building.position.y);var t=this.isConnectedBuilding(this.building.leftBuilding),e=this.isConnectedBuilding(this.building.rightBuilding),i=this.isConnectedBuilding(this.building.topBuilding),n=this.isConnectedBuilding(this.building.bottomBuilding),s=!1,r=!1,o=!1,a=!1;t&&i&&(s=this.isConnectedBuilding(this.building.leftBuilding.topBuilding)),e&&i&&(r=this.isConnectedBuilding(this.building.rightBuilding.topBuilding)),t&&n&&(o=this.isConnectedBuilding(this.building.leftBuilding.bottomBuilding)),e&&n&&(a=this.isConnectedBuilding(this.building.rightBuilding.bottomBuilding)),t=t||this.isConnectedBuildingHOnly(this.building.leftBuilding),e=e||this.isConnectedBuildingHOnly(this.building.rightBuilding);var l,h,u,d,c=H.getTexturesBySize(this.currentTextureName,10,10,2,!0),p=0==this.building.worldPosition.y,g=6*((t?1:0)+(i?2:0)+(s?1:0)),m=1+6*((e?1:0)+(i?2:0)+(r?1:0)),f=6*((t?1:0)+(n?2:0)+(o?1:0)),y=1+6*((e?1:0)+(n?2:0)+(a?1:0));if(null==this.fgTexturesSet||p?(this.spriteTopLeft.texture=c[g+(p?2:0)][0],this.spriteTopRight.texture=c[m+(p?2:0)][0],this.spriteBottomLeft.texture=c[f+(p?2:0)][1],this.spriteBottomRight.texture=c[y+(p?2:0)][1]):(l=2*((t?1:0)+(i?2:0)+(s?1:0)),this.spriteTopLeft.texture=this.fgTexturesSet[l][0],h=1+2*((e?1:0)+(i?2:0)+(r?1:0)),this.spriteTopRight.texture=this.fgTexturesSet[h][0],u=2*((t?1:0)+(n?2:0)+(o?1:0)),this.spriteBottomLeft.texture=this.fgTexturesSet[u][1],d=1+2*((e?1:0)+(n?2:0)+(a?1:0)),this.spriteBottomRight.texture=this.fgTexturesSet[d][1]),null!=this.bgTexturesSet?(l=2*((t?1:0)+(i?2:0)+(s?1:0)),this.bgSpriteTopLeft.texture=this.bgTexturesSet[l][0],h=1+2*((e?1:0)+(i?2:0)+(r?1:0)),this.bgSpriteTopRight.texture=this.bgTexturesSet[h][0],u=2*((t?1:0)+(n?2:0)+(o?1:0)),this.bgSpriteBottomLeft.texture=this.bgTexturesSet[u][1],d=1+2*((e?1:0)+(n?2:0)+(a?1:0)),this.bgSpriteBottomRight.texture=this.bgTexturesSet[d][1]):(this.bgSpriteTopLeft.texture=c[4+g][0],this.bgSpriteTopRight.texture=c[4+m][0],this.bgSpriteBottomLeft.texture=c[4+f][1],this.bgSpriteBottomRight.texture=c[4+y][1]),this.bgStage.isInvalid=!0,this.stage.isInvalid=!0,null!=this.secondaryBackgroundTextureName){for(var _=this.building,w=Fr.getClass(this.building);null!=_.bottomBuilding&&_.bottomBuilding.is(w);)_=_.bottomBuilding;_!=this.building&&(null==(y=_.drawer).secondaryBackgroundTextureName||(y=y.getCurrentSecondaryTextureGroup())!=this.getCurrentSecondaryTextureGroup()&&this.setGroupOfSecondaryTextureForBuilding(this.building,y)),this.updateSecondaryBackgroundImage(i,n)}},setSecondaryBackgroundImages:function(t,e,i,n){this.secondaryBackgroundTextureName=t,this.secondaryBackgroundSets=e,this.currentSecondaryTexture=i,this.secondaryTextureOnSet=n,this.updateSecondaryBackgroundImageNoExtraInfo()},updateSecondaryBackgroundImageNoExtraInfo:function(){this.updateSecondaryBackgroundImage(this.isConnectedBuilding(this.building.topBuilding),this.isConnectedBuilding(this.building.bottomBuilding))},updateSecondaryBackgroundImage:function(t,e){var i;null!=this.secondaryBackgroundTextureName&&(i=this.getCurrentSecondaryBackTextures(),this.spriteSecondaryBackground.texture=i[(e?1:0)+(t?3:0)+(t&&e?-2:0)],this.bgStage.isInvalid=!0)},changeMainTexture:function(t){Xi.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){Xi.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteTopLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.bgStage,e=this.bgSpriteTopRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.bgStage,e=this.bgSpriteBottomLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.bgStage,e=this.bgSpriteBottomRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.bgStage,e=this.spriteSecondaryBackground;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteTopLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteTopRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteBottomLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteBottomRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;t=this.getOtherAMDrawer(t);return null!=t&&(t.currentTextureName==this.currentTextureName||t.currentTextureGroupName==this.currentTextureGroupName)},isConnectedBuildingHOnly:function(t){if(null==t)return!1;t=this.getOtherAMDrawerHOnly(t);return null!=t&&(t.currentTextureName==this.currentTextureName||t.currentTextureGroupName==this.currentTextureGroupName)},getOtherAMDrawer:function(t){if(null==t)return null;t=t.drawer;return t.canMergeH&&t.canMergeV?t:null},getOtherAMDrawerHOnly:function(t){if(null==t)return null;t=t.drawer;return t.canMergeH?t:null},getSecondaryBackTextures:function(){return H.getTexturesBySize(this.secondaryBackgroundTextureName,20,20)},getCurrentSecondaryBackTextures:function(){return this.getSecondaryBackTextures()[this.currentSecondaryTexture]},getCurrentSecondaryTextureGroup:function(){return this.getSecondaryTextureGroup(this.currentSecondaryTexture)},getSecondaryTextureGroup:function(t){for(var e=-1,i=0;i<=t;)++e,i+=this.secondaryBackgroundSets[e];return e},getFirstSecondaryTextureOfGroup:function(t){for(var e=0,i=0;i<t;)e+=this.secondaryBackgroundSets[i],++i;return e},setSecondaryTextureWithinGroup:function(t){this.currentSecondaryTexture=this.getFirstSecondaryTextureOfGroup(this.getCurrentSecondaryTextureGroup())+t,this.secondaryTextureOnSet(this.currentSecondaryTexture),this.updateSecondaryBackgroundImageNoExtraInfo()},setGroupOfSecondaryTexture:function(t){for(var e=Fr.getClass(this.building),i=this.building;null!=i.bottomBuilding&&i.bottomBuilding.is(e)&&this.isConnectedBuilding(i.bottomBuilding);)i=i.bottomBuilding;for(;this.setGroupOfSecondaryTextureForBuilding(i,t),null!=i.topBuilding&&i.topBuilding.is(e)&&this.isConnectedBuilding(i.topBuilding);)i=i.topBuilding},setGroupOfSecondaryTextureForThisBuilding:function(t){this.setGroupOfSecondaryTextureForBuilding(this.building,t)},setGroupOfSecondaryTextureForBuilding:function(t,e){t=t.drawer;t.currentSecondaryTexture=this.getFirstSecondaryTextureOfGroup(e)+bo.getInt(this.secondaryBackgroundSets[e]),t.secondaryTextureOnSet(t.currentSecondaryTexture),t.updateSecondaryBackgroundImageNoExtraInfo()},__class__:ji});var Vi=function(t,e,i,n){Xi.call(this,t,e,i,n),this.canMergeH=!0,this.canMergeV=!1,this.bgSpriteLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteLeft),i.isInvalid=!0,this.bgSpriteRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteRight),i.isInvalid=!0,this.spriteLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteLeft),e.isInvalid=!0,this.spriteRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteRight),e.isInvalid=!0,this.positionSprites()};(V["buildings.buildingDrawers.AutoMergingBuildingDrawer"]=Vi).__name__="buildings.buildingDrawers.AutoMergingBuildingDrawer",Vi.__super__=Xi,Vi.prototype=e(Xi.prototype,{positionSpritesMerging:function(){this.spriteLeft.position.set(this.building.position.x,this.building.position.y),this.bgSpriteLeft.position.set(this.building.position.x,this.building.position.y),this.spriteRight.position.set(this.building.position.x+10,this.building.position.y),this.bgSpriteRight.position.set(this.building.position.x+10,this.building.position.y);var t=0==this.building.worldPosition.y,e=this.isConnectedBuilding(this.building.leftBuilding),i=this.isConnectedBuilding(this.building.rightBuilding),n=H.getTexturesByWidth(this.currentTextureName,10,!0);this.bgSpriteLeft.texture=n[4+(e?6:0)],this.bgSpriteRight.texture=n[5+(i?6:0)],this.spriteLeft.texture=n[(t?2:0)+(e?6:0)],this.spriteRight.texture=n[1+(t?2:0)+(i?6:0)],this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},changeMainTexture:function(t){Xi.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){Xi.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.bgStage,e=this.bgSpriteRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;t=this.getOtherAMDrawer(t);return null!=t&&(t.currentTextureName==this.currentTextureName||t.currentTextureGroupName==this.currentTextureGroupName)},getOtherAMDrawer:function(t){if(null==t)return null;t=t.drawer;return t.canMergeH?t:null},__class__:Vi});var Yi=function(t,e,i,n){Xi.call(this,t,e,i,n),this.canMergeH=!0,this.canMergeV=!1,this.bgSpriteLeft=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteLeft),i.isInvalid=!0,this.bgSpriteRight=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteRight),i.isInvalid=!0,this.spriteLeft=new PIXI.Sprite,e.cacheableChildren.push(this.spriteLeft),e.isInvalid=!0,this.spriteRight=new PIXI.Sprite,e.cacheableChildren.push(this.spriteRight),e.isInvalid=!0,this.positionSprites()};(V["buildings.buildingDrawers.AutoMergingBuildingDrawerDifferentForType"]=Yi).__name__="buildings.buildingDrawers.AutoMergingBuildingDrawerDifferentForType",Yi.__super__=Xi,Yi.prototype=e(Xi.prototype,{positionSpritesMerging:function(){this.spriteLeft.position.set(this.building.position.x,this.building.position.y),this.bgSpriteLeft.position.set(this.building.position.x,this.building.position.y),this.spriteRight.position.set(this.building.position.x+10,this.building.position.y),this.bgSpriteRight.position.set(this.building.position.x+10,this.building.position.y);var t=0==this.building.worldPosition.y,e=this.isConnectedBuilding(this.building.leftBuilding),i=this.isConnectedBuilding(this.building.rightBuilding),n=!0,s=!0;e&&(n=this.isFullyConnectedBuilding(this.building.leftBuilding)),i&&(s=this.isFullyConnectedBuilding(this.building.rightBuilding));var r=H.getTexturesByWidth(this.currentTextureName,10,!0);this.bgSpriteLeft.texture=r[4+(e?6:0)+(n?0:6)],this.bgSpriteRight.texture=r[5+(i?6:0)+(s?0:6)],this.spriteLeft.texture=r[(t?2:0)+(e?6:0)+(n?0:6)],this.spriteRight.texture=r[1+(t?2:0)+(i?6:0)+(s?0:6)],this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},changeMainTexture:function(t){Xi.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){Xi.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.bgStage,e=this.bgSpriteRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteLeft;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteRight;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;t=this.getOtherAMDrawer(t);return null!=t&&(t.currentTextureName==this.currentTextureName||t.currentTextureGroupName==this.currentTextureGroupName)},isFullyConnectedBuilding:function(t){if(null==t)return!1;t=this.getOtherAMDrawer(t);return null!=t&&t.currentTextureName==this.currentTextureName},getOtherAMDrawer:function(t){if(null==t)return null;t=t.drawer;return t.canMergeH?t:null},__class__:Yi}),fe=function(t,e,i,n){Xi.call(this,t,e,i,n),this.canMergeH=!1,this.canMergeV=!0,this.bgSpriteTop=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteTop),i.isInvalid=!0,this.bgSpriteBottom=new PIXI.Sprite,i.cacheableChildren.push(this.bgSpriteBottom),i.isInvalid=!0,this.spriteTop=new PIXI.Sprite,e.cacheableChildren.push(this.spriteTop),e.isInvalid=!0,this.spriteBottom=new PIXI.Sprite,e.cacheableChildren.push(this.spriteBottom),e.isInvalid=!0,this.positionSprites()},(V["buildings.buildingDrawers.AutoMergingBuildingDrawerUD"]=fe).__name__="buildings.buildingDrawers.AutoMergingBuildingDrawerUD",fe.__super__=Xi,fe.prototype=e(Xi.prototype,{positionSpritesMerging:function(){this.spriteTop.position.set(this.building.position.x,this.building.position.y),this.bgSpriteTop.position.set(this.building.position.x,this.building.position.y),this.spriteBottom.position.set(this.building.position.x,this.building.position.y+10),this.bgSpriteBottom.position.set(this.building.position.x,this.building.position.y+10);var t=0==this.building.worldPosition.y,e=this.isConnectedBuilding(this.building.topBuilding),i=this.isConnectedBuilding(this.building.bottomBuilding),n=H.getTexturesAsGrid(this.currentTextureName,6,2,2);this.bgSpriteTop.texture=n[2+(e?3:0)][0],this.bgSpriteBottom.texture=n[2+(i?3:0)][1],this.spriteTop.texture=n[(t?1:0)+(e?3:0)][0],this.spriteBottom.texture=n[(t?1:0)+(i?3:0)][1],this.stage.isInvalid=!0,this.bgStage.isInvalid=!0},positionSprites:function(){this.building.city.updateConnectedBuildingSprites=!0},changeMainTexture:function(t){Xi.prototype.changeMainTexture.call(this,t),this.positionSprites()},destroy:function(){Xi.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSpriteTop;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.bgStage,e=this.bgSpriteBottom;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteTop;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.spriteBottom;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e),this.building.city.updateConnectedBuildingSprites=!0},isConnectedBuilding:function(t){if(null==t)return!1;t=this.getOtherAMDrawer(t);return null!=t&&t.currentTextureName==this.currentTextureName},getOtherAMDrawer:function(t){if(null==t)return null;t=t.drawer;return t.canMergeV?t:null},__class__:fe});var $i=function(t,e,i,n){Xi.call(this,t,e,i,n),this.bgSprite=H.makeSprite(this.currentTextureName,new xn(44,0,20,20)),i.cacheableChildren.push(this.bgSprite),i.isInvalid=!0,this.sprite=new PIXI.Sprite,e.cacheableChildren.push(this.sprite),e.isInvalid=!0,this.positionSprites()};(V["buildings.buildingDrawers.NormalBuildingDrawer"]=$i).__name__="buildings.buildingDrawers.NormalBuildingDrawer",$i.__super__=Xi,$i.prototype=e(Xi.prototype,{positionSprites:function(){this.sprite.position.set(this.building.position.x,this.building.position.y),this.bgSprite.position.set(this.building.position.x,this.building.position.y);var t=new xn(0,0,20,20);0==this.building.worldPosition.y&&(t.x+=22),this.sprite.texture=H.getTexture(this.currentTextureName,t),this.stage.isInvalid=!0},mirror:function(){this.bgSprite.anchor.x=1-this.bgSprite.anchor.x,this.bgSprite.scale.x=-this.bgSprite.scale.x,this.sprite.anchor.x=1-this.sprite.anchor.x,this.sprite.scale.x=-this.sprite.scale.x,this.bgStage.isInvalid=!0,this.stage.isInvalid=!0},changeMainTexture:function(t){Xi.prototype.changeMainTexture.call(this,t),this.bgSprite.texture=H.getTexture(this.currentTextureName,new xn(44,0,20,20)),this.bgStage.isInvalid=!0,this.positionSprites()},destroy:function(){Xi.prototype.destroy.call(this);var t=this.bgStage,e=this.bgSprite;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e);t=this.stage,e=this.sprite;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e)},getBackgroundTexture:function(){return this.bgSprite.texture},__class__:$i});var qi=function(t,e,i,n){this.backTexture=null,this.frontTextureWithDoor=null,this.frontTextureNoDoor=null,$i.call(this,t,e,i,n)};(V["buildings.buildingDrawers.CustomizableBuildingDrawer"]=qi).__name__="buildings.buildingDrawers.CustomizableBuildingDrawer",qi.__super__=$i,qi.prototype=e($i.prototype,{positionSprites:function(){this.sprite.position.set(this.building.position.x,this.building.position.y),this.bgSprite.position.set(this.building.position.x,this.building.position.y);var t=this.frontTextureNoDoor,e=new xn(0,0,20,20);0==this.building.worldPosition.y&&(e.x+=22,t=this.frontTextureWithDoor);e=null!=t?t:H.getTexture(this.currentTextureName,e);this.sprite.texture=e,this.stage.isInvalid=!0},setCustomTextures:function(t,e,i){this.frontTextureNoDoor=t,this.frontTextureWithDoor=e,null!=(this.backTexture=i)&&(this.bgSprite.texture=i,this.bgStage.isInvalid=!0),this.positionSprites()},__class__:qi});var Ki=function(t,e,i,n){this.subImage=0,Xi.call(this,t,e,i,n),this.sprite=new PIXI.Sprite,e.cacheableChildren.push(this.sprite),e.isInvalid=!0,this.positionSprites()};function Qi(t){this.isActive=!1,this.city=t,this.gui=t.gui}function Ji(t,e){Qi.call(this,t),this.citizen=e}function Zi(){}function tn(t){Qi.call(this,t)}(V["buildings.buildingDrawers.DecorationBuildingDrawer"]=Ki).__name__="buildings.buildingDrawers.DecorationBuildingDrawer",Ki.__super__=Xi,Ki.prototype=e(Xi.prototype,{positionSprites:function(){this.sprite.position.set(this.building.position.x,this.building.position.y);var t=new xn(22*this.subImage,0,20,20);this.sprite.texture=H.getTexture(this.currentTextureName,t),this.stage.isInvalid=!0},getSubImageNumber:function(){return Math.round(H.getTexture(this.currentTextureName).width+2)/22|0},mirror:function(){this.sprite.anchor.x=1-this.sprite.anchor.x,this.sprite.scale.x=-this.sprite.scale.x,this.stage.isInvalid=!0},changeMainTexture:function(t){Xi.prototype.changeMainTexture.call(this,t),this.positionSprites()},changeSubImage:function(t){this.subImage=t,this.positionSprites()},destroy:function(){Xi.prototype.destroy.call(this);var t=this.stage,e=this.sprite;Y.remove(t.cacheableChildren,e),t.isInvalid=!0,null!=e.parent&&e.parent.removeChild(e)},__class__:Ki}),(V["cityActions.CitySpecialAction"]=Qi).__name__="cityActions.CitySpecialAction",Qi.prototype={get_specialActionID:function(){return""},get_hasPermanentAction:function(){return!1},get_canBeRestoredAfterDeactivation:function(){return!1},activate:function(){this.isActive=!0,this.city.specialAction=this},deactivate:function(t){null==t&&(t=!1),this.isActive=!1,this.city.specialAction=null,this.get_canBeRestoredAfterDeactivation()&&!t&&(this.city.specialActionOld=this)},__class__:Qi},(V["cityActions.ChangeCitizenVitalBuildings"]=Ji).__name__="cityActions.ChangeCitizenVitalBuildings",Ji.__super__=Qi,Ji.prototype=e(Qi.prototype,{get_specialActionID:function(){return"ChangeCitizenVitalBuildings"},get_hasPermanentAction:function(){return!0},activate:function(){Qi.prototype.activate.call(this)},performPermanentAction:function(t){var e,i,n,s,r,o;t.is(Si)&&"cityofthekey"==this.city.progress.story.storyName?this.city.gui.showSimpleWindow(kn.lo("secret_society_forbidden"),null,!0,!0):(e=t).is(Jt)&&null==this.citizen.school&&16<=this.citizen.get_age()?(n=e,i=null,this.citizen.job!=n&&(i=n.workers[0],n.workers.length>=n.get_jobs()&&i.loseJob(!1),this.citizen.loseJob(!0),this.city.simulation.jobAssigner.giveCitizenJob(this.citizen,n),this.city.game.audio.playSound(this.city.game.audio.changeVitalBuildingSound),null!=this.citizen.home&&this.citizen.home!=n&&this.citizen.home.is(Jt)&&(e=this.citizen.home,this.citizen.home.get_residentCapacity()<=e.get_jobs()&&this.citizen.evictFromHome())),n.is(Yt)&&(r=n,this.citizen.home!=r&&(n=r.residents.length>=r.get_residentCapacity(),s=!1,null!=i&&i.home==r&&n?(i.evictFromHome(),s=!0):n&&(r.residents[0].evictFromHome(),s=!0),n&&!s||(this.citizen.evictFromHome(),((o=this.citizen).home=r).residents.push(o),this.citizen.isForcedHome||this.city.simulation.houseAssigner.citizensWithFixedHomes.push(this.citizen),this.citizen.isForcedHome=!0)))):(s=t).is(Yt)?(r=s,this.citizen.home!=r&&(r.residents.length>=r.get_residentCapacity()&&r.residents[0].evictFromHome(),this.citizen.evictFromHome(),((o=this.citizen).home=r).residents.push(o),this.citizen.isForcedHome||this.city.simulation.houseAssigner.citizensWithFixedHomes.push(this.citizen),this.citizen.isForcedHome=!0,null!=this.citizen.job&&this.citizen.home!=this.citizen.job&&this.citizen.job.is(Yt)&&this.citizen.job.get_residentCapacity()<=this.citizen.job.get_jobs()&&this.citizen.loseJob(!1),this.city.game.audio.playSound(this.city.game.audio.changeVitalBuildingSound))):(t=t).is(bi)&&this.citizen.get_age()<16&&(t=t,this.citizen.school!=t&&(t.students.length>=t.get_studentCapacity()&&t.students[0].leaveSchool(),this.citizen.leaveSchool(),(this.citizen.school=t).students.push(this.citizen),this.city.game.audio.playSound(this.city.game.audio.changeVitalBuildingSound)))},__class__:Ji}),(V["cityActions.CityHighlightBuildingsOfType"]=Zi).__name__="cityActions.CityHighlightBuildingsOfType",Zi.doHighlight=function(d,c){var p=H.getTexturesByWidth("spr_hoverhint",22);d.setHoverHightlight(function(t){if(t.is(c)){for(var e=t,i=!1,n=0,s=e.get_possibleUpgrades();n<s.length;){var r=[s[n]];if(++n,d.progress.unlocks.getUnlockState(r[0])!=mo.Locked){var o=H.buildingUpgradesInfo,a=r[0].__name__,l=o.h[a],h=M.fromBuildingUpgradesInfo(l);if(!vn.any(e.upgrades,function(e){return function(t){return Fr.getClass(t)==e[0]}}(r))&&(i=!0,d.materials.canAfford(h)))return p[2]}}for(n=0,s=e.get_possibleCityUpgrades();n<s.length;){var u=[s[n]];if(++n,d.progress.unlocks.getUnlockState(u[0])!=mo.Locked){o=H.cityUpgradesInfo,a=u[0].__name__,l=o.h[a],h=M.fromCityUpgradesInfo(l);if(!vn.any(d.upgrades.upgrades,function(e){return function(t){return Fr.getClass(t)==e[0]}}(u))&&(i=!0,d.materials.canAfford(h)))return p[2]}}return i?p[1]:p[0]}return d.progress.resetCtrlToHightlightHint(),null},6735360)},Zi.findLeastUpgraded=function(t,e){for(var i=null,n=1e4,s=0,r=t.permanents;s<r.length;){var o=r[s];++s,!o.isBuilding||(o=o).is(e)&&o.upgrades.length<n&&(n=o.upgrades.length,i=o)}return i},(V["cityActions.FollowCitizenAction"]=tn).__name__="cityActions.FollowCitizenAction",tn.__super__=Qi,tn.prototype=e(Qi.prototype,{get_specialActionID:function(){return"FollowCitizenAction"},activate:function(){var t=this;Qi.prototype.activate.call(this),this.gui.showSimpleWindow(kn.lo("tap_near_citizen_to_follow"),null,!0),this.city.gui.setWindowPositioning(nr.Top),(this.gui.windowRelatedTo=this).gui.windowOnDestroy=function(){t.isActive=!1,t.deactivate(!0)}},deactivate:function(t){null==t&&(t=!1),this.isActive&&null!=this.gui.window&&this.gui.windowRelatedTo==this&&this.gui.closeWindow(),Qi.prototype.deactivate.call(this,t)},__class__:tn});var en=function(t){this.city=t,this.gui=t.gui};function nn(){var e=Fr.getClass(this).__name__;this.info=tt.find(H.cityUpgradesInfo,function(t){return"cityUpgrades."+t.className==e})}(V["cityActions.ViewActions"]=en).__name__="cityActions.ViewActions",en.prototype={showFollow:function(){this.gui.get_keyboard().down[17]&&0<this.city.simulation.citizens.length?(bo.fromArray(this.city.simulation.citizens).onClick(),null!=this.city.specialAction&&this.city.specialAction.deactivate(!0)):this.city.activateSpecialCityAction(new tn(this.city))},isFollowOpen:function(){return null!=this.city.specialAction&&"FollowCitizenAction"==this.city.specialAction.get_specialActionID()},__class__:en},(V["cityUpgrades.CityUpgrade"]=nn).__name__="cityUpgrades.CityUpgrade",nn.__interfaces__=[n],nn.prototype={addToCity:function(t){this.city=t},save:function(t,e){null==e&&(e=!0),e&&t.addString(nn.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:nn};var sn=function(){nn.call(this)};(V["cityUpgrades.BirthControl"]=sn).__name__="cityUpgrades.BirthControl",sn.__super__=nn,sn.prototype=e(nn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.hasBirthControl=!0},__class__:sn});var rn=function(){nn.call(this)};(V["cityUpgrades.BuildingRecycling"]=rn).__name__="cityUpgrades.BuildingRecycling",rn.__super__=nn,rn.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.upgrades.vars.recyclingAmount=Math.max(t.upgrades.vars.recyclingAmount,.5),t.progress.unlocks.unlock(on)},__class__:rn});var on=function(){nn.call(this)};(V["cityUpgrades.BuildingRecycling2"]=on).__name__="cityUpgrades.BuildingRecycling2",on.__super__=nn,on.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.upgrades.vars.recyclingAmount=Math.max(t.upgrades.vars.recyclingAmount,.75),t.progress.unlocks.unlock(an)},__class__:on});var an=function(){nn.call(this)};(V["cityUpgrades.BuildingRecycling3"]=an).__name__="cityUpgrades.BuildingRecycling3",an.__super__=nn,an.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.upgrades.vars.recyclingAmount=Math.max(t.upgrades.vars.recyclingAmount,.9)},__class__:an});var ln=function(){nn.call(this)};(V["cityUpgrades.ChipBinning"]=ln).__name__="cityUpgrades.ChipBinning",ln.__super__=nn,ln.prototype=e(nn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.computerChipFactorySpeed*=1.2},__class__:ln});var hn=function(t){this.city=t,this.upgrades=[],this.vars=new _n};(V["cityUpgrades.CityUpgrades"]=hn).__name__="cityUpgrades.CityUpgrades",hn.prototype={addUpgrade:function(t){this.upgrades.push(t),t.addToCity(this.city)},save:function(t){var e,i=this.upgrades.length;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;for(var n=0,s=this.upgrades;n<s.length;){var r=s[n];++n;var o=Fr.getClass(r);t.addString(o.__name__),r.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var s=t.readString(),s=X.createInstance(V[s],[]);if(s.load(t),this.addUpgrade(s),t.version<=11&&s instanceof gn)for(var r=0,o=this.city.permanents;r<o.length;){var a=o[r];++r,a.is($t)&&(a=a,vn.any(a.upgrades,function(t){return t instanceof bt})||a.upgrades.push(X.createInstance(bt,[a.stage,this.city.cityMidStage,a.bgStage,a])))}}},__class__:hn};var un=function(){nn.call(this)};(V["cityUpgrades.MechanicalLiving"]=un).__name__="cityUpgrades.MechanicalLiving",un.__super__=nn,un.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.MechanicalHouse"].residents+=1,t.progress.resources.buildingInfo.h["buildings.TinkerersHome"].residents+=1},__class__:un});var dn=function(){nn.call(this)};(V["cityUpgrades.MedicalMachineLearning"]=dn).__name__="cityUpgrades.MedicalMachineLearning",dn.__super__=nn,dn.prototype=e(nn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.extendAgeBy+=.05},__class__:dn});var cn=function(){nn.call(this)};(V["cityUpgrades.OptimizedChipLayouts"]=cn).__name__="cityUpgrades.OptimizedChipLayouts",cn.__super__=nn,cn.prototype=e(nn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.computerChipFactorySpeed*=1.33},__class__:cn});var pn=function(){nn.call(this)};(V["cityUpgrades.SecretiveLiving"]=pn).__name__="cityUpgrades.SecretiveLiving",pn.__super__=nn,pn.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.SecretSocietyHouse"].quality+=25},__class__:pn});var gn=function(){nn.call(this)};(V["cityUpgrades.SlimyLiving"]=gn).__name__="cityUpgrades.SlimyLiving",gn.__super__=nn,gn.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.AlienHouse"].quality+=25,t.progress.unlocks.unlock(bt,!0)},__class__:gn});var mn=function(){nn.call(this)};(V["cityUpgrades.SpaciousLiving"]=mn).__name__="cityUpgrades.SpaciousLiving",mn.__super__=nn,mn.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.SpaciousHouse"].quality+=15},__class__:mn});var fn=function(){nn.call(this)};(V["cityUpgrades.SuperSpaciousLiving"]=fn).__name__="cityUpgrades.SuperSpaciousLiving",fn.__super__=nn,fn.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.SpaciousHouse"].residents+=1},__class__:fn});var yn=function(){nn.call(this)};(V["cityUpgrades.UniverseMapping"]=yn).__name__="cityUpgrades.UniverseMapping",yn.__super__=nn,yn.prototype=e(nn.prototype,{addToCity:function(t){(this.city=t).upgrades.vars.stoneTeleporterChanceForRefinedMetals=.04,t.upgrades.vars.stoneTeleporterHasBigStones=!0,t.upgrades.vars.starDatabaseIsMoreEffective=!0},__class__:yn});var _n=function(){this.advancedBuildingAllowed=!1,this.stoneResearchCenterWithFossils=null,this.stoneMiningSpeed=1,this.computerChipFactorySpeed=1,this.recyclingAmount=0,this.hasBirthControl=!1,this.extendAgeBy=0,this.stoneTeleporterChanceForRefinedMetals=0,this.starDatabaseIsMoreEffective=!1,this.stoneTeleporterHasBigStones=!1};(V["cityUpgrades.UpgradeVars"]=_n).__name__="cityUpgrades.UpgradeVars",_n.prototype={__class__:_n};var wn=function(){nn.call(this)};(V["cityUpgrades.WoodenLiving"]=wn).__name__="cityUpgrades.WoodenLiving",wn.__super__=nn,wn.prototype=e(nn.prototype,{addToCity:function(t){nn.prototype.addToCity.call(this,t),t.progress.resources.buildingInfo.h["buildings.ComfortableHouse"].quality+=10},__class__:wn});var bn=function(){};(V["common.AdHelper"]=bn).__name__="common.AdHelper",bn.init=function(t){t=new Tn(t);bn.provider=t,bn.adExpireTime=0},bn.update=function(t){0<=bn.adExpireTime&&(bn.adExpireTime-=t),0<=bn.adExpireTimeRewarded&&(bn.adExpireTimeRewarded-=t)},bn.cityUpdate=function(t,e){},bn.adAvailableRewarded=function(){return!!bn.provider.adAvailableRewarded()&&bn.adExpireTimeRewarded<=0},bn.showRewardedInterstitial=function(t,e,i){null==i&&(i=!1);var n=!1,i=function(){n||(n=!0,bn.adExpireTime=-1,bn.adExpireTimeRewarded=-1,e())};bn.adExpireTimeRewarded+=bn.minTimeBetweenRewarded,bn.provider.showRewardedInterstitial(t,i)||i(),bn.adExpireTime=Math.min(Math.max(bn.adExpireTime,bn.minTimeBetweenRewarded),bn.standardAdExpireTime)},bn.showNonRewardedInterstitialIfAllowed=function(t){null==t&&(t=!1),k.hasRemoveAds()||null!=bn.provider&&(bn.adExpireTime<=0||bn.noAdShown&&t)&&bn.provider.showNonRewardedInterstitialIfAllowed()&&(bn.adExpireTime+=bn.standardAdExpireTime,bn.noAdShown=!1)},bn.canShowBanner=function(){return!k.hasRemoveAds()&&(null!=bn.provider&&bn.provider.canShowBanner())},bn.showBanner=function(){bn.provider.showBanner()},bn.hideBanner=function(){bn.provider.hideBanner()},Kt=function(){},(V["common.AdProviderHelper"]=Kt).__name__="common.AdProviderHelper",Kt.__isInterface__=!0,Kt.prototype={__class__:Kt};var vn=function(){};(V["common.ArrayExtensions"]=vn).__name__="common.ArrayExtensions",vn.whereMax=function(t,e,i){null==i&&(i=function(t){return t});for(var n=-1/0,s=null,r=0;r<t.length;){var o,a=t[r];++r,!e(a)||n<(o=i(a))&&(s=a,n=o)}return s},vn.max=function(t,e){null==e&&(e=function(t){return t});for(var i=-1/0,n=null,s=0;s<t.length;){var r=t[s];++s;var o=e(r);i<o&&(n=r,i=o)}return n},vn.min=function(t,e){null==e&&(e=function(t){return t});for(var i=1/0,n=null,s=0;s<t.length;){var r=t[s];++s;var o=e(r);o<i&&(n=r,i=o)}return n},vn.sum=function(t,e){null==e&&(e=function(t){return t});for(var i=0,n=0;n<t.length;){var s=t[n];++n,i+=e(s)}return i},vn.sumFPoint=function(t,e){null==e&&(e=function(t){return t});for(var i=new In(0,0),n=0;n<t.length;){var s=t[n];++n;s=e(s),i=new In(i.x+s.x,i.y+s.y)}return i},vn.isum=function(t,e){null==e&&(e=function(t){return t});for(var i=0,n=0;n<t.length;){var s=t[n];++n,i+=e(s)}return i},vn.any=function(t,e){for(var i=0;i<t.length;){var n=t[i];if(++i,e(n))return!0}return!1},vn.all=function(t,e){for(var i=0;i<t.length;){var n=t[i];if(++i,!e(n))return!1}return!0},vn.findRandom=function(t,e){for(var i,n=bo.getInt(t.length),s=n;n<t.length;){if(e(i=t[n]))return i;++n}for(n=0;n<s;){if(e(i=t[n]))return i;++n}return null};var Sn=function(){};(V["common.ColorExtensions"]=Sn).__name__="common.ColorExtensions",Sn.toHexInt=function(t){return 65536*oa.get_red(t)+256*oa.get_green(t)+oa.get_blue(t)};var xn=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n};(V["common.Rectangle"]=xn).__name__="common.Rectangle",xn.fromPixiRect=function(t){return new xn(0|t.x,0|t.y,0|t.width,0|t.height)},xn.fromStoryRect=function(t){return new xn(t.x,t.y,t.width,t.height)},xn.prototype={get_x2:function(){return this.x+this.width},get_y2:function(){return this.y+this.height},get_center:function(){return new Cn(this.x+(this.width/2|0),this.y+(this.height/2|0))},clone:function(){return new xn(this.x,this.y,this.width,this.height)},intersects:function(t){var e=this.x;return!!(e>=t.x&&e<t.x+t.width||(e=t.x)>=this.x&&e<this.x+this.width)&&((e=t.y)>=this.y&&e<this.y+this.height||(e=this.y)>=t.y&&e<t.y+t.height)},fullyContains:function(t){return this.x<=t.x&&this.y<=t.y&&this.get_x2()>t.get_x2()&&this.get_y2()>t.get_y2()},contains:function(t){var e=t.x;return e>=this.x&&e<this.x+this.width&&((e=t.y)>=this.y&&e<this.y+this.height)},__class__:xn};var Pn=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n};(V["common.FRectangle"]=Pn).__name__="common.FRectangle",Pn.prototype={get_x2:function(){return this.x+this.width},get_y2:function(){return this.y+this.height},clone:function(){return new Pn(this.x,this.y,this.width,this.height)},__class__:Pn};var Cn=function(t,e){this.x=t,this.y=e};(V["common.Point"]=Cn).__name__="common.Point",Cn.distance=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},Cn.mean=function(t,e){return new In(.5*(t.x+e.x),.5*(t.y+e.y))},Cn.prototype={__class__:Cn};var In=function(t,e){this.x=t,this.y=e};(V["common.FPoint"]=In).__name__="common.FPoint",In.distance=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},In.prototype={get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},__class__:In},fe=function(){},(V["common.DesktopHelpers"]=fe).__name__="common.DesktopHelpers",fe.update=function(t){var e;t.keyboard.pressed[119]&&((e=chrome.app.window.getAll()[0]).innerBounds.width=1280,e.innerBounds.height=720),t.keyboard.pressed[118]&&((e=chrome.app.window.getAll()[0]).innerBounds.width=1920,e.innerBounds.height=1080)};var Tn=function(t){this.adsBlocked=!1,this.game=t};(V["common.GameDistributionAdsHelper"]=Tn).__name__="common.GameDistributionAdsHelper",Tn.__interfaces__=[Kt],Tn.prototype={adAvailableRewarded:function(){return!!this.adAvailable()&&gd_rewardedAvailable()},adAvailable:function(){return!this.adsBlocked},showRewardedInterstitial:function(t,e){return gd_showRewarded(function(){t()}),!0},showNonRewardedInterstitialIfAllowed:function(){return"undefined"!=typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd().then(()=>{}).catch(t=>{}),!0},canShowBanner:function(){return!1},showBanner:function(){},hideBanner:function(){},__class__:Tn};var Bn=function(){};(V["common.KongTools"]=Bn).__name__="common.KongTools",Bn.init=function(){jsFunctions.loadJS("site-specific/kong/quickKong.js",function(){try{QuickKong.doInitKong(),Bn.kongJSLoaded=!0}catch(t){}})},Bn.reportHappiness=function(t){t>Bn.highestHappinessKnown&&(Bn.highestHappinessKnown=t,Bn.statTimeout=60),Bn.statTimeout<=0&&Bn.highestHappinessKnown>Bn.highestHappinessReported&&Bn.kongJSLoaded&&(QuickKong.setStat("happiness",Bn.highestHappinessKnown),Bn.highestHappinessReported=Bn.highestHappinessKnown,Bn.statTimeout=120)},Bn.setStat=function(t,e){Bn.kongJSLoaded&&QuickKong.setStat(t,e)};var kn=function(){};(V["common.Localize"]=kn).__name__="common.Localize",kn.init=function(t){kn.game=t},kn.loadLanguage=function(t,i,n,s){Mn.load(t,function(t,e){t?(i?kn.defaultLocalizations=e:kn.localizations=e,n()):s()})},kn.translateFiles=function(t){for(var e=zr.keysIterator(H.buildingInfo.h);e.hasNext();){var i=e.next(),n="buildinginfo.json/"+(a=H.buildingInfo.h[i]).className+".";if(a.name=kn.lo(n+"name"),a.description=kn.lo(n+"description"),null!=a.tooltipBottomIconInfo)for(var s=0,r=a.tooltipBottomIconInfo.length;s<r;){var o=s++;a.tooltipBottomIconInfo[o].text=kn.lo(n+"tooltipBottomIconInfo_"+o)}null!=(l=kn.lo(n+"showUnlockHint"))&&"!!! missing text !!!"!=l&&(a.showUnlockHint=l)}if(null!=t)for(s=0;s<t.length;){var a=t[s];++s;var l,n="buildinginfo.json/"+a.className+".";if(a.name=kn.lo(n+"name"),a.description=kn.lo(n+"description"),null!=a.tooltipBottomIconInfo)for(var r=0,h=a.tooltipBottomIconInfo.length;r<h;){o=r++;a.tooltipBottomIconInfo[o].text=kn.lo(n+"tooltipBottomIconInfo_"+o)}null!=(l=kn.lo(n+"showUnlockHint"))&&"!!! missing text !!!"!=l&&(a.showUnlockHint=l)}for(var u=zr.keysIterator(H.buildingUpgradesInfo.h);u.hasNext();){var d=u.next(),n="buildingUpgradesInfo.json/"+(a=H.buildingUpgradesInfo.h[d]).className+".";a.name=kn.lo(n+"name"),a.description=kn.lo(n+"description")}for(s=0,r=H.worldResourcesInfo;s<r.length;){var c=r[s];++s;n="buildableWorldResourcesInfo.json/"+c.className+".";c.name=kn.lo(n+"name"),c.description=kn.lo(n+"description")}for(s=0,r=H.buildingCategoriesInfo;s<r.length;){var p=r[s];++s,p.displayName=kn.lo("categories/"+p.name+".name"),p.description=kn.lo("categories/"+p.name+".description")}for(s=0,r=H.decorationsInfo;s<r.length;){var g=r[s];++s,g.name=kn.lo("decorationsInfo.json/"+g.textureName+".name"),g.description=kn.lo("decorationsInfo.json/"+g.textureName+".description"),"!!! missing text !!!"==g.description&&(g.description=null)}for(var m=zr.valueIterator(H.cityUpgradesInfo.h);m.hasNext();){var f=m.next(),n="cityUpgradesInfo.json/"+f.className+".";f.name=kn.lo(n+"name"),f.description=kn.lo(n+"description")}for(s=0,r=H.allStoriesInfo;s<r.length;){var y=r[s];++s;n="stories.json/"+y.link+".";y.name=kn.lo(n+"name"),y.description=kn.lo(n+"description")}},kn.translateStory=function(t,e){for(var i=t+".json/",n=0,s=e.goals;n<s.length;){var r=s[n];++n,r.quickText=kn.lo(i+r.name+".quickText"),"Welcome to this Free Play Scenario!\nA few citizens are already here. Some more will arrive over the coming days."==r.text?r.text=kn.lo("FreePlay.FreePlayStart.text"):r.text=kn.lo(i+r.name+".text");var o=kn.lo(i+r.name+".title");if("!!! missing text !!!"!=o&&(r.title=o),null!=r.planning)for(var a=0,l=r.planning;a<l.length;){var h=l[a];++a,"ScriptedStoryPart"==h.type&&"SpawnCitizensRegularly"==h.className&&("All the people from your ship have now arrived. Of course, your population can still grow through their offspring."==(h=h).afterDoneMessage?h.afterDoneMessage=kn.lo("FreePlay.FreePlayStart.planning.afterDoneMessage"):"All the people from your previous city have now arrived. Of course, your population can still grow through their offspring."==h.afterDoneMessage?h.afterDoneMessage=kn.lo("previous_city_arrived"):"The people who wanted to move here have now all arrived. Of course, your population can still grow through their offspring."==h.afterDoneMessage&&(h.afterDoneMessage=kn.lo("moved_here_arrived")))}}},kn.lo=function(t,e){if(null==(o=kn.localizations.h[t])&&null==(o=kn.defaultLocalizations.h[t])&&(o="!!! missing text !!!"),-1!=o.indexOf("[")&&(o=N.replace(o,"[tap]",kn.game.textHelper.clickOrTap(!1)),o=N.replace(o,"[Tap]",kn.game.textHelper.clickOrTap(!0))),null!=e)for(var i=0,n=e.length;i<n;)var s=i++,r=e[s],o=N.replace(o,"["+s+"]",r);return N.replace(o,"\\n","\n")};var Mn=function(){};function zn(){}(V["common.LocalizeLoader"]=Mn).__name__="common.LocalizeLoader",Mn.load=function(t,i){var e=new PIXI.loaders.Loader;e.add("https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/lang_"+t+".csv?cache=20210613164938"),e.use(function(t,e){t.error?i(!1,null):(i(!0,Mn.processLangFile(t.data)),e())}),e.load(function(){})},Mn.processLangFile=function(t){var e=new zr,i=t.split("\r\n");1==i.length&&(i=t.split("\n"));for(var n=0,s=i.length;n<s;){var r=i[n++],o=r.indexOf("|"),a=r.substring(0,o),o=Y.substr(r,o+1,null);e.h[a]=o}return e},(V["common.MathExtensions"]=zn).__name__="common.MathExtensions",zn.largeNumberFormat=function(t,e){return 1e8<e?zn.floatFormat(Math,e/1e6,0)+"m":1e6<e?zn.floatFormat(Math,e/1e6,1)+"m":1e4<e?zn.floatFormat(Math,e/1e3,0)+"k":1e3<e?zn.floatFormat(Math,e/1e3,1)+"k":""+e},zn.largeNumberFormatAlt=function(t,e){return 1e6<e?zn.floatFormat(Math,e/1e6,1)+"m":1e5<e?zn.floatFormat(Math,e/1e3,0)+"k":""+e},zn.floatFormat=function(t,e,i){if(0==i)return q.string(Math.floor(e));var n=""+(e=Math.round(e*Math.pow(10,i))),s=n.length;if(s<=i){for(;s<i;)n="0"+n,++s;return"0."+n}return Y.substr(n,0,n.length-i)+"."+Y.substr(n,n.length-i,null)};var An=function(){};(V["common.Performance"]=An).__name__="common.Performance",An.get_fps=function(){return 1e3/(vn.sum(An.frameTimeValues)/An.frameTimeValues.length)},An.registerFrame=function(){var t=window.performance.now();60<An.frameTimeValues.length&&An.frameTimeValues.splice(0,1),0!=An.previousTime&&An.frameTimeValues.push(t-An.previousTime),An.previousTime=t,An.isDrawingFPSCurrently&&(An.fpsBitmap.set_text(Math.round(An.get_fps())+""),100<=An.get_fps()&&(An.fpsRect.clear(),An.fpsRect.beginFill(0,.5),An.fpsRect.drawRect(7*An.dpi,7*An.dpi,46*An.dpi,29*An.dpi),An.fpsRect.endFill()))};var Wn=function(t){this.text2=null,this.stage=t,this.subStage1=new PIXI.Container,t.addChild(this.subStage1),this.subStage2=new PIXI.Container,t.addChild(this.subStage2),this.logoSprite=new PIXI.Sprite(H.getTexture("spr_title")),this.subStage2.addChild(this.logoSprite),this.graphics=new PIXI.Graphics,this.subStage1.addChild(this.graphics),jsFunctions.orientationLockSupported()?(this.text=new Hn("Please tap anywhere to continue.",{font:"Arial18",tint:16777215}),this.text2=new Hn("(if this has no effect, please rotate your device manually)",{font:"Arial16",tint:12632256}),this.text.get_anchor().set(.5,1),this.text2.get_anchor().set(.5,1)):(this.text=new Hn("Please rotate your device to continue.",{font:"Arial18",tint:16777215}),this.text.get_anchor().set(.5,1)),this.text.set_align("center"),null!=this.text2&&(this.text2.set_align("center"),this.subStage1.addChild(this.text2)),this.subStage1.addChild(this.text)};(V["common.PleaseRotateDevice"]=Wn).__name__="common.PleaseRotateDevice",Wn.prototype={update:function(t,e,i){this.subStage1.scale.x=this.subStage1.scale.y=i;var n=Math.floor(t*i/this.logoSprite.width),n=n<1?1:n;this.subStage2.scale.x=this.subStage2.scale.y=n,this.logoSprite.anchor.set(.5,0),this.logoSprite.position.set(t/n*i/2,20),this.graphics.clear(),this.graphics.beginFill(2626656,1).drawRect(0,0,t,e),this.text.set_maxWidth(t-20),null!=this.text2?(this.text2.set_maxWidth(t-20),this.text2.position.set(t/2,e-20),this.text.position.set(t/2,e-20-this.text2.get_textHeight()-10)):this.text.position.set(t/2,e-20)},destroy:function(){this.subStage1.destroy(),this.subStage2.destroy()},__class__:Wn};var Fn=function(){};(V["common.PokiHelpers"]=Fn).__name__="common.PokiHelpers",Fn.reportStartGameplay=function(){},Fn.reportStopGameplay=function(){},fe=function(t,e,i,n,s,r,o,a){this.stage=t,this.splashSprite=new PIXI.Sprite(PIXI.Texture.fromImage(e,null)),t.addChild(this.splashSprite),this.logoWidth=i,this.logoHeight=n,this.resize(s,r),this.displayTimeLeft=o,this.onDone=a},(V["common.Splash"]=fe).__name__="common.Splash",fe.prototype={update:function(t){this.splashSprite.texture.baseTexture.hasLoaded&&(this.displayTimeLeft-=t,this.displayTimeLeft<=0&&(this.destroy(),this.onDone()))},resize:function(t,e){var i=Math.min(t/this.logoWidth,e/this.logoHeight);this.splashSprite.scale.x=i,this.splashSprite.scale.y=i,this.splashSprite.position.set((t/this.logoWidth-i)*this.logoWidth/2,(e/this.logoHeight-i)*this.logoHeight/2)},destroy:function(){this.splashSprite.destroy()},__class__:fe};var On=function(){};(V["common.Storage"]=On).__name__="common.Storage",On.testSupport=function(e,t){if(!On.knowsSupport||On.hasSupport)if(On.knowsSupport&&On.hasSupport)e();else try{localforage.ready().then(function(){On.hasSupport=!0,On.knowsSupport=!0,e()}).catch(function(){On.hasSupport=!1,On.knowsSupport=!0,On.storageReplacement=new zr,t()})}catch(t){On.knowsSupport=!0,On.hasSupport=!0,e()}else t()},On.getItem=function(t,e,i){return null==i&&(i=!1),On.hasSupport?i?localforage.getItemBuffer(t,e):localforage.getItemParsed(t,e):(On.testSupport(function(){null==(i?localforage.getItemBuffer(t,e):localforage.getItemParsed(t,e))&&e("error",null)},function(){Object.prototype.hasOwnProperty.call(On.storageReplacement.h,t)?e(null,On.storageReplacement.h[t]):e("error",null)}),-1)},On.setItem=function(t,e,i){On.testSupport(function(){localforage.setItem(t,e,i)},function(){On.storageReplacement.h[t]=e,i()})},On.storageSupported=function(){return!On.knowsSupport||On.hasSupport};var Dn=function(){};(V["common.StringExtensions"]=Dn).__name__="common.StringExtensions",Dn.firstToUpper=function(t){return 0==t.length?t:t.charAt(0).toUpperCase()+Y.substr(t,1,null)};var Rn=function(t){this.game=t};(V["common.TextHelper"]=Rn).__name__="common.TextHelper",Rn.prototype={ifNotMobile:function(t){return this.game.isMobile?"":t},clickOrTap:function(t){return null==t&&(t=!0),t?this.game.isMobile?Dn.firstToUpper(kn.lo("tap")):Dn.firstToUpper(kn.lo("click")):this.game.isMobile?kn.lo("tap"):kn.lo("click")},__class__:Rn};var Un=function(){};(V["gamesave.GameSaveHelper"]=Un).__name__="gamesave.GameSaveHelper",Un.makeLoadMap=function(t,e){for(var i=new zr,n=0,s=t.split("|");n<s.length;){var r=s[n];if(++n,""!=r){var r=r.split("$"),o=r[1];switch(o){case"Bool":var a,l=e.version<29?(a=e.bytes.getInt32(e.readStart),e.readStart+=4,1==a&&!0):(h=e.bytes.b[e.readStart],e.readStart+=1,0<h);break;case"FPoint":l=e.readFPoint();break;case"Float":var h=e.bytes.getDouble(e.readStart);e.readStart+=8,l=h;break;case"Int":var u=e.bytes.getInt32(e.readStart);e.readStart+=4,l=u;break;case"Point":l=e.readPoint();break;case"Rectangle":l=e.readRectangle();break;case"String":l=e.readString();break;case"ds":l=_r.run(e.readString());break;default:u=x[o];if(null==u)throw cr.thrown("That type isn't supported while loading the game!");l=X.createEnum(u,e.readString())}i.h[r[0]]=l}}return i};var Ln=function(t){this.version=0,this.bytes=null!=t?t:new br(new ArrayBuffer(10)),this.size=0,this.readStart=0,this.stringLocations=new zr};(V["gamesave.ResizingBytesQueue"]=Ln).__name__="gamesave.ResizingBytesQueue",Ln.fromBase64=function(t){var e=new Ln;return e.bytes=Sr.decode(t),e.size=e.bytes.length,e},Ln.fromData=function(t){var e=new Ln;return e.bytes=br.ofData(t.buffer),e.size=e.bytes.length,e},Ln.prototype={addFloat:function(t){var e;this.size+8>this.bytes.length&&(e=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+8))),this.bytes.blit(0,e,0,this.size)),this.bytes.setDouble(this.size,t),this.size+=8},addInt:function(t){var e;this.size+4>this.bytes.length&&(e=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,e,0,this.size)),this.bytes.setInt32(this.size,t),this.size+=4},addByte:function(t){var e;this.size+1>this.bytes.length&&(e=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,e,0,this.size)),this.bytes.b[this.size]=t,this.size+=1},addBool:function(t){var e;this.size+1>this.bytes.length&&(e=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,e,0,this.size)),this.bytes.b[this.size]=t?1:0,this.size+=1},addString:function(t){var e=this.stringLocations.h[t];if(null!=e)return this.size+1>this.bytes.length&&(s=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,s,0,this.size)),this.bytes.b[this.size]=1,this.size+=1,this.size+4>this.bytes.length&&(s=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,s,0,this.size)),this.bytes.setInt32(this.size,e),void(this.size+=4);this.size+1>this.bytes.length&&(s=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,s,0,this.size)),this.bytes.b[this.size]=0,this.size+=1;var e=this.size,i=(t.length,0);this.size+4>this.bytes.length&&(s=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,s,0,this.size)),this.bytes.setInt32(this.size,0),this.size+=4;for(var n=0;n<t.length;){var s,r,o,a,l,h,u=t.charCodeAt(n++);55296<=u&&u<=56319&&(u=u-55232<<10|1023&t.charCodeAt(n++),0),u<=127?(this.size+1>this.bytes.length&&(s=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,s,0,this.size)),this.bytes.b[this.size]=u,this.size+=1,++i):u<=2047?(this.size+1>this.bytes.length&&(r=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,r,0,this.size)),this.bytes.b[this.size]=192|u>>6,this.size+=1,this.size+1>this.bytes.length&&(o=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,o,0,this.size)),this.bytes.b[this.size]=128|63&u,this.size+=1,i+=2):u<=65535?(this.size+1>this.bytes.length&&(o=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,o,0,this.size)),this.bytes.b[this.size]=224|u>>12,this.size+=1,this.size+1>this.bytes.length&&(a=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,a,0,this.size)),this.bytes.b[this.size]=128|u>>6&63,this.size+=1,this.size+1>this.bytes.length&&(a=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,a,0,this.size)),this.bytes.b[this.size]=128|63&u,this.size+=1,i+=3):(this.size+1>this.bytes.length&&(l=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,l,0,this.size)),this.bytes.b[this.size]=240|u>>18,this.size+=1,this.size+1>this.bytes.length&&(l=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,l,0,this.size)),this.bytes.b[this.size]=128|u>>12&63,this.size+=1,this.size+1>this.bytes.length&&(h=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,h,0,this.size)),this.bytes.b[this.size]=128|u>>6&63,this.size+=1,this.size+1>this.bytes.length&&(h=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+1))),this.bytes.blit(0,h,0,this.size)),this.bytes.b[this.size]=128|63&u,this.size+=1,i+=4)}this.stringLocations.h[t]=e,this.bytes.setInt32(e,i)},addRectangle:function(t){var e=t.x;this.size+4>this.bytes.length&&(i=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)),this.bytes.setInt32(this.size,e),this.size+=4;e=t.y;this.size+4>this.bytes.length&&(i=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)),this.bytes.setInt32(this.size,e),this.size+=4;e=t.width;this.size+4>this.bytes.length&&(i=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)),this.bytes.setInt32(this.size,e),this.size+=4;var i,e=t.height;this.size+4>this.bytes.length&&(i=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+4))),this.bytes.blit(0,i,0,this.size)),this.bytes.setInt32(this.size,e),this.size+=4},readRectangle:function(){var t=this.bytes.getInt32(this.readStart);this.readStart+=4;var e=this.bytes.getInt32(this.readStart);this.readStart+=4;var i=this.bytes.getInt32(this.readStart);this.readStart+=4;var n=this.bytes.getInt32(this.readStart);return this.readStart+=4,new xn(t,e,i,n)},addFPoint:function(t){var e=t.x;this.size+8>this.bytes.length&&(i=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+8))),this.bytes.blit(0,i,0,this.size)),this.bytes.setDouble(this.size,e),this.size+=8;var i,e=t.y;this.size+8>this.bytes.length&&(i=this.bytes,this.bytes=new br(new ArrayBuffer(2*(this.size+8))),this.bytes.blit(0,i,0,this.size)),this.bytes.setDouble(this.size,e),this.size+=8},addJSON:function(t){this.addString(JSON.stringify(t))},readJSON:function(){return JSON.parse(this.readString())},readPoint:function(){var t=this.bytes.getInt32(this.readStart);this.readStart+=4;var e=this.bytes.getInt32(this.readStart);return this.readStart+=4,new Cn(t,e)},readFPoint:function(){var t=this.bytes.getDouble(this.readStart);this.readStart+=8;var e=this.bytes.getDouble(this.readStart);return this.readStart+=8,new In(t,e)},readString:function(){var t=this.bytes.b[this.readStart];this.readStart+=1;if(1==t){var e=this.bytes.getInt32(this.readStart);this.readStart+=4;var t=e,i=this.bytes.getInt32(t);return this.bytes.getString(t+4,i)}e=this.bytes.getInt32(this.readStart);this.readStart+=4;i=e,e=this.bytes.getString(this.readStart,i);return this.readStart+=i,e},readInt:function(){var t=this.bytes.getInt32(this.readStart);return this.readStart+=4,t},peekInt:function(){return this.bytes.getInt32(this.readStart)},readByte:function(){var t=this.bytes.b[this.readStart];return this.readStart+=1,t},readBool:function(){var t=this.bytes.b[this.readStart];return this.readStart+=1,0<t},readFloat:function(){var t=this.bytes.getDouble(this.readStart);return this.readStart+=8,t},toBase64:function(){var t=new br(new ArrayBuffer(this.size));return t.blit(0,this.bytes,0,this.size),Sr.encode(t)},getData:function(){var t=new br(new ArrayBuffer(this.size));return t.blit(0,this.bytes,0,this.size),t.b},__class__:Ln};var En=function(){};(V["gamesave.SaveMetaData"]=En).__name__="gamesave.SaveMetaData",En.saveMetaData=function(t,e){var i=tt.find(H.allStoriesInfo,function(t){return t.link==e.progress.story.storyName}),n=kn.lo("city");null!=i&&(n=i.name),""!=e.cityName&&(n=e.cityName);n=kn.lo("file_description",[n,e.simulation.citizens.length]);On.setItem(t+"__meta",n,function(){}),On.setItem("__meta__mostRecentlyPlayed",t,function(){})};var Hn=function(t,e,i){null==i&&(i=!1),PIXI.Container.call(this),"vi"!=R.language||i||(e.font=q.string(e.font)+"_vi"),this.internalText=new PIXI.extras.BitmapText(t,e),this.addChild(this.internalText),"vi"!=R.language||i||(this.internalText.position.y=1)};(V["graphics.BitmapText"]=Hn).__name__="graphics.BitmapText",Hn.__super__=PIXI.Container,Hn.prototype=e(PIXI.Container.prototype,{set_maxWidth:function(t){return this.internalText.maxWidth=t},get_text:function(){return this.internalText.text},set_text:function(t){return this.internalText.text=t},get_textWidth:function(){return this.internalText.textWidth},get_textHeight:function(){return this.internalText.textHeight},get_font:function(){return this.internalText.font},set_tint:function(t){return this.internalText.tint=t},get_anchor:function(){return this.internalText.anchor},set_align:function(t){return this.internalText.align=t},__class__:Hn});var Nn=function(t){this.previousCullRectangle=null,this.isInvalid=!0,PIXI.Container.call(this),this.cacheWithinRect=t,this.cacheableChildren=[],this.cacheContainer=new PIXI.Container,this.explicitUncachedContainer=new PIXI.Container,this.addChild(this.cacheContainer),this.addChild(this.explicitUncachedContainer)};(V["graphics.CachingContainer"]=Nn).__name__="graphics.CachingContainer",Nn.__super__=PIXI.Container,Nn.prototype=e(PIXI.Container.prototype,{preDraw:function(t){if(this.isInvalid){if(S.isCanvasRenderer&&!S.isMobile||this.cacheableChildren.length<512&&(!S.isMobile||0==this.cacheableChildren.length)){this.cacheContainer.cacheAsBitmap=!1;for(var e=0,i=this.cacheableChildren;e<i.length;){var n=i[e];++e,n.parent!=this.explicitUncachedContainer&&(null!=n.parent&&n.parent.removeChild(this.parent),this.explicitUncachedContainer.addChild(n),n.visible=!0)}}else{for(e=0,i=this.cacheableChildren;e<i.length;){n=i[e];++e;var s=n,s=null!=s.width?new xn(Math.floor(n.x),Math.floor(n.y),Math.ceil(s.width+1),Math.ceil(s.height+1)):xn.fromPixiRect(n.getLocalBounds());this.cacheWithinRect.fullyContains(s)?n.parent!=this.cacheContainer&&(null!=n.parent&&n.parent.removeChild(this.parent),this.cacheContainer.addChild(n),n.visible=!0):n.parent!=this.explicitUncachedContainer&&(null!=n.parent&&n.parent.removeChild(this.parent),this.explicitUncachedContainer.addChild(n))}this.cacheContainer.cacheAsBitmap=!1,this.cacheContainer.cacheAsBitmap=!0}this.isInvalid=!1,this.cull(t),this.previousCullRectangle=t.clone()}else null!=this.previousCullRectangle&&this.previousCullRectangle.x==t.x&&this.previousCullRectangle.y==t.y&&this.previousCullRectangle.width==t.width&&this.previousCullRectangle.height==t.height||(this.cull(t),this.previousCullRectangle=t.clone())},uncull:function(){for(var t=0,e=this.explicitUncachedContainer.children;t<e.length;){var i=e[t];++t,i.visible=!0}this.previousCullRectangle=null},cull:function(t){for(var e=t.get_x2(),i=t.get_y2(),n=0,s=this.explicitUncachedContainer.children;n<s.length;){var r=s[n];++n;null!=r.width&&(r.visible=r.x+r.width>=t.x&&r.y+r.height>=t.y&&r.x<e&&r.y<i)}},removeCache:function(){this.cacheContainer.cacheAsBitmap=!1},__class__:Nn});var Gn=function(){PIXI.Container.call(this)};(V["graphics.CullableContainer"]=Gn).__name__="graphics.CullableContainer",Gn.__super__=PIXI.Container,Gn.prototype=e(PIXI.Container.prototype,{preDraw:function(t){this.cull(t)},uncull:function(){for(var t=0,e=this.children;t<e.length;){var i=e[t];++t,i.visible=!0}},cull:function(t){for(var e=t.get_x2(),i=t.get_y2(),n=0,s=this.children;n<s.length;){var r=s[n];++n;null!=r.width&&(r.visible=r.x+r.width>=t.x&&r.y+r.height>=t.y&&r.x<e&&r.y<i)}},__class__:Gn});var Xn=function(t,e,i,n){this.stage=t,this.position=e,this.textureName=i,this.textures=H.getTexturesByWidth(i,20),null==n&&(n=bo.getInt(this.textures.length)),this.sprite=new PIXI.Sprite(this.textures[n]),this.subImage=n,this.sprite.position.set(e.x,e.y),t.addChild(this.sprite)};function jn(){}(V["graphics.GroundDecoration"]=Xn).__name__="graphics.GroundDecoration",Xn.prototype={destroy:function(){this.stage.removeChild(this.sprite)},__class__:Xn},(V["graphics.Particle"]=jn).__name__="graphics.Particle",jn.create=function(t,e,i){var n=0==jn.pool.length?new jn:jn.pool.pop();return n.___internal_pooling_initObject(t,e,i),n},jn.prototype={___internal_pooling_initObject:function(t,e,i){this.stage=t,this.textures=e,this.frame=0,this.animSpeed=.5,this.sprite=so.create(e[0],t),this.sprite.position.set(i.x,i.y)},update:function(t){if(this.frame+=this.animSpeed*t,this.frame>=this.textures.length){var e=this.sprite,t=this.stage;return e.visible=!1,e.position.set(-1e5,-1e5),so.pool.h[t.__id__].push(e),this.destroy(),!0}return this.sprite.texture=this.textures[0|this.frame],!1},destroy:function(){jn.pool.push(this)},__class__:jn};var Vn=function(){};(V["graphics.ParticleContainerHelper"]=Vn).__name__="graphics.ParticleContainerHelper",Vn.recreateContainer=function(t){var e=t.parent,i=t.parent.children.indexOf(t);t.parent.removeChild(t),e.addChildAt(t,i)};var Yn=function(t){this.stage=t,this.particles=[]};(V["graphics.Particles"]=Yn).__name__="graphics.Particles",Yn.prototype={update:function(t){for(var e=this.particles.length;0<=--e;)this.particles[e].update(t)&&(this.particles[e]=this.particles[this.particles.length-1],this.particles.pop())},addParticle:function(t,e){e=jn.create(this.stage,t,e);return this.particles.push(e),e},__class__:Yn};var $n=function(t,e){this.maxStarY=800,this.maxStarX=800,this.stage=t,this.city=e,this.sprites=[],this.resize()};(V["graphics.Stars"]=$n).__name__="graphics.Stars",$n.prototype={get_requiredNumberOfStars:function(){return this.maxStarX*this.maxStarY/1e3|0},resize:function(){var t=1,e=1;this.city.get_displayWidth()>this.maxStarX&&(t=this.city.get_displayWidth()/this.maxStarX,this.maxStarX=this.city.get_displayWidth()),this.city.get_displayHeight()>this.maxStarY&&(e=this.city.get_displayHeight()/this.maxStarY,this.maxStarY=this.city.get_displayHeight());for(var i=0,n=this.sprites;i<n.length;){var s=n[i];++i,s.position.x*=t,s.position.y*=e}for(i=this.sprites.length,n=this.get_requiredNumberOfStars();i<n;){i++;var s=H.makeSprite("spr_pixel"),r=[bo.getFloat(360),bo.getFloat(0,1),bo.getFloat(.9,1)];s.tint=oa.toInt(sa.toRgb(r)),s.position.set(bo.getInt(this.maxStarX),bo.getInt(this.maxStarY)),s.alpha=bo.getFloat(.2,.6),this.sprites.push(s),this.stage.addChild(s)}},update:function(){var t=this.city.simulation.time.timeSinceStart/60%24;this.stage.alpha=23<=t||t<4?1:4<=t&&t<6?1-(t-4)/2:21<=t&&t<23?1-(23-t)/2:0,this.stage.visible=0!=this.stage.alpha},__class__:$n};var qn=function(){};function Kn(){}function Qn(){}function Jn(t,e,i,n,s,r,o){this.destroyed=!1,this.maskRect=null,this.game=t,this.outerStage=e,this.parent=i,this.stage=new PIXI.Container,e.addChild(this.stage),this.scrollPosition=new Cn(0,0),this.rect=new xn(0,0,s,r),this.origin=o,this.updatePosition(n),this.updateSize(),this.dragDir=new In(0,0),this.dragDirRemaining=new In(0,0),this.remainingStepDragDir=new In(0,0)}function Zn(t,e,i,n,s,r,o){this.maxWidth=s,this.maxHeight=r,Jn.call(this,t,e,i,n,s,r,o)}(V["graphics.WorldImage"]=qn).__name__="graphics.WorldImage",qn.makeWorldSprite=function(t,n,e,i){var s=2103312,r=5259312,o=e-((F=e-10)<0?0:12<F?12:F);"key"!=i&&"key2"!=i||(r=5195330,s=1973275);var a=window.document.createElement("canvas");a.width=n,a.height=e;for(var l=a.getContext("2d"),h=l.createImageData(n,e),u=[],d=0,c=n/20|0;d<c;){for(var p=d++,g=[],m=0,f=e/20|0;m<f;){var y=m++;g.push(!1)}u.push(g)}for(var _=u,w=Math.floor(o-o/4),b=Math.floor(o-o/2),v=Math.floor(o-o/3),S=[{x:0,y:0}],x=0|Math.min(o/4+t.getInt(-5,6),n/3),P=0|Math.max(1,Math.floor((n-2*x)/(t.getInt(25,35)+n/40))),C=Math.floor((n-2*x)/P),I=x+((n-2*x-C*(P-.5))/2|0),u=0,d=P;u<d;){var T=u++;S.push({x:I+t.getInt(-6,7),y:t.getInt(w,o)}),T!=P-1&&S.push({x:I+(C/2|0)+t.getInt(-6,7),y:t.getInt(b,v)}),I+=C}S.push({x:n-1,y:0});function B(t,e){var i=4*(n*e+t);h.data[i]=r>>16&255,h.data[1+i]=r>>8&255,h.data[2+i]=255&r,h.data[3+i]=255,_[t/20|0][e/20|0]=!0}var k=1.6,M=1.2,z=8;"key"==i&&(k=1,M=.8,z=3);for(var A=0,W=0,u=0,d=n;u<d;){var F,T=u++,O=z/(Math.abs(S[A+1].y-S[A].y)+5),W=(F=W+t.getFloat(-O,O))<-.2?-.2:.2<F?.2:F;if(T>S[A+1].x){if(S[A+1].y>S[A].y)for(var D=t.getInt(1,3),R=t.getInt(5,8),c=0,g=D;c<g;)for(var U,L=c++,L=t.getInt(-2,3)+T-(D-1)*R+(2*R*L|0),E=S[A+1].y+t.getInt(3),H=L-1,N=L,m=E+2,f=E+11;m<f;){(y=m++)<=E+5?(H-=t.getInt(y<E+5?3:2),N+=t.getInt(y<E+5?3:2)):(H=N<(U=H+t.getInt(E+6<y?3:2))?N:U,N=(U=N-t.getInt(E+6<y?3:2))<H?H:U),y==E+2&&N-H==1&&++N,y==E+3&&N-H==2&&--H;for(var G=H,X=N;G<X;)0<=(p=G++)&&p<n&&y+2<e&&B(p,y)}++A}for(var j=S[A],V=S[A+1],O=(T-j.x)/(V.x-j.x),O=V.y<j.y?Math.pow(O,k-O*M+W):1-Math.pow(1-O,k-(1-O)*M-W),V=Math.floor(O*(V.y-j.y)+j.y),j=o-1,Y=0,$=(j<V?j:V)+1;Y<$;)B(T,Y++)}for(u=0,d=h.data.length/4|0;u<d;){p=(T=u++)%n,y=Math.floor(T/n);255!=h.data[4*T+3]||0!=p&&0!=y&&p!=n-1&&y!=e-1&&0!=h.data[4*T-1]&&0!=h.data[4*T+7]&&0!=h.data[4*((y-1)*n+p)+3]&&0!=h.data[4*((y+1)*n+p)+3]||(h.data[4*T]=s>>16&255,h.data[4*T+1]=s>>8&255,h.data[4*T+2]=255&s)}return l.putImageData(h,0,0),{sprite:new PIXI.Sprite(PIXI.Texture.fromCanvas(a)),mask:_}},(V["gui.ActivableButton"]=Kn).__name__="gui.ActivableButton",Kn.create=function(t,e,i,n,s,r){n=new ls(t,e,i,n,s,null,"spr_button_activable"),s=t.game.isMobile?3:0;return n.container.padding.top=3+s,n.container.padding.left=3,n.container.padding.right=3,n.container.padding.bottom=s,null!=r&&n.container.addChild(new Qs(n.container,t.innerWindowStage,r)),n.container.fillSecondarySize=!0,n},(V["gui.AdRewardWindow"]=Qn).__name__="gui.AdRewardWindow",Qn.create=function(t,e,i,n,s,r){t.gui.windowAddTitleText(k.hasRemoveAds()?kn.lo("boost_activated"):kn.lo("thank_you_ex")),n.addChild(new Qs(n,i,kn.lo("boost_activated_description"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),"en"==R.language&&n.addChild(new Qs(n,i,s.text,null,"Arial15"));s=new Us(s.materials),s=new us(t.gui.windowInner,t.gui.innerWindowStage,s);n.addChild(s),""!=r&&(n.addChild(new Cs(n,new Cn(2,6))),e.windowAddInfoText(r)),e.windowAddBottomButtons()},Kt=function(){},(V["gui.IGUIElement"]=Kt).__name__="gui.IGUIElement",Kt.__isInterface__=!0,Kt.prototype={__class__:Kt},(V["gui.Scrollable"]=Jn).__name__="gui.Scrollable",Jn.__interfaces__=[Kt],Jn.prototype={get_innerHeight:function(){return this.child.rect.height},setChild:function(t){this.child=t,this.updateSize()},updateSize:function(){var t,e;null!=this.child&&(t=this.scrollPosition.y,e=0<(e=this.get_innerHeight()-this.rect.height)?e:0,this.scrollPosition.y=t<0?0:e<t?e:t),null!=this.parent?this.parent.updateSize():this.updatePosition(this.position)},updateScrollPosition:function(t){this.scrollPosition=t,this.updateSize()},updateStageMask:function(){if(null==this.child||this.child.rect.width<=this.rect.width&&this.get_innerHeight()<=this.rect.height)return null!=this.stage.mask&&this.stage.mask.destroy(),this.stage.mask=null,void(this.maskRect=null);var t;null!=this.maskRect&&this.maskRect.x==this.rect.x&&this.maskRect.y==this.rect.y&&this.maskRect.width==this.rect.width&&this.maskRect.height==this.rect.height||(this.maskRect=this.rect.clone(),null!=this.stage.mask&&this.stage.mask.destroy(),(t=new PIXI.Graphics).beginFill(0),t.alpha=0,this.stage.addChild(t),t.drawRect(this.rect.x,this.rect.y-1,this.rect.width,this.rect.height+1),t.endFill(),this.stage.mask=t)},updatePosition:function(t){this.position=t;var e=this.rect,i=this.position,n=this.origin.x*this.rect.width|0,t=this.origin.y*this.rect.height|0,n=i.x-n,t=i.y-t;e.x=n,e.y=t;null!=this.child&&(n=(e=this.rect).x,t=e.y,e=this.scrollPosition,this.child.updatePosition(new Cn(n-e.x,t-e.y))),this.updateStageMask()},destroy:function(){null!=this.child&&this.child.destroy(),this.stage.destroy(!0),this.destroyed=!0},claimMouseForScroll:function(e,t){null==t&&(t=!0);var i=this;return!!e.hasNoClaim()&&(this.mousePreviousY=e.position.y,e.strongClaimMouse("scrollWindow",function(){var t;i.destroyed||(t=i.mousePreviousY-e.position.y,i.updateScrollPosition(new Cn(i.scrollPosition.x,i.scrollPosition.y+t)),i.mousePreviousY=e.position.y)},t),!0)},handleMouse:function(t){return!!this.rect.contains(t.position)&&(this.handleScrollWheel(t),t.isTouch&&t.weakClaimForScroll(this)&&this.claimMouseForScroll(t,!1)||null!=this.child&&this.child.handleMouse(t)||t.isTouch&&this.claimMouseForScroll(t)||t.claimMouse(this),!0)},handleScrollWheel:function(t){var e,i,n=this.rect.height-10;0!=t.scrollBarMovement&&(e=Math.round(t.scrollBarMovement),i=-n,this.updateScrollPosition(new Cn(this.scrollPosition.x,this.scrollPosition.y+(e<i?i:n<e?n:e)))),0!=t.scrollBarMovementPages&&(e=Math.round(this.rect.height*t.scrollBarMovementPages),i=-n,this.updateScrollPosition(new Cn(this.scrollPosition.x,this.scrollPosition.y+(e<i?i:n<e?n:e))))},update:function(){var t,e;null!=this.child&&this.child.update(),this.game.mouse.pressed||this.dragDir.get_length()<.5?(this.dragDir.x=0,this.dragDir.y=0,this.remainingStepDragDir.x=0,this.remainingStepDragDir.y=0):this.game.mouse.hasSpecificClaim("scrollWindow")||(e=this.game.mouse.isTouch?.933:.8,this.dragDir.x*=e,this.dragDir.y*=e,t=this.dragDir.x+this.dragDirRemaining.x,e=this.dragDir.y+this.dragDirRemaining.y,this.dragDirRemaining.x+=this.dragDir.x-t,this.dragDirRemaining.y+=this.dragDir.y-e,this.remainingStepDragDir.x+=t,this.remainingStepDragDir.y+=e,e=Math.floor(this.remainingStepDragDir.y),this.updateScrollPosition(new Cn(this.scrollPosition.x,this.scrollPosition.y+e)),this.remainingStepDragDir.y-=e)},__class__:Jn},(V["gui.AutoScrollable"]=Zn).__name__="gui.AutoScrollable",Zn.__super__=Jn,Zn.prototype=e(Jn.prototype,{updateSize:function(){var t,e;null!=this.child&&(t=this.maxWidth,e=this.child.rect.width,this.rect.width=e<t?e:t,t=this.maxHeight,e=this.child.rect.height,this.rect.height=e<t?e:t),Jn.prototype.updateSize.call(this)},updatePosition:function(t){Jn.prototype.updatePosition.call(this,t)},__class__:Zn});var ts=function(){};function es(t,e){this.mirrored=!1,this.wasLargeMobile=!1,this.previouslyShownCategory="",this.inviteCitizensButton=null,this.mobileStopBuildingOrManagingButton=null,this.activateBuildModeButton=null,this.activateManagementModeButton=null,this.buildingModeEnabled=!1,this.shownManagementOptions=!1,this.shownBuildingModes=!1,this.shownSubCategory=null,this.creatableCityElementsThatNeededAttention=[],this.categoryButtonPosition=new zr,this.gui=t,this.city=e,this.createBuildingButtons(),this.shownCategory="",this.buttonsByCategory=new zr,this.buttonsInCategory=new zr,this.wasLargeMobile=this.gui.game.isLargeMobile}function is(){}function ns(t,e,i,n,s,r){this.keyboardButton=null,this.canBeHeld=!1,this.mouseOut=!1,this.onUpdate=null,this.stage=e,this.gui=t,this.parent=i,this.action=n,this.onHover=r,null==s&&(s=function(){return!1}),this.isActive=s,this.buttonSound=C.get().buttonSound}(V["gui.BirthControlWindow"]=ts).__name__="gui.BirthControlWindow",ts.create=function(t,e,i,n){e.windowAddTitleText(kn.lo("birth_control"));var s=t.simulation.babyMaker.mode;ir.createActivatableButton(e,1==s,function(){t.simulation.babyMaker.mode=1,t.simulation.babyMaker.targetPopAmount=t.simulation.citizens.length,e.reloadWindow()},kn.lo("greatly_discourage_children"),kn.lo("pop_stabilize")),ir.createActivatableButton(e,2==s,function(){t.simulation.babyMaker.mode=2,e.reloadWindow()},kn.lo("encourage_contraception"),kn.lo("slow_pop_growth")),ir.createActivatableButton(e,0==s,function(){t.simulation.babyMaker.mode=0,e.reloadWindow()},kn.lo("no_special_policy"),kn.lo("babies_born_normal")),ir.createActivatableButton(e,3==s,function(){t.simulation.babyMaker.mode=3,e.reloadWindow()},kn.lo("encourage_parenthood"),kn.lo("more_babies_born")),e.windowAddBottomButtons()},(V["gui.BuildingButtons"]=es).__name__="gui.BuildingButtons",es.prototype={resize:function(){this.buildingButtons.updatePosition(new Cn(0,this.gui.game.rect.height)),this.allBuildingModeButtons.updatePosition(new Cn(0,this.gui.game.rect.height-20-2)),this.allManagementOptionsButtons.updatePosition(new Cn(0,this.gui.game.rect.height-20-2)),this.gui.game.isMobile&&this.gui.game.isLargeMobile!=this.wasLargeMobile&&(this.wasLargeMobile?this.buildingModeEnabled=null!=this.city.builder||""!=this.shownCategory||this.shownBuildingModes:(this.buildingModeEnabled&&(this.mobileStopBuildingOrManagingButton=null,this.gui.createCityInfo()),this.buildingModeEnabled=!1),this.refreshCategoryBuildingsShown(),this.wasLargeMobile=this.gui.game.isLargeMobile)},update:function(t){this.allBuildingModeButtons.update(),this.buildingButtons.update(),this.allManagementOptionsButtons.update(),this.updateGoalAttentions()},handleMouse:function(t){return!!this.allBuildingModeButtons.handleMouse(t)||(!!this.buildingButtons.handleMouse(t)||!!this.allManagementOptionsButtons.handleMouse(t))},activateLoserState:function(){this.buildingButtons.clear(),this.allBuildingModeButtons.clear(),this.allManagementOptionsButtons.clear()},createBuildingButtons:function(){this.buildingButtons=new ds(this.gui,this.gui.stage,null,new Cn(0,this.gui.game.rect.height),new In(0,1)),this.categoryButtons=new ds(this.gui,this.gui.stage,this.buildingButtons),this.allBuildingModeButtons=new ds(this.gui,this.gui.stage,null,new Cn(0,this.gui.game.rect.height-20-2),new In(0,1)),this.allManagementOptionsButtons=new ds(this.gui,this.gui.stage,null,new Cn(0,this.gui.game.rect.height-20-2),new In(0,1)),this.buildingInCategoryButtons=new ds(this.gui,this.gui.stage,this.buildingButtons),this.buildingButtons.direction=vs.Vertical,this.buildingInCategoryButtons.direction=this.gui.game.isMobile?vs.Vertical:vs.Horizontal,this.buildingInCategoryButtonsCol=null,this.buildingInCategoryButtonsColAmount=0,this.allBuildingModeButtons.direction=this.gui.game.isMobile?vs.Horizontal:vs.Vertical,this.allManagementOptionsButtons.direction=this.gui.game.isMobile?vs.Horizontal:vs.Vertical,this.buildingButtons.addChild(this.buildingInCategoryButtons),this.buildingButtons.addChild(this.categoryButtons),this.gui.game.isMobile&&!this.gui.game.isLargeMobile?this.createMobileBuildButton():this.createBuildingCategoryButtons()},showTutorialArrows1:function(t,e,i){var n=this,s=new Ms(this.gui,i,function(){return n.categoryButtons.children[n.buildingModeEnabled&&!n.gui.game.isLargeMobile?1:0]},function(){return!(!e()||null!=n.city.builder)&&""==n.shownCategory});this.gui.game.isMobile||s.useBigMovement(),t.push(s);i=new Ms(this.gui,i,function(){var t=n.buildingInCategoryButtons.children[0];return t.children[t.children.length-1]},function(){return!(!e()||null!=n.city.builder)&&""!=n.shownCategory},ks.Left);t.push(i)},showTutorialArrows101:function(t,e,i){var n=this,s=new Ms(this.gui,i,function(){return n.categoryButtons.children[n.buildingModeEnabled&&!n.gui.game.isLargeMobile?1:0]},function(){return!(!e()||null!=n.city.builder)&&""==n.shownCategory});t.push(s);i=new Ms(this.gui,i,function(){var t=n.buildingInCategoryButtons.children[0];return t.children[t.direction==vs.Horizontal?t.children.length-1:t.children.length-2]},function(){return!(!e()||null!=n.city.builder)&&""!=n.shownCategory},ks.Left);t.push(i);t=kn.lo("you_have_enough_wood");s.addText(t),i.addText(t)},showTutorialArrows2:function(t,e,i,n){var s=this;t.push(new Ms(this.gui,i,function(){return s.mobileStopBuildingOrManagingButton},function(){return!(!n()||null!=sr.tutorialStoneMineUpButton)&&!e()},ks.Down))},showTutorialArrowsInviteCitizens:function(t,e){var i=this;t.push(new Ms(this.gui,e,function(){return i.inviteCitizensButton},function(){return"invite_people"!=i.gui.windowRelatedTo},ks.Left)),t.push(new Ms(this.gui,e,function(){return i.activateManagementModeButton},function(){return null==i.inviteCitizensButton&&"invite_people"!=i.gui.windowRelatedTo},ks.Down))},createMobileBuildButton:function(){function t(t){null==t&&(t=!1),s.buildingModeEnabled=!0,s.activateBuildModeButton=null,s.activateManagementModeButton=null,t||"travel_time"==s.gui.windowRelatedTo||s.gui.closeWindow(),s.gui.hideCityInfo(),s.categoryButtons.clear(),e(),s.createBuildingCategoryButtons(),""!=s.previouslyShownCategory&&(s.showOrHideBuildingsOfCategory(s.previouslyShownCategory,null,s.categoryButtonPosition.h[s.previouslyShownCategory],!1,!0,!0),s.previouslyShownCategory="")}var s=this,e=null,e=function(){var t=s.gui,e=s.gui.stage,i=s.categoryButtons,n=H.getTexture("spr_arrow_back");s.mobileStopBuildingOrManagingButton=new Fs(t,e,i,function(){s.mobileStopBuildingOrManaging()},n,function(){return!1},function(){s.gui.tooltip.setText(s.mobileStopBuildingOrManagingButton,kn.lo("back"))}),s.categoryButtons.addChild(s.mobileStopBuildingOrManagingButton)};if(this.buildingModeEnabled)return t(!0),void(this.shownManagementOptions=!1);function i(t){null==t&&(t=!1),s.shownManagementOptions=!0,s.activateBuildModeButton=null,s.activateManagementModeButton=null,t||s.gui.closeWindow(),s.gui.hideCityInfo(),s.categoryButtons.clear(),e(),s.showManagementOptions(s.categoryButtons)}var n,r;if(this.shownManagementOptions)return i(!0),void(this.buildingModeEnabled=!1);n=new Fs(s.gui,s.gui.stage,s.categoryButtons,function(){t()},H.getTexture("spr_icon_build"),function(){return!1},function(){s.gui.tooltip.setText(n,kn.lo("build"))}),s.categoryButtons.addChild(n),s.activateBuildModeButton=n,this.city.progress.unlocks.unlockedManagementOptions&&(r=new Fs(s.gui,s.gui.stage,s.categoryButtons,function(){i()},H.getTexture("spr_icon_management"),function(){return!1},function(){s.gui.tooltip.setText(r,kn.lo("management"))}),s.categoryButtons.addChild(r),s.activateManagementModeButton=r)},mobileStopBuildingOrManaging:function(){(this.buildingModeEnabled||this.shownManagementOptions)&&(this.mobileStopBuildingOrManagingButton=null,this.inviteCitizensButton=null,this.buildingModeEnabled=!1,this.shownManagementOptions=!1,this.gui.createCityInfo(),this.categoryButtons.clear(),""!=this.shownCategory&&(this.previouslyShownCategory=this.shownCategory,this.showOrHideBuildingsOfCategory(this.shownCategory,null,this.categoryButtonPosition.h[this.shownCategory],!1,!0,!0)),this.closeExtraBuildingModes(),this.createMobileBuildButton())},createBuildingCategoryButtons:function(){var n=this,t=0;this.buttonsByCategory=new zr,this.buttonsInCategory=new zr;for(var e=0,i=H.buildingCategoriesInfo;e<i.length;){var s=[i[e]];++e;for(var r=!1,o=0,a=this.city.progress.resources.buildingInfoArray;o<a.length;){var l=a[o];++o;var h="buildings."+l.className,h=V[h],h=this.city.progress.unlocks.getUnlockState(h);l.category!=s[0].name||h!=mo.Unlocked&&h!=mo.Researched&&h!=mo.Createable||(r=!0)}for(var u=0,d=H.decorationsInfo;u<d.length;){var c=d[u];++u,c.category==s[0].name&&this.city.progress.unlocks.unlockedDecorationTab&&(r=!0)}for(var p,g,m=0,f=H.worldResourcesInfo;m<f.length;){var y=f[m];++m,y.category==s[0].name&&this.city.progress.unlocks.unlockedDecorationTab&&(r=!0)}r&&(g=[t],(p=[null])[0]=new Fs(this.gui,this.gui.stage,this.categoryButtons,function(t,e,i){return function(){n.shownSubCategory=null,e[0].stopNotify(),n.showOrHideBuildingsOfCategory(i[0].name,null,t[0]),n.updateGoalAttentions()}}(g,p,s),H.getTexture(s[0].image),function(t){return function(){return n.shownCategory==t[0].name}}(s),function(t,e){return function(){n.gui.tooltip.setText(t[0],e[0].description,e[0].displayName)}}(p,s),null,"spr_transparentbutton"),this.categoryButtons.addChild(p[0]),this.categoryButtonPosition.h[s[0].name]=t,this.buttonsByCategory.h[s[0].name]=p[0],t+=22,this.city.progress.unlocks.getShouldNotifyForCategoryUnlock(s[0].name)&&(this.shownCategory==s[0].name?this.city.progress.unlocks.stopNotifyCategoryUnlock(s[0].name):p[0].notify(!1,function(t,e){return function(){t[0](e[0])}}([fa(B=this.city.progress.unlocks,B.stopNotifyCategoryUnlock)],[s[0].name]))))}this.city.progress.unlocks.unlockedBuildingModeButton&&this.addBuildingModeButtons(),this.gui.game.isMobile&&!this.gui.game.isLargeMobile||this.city.progress.unlocks.unlockedManagementOptions&&this.addManagementButtons()},showOrHideBuildingsOfCategory:function(t,e,i,n,s,r){if(null==r&&(r=!1),null==s&&(s=!0),null==n&&(n=!1),this.buildingInCategoryButtons.clear(),r||this.closeExtraBuildingModes(),!r&&this.shownManagementOptions&&this.closeManagementOptions(),this.buildingInCategoryButtonsCol=null,this.buildingInCategoryButtonsColAmount=0,this.buildingInCategoryButtonsNumberOfCols=0,this.buttonsInCategory=new zr,s&&null!=this.city.builder&&this.city.builder.cancel(),this.shownCategory!=t||this.shownSubCategory!=e||n){var o=this.shownCategory=t;null!=e&&(o+="_"+e),this.shownSubCategory=e,null==i||this.gui.game.isMobile||(this.buildingInCategoryButtons.padding.left=i),null!=e&&(this.createSubCategoryBackButton(i),this.categoryHasMirror(o)&&this.createSubCategoryMirrorButton(i));for(var a=0,l=this.city.progress.resources.buildingInfoArray;a<l.length;){var h=l[a];++a;var u="buildings."+h.className,d=V[u],c=this.city.progress.unlocks.getUnlockState(d),u=this.city.progress.unlocks.getShouldNotifyForUnlock(d);h.category!=o||c!=mo.Unlocked&&c!=mo.Researched&&c!=mo.Createable||this.addBuildingButton(d,c,u)}for(a=0,l=H.decorationsInfo;a<l.length;){var p=l[a];++a,p.category==o&&this.addDecorationButton(p)}for(a=0,l=H.worldResourcesInfo;a<l.length;){var g=l[a];++a,g.category==o&&this.addWorldResourceButton(g)}this.addSubCategories(o,i);i=this.buildingInCategoryButtons.padding.left;this.buildingInCategoryButtons.padding.left=0<i?i:0,this.buildingInCategoryButtons.updateSize()}else this.shownCategory=""},addSubCategories:function(t,e){"Decoration & Nature"==t&&(this.addSubCategoryButton(t,"coloredBlocks",e,kn.lo("colored_blocks"),"spr_coloredblock"),this.addSubCategoryButton(t,"slantedroofs",e,kn.lo("slanted_roofs"),"spr_slantedroof"),this.addSubCategoryButton(t,"slantedrooftops",e,kn.lo("slanted_rooftops"),"spr_slantedrooftop"))},categoryHasMirror:function(t){return"Decoration & Nature_slantedroofs"==t},addSubCategoryButton:function(t,e,i,n,s){var r=this;this.makeSpaceForBuildingButton();var o=new Fs(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){r.showOrHideBuildingsOfCategory(t,e,i)},H.getTexturesByWidth(s,20)[0],function(){return!1},function(){r.gui.tooltip.setText(o,n)});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(o):this.buildingInCategoryButtonsCol.insertChild(o,0)},refreshCategoryBuildingsShown:function(){this.buildingButtons.destroy(),this.allBuildingModeButtons.destroy(),this.allManagementOptionsButtons.destroy(),this.buttonsByCategory=new zr,this.createBuildingButtons(),""!=this.shownCategory&&this.showOrHideBuildingsOfCategory(this.shownCategory,this.shownSubCategory,this.categoryButtonPosition.h[this.shownCategory],!0,!1,!0),this.updateGoalAttentions()},makeSpaceForBuildingButton:function(){var t;t=(t=this.gui.game.isMobile?(this.gui.game.rect.width-40)/20|0:(this.gui.game.rect.height-60)/20|0,this.buildingInCategoryButtonsColAmount>=(2<t?t:2)),null!=this.buildingInCategoryButtonsCol&&!t||(this.buildingInCategoryButtonsColAmount=0,this.buildingInCategoryButtonsCol=new ds(this.gui,this.gui.stage,this.buildingInCategoryButtons),this.gui.game.isMobile?(this.buildingInCategoryButtonsCol.direction=vs.Horizontal,this.buildingInCategoryButtonsCol.alignment=Ss.LeftOrTop,this.buildingInCategoryButtons.insertChild(this.buildingInCategoryButtonsCol,0)):(this.buildingInCategoryButtonsCol.direction=vs.Vertical,this.buildingInCategoryButtonsCol.alignment=Ss.LeftOrTop,this.buildingInCategoryButtons.addChild(this.buildingInCategoryButtonsCol)),this.buildingInCategoryButtonsNumberOfCols+=1),this.buildingInCategoryButtonsColAmount+=1},addBuildingButton:function(i,t,e){var n,s,r=this,o=D.field(i,"spriteName"),a=i.__name__,l=this.city.progress.resources.buildingInfo.h[a],h=null!=l.showUnlockHint&&t==mo.Unlocked,t=-1!=l.specialInfo.indexOf("as_multi_decor"),u=[H.getTexture(h?"spr_lockedbuilding@0,0,20,20":o+"@0,0,20,20")];if(t&&!h){for(var d=[],c=0,p=(u=H.getTexturesByWidth(o,20)).length;c<p;){var g=c++;d.push(g)}s=d}else s=[0];for(d=0;d<s.length;){var m=[s[d]];++d,this.makeSpaceForBuildingButton(),n=new Fs(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(e){return function(){if(r.gui.game.isMobile&&r.closeExtraBuildingModes(),h)return null!=r.city.builder&&r.city.builder.cancel(),void r.gui.showSimpleWindow(l.showUnlockHint,"",!0,!0);var t;!r.gui.get_keyboard().down[17]||null==(t=Zi.findLeastUpgraded(r.city,i))?r.city.createOrRemoveBuilder(i,!1,e[0],-1!=l.specialInfo.indexOf("mirrorable")&&r.mirrored):t.showWindow()}}(m),u[m[0]],function(t){return function(){return null!=r.city.builder&&r.city.builder.get_buildingToBuild()==i&&r.city.builder.decorationAppearance==t[0]}}(m),function(){h?r.gui.tooltip.setText(n,l.showUnlockHint):r.gui.get_keyboard().down[17]?Zi.doHighlight(r.city,i):r.showBuildingTooltip(l,i,n)},H.getTexture(h?"spr_lockedbuilding@22,0,20,20":null==l.buttonBack?o+"@44,0,20,20":l.buttonBack)),e&&n.notify(!0,function(t,e){return function(){t[0](e[0])}}([fa(B=this.city.progress.unlocks,B.stopNotifyForUnlock)],[i])),this.mirrored&&-1!=l.specialInfo.indexOf("mirrorable")&&n.mirror(),this.buttonsInCategory.h[a]=n,this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(n):this.buildingInCategoryButtonsCol.insertChild(n,0),null!=this.shownSubCategory&&0==m[0]&&null==this.city.builder&&this.city.createOrRemoveBuilder(i,!0,m[0],-1!=l.specialInfo.indexOf("mirrorable")&&this.mirrored)}},showBuildingTooltip:function(t,e,i,n){null==n&&(n=!1);var s=this.city.progress.buildingCost.getBuildingCost(t);this.city.progress.unlocks.getUnlockState(e)==mo.Researched&&(s.knowledge=0);var r,o=[];if(null!=t.tooltipBottomIconInfo){for(var a=t.tooltipBottomIconInfo,l=new Array(a.length),h=0,u=a.length;h<u;){var d=h++,c=a[d];l[d]={text:c.text,texture:H.getTexture(c.texture)}}r=l}else r=[];null!=t.jobs&&0!=t.jobs&&o.push({texture:H.getTexture("spr_work"),text:null==t.jobs?"null":""+t.jobs}),null!=t.residents&&0!=t.residents&&o.push({texture:H.getTexture("spr_residents"),text:null==t.residents?"null":""+t.residents}),null!=t.quality&&0!=t.quality&&o.push({texture:H.getTexture("spr_happiness"),text:null==t.quality?"null":""+t.quality}),-1!=t.specialInfo.indexOf("unique")&&o.push({texture:H.getTexture("spr_uniquebuilding"),text:vn.any(this.city.permanents,function(t){return t.is(e)})?"[red]"+kn.lo("already_built"):kn.lo("unique")});var p=t.description,p=vn.any(this.city.permanents,function(t){return t.is(e)})?N.replace(p,"!unlocks",""):N.replace(p,"!unlocks"," "+kn.lo("also_unlocks_new"));p+=this.city.progress.buildingCost.getBuildingCostDescriptionAdder(t);var g=this.city.simulation.operatingCost.getOperatingCost(t),m="";g.any()&&(m=this.city.simulation.operatingCost.getOperatingCostReason(t)),n?this.gui.tooltip.setTextForContinuous(p,kn.lo("building_a_building",[t.name]),s,o,r,g,m):this.gui.tooltip.setText(i,p,t.name,s,o,r,g,m)},addDecorationButton:function(e){var i=this;this.makeSpaceForBuildingButton();var t=fa(B=this.city,B.createOrRemoveDecorationBuilder),n=e,s=new Fs(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){t(n)},H.getTexture(e.textureName+"@0,0,20,20"),function(){if(null==i.city.builder)return!1;var t=i.city.builder.builderType;return(1==t._hx_index?t.decorationInfo.name:"")==e.name},function(){i.showDecorationTooltip(e,s)});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(s):this.buildingInCategoryButtonsCol.insertChild(s,0)},showDecorationTooltip:function(t,e,i){null==i&&(i=!1);var n=M.fromDecorationInfo(t);i?t.isRemoveDecoration?this.gui.tooltip.setTextForContinuous(t.description,t.name+"",n):this.gui.tooltip.setTextForContinuous(t.description,kn.lo("placing_a_decoration",[t.name]),n):this.gui.tooltip.setText(e,t.description,t.name,n)},addWorldResourceButton:function(e){var i=this;this.makeSpaceForBuildingButton();var t=fa(B=this.city,B.createOrRemoveWorldResourceBuilder),n=e,s=new Fs(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){t(n)},H.getTexture(""+e.textureName),function(){if(null==i.city.builder)return!1;var t=i.city.builder.builderType;return(2==t._hx_index?t.resourceInfo:null)==e},function(){i.showWorldResourceTooltip(e,s)});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(s):this.buildingInCategoryButtonsCol.insertChild(s,0)},showWorldResourceTooltip:function(t,e,i){null==i&&(i=!1);var n=M.fromWorldResourceInfo(t);i?this.gui.tooltip.setTextForContinuous(t.description,kn.lo("planting_a_forest",[t.name]),n):this.gui.tooltip.setText(e,t.description,t.name,n)},createSubCategoryMirrorButton:function(i){var n=this;this.makeSpaceForBuildingButton();var t=new Fs(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){var t=null,e=null;null!=n.city.builder&&(t=n.city.builder.get_buildingToBuild(),e=n.city.builder.decorationAppearance),n.mirrored=!n.mirrored,n.showOrHideBuildingsOfCategory(n.shownCategory,n.shownSubCategory,i,!0),null!=t&&n.city.createOrRemoveBuilder(t,!0,e,n.mirrored)},H.getTexture("spr_mirror"),function(){return!1},function(){n.gui.tooltip.setText(t,kn.lo("mirror"))});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(t):this.buildingInCategoryButtonsCol.insertChild(t,0)},createSubCategoryBackButton:function(t){var e=this;this.makeSpaceForBuildingButton();var i=new Fs(this.gui,this.gui.stage,this.buildingInCategoryButtonsCol,function(){e.showOrHideBuildingsOfCategory(e.shownCategory,null,t)},H.getTexture("spr_arrow_back"),function(){return!1},function(){e.gui.tooltip.setText(i,kn.lo("back"))});this.gui.game.isMobile?this.buildingInCategoryButtonsCol.addChild(i):this.buildingInCategoryButtonsCol.insertChild(i,0)},addBuildingModeButtons:function(){function s(t){switch(t._hx_index){case 0:return"spr_icon_buildingmode_ontop";case 1:return"spr_icon_buildingmode_insert";case 2:return"spr_icon_buildingmode_replace";case 3:return"spr_icon_buildingmode_drag";case 4:return"spr_icon_buildingmode_destroy"}}function r(t,e,n){function i(t,e,i){n?o.gui.tooltip.setTextForContinuous(e,i):o.gui.tooltip.setText(t,e,i)}if(o.gui.game.isMobile)switch(e._hx_index){case 0:i(t,kn.lo("build_mode_normal_explanation"),kn.lo("build_mode_normal"));break;case 1:i(t,kn.lo("build_anywhere"),kn.lo("build_mode_insert"));break;case 2:i(t,kn.lo("build_mode_replace_explanation"),kn.lo("build_mode_replace"));break;case 3:i(t,kn.lo("build_mode_multi_explanation"),kn.lo("build_mode_multi"));break;case 4:i(t,kn.lo("build_mode_destroy_explanation"),kn.lo("build_mode_destroy"))}else switch(e._hx_index){case 0:i(t,kn.lo("build_mode_normal_explanation_pc")+" "+kn.lo("exception")+" "+(null==o.city.builder?kn.lo("click_rooftop_selected"):kn.lo("click_rooftop"))+" ",kn.lo("build_mode_normal"));break;case 1:i(t,kn.lo("build_anywhere_pc")+" "+(null==o.city.builder?kn.lo("build_mode_insert_explanation_pc"):kn.lo("build_mode_insert_explanation_pc_b")),kn.lo("build_mode_insert"));break;case 2:i(t,kn.lo("build_mode_replace_explanation_pc"),kn.lo("build_mode_replace"));break;case 3:i(t,kn.lo("build_mode_multi_explanation_pc"),kn.lo("build_mode_multi"));break;case 4:i(t,kn.lo("build_mode_destroy_explanation"),kn.lo("build_mode_destroy"))}}function e(){for(var t=[E.Normal,E.Insert,E.Replace,E.Destroy],e=0;e<t.length;){var i=[t[e]];++e;var n=[];n[0]=new Fs(o.gui,o.gui.stage,o.allBuildingModeButtons,function(n){return function(){if(o.city.buildingMode=n[0],o.gui.game.isMobile&&null!=o.city.builder&&o.city.builder.invalidateCache(),n[0]!=E.Destroy){if(null==o.city.builder&&null!=o.city.specialActionOld&&o.city.specialActionOld.activate(),!o.gui.game.isMobile||""!=o.shownCategory){if(o.gui.game.isMobile){var t,e,i=o.gui;switch(n[0]._hx_index){case 0:t=kn.lo("build_mode_normal_explanation");break;case 1:t=kn.lo("build_anywhere");break;case 2:t=kn.lo("build_mode_replace_explanation");break;case 3:t=kn.lo("build_mode_multi_explanation");break;case 4:t=kn.lo("build_mode_destroy_explanation")}switch(n[0]._hx_index){case 0:e=kn.lo("build_mode_normal");break;case 1:e=kn.lo("build_mode_insert");break;case 2:e=kn.lo("build_mode_replace");break;case 3:e=kn.lo("build_mode_multi");break;default:e=""}i.notify(t,e,120)}o.closeExtraBuildingModes()}}else null!=o.city.specialAction&&o.city.specialAction.deactivate(),o.gui.game.isMobile&&(o.allBuildingModeButtons.padding.bottom=0,o.allBuildingModeButtons.updateSize()),o.showOrHideBuildingsOfCategory(o.shownCategory,null,o.categoryButtonPosition.h[o.shownCategory],!1,!0,!0)}}(i),H.getTexture(s(i[0])),function(t){return function(){return o.city.buildingMode==t[0]}}(i),function(t,e){return function(){r(t[0],e[0],!1)}}(n,i)),o.gui.game.isMobile?o.allBuildingModeButtons.addChild(n[0]):o.allBuildingModeButtons.insertChild(n[0],0)}o.gui.game.isMobile&&(o.allBuildingModeButtons.padding.bottom=""!=o.shownCategory?o.buildingInCategoryButtons.baseHeight:0,o.allBuildingModeButtons.updateSize()),o.gui.game.isMobile&&o.shownManagementOptions&&o.closeManagementOptions()}function t(){for(var t=zr.valueIterator(o.categoryButtonPosition.h);t.hasNext();)t.next();o.shownBuildingModes?o.closeExtraBuildingModes():(e(),o.shownBuildingModes=!0)}var i,o=this;this.gui.game.isMobile||(this.allBuildingModeButtons.padding.left=this.categoryButtons.rect.width),i=new Fs(this.gui,this.gui.stage,this.categoryButtons,function(){o.gui.game.isMobile?t():(o.city.buildingMode=o.city.buildingMode==E.Normal?E.Insert:E.Normal,o.closeExtraBuildingModes())},H.getTexture(s(this.city.buildingMode)),function(){return!!o.gui.game.isMobile&&o.shownBuildingModes},function(){r(i,o.city.buildingMode,!1)},null,"spr_transparentbutton");var n,a=E.Normal;i.onUpdate=function(){a!=o.city.buildingMode&&(i.updateTexture(H.getTexture(s(o.city.buildingMode))),a=o.city.buildingMode),o.gui.game.isMobile&&o.shownBuildingModes&&null==o.city.builder&&r(i,o.city.buildingMode,!0)},this.categoryButtons.addChild(i),this.gui.game.isMobile||(n=new Fs(this.gui,this.gui.stage,this.categoryButtons,t,H.getTexture("spr_morebuildingmodes_arrowup"),function(){return o.shownBuildingModes},function(){o.gui.tooltip.setText(n,kn.lo("all_building_modes"))},null,"spr_morebuildingmodebuttons"),this.categoryButtons.addChild(n)),this.shownBuildingModes&&e()},closeExtraBuildingModes:function(){this.allBuildingModeButtons.clear(),this.shownBuildingModes=!1,this.city.buildingMode==E.Destroy&&(this.city.buildingMode=E.Normal,null==this.city.builder&&null!=this.city.specialActionOld&&this.city.specialActionOld.activate())},showManagementOptions:function(t){var e,i=this;null==t&&(t=this.allManagementOptionsButtons),this.gui.game.isMobile&&this.shownBuildingModes&&this.closeExtraBuildingModes(),this.city.progress.story.storyInfo.useInviteCitizens&&(e=new Fs(this.gui,this.gui.stage,t,function(){"invite_people"==i.gui.windowRelatedTo?i.gui.closeWindow():ar.createWindow(i.city)},H.getTexture("spr_icon_invitepeople"),function(){return"invite_people"==i.gui.windowRelatedTo},function(){i.gui.tooltip.setText(e,kn.lo("invite_people"))}),this.gui.game.isMobile?t.addChild(e):t.insertChild(e,0),this.inviteCitizensButton=e);var n=new Fs(this.gui,this.gui.stage,t,function(){i.city.viewActions.isFollowOpen()?i.city.specialAction.deactivate(!0):i.city.viewActions.showFollow()},H.getTexture("spr_icon_followcitizen"),function(){return i.city.viewActions.isFollowOpen()},function(){i.gui.tooltip.setText(n,kn.lo("follow_citizen"))});this.gui.game.isMobile?t.addChild(n):t.insertChild(n,0);var s=new Fs(this.gui,this.gui.stage,t,function(){"global_upgrades"==i.gui.windowRelatedTo?i.gui.closeWindow():(i.gui.createWindow("global_upgrades"),Ts.create(i.city,i.gui,i.gui.innerWindowStage,i.gui.windowInner))},H.getTexture("spr_icon_upgrade"),function(){return"global_upgrades"==i.gui.windowRelatedTo},function(){i.gui.tooltip.setText(s,kn.lo("upgrades_and_policies"))});this.gui.game.isMobile?t.addChild(s):t.insertChild(s,0);var r=new Fs(this.gui,this.gui.stage,t,function(){"highlight_buildings"==i.gui.windowRelatedTo?i.gui.closeWindow():rr.createWindow(i.city)},H.getTexture("spr_icon_findbuilding"),function(){return"highlight_buildings"==i.gui.windowRelatedTo},function(){i.gui.game.isMobile?i.gui.tooltip.setText(r,kn.lo("highlight_buildings")):i.gui.tooltip.setText(r,kn.lo("ctrl_to_highlight"),kn.lo("highlight_buildings"))});this.gui.game.isMobile?t.addChild(r):t.insertChild(r,0),this.gui.game.isMobile&&this.gui.game.isLargeMobile&&""!=this.shownCategory&&this.showOrHideBuildingsOfCategory(this.shownCategory,null,this.categoryButtonPosition.h[this.shownCategory],!1,!0,!0)},closeManagementOptions:function(){this.allManagementOptionsButtons.clear(),this.shownManagementOptions=!1,this.inviteCitizensButton=null},addManagementButtons:function(){var t=this,e=new Fs(this.gui,this.gui.stage,this.categoryButtons,function(){t.shownManagementOptions=!t.shownManagementOptions,t.shownManagementOptions?t.showManagementOptions():t.closeManagementOptions()},H.getTexture("spr_icon_management"),function(){return t.shownManagementOptions},function(){t.gui.tooltip.setText(e,kn.lo("management"))},null,"spr_transparentbutton");this.gui.game.isMobile||(this.allManagementOptionsButtons.padding.left=this.categoryButtons.rect.width),this.categoryButtons.addChild(e),this.activateManagementModeButton=e,this.shownManagementOptions&&this.showManagementOptions()},updateGoalAttentions:function(){function t(e,t){var i,n=e.__name__,s=H.buildingInfo.h[n];null==s||t&&!g.city.materials.canAfford(M.fromBuildingInfo(s))||(s=s.category,null!=g.activateBuildModeButton&&g.activateBuildModeButton.setNeedsAttention(t),(p=null!=s&&""!=s&&null!=(i=g.buttonsByCategory.h[s]))&&(i.setNeedsAttention(t),null!=(r=g.buttonsInCategory.h[n])&&r.setNeedsAttention(t)));var r=H.buildingUpgradesInfo.h[n];if(null!=r&&(!t||g.city.materials.canAfford(M.fromBuildingUpgradesInfo(r)))){var o=!0;if(null!=g.gui.window&&g.gui.windowRelatedTo instanceof m&&(-1==(d=g.gui.windowRelatedTo).get_possibleUpgrades().indexOf(e)||vn.any(d.upgrades,function(t){return Fr.getClass(t)==e})||(null!=(u=g.gui.currentUpgradeButtons.h[n])&&u.setNeedsAttention(t),o=!1)),o||!t)for(var a=0,l=g.city.permanents;a<l.length;){var h=l[a];++a,h.is(m)&&(-1==(d=h).get_possibleUpgrades().indexOf(e)||vn.any(d.upgrades,function(t){return Fr.getClass(t)==e})||(t?(null==d.highlightSprite&&(d.highlightSprite=new PIXI.Sprite(H.getTexture("spr_whiteoutline")),d.highlightSprite.position.set(d.position.x-1,d.position.y-1),g.city.farForegroundStage.addChild(d.highlightSprite),c=[89,1,.77],p=ra.toRgb(c),d.highlightSprite.tint=Sn.toHexInt(p)),d.highlightSprite.alpha=(Math.sin(g.gui.guiTimer/10)+1)/2):null!=d.highlightSprite&&(d.highlightSprite.destroy(),d.highlightSprite=null)))}}if(null!=(r=H.cityUpgradesInfo.h[n])&&(!t||g.city.materials.canAfford(M.fromCityUpgradesInfo(r)))){var u,o=!0;if(null!=g.gui.window&&g.gui.windowRelatedTo instanceof m&&(-1==(d=g.gui.windowRelatedTo).get_possibleCityUpgrades().indexOf(e)||vn.any(g.city.upgrades.upgrades,function(t){return Fr.getClass(t)==e})||(null!=(u=g.gui.currentUpgradeButtons.h[n])&&u.setNeedsAttention(t),o=!1)),o||!t)for(a=0,l=g.city.permanents;a<l.length;){var d,c,p,h=l[a];++a,h.is(m)&&(-1==(d=h).get_possibleCityUpgrades().indexOf(e)||vn.any(g.city.upgrades.upgrades,function(t){return Fr.getClass(t)==e})||(t?(null==d.highlightSprite&&(d.highlightSprite=new PIXI.Sprite(H.getTexture("spr_whiteoutline")),d.highlightSprite.position.set(d.position.x-1,d.position.y-1),g.city.farForegroundStage.addChild(d.highlightSprite),c=[89,1,.77],p=ra.toRgb(c),d.highlightSprite.tint=Sn.toHexInt(p)),d.highlightSprite.alpha=(Math.sin(g.gui.guiTimer/10)+1)/2):null!=d.highlightSprite&&(d.highlightSprite.destroy(),d.highlightSprite=null)))}}}var g=this,e=this.city.progress.story.getDesiredGoalHighlights();if(null!=this.creatableCityElementsThatNeededAttention&&0<this.creatableCityElementsThatNeededAttention.length)for(var i=0,n=this.creatableCityElementsThatNeededAttention;i<n.length;){var s=n[i];++i,t(s,!1)}for(i=0;i<e.length;){var r=e[i];++i,t(r,!0)}this.creatableCityElementsThatNeededAttention=e},__class__:es},(V["gui.BuildingTypeImage"]=is).__name__="gui.BuildingTypeImage",is.create=function(t,e,i,n,s){var r=new PIXI.Container,o=D.field(i,"spriteName"),e=e.progress.resources.buildingInfo,i=i.__name__,a=e.h[i];r.addChild(H.makeSprite(null==a.buttonBack?o+"@44,0,20,20":a.buttonBack)),r.addChild(H.makeSprite(o+"@0,0,20,20"));var l=null;return l=new us(n,t,r,null,null,function(t){return!!l.rect.contains(t.position)&&(s.tooltip.setText(l,a.name),!0)})},(V["gui.Button"]=ns).__name__="gui.Button",ns.__interfaces__=[Kt],ns.prototype={updateSize:function(){null!=this.parent&&this.parent.updateSize()},updatePosition:function(t){this.rect.x=t.x,this.rect.y=t.y},handleMouse:function(t){return this.doHandleMouse(t,function(){},function(){})},doHandleMouse:function(t,e,i){if(this.rect.contains(t.position)){this.mouseOut=!1;t=t.claimMouse(this,null,!0,this.canBeHeld);return t==A.Confirmed?(this.action(),null!=this.buttonSound&&C.get().playSound(this.buttonSound)):(t==A.Active?i:e)(),null!=this.onHover&&this.onHover(),!0}return!1},update:function(){null!=this.onUpdate&&this.onUpdate(),null!=this.keyboardButton&&this.gui.get_keyboard().pressed[this.keyboardButton]&&this.action(),this.mouseOut=!0},destroy:function(){},__class__:ns};var ss=function(){};(V["gui.ChangeCityNameWindow"]=ss).__name__="gui.ChangeCityNameWindow",ss.createWindow=function(t){t.gui.createWindow("changeCityNameWindow");var e=t;t.gui.addWindowToStack(function(){ss.createWindow(e)}),ss.create(t,t.gui,t.gui.innerWindowStage,t.gui.windowInner)},ss.create=function(e,t,i,n){t.windowAddTitleText(kn.lo("change_city_name")),n.addChild(new Qs(n,i,kn.lo("give_city_name"))),n.addChild(new Cs(t.windowInner,new Cn(2,4)));i=new Zs(t.windowInner,t,e.game,kn.lo("city_name"),e.cityName);n.addChild(i),i.onInput=function(t){return null!=t&&(e.cityName=me.sanitizeCityName(t),!0)},n.addChild(new Cs(t.windowInner,new Cn(2,4))),t.windowAddBottomButtons()};var rs=function(t,e,i,n,s,r,o,a,l){null==l&&(l="spr_button_checked"),null==a&&(a="spr_button"),ns.call(this,t,e,i,n,r);a=H.getTextures(a,3),l=H.getTextures(l,3);this.buttonPatch=new Hs(a[0],2,20,20),this.buttonPatch.texture=a[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=a[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=l[0],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=l[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=l[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.setTextureSet(0),e.addChild(this.buttonPatch),this.container=new ds(t,e,this),this.rect=new xn(0,0,2,2),this.isChecked=s};(V["gui.CheckboxButton"]=rs).__name__="gui.CheckboxButton",rs.createSettingButton=function(t,e,i,n,s,r){var o=new rs(t,e,i,n,s),e=o.container;e.padding.top=3,e.padding.left=3,e.padding.right=3,e.padding.bottom=1,e.fillSecondarySize=!0,S.isMobile&&(e.padding.top+=2,e.padding.bottom+=2);var a=H.getTextures("spr_checkbox",2),l=new PIXI.Sprite(a[1]),n=new us(e,t.innerWindowStage,l,{left:0,right:3,top:0,bottom:0},function(){var t=a,e=s()?0:1;l.texture=t[e]});e.addChild(n),e.addChild(new Qs(e,t.innerWindowStage,r)),i.addChild(o)},rs.__super__=ns,rs.prototype=e(ns.prototype,{updatePosition:function(t){ns.prototype.updatePosition.call(this,t),this.buttonPatch.position.set(t.x,t.y),this.buttonPatch.updateSprites(),this.container.updatePosition(t)},updateSize:function(){null!=this.container&&(this.rect.width=this.container.rect.width,this.rect.height=this.container.rect.height,this.updateSizeDisplay(),null!=this.parent&&this.parent.updateSize(),this.container.minWidth=this.container.baseWidth)},updateSizeDisplay:function(){null!=this.container&&(this.buttonPatch.npWidth=this.rect.width,this.buttonPatch.npHeight=this.rect.height,this.buttonPatch.updateSprites())},handleMouse:function(t){var e=this,i=this.isChecked();return ns.prototype.doHandleMouse.call(this,t,function(){e.buttonPatch.setTextureSet(i?4:1)},function(){e.buttonPatch.setTextureSet(i?5:2)})},update:function(){this.container.update(),this.mouseOut&&this.buttonPatch.setTextureSet(this.isChecked()?3:0),this.isActive()&&this.buttonPatch.setTextureSet(this.isChecked()?5:2),ns.prototype.update.call(this)},destroy:function(){ns.prototype.destroy.call(this),this.container.destroy(),this.stage.removeChild(this.buttonPatch)},__class__:rs});var os=function(t,e,i){this.gameSpeedOnUse=null,this.storyHelpButtonOnUse=null,this.hideShowUIButton=null,this.cityExtraInfoHidden=!1,this.simulationSpeedChosen=0,this.workerAssignButton=null,this.notificationPanel=null,f.call(this,t,e),this.tooltip=new tr(t,i,this.tooltipStage),this.city=i,this.cityInfo=new ds(this,this.stage,null,new Cn(0,0),new In(1,1)),this.currentUpgradeButtons=new zr,this.buildingButtons=new es(this,i),this.createCityInfo(),this.resize()};(V["gui.CityGUI"]=os).__name__="gui.CityGUI",os.__super__=f,os.prototype=e(f.prototype,{onLanguageChange:function(){f.prototype.onLanguageChange.call(this),this.tooltip=new tr(this.game,this.city,this.tooltipStage)},createWindowInCurrentContext:function(t,e){f.prototype.createWindow.call(this,t,e)},createWindow:function(t,e){f.prototype.createWindow.call(this,t,e)},refreshCityInfo:function(){null!=this.materialsInfo&&(this.hideCityInfo(),this.createCityInfo())},createCityInfo:function(){this.addHelpAndGameSpeedButtons(),this.cityExtraInfoHidden||(this.addGeneralStatistics(),this.addAllMaterialsInfo())},hideCityInfo:function(){this.cityInfo.clear(),this.materialsInfo=null,this.workerAssignButton=null,this.hideShowUIButton=null,this.woodAmountDisplay=null,this.stoneAmountDisplay=null,this.storyHelpButton=null,this.city.simulation.boostManager.hideBoostButtonAfterGUIHide()},miniButtonToUse:function(){return this.game.isMobile?"spr_transparentbutton_info_miniplus":"spr_transparentbutton_info_mini"},addHelpAndGameSpeedButtons:function(){var s=this,i=new ds(this,this.stage,this.cityInfo,null);i.alignment=Ss.RightOrBottom,this.cityInfo.addChild(i);function r(){return s.city.progress.goalHelp.hasCurrentGoalHelp()}var t=null,t=function(){"quickMissionWindow"==s.windowRelatedTo?s.closeWindow():r()&&(s.city.gui.clearWindowStack(),s.city.gui.createWindow("quickMissionWindow"),s.city.gui.addWindowToStack(t),null!=s.storyHelpButtonOnUse&&s.storyHelpButtonOnUse(),ys.create(s.city,s.city.gui,s.city.gui.innerWindowStage,s.city.gui.windowInner))};this.storyHelpButton=new Fs(this,this.stage,i,t,H.getTexture("spr_icon_help"),function(){return"quickMissionWindow"==s.windowRelatedTo},function(){if(r()){var t=s.city.progress.goalHelp.getCurrentGoalHelp();if(1==t.length)s.tooltip.setText(s.storyHelpButton,t[0].text,t[0].category==kn.lo("main_goal")?kn.lo("current_task"):t[0].category);else{for(var e="",i=0;i<t.length;){var n=t[i];++i,""!=e&&(e+="\n\n"),e+="- "+n.category+"\n"+n.text}s.tooltip.setText(s.storyHelpButton,e,kn.lo("current_tasks"))}}null!=s.storyHelpButtonOnUse&&s.storyHelpButtonOnUse()},null,this.miniButtonToUse(),this.game.isMobile?4:1),this.storyHelpButton.onUpdate=function(){r()?s.storyHelpButton.show():s.storyHelpButton.hide()},i.addChild(this.storyHelpButton);var e=new Fs(this,this.stage,i,function(){s.city.set_pauseGame(!s.city.pauseGame),s.city.pauseGame?Fn.reportStopGameplay():Fn.reportStartGameplay()},H.getTexture("spr_icon_pause"),function(){return s.city.pauseGame},function(){var t=s.game.isMobile?Dn.firstToUpper(kn.lo("tap")):kn.lo("click_or_space");s.city.pauseGame?s.tooltip.setText(e,t+" "+kn.lo("to_unpause"),kn.lo("game_paused")):s.tooltip.setText(e,t+" "+kn.lo("to_pause"),kn.lo("game_running"))},null,this.miniButtonToUse(),this.game.isMobile?4:1);i.addChild(e);var n=[{speed:1,icon:H.getTexture("spr_icon_play"),tooltipTitle:kn.lo("normal_speed")},{speed:1.5,icon:H.getTexture("spr_oneandhalfspeed"),tooltipTitle:kn.lo("onepointfive_speed")},{speed:2,icon:H.getTexture("spr_icon_speedup"),tooltipTitle:kn.lo("double_speed")},{speed:.5,icon:H.getTexture("spr_icon_halfspeed"),tooltipTitle:kn.lo("half_speed")},{speed:.75,icon:H.getTexture("spr_icon_slightlyslowerspeed"),tooltipTitle:kn.lo("threequarter_speed")}];k.cheatSpeedEnabled&&n.push({speed:10,icon:H.getTexture("spr_icon_speedup"),tooltipTitle:"Cheat Speed"}),this.gameSpeedButton=new Fs(this,this.stage,i,function(){s.game.keyboard.down[17]?s.game.keyboard.down[16]?--s.simulationSpeedChosen<0&&(s.simulationSpeedChosen=n.length-1):++s.simulationSpeedChosen>=n.length&&(s.simulationSpeedChosen=0):1<s.simulationSpeedChosen?s.simulationSpeedChosen=0:s.simulationSpeedChosen=2,s.city.simulationSpeed=n[s.simulationSpeedChosen].speed,s.gameSpeedButton.imageSprite.texture=n[s.simulationSpeedChosen].icon,s.game.keyboard.down[16]||(s.city.set_pauseGame(!1),Fn.reportStartGameplay()),null!=s.gameSpeedOnUse&&s.gameSpeedOnUse()},vn.min(n,function(t){return Math.abs(t.speed-s.city.simulationSpeed)}).icon,function(){return!1},function(){s.tooltip.setText(s.gameSpeedButton,s.game.isMobile?kn.lo("change_game_speed_mobile"):kn.lo("change_game_speed_pc")+(s.city.pauseGame?"\n"+kn.lo("keep_paused_help"):""),n[s.simulationSpeedChosen].tooltipTitle),null!=s.gameSpeedOnUse&&s.gameSpeedOnUse()},null,this.miniButtonToUse(),this.game.isMobile?4:1),this.gameSpeedButton.keyboardButton=b.getLetterCode("S"),i.addChild(this.gameSpeedButton);var o,a=new Fs(this,this.stage,i,function(){"gameMenu"==s.windowRelatedTo?s.closeWindow():Is.create(s,s.city)},H.getTexture("spr_icon_menu"),function(){return"gameMenu"==s.windowRelatedTo},function(){s.tooltip.setText(a,"",kn.lo("game_menu"))},null,this.miniButtonToUse(),this.game.isMobile?4:1);a.keyboardButton=b.getLetterCode("M"),i.addChild(a),this.game.isMobile&&(o=H.getTexturesByWidth("spr_hideui",12),this.hideShowUIButton=new Fs(this,this.stage,i,function(){if(s.cityExtraInfoHidden)s.addGeneralStatistics(),s.addAllMaterialsInfo(),s.cityExtraInfoHidden=!1;else{for(var t=s.cityInfo.children.length-1;0<=t;){var e=s.cityInfo.children[t];e!=i&&s.cityInfo.removeChild(e),--t}s.materialsInfo=null,s.workerAssignButton=null,s.woodAmountDisplay=null,s.stoneAmountDisplay=null,s.cityExtraInfoHidden=!0,s.city.simulation.boostManager.hideBoostButtonAfterGUIHide()}s.hideShowUIButton.updateTexture(o[s.cityExtraInfoHidden?0:1])},o[this.cityExtraInfoHidden?0:1],null,function(){s.cityExtraInfoHidden?s.tooltip.setText(s.hideShowUIButton,kn.lo("show_extra_info")):s.tooltip.setText(s.hideShowUIButton,kn.lo("hide_extra_info"))},null,this.miniButtonToUse(),this.game.isMobile?4:1),i.addChild(this.hideShowUIButton))},addGeneralStatistics:function(){var o=this,t=new ds(this,this.stage,this.cityInfo,null);t.alignment=Ss.RightOrBottom,t.direction=vs.Vertical,this.cityInfo.addChild(t);var a=this.city.simulation.happiness,e=new ds(this,this.stage,t);e.fillSecondarySize=!0,t.addChild(e);var i=this.createInfoButton(function(){"popInfo"==o.windowRelatedTo?o.closeWindow():(o.createWindow("popInfo"),Gs.create(o.city,o,o.innerWindowStage,o.windowInner))},function(){var t=tt.count(o.city.simulation.citizens,function(t){return t.get_age()<=16});o.tooltip.setText(kn.lo("population"),kn.lo("total_amount_of_citizens")+"\n"+(1==t?kn.lo("is_one_child"):kn.lo("are_n_children",[t]))+"\n"+(1950<=o.city.simulation.citizens.length?kn.lo("tap_for_age_distribution"):kn.lo("tap_for_age_distribution_or_pop_limit"))+o.game.textHelper.ifNotMobile("\n\n"+kn.lo("follow_hint")))},function(){return q.string(0|o.city.simulation.citizens.length)},"spr_population",e,23,function(){return"popInfo"==o.windowRelatedTo});i.keyboardButton=b.getLetterCode("C"),e.addChild(i);var l=null;(l=this.createInfoButton(function(){"happinessWindow"==o.windowRelatedTo?o.closeWindow():(o.createWindow("happinessWindow"),Bs.create(o.city,o,o.innerWindowStage,o.windowInner))},function(){var t="",e="",i="";0<a.foodShortageUnhappiness&&(e+=kn.lo("food_shortage_unhappiness")+" "+(0|a.foodShortageUnhappiness)+"\n"),0<a.foodRationingUnhappiness&&(e+=kn.lo("food_rationing_unhappiness")+" "+Math.ceil(a.foodRationingUnhappiness)+"\n"),0<a.overtimeUnhappinessShown&&(e+=kn.lo("mandatory_overtime_unhappiness")+" "+Math.ceil(a.overtimeUnhappinessShown)+"\n"),0!=a.enthusiasmHappiness&&(t+=kn.lo("new_city_enthousiasm")+" "+(0|a.enthusiasmHappiness)+"\n");for(var n=0,s=a.happinessBoosts;n<s.length;){var r=s[n];++n,i+=r.text+": "+(0|r.boost)+"\n"}o.tooltip.setText(l,kn.lo("happiness_explainer")+"\n"+kn.lo("home_happiness")+" "+(0|a.homeHappiness)+"\n"+kn.lo("sense_of_purpose")+" "+(0|a.purposeHappiness)+"\n"+kn.lo("entertainment_happiness")+" "+(0|a.entertainmentHappiness)+"\n"+kn.lo("education_happiness")+" "+(0|a.schoolHappiness)+"\n"+kn.lo("medical_happiness")+" "+(0|a.medicalHappiness)+"\n"+e+i+t+"\n"+kn.lo("citizens_work_at_speed",[zn.floatFormat(Math,a.actionSpeedModifier,2)]),kn.lo("happiness"))},function(){return 99.99<=o.city.simulation.happiness.happiness?124.99<=o.city.simulation.happiness.happiness?"xD":":D":q.string(0|o.city.simulation.happiness.happiness)},"spr_happiness",e,26,function(){return"happinessWindow"==o.windowRelatedTo})).keyboardButton=b.getLetterCode("H"),e.addChild(l);var n=this.city.simulation.stats,s=null,s=this.createInfoButton(function(){"houseInfo"==o.windowRelatedTo?o.closeWindow():(o.createWindow("houseInfo"),As.create(o.city,o,o.innerWindowStage,o.windowInner))},function(){o.tooltip.setText(s,As.getHousingHelpText(n),kn.lo("housing"))},function(){return n.peopleWithHome>=n.people?""+(n.houseCapacity-n.peopleWithHome):"[red]-"+(n.people-n.peopleWithHome)},"spr_housing",t,20,function(){return"houseInfo"==o.windowRelatedTo});t.addChild(s);var r=this.city.simulation.stats;this.workerAssignButton=this.createInfoButton(function(){"workersAssign"==o.windowRelatedTo?o.closeWindow():(o.createWindow("workersAssign"),sr.create(o.city,o,o.innerWindowStage,o.windowInner))},function(){o.tooltip.setText(kn.lo("work"),kn.lo("work_tooltip",[r.jobs]))},function(){return r.peopleWithAJob+"/"+r.laborForce},"spr_work",t,20,function(){return"workersAssign"==o.windowRelatedTo}),this.workerAssignButton.keyboardButton=b.getLetterCode("W"),t.addChild(this.workerAssignButton)},addAllMaterialsInfo:function(){function i(t,e){null==e&&(e=t);var i="",n=Math.floor(r.city.simulation.stats.materialUsed[z.findMaterialIndex(t)][1]),s=Math.floor(r.city.simulation.stats.materialUsed[z.findMaterialIndex(t)][0]);return 0==n&&0==s||"food"==t||(i="knowledge"==t?"\n"+kn.lo("operating_cost",[n,e,s]):"\n"+kn.lo("factory_operating_cost",[n,e,s])),"\n"+kn.lo("citizen_production_cost",[Math.floor(r.city.simulation.stats.materialProduction[z.findMaterialIndex(t)][1]),e,Math.floor(r.city.simulation.stats.materialProduction[z.findMaterialIndex(t)][0])])+i}var r=this;this.materialsInfo=new ds(this,this.stage,this.cityInfo,new Cn(0,0),new In(0,0)),this.materialsInfo.direction=vs.Vertical,this.cityInfo.addChild(this.materialsInfo),this.city.simulation.boostManager.createBoostButton(this,this.materialsInfo,this.stage),this.materialsInfo.addChild(new Cs(this.materialsInfo,new Cn(2,6)));this.city.simulation.stats.materialUsed,this.addMaterialInfo("food",Dn.firstToUpper(kn.lo("food")),function(){var t="",e=r.city.simulation.eating;return.1<e.foodShortage&&(t="\n"+kn.lo("not_enough_food",[Math.ceil(e.foodShortage)])),e.getFoodText()+i("food",kn.lo("food"))+t},function(){return Math.floor(r.city.materials.food)},"spr_resource_food",function(){return 0<r.city.simulation.eating.foodShortage},"food");this.woodAmountDisplay=this.addMaterialInfo("wood",Dn.firstToUpper(kn.lo("wood")),function(){return kn.lo("wood_use")+i("wood",kn.lo("wood"))},function(){return Math.floor(r.city.materials.wood)},"spr_resource_wood",null,"wood"),this.stoneAmountDisplay=this.addMaterialInfo("stone",Dn.firstToUpper(kn.lo("stone")),function(){return kn.lo("stone_use")+i("stone",kn.lo("stone"))},function(){return Math.floor(r.city.materials.stone)},"spr_resource_stone",null,"stone"),this.addMaterialInfo("knowledge",Dn.firstToUpper(kn.lo("knowledge")),function(){return kn.lo("knowledge_use")+i("knowledge",kn.lo("knowledge"))},function(){return Math.floor(r.city.materials.knowledge)},"spr_resource_knowledge",null,"knowledge"),this.addMaterialInfo("machineParts",Dn.firstToUpper(kn.lo("machine_parts")),function(){return kn.lo("machine_parts_use")+i("machineParts",kn.lo("machine_parts"))},function(){return Math.floor(r.city.materials.machineParts)},"spr_resource_machineparts",null,"machineParts"),this.addMaterialInfo("refinedMetal",Dn.firstToUpper(kn.lo("refined_metals")),function(){return kn.lo("refined_metals_use")+i("refinedMetal",kn.lo("refined_metals"))},function(){return Math.floor(r.city.materials.refinedMetal)},"spr_resource_refinedmetal",null,"refinedMetal"),this.addMaterialInfo("computerChips",Dn.firstToUpper(kn.lo("computer_chips")),function(){return kn.lo("computer_chips_use")+i("computerChips",kn.lo("computer_chips"))},function(){return Math.floor(r.city.materials.computerChips)},"spr_resource_computerchips",null,"computerChips"),this.city.progress.unlocks.unlockedMaterial("graphene")&&this.addMaterialInfo("graphene",Dn.firstToUpper(kn.lo("graphene")),function(){return kn.lo("graphene_use")+i("graphene",kn.lo("graphene"))},function(){return Math.floor(r.city.materials.graphene)},"spr_resource_graphene",null,"graphene");for(var t=0,e=z.modMaterials;t<e.length;){var n=[e[t]];++t,this.addMaterialInfo(n[0].variableName,n[0].displayName,function(t){return function(){return t[0].description+t[0].tooltipExt()+i(t[0].variableName,t[0].displayName.toLowerCase())}}(n),function(t){return function(){return Math.floor(r.city.materials[t[0].variableName])}}(n),"spr_resource_"+n[0].variableName.toLowerCase(),null,n[0].variableName)}},resize:function(){f.prototype.resize.call(this),this.buildingButtons.resize(),this.cityInfo.updatePosition(new Cn(this.game.rect.width,this.game.rect.height)),null!=this.notificationPanel&&this.notificationPanel.updatePosition(new Cn(this.game.rect.width/2|0,0))},update:function(t){this.buildingButtons.update(t),this.cityInfo.update(),null!=this.notificationPanel&&this.notificationPanel.update(),f.prototype.update.call(this,t)},onEscapePressWithoutWindow:function(){Is.create(this,this.city)},handleMouse:function(t){return!!f.prototype.handleMouse.call(this,t)||(!!this.buildingButtons.handleMouse(t)||(!!this.cityInfo.handleMouse(t)||!(null==this.notificationPanel||!this.notificationPanel.handleMouse(t))))},addMaterialInfo:function(t,e,i,n,s,r,o){var a=this;null==r&&(r=function(){return!1});var l=this.createInfoBoxForMaterialsDynamicTooltip(t,e,i,function(){var t=q.string(n());return null!=r&&r()?"[red]"+t:t},s,this.materialsInfo,50);return l.onUpdate=function(){var t=a.city.simulation.stats.materialUsed[z.findMaterialIndex(o)][1]+.2<a.city.simulation.stats.materialProduction[z.findMaterialIndex(o)][1]||a.city.simulation.stats.materialUsed[z.findMaterialIndex(o)][1]<.2&&"food"!=o||1+((0|a.city.simulation.time.timeSinceStart)/1440|0)<=5;if(!t){for(var e=0,i=0,n=0;n<2&&a.city.simulation.festivalManager.wasFestivalOnDay[1+n];)++n;for(e+=a.city.simulation.stats.materialUsed[z.findMaterialIndex(o)][1+n],i+=a.city.simulation.stats.materialProduction[z.findMaterialIndex(o)][1+n];n<2&&a.city.simulation.festivalManager.wasFestivalOnDay[2+n];)++n;for(e+=a.city.simulation.stats.materialUsed[z.findMaterialIndex(o)][2+n],i+=a.city.simulation.stats.materialProduction[z.findMaterialIndex(o)][2+n];n<2&&a.city.simulation.festivalManager.wasFestivalOnDay[3+n];)++n;t=(e+=a.city.simulation.stats.materialUsed[z.findMaterialIndex(o)][3+n])+.2<=(i+=a.city.simulation.stats.materialProduction[z.findMaterialIndex(o)][3+n])}t||(e=a.city.simulation.stats.materialProduction[z.findMaterialIndex(o)][0],i=a.city.simulation.stats.materialUsed[z.findMaterialIndex(o)][0],10<a.city.simulation.time.timeSinceStart/60%24&&i<e&&(!l.hasAdditionalSprite()||e*(1.1+.1*Math.max(0,12-a.city.simulation.time.timeSinceStart/60%24))>i)&&(t=!0)),a.city.progress.sandbox.unlimitedResources||t?l.setAdditionalSprite(null):l.setAdditionalSprite(H.getTexture("spr_resource_downtrend"))},l},createInfoBoxForMaterialsDynamicTooltip:function(t,e,i,n,s,r,o){null==o&&(o=42);var a=this,l=new ls(this,this.stage,r,function(){a.windowRelatedTo==t?a.closeWindow():(a.createWindow(t,H.getTexture("spr_9p_window_moreopaque")),lr.create(a.city,a,a.innerWindowStage,a.windowInner,t,e))},function(){return a.windowRelatedTo==t},function(){a.tooltip.setText(l,i(),e)},"spr_transparentbutton_info");l.container.fillSecondarySize=!0;o=new Os(this,this.stage,l.container,function(){return n()},H.getTexture(s),o,function(){},"none",function(){return a.city.progress.sandbox.unlimitedResources});return o.fillSecondarySize=!0,o.fillPrimarySize=!0,l.container.addChild(o),r.addChild(l),o},createInfoButton:function(t,e,i,n,s,r,o){null==r&&(r=42);t=new ls(this,this.stage,s,t,o,e,"spr_transparentbutton_info");t.container.fillSecondarySize=!0;o=this.game.isMobile?3:0,e=this.game.isMobile?2:0;return t.container.padding={left:2+o,right:3+o,top:2+o,bottom:o-1},t.container.updateSize(),t.container.addChild(new us(t.container,this.stage,new PIXI.Sprite(H.getTexture(n)))),t.container.addChild(new Qs(t.container,this.stage,null,i,null,{left:1+e,right:0,top:1,bottom:0},null,!1,!0)),t.container.minWidth=r,t},closeWindow:function(t){null==t&&(t=!1),this.city.pauseGame&&this.pausedForWindow&&(this.city.set_pauseGame(!1),this.pausedForWindow=!1),this.city.pauseGame||-1!=this.city.gui.windowStackMeta.indexOf("GameMenu")&&1!=this.city.gui.windowStackMeta.length||t||Fn.reportStartGameplay(),f.prototype.closeWindow.call(this,t)},pauseForWindow:function(){var t=this.city.pauseGame;this.city.set_pauseGame(!0),t||(this.pausedForWindow=!0)},activateLoserState:function(){this.cityInfo.clear(),this.buildingButtons.activateLoserState()},showTutorialArrows1:function(){var t=this,e=this.windowOnDestroy,i=!1;this.windowOnDestroy=function(){i=!0,null!=e&&e()},this.overlayElements.push(new Ms(this,this.gameHelpStage,function(){return t.windowInner.children[t.windowInner.children.length-1].children[1]},function(){return!i},ks.Left,180)),this.buildingButtons.showTutorialArrows1(this.overlayElements,function(){return i},this.gameHelpStage)},showTutorialArrowsBuildStoneMine:function(t){var e=this,i=new Ms(this,this.gameHelpStage,function(){return e.woodAmountDisplay},function(){return!!t()&&e.city.materials.wood<4},ks.DownHint,0);i.addText(kn.lo("see_wood_here")),this.overlayElements.push(i),this.buildingButtons.showTutorialArrows101(this.overlayElements,function(){return 4<=e.city.materials.wood},this.gameHelpStage)},showTutorialArrows2:function(t){function e(){return n&&null==s&&(s=i.window),n=n||Object.prototype.hasOwnProperty.call(i.city.simulation.jobAssigner.priorityJobs.h,"buildings.StoneMine")&&0!=i.city.simulation.jobAssigner.priorityJobs.h["buildings.StoneMine"]}var i=this,n=!1,s=null;this.overlayElements.push(new Ms(this,this.gameHelpStage,function(){return i.hideShowUIButton},function(){return!(!t()||null!=sr.tutorialStoneMineUpButton||e())&&i.cityExtraInfoHidden},ks.Down));var r=new Ms(this,this.gameHelpStage,function(){return i.workerAssignButton},function(){return!(!t()||null!=sr.tutorialStoneMineUpButton)&&!e()},ks.Down);this.game.isMobile||r.useBigMovement(),this.overlayElements.push(r),this.overlayElements.push(new Ms(this,this.gameHelpStage,function(){return sr.tutorialStoneMineUpButton},function(){return null!=sr.tutorialStoneMineUpButton&&!e()},ks.Left));var o=new Ms(this,this.gameHelpStage,function(){return i.woodAmountDisplay},function(){return!!e()&&(null==i.window||i.window==s)},ks.DownHint,0);this.game.rect.width<900&&(o.pleaseAlignExtraTextRight=!0),o.addText(kn.lo("great_gather_stone")),this.overlayElements.push(o),this.buildingButtons.showTutorialArrows2(this.overlayElements,e,this.gameHelpStage,t);function a(){return 6<i.city.materials.stone&&i.city.materials.wood<6&&!tt.exists(i.city.permanents,function(t){return!!t.is(Ei)&&0<t.workers.length})}function l(){return!!Object.prototype.hasOwnProperty.call(i.city.simulation.jobAssigner.priorityJobs.h,"buildings.StoneMine")&&3<=i.city.simulation.jobAssigner.priorityJobs.h["buildings.StoneMine"]}r=kn.lo("you_have_enough_stone"),o=new Ms(this,this.gameHelpStage,function(){return i.hideShowUIButton},function(){return!(null!=sr.tutorialStoneMineUpButton||!a())&&i.cityExtraInfoHidden},ks.Down);o.addText(r),this.overlayElements.push(o);o=new Ms(this,this.gameHelpStage,function(){return i.workerAssignButton},function(){return null==sr.tutorialStoneMineUpButton&&a()},ks.Down);o.addText(r),this.overlayElements.push(o);o=new Ms(this,this.gameHelpStage,function(){return sr.tutorialStoneMineDownButton},function(){return!(null==sr.tutorialStoneMineDownButton||!a())&&l()},ks.Left);o.addText(kn.lo("reduce_stone_mining_priority")),this.overlayElements.push(o);o=new Ms(this,this.gameHelpStage,function(){return sr.tutorialWoodCuttersUpButton},function(){return!(null==sr.tutorialWoodCuttersUpButton||!a())&&!l()},ks.Left);o.addText(kn.lo("increase_woodcutting_priority")),this.overlayElements.push(o)},showTutorialArrows3:function(){var t=this,e=!1,i=new Ms(this,this.gameHelpStage,function(){return t.storyHelpButton},function(){return!e&&null==t.window},ks.DownHint,0);i.addText(this.city.game.isMobile?kn.lo("hint_hint"):kn.lo("hint_hint_pc")),this.overlayElements.push(i),this.storyHelpButtonOnUse=function(){e=!0,t.storyHelpButtonOnUse=null}},showTutorialArrows4:function(){var t,e,i=this;this.game.isMobile||0!=this.simulationSpeedChosen||(t=!1,(e=new Ms(this,this.gameHelpStage,function(){return i.gameSpeedButton},function(){return!t&&null==i.window},ks.DownHint,0)).addText(kn.lo("speedup_hint")),this.overlayElements.push(e),this.gameSpeedOnUse=function(){t=!0,i.gameSpeedOnUse=null})},showTutorialArrowsInviteCitizens:function(){this.buildingButtons.showTutorialArrowsInviteCitizens(this.overlayElements,this.gameHelpStage)},showWindowCloseWarning:function(t){null==t&&(t=300);var e=this,i=this.windowOnDestroy,n=!1;return this.windowOnDestroy=function(){n=!0,null!=i&&i()},this.overlayElements.push(new Ms(this,this.gameHelpStage,function(){return e.windowInner.children[e.windowInner.children.length-1].children[1]},function(){return!n},ks.Left,t)),function(){return n}},clearTutorial:function(){for(var t=0,e=this.overlayElements;t<e.length;){var i=e[t];++t,i.destroy()}this.overlayElements=[]},refreshCategoryBuildingsShown:function(){this.buildingButtons.refreshCategoryBuildingsShown()},__class__:os});var as=function(){};(V["gui.ClimateCrisisExplainerWindow"]=as).__name__="gui.ClimateCrisisExplainerWindow",as.create=function(t,e,i,n){t.gui.windowAddTitleText(kn.lo("climate_crisis_explainer_1")),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_2"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_3"),null,"Arial15")),n.addChild(new Qs(n,i,"climate_crisis_explainer_4",null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_5"),null,"Arial15")),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_6"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_7"),null,"Arial15")),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_8"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_9"),null,"Arial15")),n.addChild(new Qs(n,i,kn.lo("climate_crisis_explainer_10"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,kn.lo("thanks_signoff"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,"Florian van Strien",null,"Arial")),n.addChild(new Cs(n,new Cn(2,10))),e.windowAddBottomButtons()};var ls=function(t,e,i,n,s,r,o){null==o&&(o="spr_button"),this.needsAttention=!1,this.highlightPatch=null,ns.call(this,t,e,i,n,s,r),this.buttonTextures=H.getTextures(o,3),this.buttonPatch=new Hs(this.buttonTextures[0],2,2,2),this.buttonPatch.texture=this.buttonTextures[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=this.buttonTextures[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.setTextureSet(0),e.addChild(this.buttonPatch),this.container=new ds(t,e,this),this.rect=new xn(0,0,2,2)};function hs(t,e,i,n,s,r,o,a,l,h){null==l&&(l=16777215),null==a&&(a=10526880),null==o&&(o="spr_button"),this.progressAmount=0,ls.call(this,t,e,i,n,s,r,o),this.graphics=new PIXI.Graphics(!1),e.addChild(this.graphics),this.backColor=a,this.frontColor=l,this.autoSetProgress=h}(V["gui.ContainerButton"]=ls).__name__="gui.ContainerButton",ls.__super__=ns,ls.prototype=e(ns.prototype,{setNeedsAttention:function(t){null==t&&(t=!1),this.needsAttention=t,this.updateNeedsAttention()},updateNeedsAttention:function(){null!=this.buttonPatch&&(this.needsAttention&&null==this.highlightPatch&&(this.highlightPatch=new Hs(H.getTexture("spr_greenoutline"),2,this.buttonPatch.npWidth,this.buttonPatch.npHeight),this.stage.addChild(this.highlightPatch),this.highlightPatch.position.set(this.rect.x,this.rect.y),this.highlightPatch.updateSprites()),null!=this.highlightPatch&&(this.needsAttention&&0==this.buttonPatch.currentTextureSet?this.highlightPatch.alpha=(Math.sin(this.gui.guiTimer/10)+1)/2:this.highlightPatch.alpha=0))},updatePosition:function(t){ns.prototype.updatePosition.call(this,t),this.buttonPatch.position.set(t.x,t.y),this.buttonPatch.updateSprites(),null!=this.highlightPatch&&(this.highlightPatch.position.set(t.x,t.y),this.highlightPatch.updateSprites()),this.container.updatePosition(t)},updateSize:function(){null!=this.container&&(this.rect.width=this.container.rect.width,this.rect.height=this.container.rect.height,this.updateSizeDisplay(),null!=this.parent&&this.parent.updateSize(),this.container.minWidth=this.container.baseWidth)},updateSizeDisplay:function(){null!=this.container&&(this.buttonPatch.npWidth=this.rect.width,this.buttonPatch.npHeight=this.rect.height,this.buttonPatch.updateSprites(),null!=this.highlightPatch&&(this.highlightPatch.npWidth=this.rect.width,this.highlightPatch.npHeight=this.rect.height,this.highlightPatch.updateSprites()))},handleMouse:function(t){var e=this;return ns.prototype.doHandleMouse.call(this,t,function(){e.buttonPatch.setTextureSet(1)},function(){e.buttonPatch.setTextureSet(2)})},update:function(){this.container.update(),this.mouseOut&&this.buttonPatch.setTextureSet(0),this.isActive()&&this.buttonPatch.setTextureSet(2),this.updateNeedsAttention(),ns.prototype.update.call(this)},destroy:function(){ns.prototype.destroy.call(this),this.container.destroy(),this.stage.removeChild(this.buttonPatch),null!=this.highlightPatch&&this.highlightPatch.destroy()},__class__:ls}),(V["gui.ContainerButtonWithProgress"]=hs).__name__="gui.ContainerButtonWithProgress",hs.__super__=ls,hs.prototype=e(ls.prototype,{update:function(){ls.prototype.update.call(this),null!=this.autoSetProgress&&this.setProgress(this.autoSetProgress())},updateProgressDisplay:function(){var t,e,i;this.progressAmount<0?this.graphics.clear():(e=(t=this.rect).x,i=t.y,this.graphics.position.x=e,e=(t=this.rect).x,i=t.y,this.graphics.position.y=i,this.graphics.clear().beginFill(this.backColor,1).drawRect(1,1,this.rect.width-2,this.rect.height-2).endFill().beginFill(this.frontColor,1).drawRect(1,1,Math.round((this.rect.width-2)*this.progressAmount),this.rect.height-2).endFill())},updatePosition:function(t){ls.prototype.updatePosition.call(this,t),this.updateProgressDisplay()},updateSizeDisplay:function(){ls.prototype.updateSizeDisplay.call(this),this.updateProgressDisplay()},setProgress:function(t){this.progressAmount=t,this.updateProgressDisplay()},destroy:function(){ls.prototype.destroy.call(this),this.graphics.destroy()},__class__:hs});var us=function(t,e,i,n,s,r){this.container=i,this.stage=e,this.updateFunction=s,this.handleMouseFunction=r,e.addChild(i),this.rect=new xn(0,0,0,0),null==n&&(n={left:0,top:0,right:0,bottom:0}),this.padding=n,this.updateSize(),this.parent=t};(V["gui.ContainerHolder"]=us).__name__="gui.ContainerHolder",us.__interfaces__=[Kt],us.prototype={updateSize:function(){var t=this.container;this.container instanceof Rs||this.container instanceof Us?this.rect.width=Math.round(t.displayWidth):this.rect.width=Math.round(this.container.width),this.rect.height=Math.round(this.container.height),this.afterSizeUpdate()},afterSizeUpdate:function(){this.rect.width+=this.padding.left+this.padding.right,this.rect.height+=this.padding.top+this.padding.bottom,null!=this.parent&&this.parent.updateSize()},updatePosition:function(t){this.rect.x=t.x,this.rect.y=t.y,this.container.position.x=t.x+this.padding.left,this.container.position.y=t.y+this.padding.top},handleMouse:function(t){return null!=this.handleMouseFunction&&this.handleMouseFunction(t)},update:function(){null!=this.updateFunction&&this.updateFunction()},destroy:function(){this.stage.removeChild(this.container)},__class__:us};var ds=function(t,e,i,n,s,r,o,a){this.neverDownsize=!1,this.minHeight=0,this.minWidth=0,this.fillPrimarySize=!1,this.fillSecondarySize=!1,this.direction=vs.Horizontal,this.alignment=Ss.LeftOrTop,this.parent=i,this.stage=e,this.gui=t,this.children=null==r?[]:r,this.background=o,null==a&&(a={top:0,right:0,bottom:0,left:0}),this.padding=a,null!=o&&e.addChild(o),this.rect=new xn(0,0,0,0),this.origin=null==s?new In(0,0):s,null==n&&(n=new Cn(0,0)),this.updatePosition(n),this.updateSize()};(V["gui.GUIContainer"]=ds).__name__="gui.GUIContainer",ds.__interfaces__=[Kt],ds.prototype={handleMouse:function(t){for(var e=0,i=this.children;e<i.length;){var n=i[e];if(++e,n.handleMouse(t))return!0}return!(null==this.background||!this.rect.contains(t.position))&&(t.claimMouse(this),!0)},update:function(){null!=this.onUpdate&&this.onUpdate();for(var t=0,e=this.children;t<e.length;){var i=e[t];++t,i.update()}},updateSize:function(){this.updateSizeNonRecursive(),null!=this.parent?this.parent.updateSize():this.updateChildrenPosition()},updateSizeNonRecursive:function(){this.rect.width=0;for(var t=this.rect.height=0,e=this.children;t<e.length;){var i,n,s,r,o,a=e[t];++t,a instanceof Ps||(a instanceof ds?(i=a,this.direction==vs.Horizontal?(this.rect.width+=i.originalRectWidth,s=this.rect.height,n=i.originalRectHeight,this.rect.height=s<n?n:s):(n=this.rect.width,s=i.originalRectWidth,this.rect.width=n<s?s:n,this.rect.height+=i.originalRectHeight)):this.direction==vs.Horizontal?(this.rect.width+=a.rect.width,o=this.rect.height,r=a.rect.height,this.rect.height=o<r?r:o):(r=this.rect.width,o=a.rect.width,this.rect.width=r<o?o:r,this.rect.height+=a.rect.height))}this.neverDownsize&&(this.rect.width>this.minWidth&&(this.minWidth=this.rect.width),this.rect.height>this.minHeight&&(this.minHeight=this.rect.height)),this.rect.width<this.minWidth&&(this.rect.width=this.minWidth),this.rect.height<this.minHeight&&(this.rect.height=this.minHeight),this.baseWidth=this.rect.width,this.baseHeight=this.rect.height;for(t=0,e=this.children;t<e.length;){a=e[t];if(++t,a instanceof Ps){var l=a;switch(this.direction._hx_index){case 0:this.rect.width+=l.minFill;break;case 1:this.rect.height+=l.minFill}}}this.rect.width+=this.padding.left+this.padding.right,this.rect.height+=this.padding.top+this.padding.bottom,this.originalRectWidth=this.rect.width,this.originalRectHeight=this.rect.height,this.nonBaseWidth=this.rect.width-this.baseWidth,this.nonBaseHeight=this.rect.height-this.baseHeight},updateBackgroundSize:function(){var t,e;null!=this.background&&(t=this.background.npWidth,e=this.background.npHeight,this.background.npWidth=this.rect.width,this.background.npHeight=this.rect.height,null!=this.background&&(this.background.position.x=this.rect.x,this.background.position.y=this.rect.y,this.background.updateSprites()),t==this.background.npWidth&&e==this.background.npHeight||this.background.updateSprites())},updatePosition:function(t){this.position=t,this.updateChildrenPosition(),null!=this.background&&(this.background.position.x=this.rect.x,this.background.position.y=this.rect.y,this.background.updateSprites())},updateChildrenPosition:function(){var t=this.rect,e=this.position,i=this.origin.x*this.rect.width|0,n=this.origin.y*this.rect.height|0,i=e.x-i,n=e.y-n,s=(t.x=i,t.y=n,0),r=0;if(this.rect.width>this.originalRectWidth||this.rect.height>this.originalRectHeight){for(var o=0,a=0,l=this.children;a<l.length;){var h=l[a];if(++a,h instanceof ds&&h.fillPrimarySize){var u=h;switch(++r,this.direction._hx_index){case 0:o+=u.originalRectWidth;break;case 1:o+=u.originalRectHeight}}else switch(this.direction._hx_index){case 0:o+=h.rect.width;break;case 1:o+=h.rect.height}}if(0<=r)switch(this.direction._hx_index){case 0:o-=this.nonBaseWidth,s=this.rect.width-o;break;case 1:o-=this.nonBaseHeight,s=this.rect.height-o}}for(var d=this.rect.width-this.padding.left-this.padding.right,c=this.rect.height-this.padding.top-this.padding.bottom,a=0,l=this.children;a<l.length;){h=l[a];if(++a,h instanceof Ps)switch(this.direction._hx_index){case 0:h.rect.width=this.rect.width-this.padding.left-this.padding.right-this.baseWidth;break;case 1:h.rect.height=this.rect.height-this.padding.top-this.padding.bottom-this.baseHeight}else if(h instanceof ls||h instanceof rs){var p=h;p.container.fillSecondarySize&&(this.direction==vs.Horizontal?(h.rect.height=c,p.container.rect.height=c):(h.rect.width=d,p.container.rect.width=d)),p.updateSizeDisplay()}else if(h instanceof ds)if((u=h).fillSecondarySize&&(this.direction==vs.Horizontal?h.rect.height=c:h.rect.width=d),u.fillPrimarySize){var g=s/r|0;switch(this.direction._hx_index){case 0:h.rect.width=u.originalRectWidth+g;break;case 1:h.rect.height=u.originalRectHeight+g}s-=g,--r}}var m=this.rect.x+this.padding.left,f=this.rect.y+this.padding.top;switch(this.direction._hx_index){case 0:for(a=0,l=this.children;a<l.length;){h=l[a];if(++a,h instanceof ds)switch((u=h).alignment._hx_index){case 0:h.updatePosition(new Cn(m,f));break;case 1:h.updatePosition(new Cn(m,f+((this.rect.height-this.padding.top-this.padding.bottom-h.rect.height)/2|0)));break;case 2:h.updatePosition(new Cn(m,this.rect.get_y2()-this.padding.bottom-h.rect.height))}else h.updatePosition(new Cn(m,f));m+=h.rect.width}break;case 1:for(a=0,l=this.children;a<l.length;){h=l[a];if(++a,h instanceof ds)switch((u=h).alignment._hx_index){case 0:h.updatePosition(new Cn(m,f));break;case 1:h.updatePosition(new Cn(m+((this.rect.width-this.padding.left-this.padding.right-h.rect.width)/2|0),f));break;case 2:h.updatePosition(new Cn(this.rect.get_x2()-h.rect.width-this.padding.right,f))}else h.updatePosition(new Cn(m,f));f+=h.rect.height}}this.updateBackgroundSize()},addChild:function(t){return this.children.push(t),this.updateSize(),t},addChildWithoutSizeUpdate:function(t){return this.children.push(t),t},insertChild:function(t,e){return this.children.splice(e,0,t),this.updateSize(),t},removeChild:function(t,e){null==e&&(e=!0),t.destroy(),Y.remove(this.children,t),e&&this.updateSize()},clear:function(){tt.iter(this.children,function(t){t.destroy()}),this.children=[],this.updateSize()},destroy:function(){null!=this.onDestroy&&this.onDestroy(),tt.iter(this.children,function(t){t.destroy()}),null!=this.background&&this.stage.removeChild(this.background)},__class__:ds};var cs=function(t,e,i,n,s,r,o,a,l,h,u){null==u&&(u=1),this.setScrollPositionNextUpdate=null,this.extraPadding=1,this.scrollable=null,ds.call(this,i,n,s,r,o,a,l,h),this.maxWidthWithoutScrollbar=t,this.maxHeight=e,this.scrollbar=null,this.extraPadding=u};(V["gui.ContainerWithScrollbar"]=cs).__name__="gui.ContainerWithScrollbar",cs.__super__=ds,cs.prototype=e(ds.prototype,{setInnerContainer:function(t){this.clear();var e=new ds(this.gui,this.stage,this,null,null,null,null,{top:this.extraPadding,right:this.extraPadding,bottom:this.extraPadding,left:this.extraPadding});this.addChild(e),this.scrollable=new Zn(this.gui.game,this.stage,e,new Cn(0,0),this.maxWidthWithoutScrollbar,this.maxHeight,new In(0,0)),this.innerContainer=t,this.innerContainer.parent=this.scrollable,this.scrollable.setChild(this.innerContainer),e.addChild(this.scrollable)},addScrollBar:function(){this.scrollbar=new Ys(this,this.stage,this.scrollable),this.addChild(this.scrollbar)},setScrollPosition:function(t){null!=this.scrollable&&this.scrollable.updateScrollPosition(t),null!=this.scrollbar&&this.scrollbar.redraw()},forceSetScrollPosition:function(t){this.setScrollPosition(new Cn(t.x,t.y)),this.setScrollPositionNextUpdate=t},update:function(){ds.prototype.update.call(this),null!=this.setScrollPositionNextUpdate&&(this.setScrollPosition(this.setScrollPositionNextUpdate),this.setScrollPositionNextUpdate=null)},updateSize:function(){null!=this.scrollable&&(null!=this.scrollbar?this.scrollable.rect.height>=this.scrollable.get_innerHeight()&&(this.removeChild(this.scrollbar,!1),this.scrollbar=null):null==this.scrollbar&&this.scrollable.rect.height<this.scrollable.get_innerHeight()&&this.addScrollBar()),null!=this.scrollbar&&null!=this.scrollable&&(this.scrollbar.rect.height=this.scrollable.rect.height+2*this.extraPadding),ds.prototype.updateSize.call(this)},__class__:cs});var ps=function(){};(V["gui.CreateBuildingUpgrades"]=ps).__name__="gui.CreateBuildingUpgrades",ps.upgradeAll=function(t,e,i,n,s){for(var r=0,o=t.permanents;r<o.length;){var a=o[r];++r,a.isBuilding&&(a=a,Fr.getClass(a)==Fr.getClass(e)&&!vn.any(a.upgrades,function(t){return Fr.getClass(t)==i})&&Fr.getClass(a.buildingMode)!=i&&t.materials.canAfford(n)&&(t.materials.remove(n),s(a)))}},ps.getUpgradeAllNumberAndCanAfford=function(t,e,i,n){for(var s=t.materials.copy(),r=0,o=!0,a=n.copy(),l=a.knowledge=0,h=t.permanents;l<h.length;){var u=h[l];++l,u.isBuilding&&(u=u,Fr.getClass(u)==Fr.getClass(e)&&(vn.any(u.upgrades,function(t){return Fr.getClass(t)==i})||(s.canAfford(a)?(s.remove(a),++r):o=!1)))}return o||0!=r||(r=1),{number:r,canAffordAll:o}},ps.setUpgradeAllDisplay=function(t,e,i,n,s,r,o){null==o&&(o=!1);e=ps.getUpgradeAllNumberAndCanAfford(t,e,n,s),n=i.displayWidth;e.number<=1?(i.setBeforeKnowledgeText(0==e.number?kn.lo("per_building"):o?kn.lo("for_one_building"):kn.lo("for_this_building")),i.setCost(s)):(i.setBeforeKnowledgeText(e.canAffordAll?kn.lo("for_all_buildings"):kn.lo("for_n_buildings",[e.number])),(o=s.copy()).multiply(e.number),o.knowledge=s.knowledge,i.setCost(o)),n!=i.displayWidth&&r.updateSize()},ps.addUpgradeButton=function(t,e,i,n,s,r,o){null==o&&(o=!1);var a=t.gui,l=H.buildingUpgradesInfo,h=i.__name__,u=l.h[h],d=M.fromBuildingUpgradesInfo(u);t.progress.unlocks.getUnlockState(i)==mo.Researched&&(d.knowledge=0);var c=vn.any(e.upgrades,function(t){return Fr.getClass(t)==i})||null!=e.buildingMode&&Fr.getClass(e.buildingMode)==i,p=c;o&&(c=0==ps.getUpgradeAllNumberAndCanAfford(t,e,i,d).number);var g=ir.createActivatableButton(a,c,function(){t.materials.canAfford(d)&&(null!=r&&C.get().playSound(r),p||(t.materials.remove(d),n(e)),t.simulation.houseAssigner.shouldUpdateHouses=!0,t.progress.unlocks.research(i),d.knowledge=0,ir.hasMultiUpgradeModeOn&&ps.upgradeAll(t,e,i,d,n),t.gui.reloadWindow())},u.name,u.description);null!=g.button&&(g.button.buttonSound=null);var m,f,y,_,w,b,v,S,x,P,h=g.container;null!=g.button&&(l=a.currentUpgradeButtons,u=i.__name__,g=g.button,l.h[u]=g),c?o||(null==(m=tt.find(e.upgrades,function(t){return Fr.getClass(t)==i}))&&(m=e.buildingMode),(s||1<m.textures.length)&&(y=new ds(a,a.innerWindowStage,h),s&&(h.padding.bottom+=1,y.addChild(new Ks(a,a.innerWindowStage,h,function(){m.destroy(),Y.remove(e.upgrades,m),t.simulation.houseAssigner.shouldUpdateHouses=!0,t.gui.reloadWindow()},kn.lo("remove"))),y.addChild(new Cs(h,new Cn(2,1)))),1<m.textures.length&&(f=null,f=new Ks(a,a.innerWindowStage,h,function(){m.changeAppearance()},kn.lo("change_variant"),null,function(){a.tooltip.setText(f,kn.lo("change_appearance_upgrade"))}),y.addChild(f)),h.addChild(y),h.addChild(new Cs(h,new Cn(1,2))))):d.any()&&(c=new ds(a,a.innerWindowStage,h),s=new Rs(t,d,ir.hasMultiUpgradeModeOn?kn.lo("per_building"):""),t.game.isMobile&&(s.maxDisplayWidth=t.game.rect.width-10),y=c.addChild(new us(c,a.innerWindowStage,s,{left:0,right:0,top:0,bottom:ir.hasMultiUpgradeModeOn?0==d.knowledge?0:1:2},fa(s,s.updateCostDisplay))),ir.hasMultiUpgradeModeOn&&(ps.setUpgradeAllDisplay(t,e,s,i,d,y,o),_=t,w=e,b=s,v=i,S=d,x=y,P=o,c.onUpdate=function(){ps.setUpgradeAllDisplay(_,w,b,v,S,x,P)}),h.addChild(c))},ps.addUpgradesOrBuildingModes=function(e,t,i,n,s,r,o,a,l,h,u,d){null==d&&(d=!1);var c=e.gui;if(vn.any(i,function(t){return e.progress.unlocks.getUnlockState(t)!=mo.Locked})){var p=null;null!=n&&(p=ir.createHeader(c,n));for(var g=!1,m=!1,f=0;f<i.length;){var y,_,w,b=[i[f]];++f,e.progress.unlocks.getUnlockState(b[0])!=mo.Locked&&((y=vn.any(t.upgrades,function(e){return function(t){return Fr.getClass(t)==e[0]}}(b))||null!=t.buildingMode&&Fr.getClass(t.buildingMode)==b[0])||(_=H.buildingUpgradesInfo,w=b[0].__name__,w=_.h[w],(w=M.fromBuildingUpgradesInfo(w)).knowledge=0,w.any()&&(m=!0)),y||(g=!0),ps.addUpgradeButton(e,t,b[0],function(e,i){return function(t){e[0](i[0],t)}}([s],[b[0]]),r,u,d))}g&&null!=p&&ir.addOneAndMaxButtons(c,p,function(){ir.hasMultiUpgradeModeOn=!1,e.gui.reloadWindow()},function(){ir.hasMultiUpgradeModeOn=!0,null!=h&&h(),e.gui.reloadWindow()},o,a,l,m),c.windowInner.addChild(new Cs(c.windowInner,new Cn(2,4)))}},ps.addUpgradeParts=function(i,n,t,e){null==e&&(e=!1);var s=Fr.getClass(i);ps.addUpgradesOrBuildingModes(n,i,i.get_possibleUpgrades(),t?kn.lo("upgrades"):null,function(t,e){e.upgrades.push(X.createInstance(t,[i.stage,n.cityMidStage,i.bgStage,e]))},!1,kn.lo("upgrade_only_this"),function(){return kn.lo("upgrade_afford",[n.simulation.stats.amountOfBuildingsOfType(s)])},function(){return kn.lo("upgrade_all_explain",[n.simulation.stats.amountOfBuildingsOfType(s)])},null,C.get().buildingUpgradeSound,e)},ps.createMainWindowPart=function(r,o){o.gui.currentUpgradeButtons=new zr,ps.addUpgradeParts(r,o,!0);function a(t,e){null!=e.buildingMode&&e.buildingMode.destroy(),e.buildingMode=X.createInstance(t,[r.stage,o.cityMidStage,r.bgStage,e])}var t=Fr.getClass(r);ps.addUpgradesOrBuildingModes(o,r,r.get_possibleBuildingModes(),kn.lo("building_modes"),a,!1,kn.lo("building_mode_only_this"),function(){return kn.lo("building_mode_afford",[o.simulation.stats.amountOfBuildingsOfType(t)])},function(){return kn.lo("building_mode_all_explain",[o.simulation.stats.amountOfBuildingsOfType(t)])},function(){var t=Fr.getClass(r.buildingMode),e=H.buildingUpgradesInfo,i=t.__name__,i=e.h[i],i=M.fromBuildingUpgradesInfo(i);i.knowledge=0;var n=a,s=t;ps.upgradeAll(o,r,t,i,function(t){n(s,t)})}),gs.create(r.get_possibleCityUpgrades(),o),ms.create(r.get_possiblePolicies(),o)},ps.createBuildingUpgradesForType=function(t,e){e.gui.windowInner.addChild(new Cs(e.gui.windowInner,new Cn(2,4))),ir.hasMultiUpgradeModeOn=!0,ps.addUpgradeParts(t,e,!1,!0),gs.create(t.get_possibleCityUpgrades(),e,!1),ms.create(t.get_possiblePolicies(),e,!1)};var gs=function(){};(V["gui.CreateCityUpgrades"]=gs).__name__="gui.CreateCityUpgrades",gs.create=function(t,l,e){null==e&&(e=!0);for(var h=l.gui,i=[],n=0,s=t;n<s.length;){var r=s[n];++n,l.progress.unlocks.getUnlockState(r)==mo.Unlocked&&i.push(r)}var u,d=i,c=l.upgrades.upgrades;0!=d.length&&(e&&ir.createHeader(h,kn.lo("city_upgrades")),u=new ds(h,h.innerWindowStage,h.windowInner),h.windowInner.addChild(u),u.direction=vs.Vertical,u.fillSecondarySize=!0,function(){u.clear();for(var t=0;t<d.length;){var e=[d[t]];++t;var i=vn.any(c,function(e){return function(t){return Fr.getClass(t)==e[0]}}(e)),n=[e[0].__name__],s=H.cityUpgradesInfo.h[n[0]],r=s.name,o=s.description;if(null!=s.nextUpgrade&&""!=s.nextUpgrade){var a="cityUpgrades."+s.nextUpgrade;if(l.progress.unlocks.getUnlockState(V[a])!=mo.Locked)continue}else i&&(null!=s.nameIfNotDone&&(r=s.nameIfNotDone),null!=s.descriptionIfNotDone&&(o=s.descriptionIfNotDone));s=[M.fromCityUpgradesInfo(s)],n=ir.createActivatableButton(h,i,function(t,e,i){return function(){l.materials.canAfford(t[0])&&(l.materials.remove(t[0]),l.upgrades.addUpgrade(X.createInstance(i[0],[])),p.sendEvent("research",e[0]),l.simulation.houseAssigner.shouldUpdateHouses=!0,l.gui.reloadWindow(),C.get().playSound(C.get().buildingUpgradeSound))}}(s,n,e),r,o,u,null);null!=n.button&&(n.button.buttonSound=null),null!=n.button&&(r=h.currentUpgradeButtons,o=e[0].__name__,e=n.button,r.h[o]=e),i||s[0].any()&&(i=new ds(h,h.innerWindowStage,n.container),s=new Rs(l,s[0],""),l.game.isMobile&&(s.maxDisplayWidth=l.game.rect.width-10),i.addChild(new us(i,h.innerWindowStage,s,{left:0,right:0,top:0,bottom:2},fa(s,s.updateCostDisplay))),n.container.addChild(i))}}(),h.windowInner.addChild(new Cs(h.windowInner,new Cn(2,4))))};var ms=function(){};(V["gui.CreatePolicies"]=ms).__name__="gui.CreatePolicies",ms.create=function(t,r,e){null==e&&(e=!0);for(var o=r.gui,i=[],n=0,s=t;n<s.length;){var a=s[n];++n,r.progress.unlocks.getUnlockState(a)==mo.Unlocked&&i.push(a)}var l,h=i,u=(t=r.policies).policies;0!=h.length&&(e&&ir.createHeader(o,kn.lo("city_policies")),l=new ds(o,o.innerWindowStage,o.windowInner),o.windowInner.addChild(l),l.direction=vs.Vertical,l.fillSecondarySize=!0,function(){l.clear();for(var t=0;t<h.length;){var e=[h[t]];++t;var i=e[0].__name__,n=H.policiesInfo.h[i],s=n.name,i=n.description,n=[M.fromPoliciesInfo(n)];ir.createCheckboxButton(o,function(t){return function(){return vn.any(u,(e=t,function(t){return Fr.getClass(t)==e[0]}));var e}}(e),function(i,n){return function(){var e,t=tt.find(u,(e=n,function(t){return Fr.getClass(t)==e[0]}));null!=t?(r.policies.removePolicy(t),r.simulation.houseAssigner.shouldUpdateHouses=!0):r.materials.canAfford(i[0])&&(r.materials.remove(i[0]),r.policies.addPolicy(X.createInstance(n[0],[])),r.simulation.houseAssigner.shouldUpdateHouses=!0)}}(n,e),s,i,l,null)}}(),o.windowInner.addChild(new Cs(o.windowInner,new Cn(2,4))))};var fs=function(){};(V["gui.CreditsWindow"]=fs).__name__="gui.CreditsWindow",fs.create=function(t,e,i,n){e.windowAddTitleText(kn.lo("credits")),n.addChild(new Qs(n,i,kn.lo("game_by"),null,"Arial15")),n.addChild(new Qs(n,i,kn.lo("music_by"),null,"Arial15")),n.addChild(new Cs(n,new Cn(2,6))),""!=kn.lo("localized_by")&&(n.addChild(new Qs(n,i,kn.lo("localized_by"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))));S.isMobile;n.addChild(new Qs(n,i,kn.lo("credits_software"),null,"Arial15")),n.addChild(new Qs(n,i,kn.lo("credits_software_1"),null,"Arial")),n.addChild(new Qs(n,i,kn.lo("credits_software_2"),null,"Arial")),n.addChild(new Qs(n,i,"FileSaver.js; localForage; canvas-toBlob.js;",null,"Arial")),n.addChild(new Qs(n,i,"polygonal-ds; thx.color; pixi-sound",null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,kn.lo("early_feedback"),null,"Arial")),n.addChild(new Cs(n,new Cn(2,6))),n.addChild(new Qs(n,i,kn.lo("thanks_for_playing"),null,"Arial")),k.get_enableCrossPromo()&&jsFunctions.crossPromoInited()?e.windowAddBottomButtons([{text:"Play More Games!",action:function(){jsFunctions.showCrossPromoDisplay(!1)}}]):e.windowAddBottomButtons()};var ys=function(){};(V["gui.CurrentMissionsWindow"]=ys).__name__="gui.CurrentMissionsWindow",ys.create=function(s,t,e,i){var r=t.windowAddTitleText(kn.lo("current_tasks")),o=!0,e=new Qs(i,e,null,function(){for(var t=s.progress.goalHelp.getCurrentGoalHelp(),e="",i=0;i<t.length;){var n=t[i];++i,""!=e&&(e+="\n\n"),e+="- "+n.category+"\n"+n.text}return 1!=t.length!=o&&(1==t.length?r.setText(kn.lo("current_task")):r.setText(kn.lo("current_tasks")),o=1!=t.length),""==e&&(e="---"),e});i.addChild(e),t.windowAddBottomButtons()};var _s=function(){};function ws(){}(V["gui.FollowingCitizen"]=_s).__name__="gui.FollowingCitizen",_s.createWindow=function(e,i,t){null==t&&(t=!0),t&&e.gui.clearWindowStack(),window.globalFollowingCitizen=i,e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?nr.TopLeft:nr.Top);var n=e,s=i,r=t,o=function(){_s.createWindow(n,s,r)};e.gui.setWindowReload(o);var a=e,l=i,h=t,o=function(){_s.createWindow(a,l,h)};e.gui.addWindowToStack(o);var u=kn.lo("following",[i.nameIndex<H.citizenNames.length?H.citizenNames[i.nameIndex]:Dn.firstToUpper(kn.lo("citizen"))]),d=i.nameIndex<H.citizenNames.length?H.citizenNames[i.nameIndex]:kn.lo("this_citizen");e.gui.windowAddTitleText(u),e.gui.windowInner.addChild(new Qs(e.gui.windowInner,e.gui.innerWindowStage,null,function(){var t=i.educationLevel<.01?kn.lo("education_level_0"):i.educationLevel<.1?kn.lo("education_level_1"):i.educationLevel<.2?kn.lo("education_level_2"):i.educationLevel<.4?kn.lo("education_level_3"):i.educationLevel<.6?kn.lo("education_level_4"):i.educationLevel<.7?kn.lo("education_level_5"):i.educationLevel<.8?kn.lo("education_level_6"):i.educationLevel<1?kn.lo("education_level_7"):i.educationLevel<=1.005?kn.lo("education_level_8"):i.educationLevel<=1.2?kn.lo("education_level_9"):i.educationLevel<1.4?kn.lo("education_level_10"):i.educationLevel<1.6?kn.lo("education_level_11"):i.educationLevel<1.8?kn.lo("education_level_12"):i.educationLevel<2?kn.lo("education_level_13"):i.educationLevel<2.2?kn.lo("education_level_14"):kn.lo("education_level_15");return kn.lo("age_and_education",[Math.floor(i.get_age()),t])}));var c=16<=i.get_age()&&null==i.school,p=[];"cityofthekey"==e.progress.story.storyName&&null!=i.job&&i.job.is(Si)?e.gui.windowAddBottomButtons():p=e.gui.windowAddBottomButtons([{text:c?kn.lo("change_home_job"):kn.lo("change_home_school"),action:function(){_s.createChangeHomeAndWorkOfCitizenWindow(e,i)}}]),e.viewIsControlled=!0;var g=H.makeSprite("spr_selectedhuman");e.furtherForegroundStage.addChild(g),e.gui.windowOnLateUpdate=function(){var t;(window.__temp1=i).hasDied?_s.onCitizenDie(e,i,d,u):(!c&&16<=i.get_age()&&null==i.school&&(0<p.length&&p[0].setText(kn.lo("change_home_job")),c=!0),t=i.getCityPosition(),e.viewPos=new In(t.x,t.y),g.position.set(t.x-1,t.y-6),e.cityView.updateMovingView())},e.gui.windowOnDestroy=function(){e.viewIsControlled=!1,e.cityView.isDraggingView=!1,e.furtherForegroundStage.removeChild(g)};t=i.getCityPosition(),o=new In(t.x,t.y);e.viewPos=o,e.cityView.updateMovingView()},_s.onCitizenDie=function(t,e,i,n){t.gui.clearWindowStack(),t.gui.closeWindow(),t.gui.createWindow(),t.gui.windowAddTitleText(n),t.gui.windowInner.addChild(new Qs(t.gui.windowInner,t.gui.innerWindowStage,kn.lo("citizen_passed_away",[i]))),t.gui.windowAddBottomButtons()},_s.createChangeHomeAndWorkOfCitizenWindow=function(i,n){var s=n.nameIndex<H.citizenNames.length?H.citizenNames[n.nameIndex]:kn.lo("this_citizen"),r=H.makeSprite("spr_selectedhuman");i.furtherForegroundStage.addChild(r),i.activateSpecialCityAction(new Ji(i,n)),i.gui.createWindow(n),i.gui.setWindowPositioning(i.game.isMobile?nr.TopLeft:nr.Top);var t=i,e=n,o=function(){_s.createChangeHomeAndWorkOfCitizenWindow(t,e)};i.gui.setWindowReload(o);var a=i,l=n,o=function(){_s.createChangeHomeAndWorkOfCitizenWindow(a,l)};i.gui.addWindowToStack(o);function h(){return(16<=n.get_age()&&null==n.school?kn.lo("change_home_job"):kn.lo("change_home_school"))+" "+kn.lo("for_citizen",[n.nameIndex<H.citizenNames.length?H.citizenNames[n.nameIndex]:Dn.firstToUpper(kn.lo("citizen"))])}i.gui.windowAddTitleText(null,h),i.gui.windowAddBottomButtons(),i.gui.windowOnLateUpdate=function(){var t,e;n.hasDied?_s.onCitizenDie(i,n,s,h()):(t=n.getCityPosition(),r.position.set(t.x-1,t.y-6),e=H.getTextures("spr_hoverhints_citizen",4),i.setHoverHightlight(function(t){return n.job==t&&n.home==t?e[3]:n.job==t?e[0]:n.home==t?e[1]:n.school==t?e[2]:null},6735360))},i.gui.windowOnDestroy=function(){i.furtherForegroundStage.removeChild(r),null!=i.specialAction&&i.specialAction.deactivate(!0)}},(V["gui.FollowingFish"]=ws).__name__="gui.FollowingFish",ws.createWindow=function(e,i,t){null==t&&(t=!0),t&&e.gui.clearWindowStack(),e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?nr.TopLeft:nr.Top);var n=e,s=i,r=t,o=function(){ws.createWindow(n,s,r)};e.gui.setWindowReload(o);var a=e,l=i,h=t,o=function(){ws.createWindow(a,l,h)};e.gui.addWindowToStack(o);var u=kn.lo("following_fish");e.gui.windowAddTitleText(u),e.gui.windowAddBottomButtons(),e.viewIsControlled=!0;var d=H.makeSprite("spr_selectedfish");d.anchor.set(.5,.5),e.furtherForegroundStage.addChild(d),e.gui.windowOnLateUpdate=function(){var t;i.destroyed?ws.onFishDie(e,i,u):(t=i.getCityPosition(),e.viewPos=new In(t.x,t.y),d.position.set(t.x,t.y),e.cityView.updateMovingView())},e.gui.windowOnDestroy=function(){e.viewIsControlled=!1,e.cityView.isDraggingView=!1,e.furtherForegroundStage.removeChild(d)};t=i.getCityPosition(),o=new In(t.x,t.y);e.viewPos=o,e.cityView.updateMovingView()},ws.onFishDie=function(t,e,i){t.gui.clearWindowStack(),t.gui.closeWindow(),t.gui.createWindow(),t.gui.windowAddTitleText(i),t.gui.windowInner.addChild(new Qs(t.gui.windowInner,t.gui.innerWindowStage,kn.lo("cant_find_fish"))),t.gui.windowAddBottomButtons()};var bs=function(){};(V["gui.FreePlayConfigureWindow"]=bs).__name__="gui.FreePlayConfigureWindow",bs.createWindow=function(e,t,i,n){t.createWindow();var s=e,r=t,o=i,a=n;t.addWindowToStack(function(){bs.createWindow(s,r,o,a)}),t.windowAddTitleText(kn.lo("customize_free_play")),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,2))),t.windowAddInfoText(kn.lo("starting_resources"),null,"Arial15");var l=e.materials.copy(),h=vn.isum(e.progress.story.storyInfo.worlds,function(t){return vn.isum(t.citizens,function(t){return t.amount})}),u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.sandbox.disableUnlimitedResources(),e.materials.remove(e.materials),e.materials.add(l);var t=e.materials;t.set_food(t.food+3*(e.simulation.citizens.length-h))},function(){return!e.progress.sandbox.unlimitedResources&&e.materials.wood<1e3},kn.lo("normal_resources"));t.windowInner.addChild(u),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,2)));u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.sandbox.disableUnlimitedResources(),e.materials.remove(e.materials),e.materials.add(new M(1e3,1e3,1e3,100,500));var t=e.materials;t.set_food(t.food+3*(e.simulation.citizens.length-h))},function(){return!e.progress.sandbox.unlimitedResources&&1e3<=e.materials.wood},kn.lo("extra_resources"));t.windowInner.addChild(u),k.get_allowUnlimitedResources()&&(t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,2))),u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.sandbox.enableUnlimitedResources()},function(){return e.progress.sandbox.unlimitedResources},kn.lo("unlimited_resources")),t.windowInner.addChild(u)),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6))),t.windowAddInfoText(kn.lo("starting_citizens"),null,"Arial15");var d=new ds(t,t.innerWindowStage,t.windowInner);d.direction=vs.Horizontal;u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){bs.setCityCitizens(e,h)},function(){return e.simulation.citizens.length==h},h+"");d.addChild(u),d.addChild(new Cs(d,new Cn(2,2)));u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){bs.setCityCitizens(e,10)},function(){return 10==e.simulation.citizens.length},"10");d.addChild(u),d.addChild(new Cs(d,new Cn(2,2)));u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){bs.setCityCitizens(e,25)},function(){return 25==e.simulation.citizens.length},"25");d.addChild(u),d.addChild(new Cs(d,new Cn(2,2)));u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){bs.setCityCitizens(e,100)},function(){return 100==e.simulation.citizens.length},"100");d.addChild(u),k.get_allowUnlimitedResources()&&(d.addChild(new Cs(d,new Cn(2,2))),u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){bs.setCityCitizens(e,200)},function(){return 200==e.simulation.citizens.length},"200"),d.addChild(u),d.addChild(new Cs(d,new Cn(2,2))),u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){bs.setCityCitizens(e,500)},function(){return 500==e.simulation.citizens.length},"500"),d.addChild(u)),t.windowInner.addChild(d),k.get_allowUnlimitedResources()&&(t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6))),t.windowAddInfoText(kn.lo("buildings_research"),null,"Arial15"),u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.unlocks.unlockMost=!1},function(){return!e.progress.unlocks.unlockMost},kn.lo("standard_unlocks")),t.windowInner.addChild(u),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,2))),u=Kn.create(t,t.innerWindowStage,t.windowInner,function(){e.progress.unlocks.unlockMost=!0},function(){return e.progress.unlocks.unlockMost},kn.lo("most_unlocks")),t.windowInner.addChild(u)),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6))),t.windowAddBottomButtons([{text:kn.lo("back"),action:function(){n()}}],kn.lo("continue"),function(){i()}),t.windowOnDestroy=n},bs.setCityCitizens=function(t,e){if(t.simulation.citizens.length>e)for(;t.simulation.citizens.length>e;)t.simulation.citizens[t.simulation.citizens.length-1].tryRemove(),(n=t.materials).set_food(n.food-3);else for(;t.simulation.citizens.length<e;){for(var i=t.simulation,n=[],s=0,r=t.worlds;s<r.length;){var o=r[s];++s,vn.any(t.simulation.citizens,function(e){return function(t){return t.onWorld==e[0]}}([o]))&&n.push(o)}i.createCitizen(n[0],bo.getFloat(18,40));i=t.materials;i.set_food(i.food+3)}};var vs=x["gui.GUIContainerDirection"]={__ename__:"gui.GUIContainerDirection",__constructs__:["Horizontal","Vertical"],Horizontal:{_hx_index:0,__enum__:"gui.GUIContainerDirection",toString:i},Vertical:{_hx_index:1,__enum__:"gui.GUIContainerDirection",toString:i}},Ss=x["gui.GUIContainerAlignment"]={__ename__:"gui.GUIContainerAlignment",__constructs__:["LeftOrTop","Center","RightOrBottom"],LeftOrTop:{_hx_index:0,__enum__:"gui.GUIContainerAlignment",toString:i},Center:{_hx_index:1,__enum__:"gui.GUIContainerAlignment",toString:i},RightOrBottom:{_hx_index:2,__enum__:"gui.GUIContainerAlignment",toString:i}},xs=function(t,e,i,n,s,r,o,a){this.sizeCallback=null,ds.call(this,t,e,i,n,s,r,o,a)};(V["gui.GUIContainerWithSizeCallback"]=xs).__name__="gui.GUIContainerWithSizeCallback",xs.__super__=ds,xs.prototype=e(ds.prototype,{setSizeCallback:function(t){this.sizeCallback=t},updateSize:function(){ds.prototype.updateSize.call(this),null!=this.sizeCallback&&this.sizeCallback()},__class__:xs});var Ps=function(t,e){null==e&&(e=0),this.parent=t,this.minFill=e,this.rect=new xn(0,0,1,1)};(V["gui.GUIFiller"]=Ps).__name__="gui.GUIFiller",Ps.__interfaces__=[Kt],Ps.prototype={updateSize:function(){this.parent.updateSize()},updatePosition:function(t){var e=this.rect;new Cn(e.x=t.x,e.y=t.y)},destroy:function(){},handleMouse:function(t){return!1},update:function(){},__class__:Ps};var Cs=function(t,e){this.parent=t,this.rect=new xn(0,0,1,1),this.rect.width=e.x,this.rect.height=e.y};(V["gui.GUISpacing"]=Cs).__name__="gui.GUISpacing",Cs.__interfaces__=[Kt],Cs.prototype={updateSize:function(){this.parent.updateSize()},updatePosition:function(t){var e=this.rect;new Cn(e.x=t.x,e.y=t.y)},destroy:function(){},handleMouse:function(t){return!1},update:function(){},__class__:Cs};var Is=function(){};(V["gui.GameMenu"]=Is).__name__="gui.GameMenu",Is.create=function(t,r){var e="spr_button_small",i=2;r.game.isMobile&&(e="spr_button_medium",i=4),t.createWindow("gameMenu"),t.clearWindowStack();var n=t,s=r;t.addWindowToStack(function(){Is.create(n,s)},!0,"GameMenu"),t.windowAddTitleText(kn.lo("game_menu")),Fn.reportStopGameplay();var o=t.innerWindowStage;t.windowAddInfoText(null,function(){return On.storageSupported()?kn.lo("last_saved",[zn.floatFormat(Math,r.secondsSinceAutoSave,1)]):kn.lo("temp_save")});var a=new ds(t,o,null,new Cn(0,0),new In(0,0));a.addChild(new Ks(t,o,a,function(){Vs.createSaveWindow(r.game,t,kn.lo("use_save_slot"),function(t){r.cityFile=t,r.saveToBrowserStorage()})},kn.lo("save_command"))),a.addChild(new Cs(a,new Cn(2,2))),a.addChild(new Ks(t,o,a,function(){Vs.createLoadWindow(r.game,t,kn.lo("which_city_load"),function(t){r.game.loadFromStorage(t)}),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},kn.lo("load_command"))),a.addChild(new Cs(a,new Cn(2,2))),r.game.isMobile&&jsFunctions.isAnyApple()||(a.addChild(new Ks(t,o,a,function(){var t=r.saveToString();jsFunctions.saveAs(new Blob([t],{type:"text/plain;charset=utf-8"}),"theFinalEarth2_save.sav")},kn.lo("export"))),a.addChild(new Cs(a,new Cn(2,2)))),a.addChild(new Ks(t,o,a,function(){},kn.lo("import_command"),null,function(){r.game.setOnClickTo=function(){var t=window.document.getElementById("importFile");t.value="",t.click(),r.game.onClick=null}})),t.windowInner.addChild(a),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6)));var l=new ds(t,o,null,new Cn(0,0),new In(0,0)),h=new Ks(t,o,l,function(){Ds.createNewScenarioWindow(r.game,t),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},kn.lo("new_city"));h.setText(kn.lo("new_city")),l.addChild(h),l.addChild(new Cs(l,new Cn(2,2)));var u,d=r.progress.story.findGoal("Win");null==r.progress.story.currentGoal&&null!=d&&null!=d.nextStory&&""!=d.nextStory&&go.hasCompletedRequirements(r.game,tt.find(H.allStoriesInfo,function(t){return t.link==d.nextStory}))?(S=new Ks(t,o,a,function(){var t=r.game,e=r.gui,i=kn.lo("use_save_slot_2"),n=fa(B=r.game,B.newCity),s=d.nextStory;Vs.createSaveWindow(t,e,i,function(t){n(s,t)}),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},kn.lo("next_scenario"),null),l.addChild(S),S.setText(kn.lo("next_scenario"))):(u=null,u=function(){t.createWindow(),t.addWindowToStack(u),t.windowAddTitleText(kn.lo("restart_scenario_question")),t.windowAddInfoText(kn.lo("sure_restart")),t.windowAddBottomButtons([{text:kn.lo("restart"),action:function(){r.saveToBrowserStorage("preReset"),r.game.newCity(r.progress.story.storyName,r.cityFile),r.saveToBrowserStorage(),Is.canUndoReset=!0}}]),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()},l.addChild(new Ks(t,o,a,u,kn.lo("restart_scenario"),null))),t.windowInner.addChild(l),Is.canUndoReset&&(t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,2))),(a=new ds(t,o,null,new Cn(0,0),new In(0,0))).addChild(new Ks(t,o,l,function(){On.getItem("preReset",function(t,e){Is.canUndoReset=!1,null!=t&&null==e||r.game.loadFromTypedArray(e,r.cityFile)},!0)},kn.lo("undo_restart"),null)),t.windowInner.addChild(a)),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6))),h.extraWidth=t.windowInner.rect.width-vn.isum(l.children,function(t){return t.rect.width})-4,h.setText();l=new ds(t,o,null);t.windowInner.addChild(l);var c=H.getTextures("spr_music",2),p=null;(p=new Fs(t,o,l,function(){r.game.audio.changeMusicEnabledness(!R.musicOn),p.imageSprite.texture=c[R.musicOn?0:1]},c[R.musicOn?0:1],function(){return!1},function(){t.tooltip.setText(p,R.musicOn?kn.lo("mute_music"):kn.lo("unmute_music"))},null,e,i)).imageSprite.tint=0,l.addChild(p),l.addChild(new Cs(l,new Cn(2,2)));var g=H.getTextures("spr_sound",2),m=null;(m=new Fs(t,o,l,function(){r.game.audio.changeSoundEnabledness(!R.soundOn),m.imageSprite.texture=g[R.soundOn?0:1]},g[R.soundOn?0:1],function(){return!1},function(){t.tooltip.setText(m,R.soundOn?kn.lo("mute_sfx"):kn.lo("unmute_sfx"))},null,e,i)).imageSprite.tint=0,l.addChild(m),l.addChild(new Cs(l,new Cn(2,2)));var f,y,_,h=H.getTexture("spr_moresettings"),w=null,w=function(){t.createWindow("moreSettingsWindow"),t.addWindowToStack(w),Ls.create(r,t,t.innerWindowStage,t.windowInner,e,i,!0)},b=new Fs(t,o,l,w,h,function(){return!1},function(){t.tooltip.setText(b,kn.lo("advanced_settings"))},null,e,i);b.imageSprite.tint=0,l.addChild(b),l.addChild(new Cs(l,new Cn(6,2))),k.hasFullscreen&&!r.game.isMobile&&(h=H.getTexture("spr_fullscreen"),(f=new Fs(t,o,l,function(){},h,function(){return!1},function(){t.tooltip.setText(f,kn.lo("full_screen")),r.game.setOnClickTo=function(){jsFunctions.goFullscreen(!0)}},null,e,i)).imageSprite.tint=0,l.addChild(f),l.addChild(new Cs(l,new Cn(2,2)))),r.game.isMobile&&jsFunctions.isAnyApple()||(x=H.getTexture("spr_camera"),y=r,(_=new Fs(t,o,l,v=function(){Is.saveScreenShot(y)},x,function(){return!1},function(){t.tooltip.setText(_,kn.lo("save_screenshot"))},null,e,i)).imageSprite.tint=0,l.addChild(_),l.addChild(new Cs(l,new Cn(6,2))));var v,S,x=H.getTexture("spr_credits"),P=null,P=function(){t.createWindow("creditsWindow"),t.addWindowToStack(P),fs.create(r,t,t.innerWindowStage,t.windowInner)};(v=new Fs(t,o,l,P,x,function(){return!1},function(){t.tooltip.setText(v,kn.lo("view_credits"))},null,e,i)).imageSprite.tint=0,l.addChild(v),l.addChild(new Cs(l,new Cn(2,2))),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6))),k.isLimitedDemo?((S=new Ks(t,o,t.windowInner,function(){greenworks.activateGameOverlayToWebPage("https://store.steampowered.com/app/1180130/The_Final_Earth_2/")},kn.lo("wishlist_full"))).fillWidth(),S.setText(kn.lo("wishlist_full")),t.windowInner.addChild(S),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6)))):r.game.isMobile,t.windowAddBottomButtons([{text:kn.lo("back_to_title"),action:function(){r.game.createMainMenu()}}])},Is.saveScreenShot=function(t){var e=t.getCityEdges(),i=e.minX,n=e.maxX,s=e.minY,r=e.maxY,o=PIXI.RenderTexture.create(n-i,r-s,null,1),a=t.game.application.renderer,l=t.movingViewStage.position.x,h=t.movingViewStage.position.y,u=t.movingViewStage.scale.x;t.movingViewStage.position.x=-i,t.movingViewStage.position.y=-s,t.movingViewStage.scale.x=1,t.movingViewStage.scale.y=1;e=new PIXI.Graphics;e.beginFill(t.skyColor),e.drawRect(i,s,n-i,r-s),e.endFill(),t.movingViewStage.addChildAt(e,0),t.uncull(),a.render(t.movingViewStage,o,!0,null,!1),a.plugins.extract.canvas(o).toBlob(function(t){jsFunctions.saveAs(t,"TheFinalEarth2_screenshot.png")}),t.movingViewStage.position.x=l,t.movingViewStage.position.y=h,t.movingViewStage.scale.x=t.movingViewStage.scale.y=u,t.movingViewStage.removeChild(e)};var Ts=function(){};(V["gui.GlobalUpgradeWindow"]=Ts).__name__="gui.GlobalUpgradeWindow",Ts.create=function(t,e,i,n){Ts.createWindow(t,e,i,n)},Ts.createWindow=function(e,t,i,n){t.windowAllowBanner(),n.clear(),e.gui.windowAddTitleText(kn.lo("upgrades_and_policies"));for(var s=[],r=[],o=0,a=e.permanents;o<a.length;){var l=a[o];++o,l.isBuilding&&(vn.any(l.get_possibleUpgrades(),function(t){return e.progress.unlocks.getUnlockState(t)!=mo.Locked})||vn.any(l.get_possibleCityUpgrades(),function(t){return e.progress.unlocks.getUnlockState(t)!=mo.Locked})||vn.any(l.get_possiblePolicies(),function(t){return e.progress.unlocks.getUnlockState(t)!=mo.Locked}))&&(l=Fr.getClass(l),-1==(d=s.indexOf(l))&&(d=s.length,s.push(l),l=l.__name__.split("."),r.push(l[l.length-1])))}for(var h=[],o=0,a=e.progress.resources.buildingInfoArray;o<a.length;){var u=a[o];++o,-1!=(d=r.indexOf(u.className))&&h.push(s[d])}for(o=0,a=h.length;o<a;){var d,c=[h[d=o++]],p=new ds(t,t.innerWindowStage,t.windowInner),g=e.progress.resources.buildingInfo,m=c[0].__name__,m=g.h[m];p.addChild(is.create(i,e,c[0],p,t)),p.addChild(new Qs(p,t.innerWindowStage,m.name,null,"Arial16",{top:3,left:3,right:0,bottom:0})),t.windowInner.addChildWithoutSizeUpdate(p),ps.createBuildingUpgradesForType(tt.find(e.permanents,function(e){return function(t){return t.is(e[0])}}(c)),e),c[0]==qe&&Ts.addSmartUpgradeForLabs(e)}t.windowInner.updateSize(),0==h.length&&e.gui.windowInner.addChild(new Qs(e.gui.windowInner,e.gui.innerWindowStage,kn.lo("no_upgrades"))),t.windowAddBottomButtons();var f=e,y=t,_=i,w=n,b=function(){Ts.createWindow(f,y,_,w)};e.gui.setWindowReload(b);function v(){Ts.createWindow(S,x,P,C)}var o=fa(B=e.gui,B.reloadWindow),S=e,x=t,P=i,C=n,b=function(){o(v)};e.windowRelatedOnBuildOrDestroy=b,n.onDestroy=function(){e.windowRelatedOnBuildOrDestroy=null}},Ts.addSmartUpgradeForLabs=function(i){for(var n=new M,s=pt,r=Ht,t=[],e=0,o=i.permanents;e<o.length;){var a=o[e];++e,a.is(qe)&&0<a.getEffectsOfAdjecentBuildings("farm")&&!vn.any(a.upgrades,function(t){return Fr.__instanceof(t,s)})&&t.push(a)}for(var l=t,t=[],e=0,o=i.permanents;e<o.length;){a=o[e];++e,a.is(qe)&&(null!=a.leftBuilding&&a.leftBuilding.is(Ri)||null!=a.rightBuilding&&a.rightBuilding.is(Ri)||null!=a.topBuilding&&a.topBuilding.is(Ri)||null!=a.bottomBuilding&&a.bottomBuilding.is(Ri))&&!vn.any(a.upgrades,function(t){return Fr.__instanceof(t,r)})&&t.push(a)}var h=t,u=0<l.length||0<h.length,d=ir.createActivatableButton(i.gui,!u,function(){if(i.materials.canAfford(n)){i.materials.remove(n);for(var t=0;t<l.length;){var e=l[t];++t,e.upgrades.push(X.createInstance(s,[e.stage,i.cityMidStage,e.bgStage,e]))}for(t=0;t<h.length;){e=h[t];++t,e.upgrades.push(X.createInstance(r,[e.stage,i.cityMidStage,e.bgStage,e]))}C.get().playSound(C.get().buildingUpgradeSound),i.gui.reloadWindow()}},kn.lo("auto_upgrade"),kn.lo("upgrade_all_labs"),i.gui.windowInner,null);null!=d.button&&(d.button.buttonSound=null);var c=H.buildingUpgradesInfo,p=s.__name__,g=M.fromBuildingUpgradesInfo(c.h[p]);(n=g.copy()).multiply(l.length);c=H.buildingUpgradesInfo,p=r.__name__,c=M.fromBuildingUpgradesInfo(c.h[p]),p=c.copy();p.multiply(h.length),i.progress.unlocks.getUnlockState(s)==mo.Researched?n.knowledge=0:n.knowledge=Math.min(n.knowledge,g.knowledge),i.progress.unlocks.getUnlockState(r)==mo.Researched?p.knowledge=0:p.knowledge=Math.min(p.knowledge,c.knowledge),n.add(p),u&&n.any()&&(p=new ds(i.gui,i.gui.innerWindowStage,d.container),u=new Rs(i,n,""),i.game.isMobile&&(u.maxDisplayWidth=i.game.rect.width-10),p.addChild(new us(p,i.gui.innerWindowStage,u,{left:0,right:0,top:0,bottom:2},fa(u,u.updateCostDisplay))),d.container.addChild(p)),i.gui.windowInner.addChild(new Cs(i.gui.windowInner,new Cn(2,4)))};var Bs=function(){};(V["gui.HappinessWindow"]=Bs).__name__="gui.HappinessWindow",Bs.create=function(t,o,a,e){o.windowAllowBanner(),o.windowAddTitleText(kn.lo("happiness"),null,H.getTexture("spr_happiness"));var i=new ds(o,a,e);e.addChild(i);var l=new ds(o,a,i);l.direction=vs.Vertical,i.addChild(l);var h=new ds(o,a,i);h.direction=vs.Vertical,i.addChild(h);function n(t,e,i,n,s){null==s&&(s=0),null==n&&(n=0);var r=new zs(l,i);(n=new ds(o,a,r,null,null,null,null,{left:n,right:0,bottom:0,top:s})).addChild(new Qs(n,a,null,t,null,null,null,!0)),n.addChild(new Cs(n,new Cn(5,12))),r.setChild(n),l.addChild(r),i=new zs(h,i),(s=new ds(o,a,i,null,null,null,null,{left:0,right:0,bottom:0,top:s})).addChild(new Qs(s,a,null,e,null,null,null,!0)),s.addChild(new Cs(s,new Cn(0,12))),i.setChild(s),h.addChild(i)}var s=t.simulation.happiness;n(function(){return kn.lo("home_happiness")},function(){return""+(0|s.homeHappiness)}),n(function(){return kn.lo("sense_of_purpose")},function(){return""+(0|s.purposeHappiness)}),n(function(){return kn.lo("entertainment_happiness")},function(){return""+(0|s.entertainmentHappiness)});for(var r=t.simulation.happiness,u=0,d=r.entertainmentTypes.length;u<d;){var c=[u++];n(function(t){return function(){return zo.getName(t[0])+":"}}([r.entertainmentTypes[c[0]]]),function(t){return function(){return""+(0|r.happinessPerEntertainmentType[t[0]])}}(c),null,10)}"cityofthekey"==t.progress.story.storyName&&(n(function(){return kn.lo("glory_of_the_key")+":"},function(){return""+(0|r.gloryOfTheKey.gloryOfTheKeyHappiness)}),n(function(){return kn.lo("sculptures")+":"},function(){return""+(0|r.gloryOfTheKey.sculpturesHappiness)},null,10),n(function(){return kn.lo("luxury_housing")+":"},function(){return""+(0|r.gloryOfTheKey.highEndHomeHappiness)},null,10),n(function(){return kn.lo("high_end_restaurants")+":"},function(){return""+(0|r.gloryOfTheKey.expensiveRestaurantHappiness)},null,10)),n(function(){return kn.lo("education_happiness")},function(){return""+(0|r.schoolHappiness)}),n(function(){return kn.lo("medical_happiness")},function(){return""+(0|r.medicalHappiness)}),n(function(){return kn.lo("food_shortage_unhappiness")},function(){return"-"+(0|r.foodShortageUnhappiness)},function(){return 0<r.foodShortageUnhappiness}),n(function(){return kn.lo("food_rationing_unhappiness")},function(){return"-"+(0|r.foodRationingUnhappiness)},function(){return 0<r.foodRationingUnhappiness}),n(function(){return kn.lo("mandatory_overtime_unhappiness")},function(){return"-"+(0|r.overtimeUnhappinessShown)},function(){return 0<r.overtimeUnhappinessShown}),n(function(){return kn.lo("new_city_enthousiasm")},function(){return"+"+(0|r.enthusiasmHappiness)},function(){return 0!=r.enthusiasmHappiness}),n(function(){for(var t="",e=0,i=r.happinessBoosts;e<i.length;){var n=i[e];++e,""!=t&&(t+="\n"),t+=n.text+":"}return t},function(){for(var t="",e=0,i=r.happinessBoosts;e<i.length;){var n=i[e];++e,""!=t&&(t+="\n"),t+="+"+(0|n.boost)}return t},function(){return 0<r.happinessBoosts.length},0,4),n(function(){return kn.lo("total_happiness")},function(){return""+(0|r.happiness)},null,0,4),n(function(){return kn.lo("work_speed_modifier")},function(){return""+zn.floatFormat(Math,r.actionSpeedModifier,2)}),o.windowAddBottomButtons()};var ks=x["gui.HelpArrowDirection"]={__ename__:"gui.HelpArrowDirection",__constructs__:["Down","Left","DownHint"],Down:{_hx_index:0,__enum__:"gui.HelpArrowDirection",toString:i},Left:{_hx_index:1,__enum__:"gui.HelpArrowDirection",toString:i},DownHint:{_hx_index:2,__enum__:"gui.HelpArrowDirection",toString:i}},Ms=function(t,e,i,n,s,r){switch(null==r&&(r=0),this.pleaseAlignExtraTextRight=!1,this.circleTme=Math.PI/2,this.arrowTime=0,this.gui=t,this.getPointsTo=i,this.stage=e,this.isActive=n,this.direction=null==s?ks.Down:s,this.onlyVisibleAfter=r,this.direction._hx_index){case 0:this.sprite=new PIXI.Sprite(H.getTexture("spr_tutorialarrowdown")),this.sprite.anchor.set(.5,1);break;case 1:this.sprite=new PIXI.Sprite(H.getTexture("spr_tutorialarrowleft")),this.sprite.anchor.set(0,.5);break;case 2:this.sprite=new PIXI.Sprite(H.getTexture("spr_hintinfo_arrow")),this.sprite.anchor.set(.5,1)}e.addChild(this.sprite),this.extraText9P=null,this.extraText="",this.extraTextElement=null,this.setPosition()};(V["gui.HelpArrow"]=Ms).__name__="gui.HelpArrow",Ms.prototype={useBigMovement:function(){this.useCircle=!0,this.setPosition()},addText:function(t){if(null!=this.extraTextElement)return this.extraText=t,this.extraTextElement.set_text(t),void this.setExtraTextPosition();this.extraText=t,this.extraTextElement=new Hn(t,{font:"Arial",tint:0}),t.length<45?this.extraTextElement.set_maxWidth(133):this.extraTextElement.set_maxWidth(200),this.extraText9P=new Hs(H.getTexture("spr_9p_hintinfo"),5,6+(0|this.extraTextElement.width),6+(0|this.extraTextElement.height)),this.stage.addChild(this.extraText9P),this.stage.addChild(this.extraTextElement),this.setExtraTextPosition()},update:function(t){var e=!!(this.isActive()&&this.arrowTime>=this.onlyVisibleAfter)&&null!=this.getPointsTo();e&&this.useCircle&&0<this.circleTme&&(this.circleTme-=.015*t+.04*t*(this.circleTme/(Math.PI/2))),this.arrowTime+=t,this.setPosition(),this.setExtraTextPosition()},destroy:function(){this.stage.removeChild(this.sprite),null!=this.extraText9P&&this.extraText9P.destroy(),null!=this.extraTextElement&&this.extraTextElement.destroy()},setPosition:function(){var t,e=!!(this.isActive()&&this.arrowTime>=this.onlyVisibleAfter)&&null!=(t=this.getPointsTo());if(e){switch(this.direction._hx_index){case 0:this.sprite.position.set(t.rect.get_center().x,t.rect.y-2-2*Math.sin(this.arrowTime/10));break;case 1:this.sprite.position.set(t.rect.get_x2()+2+2*Math.sin(this.arrowTime/10),t.rect.get_center().y);break;case 2:this.pleaseAlignExtraTextRight?this.sprite.position.set(this.gui.game.rect.width-5-this.sprite.width,t.rect.y-2):this.sprite.position.set(t.rect.get_center().x,t.rect.y-2)}this.useCircle&&0<this.circleTme?(this.sprite.position.x<this.gui.game.rect.width/2?this.sprite.rotation=this.circleTme:this.sprite.rotation=-this.circleTme,this.sprite.position.set(Math.cos(this.circleTme)*(this.sprite.position.x-this.gui.game.rect.width/2)+this.gui.game.rect.width/2,Math.sin(this.circleTme)*(this.gui.game.rect.height/2-this.sprite.position.y)+this.sprite.position.y),this.sprite.alpha=Math.cos(this.circleTme)):(this.sprite.rotation=0,this.sprite.alpha=1),this.sprite.visible=!0}else this.sprite.visible=!1},setExtraTextPosition:function(){if(null!=this.extraText9P){var t,e=!!(this.isActive()&&this.arrowTime>=this.onlyVisibleAfter)&&null!=(t=this.getPointsTo());if(e){switch(this.direction._hx_index){case 0:t.rect.get_center().x>this.extraText9P.width+5+Math.floor(this.sprite.width/2)?this.extraText9P.position.set(t.rect.get_center().x-Math.floor(this.sprite.width/2)-2-this.extraText9P.width,t.rect.y-2-this.extraText9P.height):this.extraText9P.position.set(t.rect.get_center().x+Math.floor(this.sprite.width/2)+2,t.rect.y-2-this.extraText9P.height);break;case 1:t.rect.get_x2()+this.extraText9P.width>this.gui.game.rect.width?this.extraText9P.position.set(this.gui.game.rect.width-this.extraText9P.width-5,t.rect.get_center().y-2-Math.floor(this.sprite.height/2)-this.extraText9P.height):this.extraText9P.position.set(t.rect.get_x2(),t.rect.get_center().y-2-Math.floor(this.sprite.height/2)-this.extraText9P.height);break;case 2:this.pleaseAlignExtraTextRight?this.extraText9P.position.set(this.gui.game.rect.width-5-this.extraText9P.width,t.rect.y-2-this.sprite.height-this.extraText9P.height):t.rect.get_center().x>this.extraText9P.width+5+Math.floor(this.sprite.width/2)?this.extraText9P.position.set(t.rect.get_center().x-this.extraText9P.width+Math.floor(this.sprite.width/2),t.rect.y-2-this.sprite.height-this.extraText9P.height):t.rect.get_center().x-this.sprite.width+this.extraText9P.width<this.gui.game.rect.width?this.extraText9P.position.set(t.rect.get_center().x-Math.floor(this.sprite.width/2),t.rect.y-2-this.sprite.height-this.extraText9P.height):this.extraText9P.position.set(5,t.rect.y-2-this.sprite.height-this.extraText9P.height)}this.extraTextElement.position.set(this.extraText9P.position.x+3,this.extraText9P.position.y+2),this.extraTextElement.visible=!0,this.extraText9P.visible=!0}else this.extraText9P.visible=!1,this.extraTextElement.visible=!1}},__class__:Ms};var zs=function(t,e){this.alwaysUpdateChild=!1,this.visible=!0,this.parent=t,this.isShown=e,this.rect=new xn(0,0,0,0)};(V["gui.HideableContainer"]=zs).__name__="gui.HideableContainer",zs.__interfaces__=[Kt],zs.prototype={show:function(){this.visible=!0,this.updateSize()},hide:function(){this.visible=!1,this.child.updatePosition(new Cn(-1e4,-1e4)),this.updateSize()},setChild:function(t){this.child=t,this.updateSize(),null!=this.isShown&&(this.visible=this.isShown(),this.visible||this.hide())},updateSize:function(){this.visible&&null!=this.child?this.rect=this.child.rect:(this.rect.width=0,this.rect.height=0),null!=this.parent&&this.parent.updateSize()},updatePosition:function(t){this.visible&&null!=this.child&&this.child.updatePosition(t)},destroy:function(){null!=this.child&&this.child.destroy()},handleMouse:function(t){return!(!this.visible||null==this.child)&&this.child.handleMouse(t)},update:function(){var t;null==this.isShown||(t=this.isShown())!=this.visible&&(this.visible=t,this.visible?this.show():this.hide()),(this.visible||this.alwaysUpdateChild)&&null!=this.child&&this.child.update()},__class__:zs};var As=function(){};function Ws(t){PIXI.Container.call(this),this.setDisplay(t)}(V["gui.HouseInformationWindow"]=As).__name__="gui.HouseInformationWindow",As.create=function(t,e,i,n){As.createWindow(t,e,i,n)},As.createWindow=function(s,n,t,e){n.windowAllowBanner(),e.clear(),n.windowAddTitleText(kn.lo("housing_information"),null,H.getTexture("spr_housing")),e.addChild(new Qs(e,t,null,function(){return As.getHousingHelpText(s.simulation.stats)}));for(var i=[],r=[],o=0,a=s.permanents;o<a.length;){var l=a[o];++o,l.is(Yt)&&(l=Fr.getClass(l),-1==(f=i.indexOf(l))&&(f=i.length,i.push(l),l=l.__name__.split("."),r.push(l[l.length-1])))}for(var h=[],o=0,a=s.progress.resources.buildingInfoArray;o<a.length;){var u=a[o];++o,-1!=(f=r.indexOf(u.className))&&h.push(i[f])}var d=[],c=function(){d=[];for(var t=0;t<h.length;){h[t];++t,d.push({number:0,filledHousing:0,housing:0})}for(var t=0,e=s.permanents;t<e.length;){var i,n=e[t];++t,n.is(Yt)&&(i=n,n=Fr.getClass(n),-1!=(n=h.indexOf(n))&&((n=d[n]).housing+=i.get_residentCapacity(),n.filledHousing+=i.residents.length,n.number+=1))}};c(),e.onUpdate=c;var p={left:2,top:5,bottom:0,right:0},c=new ds(n,t,e),g=new ds(n,t,c),m=new ds(n,t,c);g.direction=vs.Vertical,m.direction=vs.Vertical;for(o=0,a=h.length;o<a;){var f=[o++],y=h[f[0]],_=(y.__name__,d[f[0]]),w=new ds(n,t,g),b=new PIXI.Container,v=D.field(y,"spriteName"),S=s.progress.resources.buildingInfo,y=y.__name__,y=[S.h[y]];b.addChild(H.makeSprite(null==y[0].buttonBack?v+"@44,0,20,20":y[0].buttonBack)),b.addChild(H.makeSprite(v+"@0,0,20,20"));v=[null];v[0]=new us(w,t,b,null,null,function(e,i){return function(t){return!!e[0].rect.contains(t.position)&&(n.tooltip.setText(e[0],i[0].name),!0)}}(v,y)),w.addChild(v[0]);v=new ds(n,t,w,null,null,null,null,p);v.addChild(new Qs(v,t,"x"+_.number+": ")),w.addChild(v),g.addChild(w);w=new ds(n,t,m,null,null,null,null,p);w.minHeight=15,w.addChild(new Qs(w,t,null,function(t){return function(){return kn.lo("residents",[d[t[0]].filledHousing,d[t[0]].housing])}}(f))),m.addChild(w)}0==h.length&&n.windowAddInfoText(kn.lo("there_are_no_houses")),c.addChild(g),c.addChild(m),e.addChild(c);function x(){As.createWindow(P,C,I,T)}var o=fa(B=s.gui,B.reloadWindow),P=s,C=n,I=t,T=e;s.windowRelatedOnBuildOrDestroy=function(){o(x)},e.onDestroy=function(){s.windowRelatedOnBuildOrDestroy=null},n.windowAddBottomButtons()},As.getHousingHelpText=function(t){if(t.peopleWithHome>=t.people)return t.houseCapacity==t.peopleWithHome?kn.lo("houses_exactly_enough"):kn.lo("house_n_cap_remaining",[t.houseCapacity-t.peopleWithHome]);t=t.people-t.peopleWithHome;return 1==t?kn.lo("homeless_one"):kn.lo("homeless_n",[t])},(V["gui.IconListDisplay"]=Ws).__name__="gui.IconListDisplay",Ws.__super__=PIXI.Container,Ws.prototype=e(PIXI.Container.prototype,{wouldChangeDisplay:function(t){if(this.displayedIcons.length!=t.length)return!0;for(var e=0,i=this.displayedIcons.length;e<i;){var n=e++;if(t[n].texture!=this.displayedIcons[n].texture||t[n].text!=this.displayedIcons[n].text)return!0}return!1},setDisplay:function(t){this.displayedIcons=t;for(var e=this.children.length;0<=--e;)this.children.splice(e,1);for(var i=0,n=0;n<t.length;){var s=t[n];++n;var r=new PIXI.Sprite(s.texture);r.position.x=i,this.addChild(r),i+=2+(0|r.width);var o=s.text,r=0;"[red]"==Y.substr(s.text,0,"[red]".length)&&(o=Y.substr(o,"[red]".length,null),r=16711680);r=new Hn(o,{font:"Arial",tint:r});"1"==o&&--i,r.position.set(i,-1),"1"==o&&--i,this.addChild(r),i+=3+(0|r.get_textWidth())}this.displayWidth=i},__class__:Ws});var Fs=function(t,e,i,n,s,r,o,a,l,h){null==h&&(h=1),null==l&&(l="spr_buildingbutton"),this.needsAttention=!1,this.attentionGetterSprite=null,this.imageSpriteOffset=1,this.removeNotificationOnHover=!0,this.shown=!0,ns.call(this,t,e,i,n,r,o),this.buttonTextures=H.getTextures(l,3),this.buttonSprite=new PIXI.Sprite(this.buttonTextures[0]),e.addChild(this.buttonSprite),null!=a&&(this.imageSpriteBack=new PIXI.Sprite(a),this.imageSpriteBack.position.set(1,1),e.addChild(this.imageSpriteBack)),this.imageSpriteOffset=h,this.imageSprite=new PIXI.Sprite(s),this.imageSprite.position.set(h,h),e.addChild(this.imageSprite),this.rect=new xn(0,0,(0|s.width)+2*h,(0|s.height)+2*h)};(V["gui.ImageButton"]=Fs).__name__="gui.ImageButton",Fs.__super__=ns,Fs.prototype=e(ns.prototype,{updateTexture:function(t){this.imageSprite.texture=t},updatePosition:function(t){ns.prototype.updatePosition.call(this,t),this.buttonSprite.position.set(t.x,t.y),this.imageSprite.position.set(t.x+this.imageSpriteOffset,t.y+this.imageSpriteOffset),null!=this.imageSpriteBack&&this.imageSpriteBack.position.set(t.x+1,t.y+1),null!=this.imageSpriteForeground&&this.imageSpriteForeground.position.set(t.x,t.y),null!=this.attentionGetterSprite&&this.attentionGetterSprite.position.set(t.x,t.y)},handleMouse:function(t){var e=this;return!!this.shown&&ns.prototype.doHandleMouse.call(this,t,function(){e.buttonSprite.texture=e.buttonTextures[1],e.removeNotificationOnHover&&e.stopNotify()},function(){e.buttonSprite.texture=e.buttonTextures[2],e.stopNotify()})},update:function(){this.mouseOut&&(this.buttonSprite.texture=this.buttonTextures[0]),this.isActive()&&(this.buttonSprite.texture=this.buttonTextures[2]),this.updateNeedsAttention(),ns.prototype.update.call(this)},mirror:function(){var t=this.imageSprite;null!=t&&(t.anchor.set(1,0),t.scale.set(-1,1)),null!=(t=this.imageSpriteBack)&&(t.anchor.set(1,0),t.scale.set(-1,1)),null!=(t=this.imageSpriteForeground)&&(t.anchor.set(1,0),t.scale.set(-1,1))},setNeedsAttention:function(t){null==t&&(t=!1),this.needsAttention=t,this.updateNeedsAttention()},updateNeedsAttention:function(){var t;null!=this.buttonSprite&&(this.needsAttention&&this.buttonSprite.texture==this.buttonTextures[0]?(null==this.attentionGetterSprite&&(this.attentionGetterSprite=new PIXI.Sprite(H.getTexture("spr_whiteoutline")),this.attentionGetterSprite.position.set(this.buttonSprite.position.x,this.buttonSprite.position.y),null!=this.buttonSprite.parent&&this.buttonSprite.parent.addChild(this.attentionGetterSprite)),t=ra.toRgb([89,1,.77]),this.attentionGetterSprite.tint=Sn.toHexInt(t),this.attentionGetterSprite.alpha=(Math.sin(this.gui.guiTimer/10)+1)/2):null!=this.attentionGetterSprite&&(this.needsAttention?this.attentionGetterSprite.alpha=0:(this.attentionGetterSprite.destroy(),this.attentionGetterSprite=null)))},destroy:function(){ns.prototype.destroy.call(this),this.stage.removeChild(this.buttonSprite),this.stage.removeChild(this.imageSprite),null!=this.imageSpriteBack&&this.stage.removeChild(this.imageSpriteBack),null!=this.imageSpriteForeground&&this.stage.removeChild(this.imageSpriteForeground),null!=this.attentionGetterSprite&&this.attentionGetterSprite.destroy()},hide:function(){null!=this.imageSpriteBack&&(this.imageSpriteBack.visible=!1),this.imageSprite.visible=!1,this.buttonSprite.visible=!1,null!=this.imageSpriteForeground&&(this.imageSpriteForeground.visible=!1),null!=this.attentionGetterSprite&&(this.attentionGetterSprite.visible=!1),this.shown=!1},show:function(){null!=this.imageSpriteBack&&(this.imageSpriteBack.visible=!0),this.imageSprite.visible=!0,this.buttonSprite.visible=!0,null!=this.imageSpriteForeground&&(this.imageSpriteForeground.visible=!0),null!=this.attentionGetterSprite&&(this.attentionGetterSprite.visible=!0),this.shown=!0},notify:function(t,e){var i;this.removeNotificationOnHover=t,null==this.imageSpriteForeground&&(this.imageSpriteForeground=new PIXI.Sprite(H.getTexture("spr_buttonnotification")),t=(i=this.rect).x,i=i.y,i=new PIXI.Point(t,i),this.imageSpriteForeground.position=i,this.stage.addChild(this.imageSpriteForeground),this.doOnStopNotify=e)},stopNotify:function(){null!=this.imageSpriteForeground&&(this.stage.removeChild(this.imageSpriteForeground),this.imageSpriteForeground=null,this.doOnStopNotify())},__class__:Fs});var Os=function(t,e,i,n,s,r,o,a,l){null==a&&(a="spr_9p_info"),null==r&&(r=0),this.showingInfinitySign=!1,this.additionalSprite=null,this.shouldShowInfinitySign=null==l?function(){return!1}:l;var h="none"==a?null:new Hs(H.getTexture(a),2,10,14),a=t.game.isMobile?3:0;ds.call(this,t,e,i,null,null,null,h,{left:2+a,right:2+a,top:2+a,bottom:a-1}),this.fillSecondarySize=!0,this.fillPrimarySize=!0,this.onHover=o,this.minWidth=r,this.onTextUpdate=n,this.shouldShowInfinitySign=l,this.spriteContainer=new PIXI.Sprite(s),null!=s&&this.addChild(new us(this,e,this.spriteContainer)),this.createSecondElement()};(V["gui.InfoBox"]=Os).__name__="gui.InfoBox",Os.__super__=ds,Os.prototype=e(ds.prototype,{update:function(){this.shouldShowInfinitySign()!=this.showingInfinitySign&&(this.secondElement.destroy(),this.removeChild(this.secondElement,!1),this.createSecondElement()),ds.prototype.update.call(this)},createSecondElement:function(){var t;this.showingInfinitySign=this.shouldShowInfinitySign(),this.showingInfinitySign?this.secondElement=this.addChild(new us(this,this.stage,new PIXI.Sprite(H.getTexture("spr_icon_unlimited")))):(t=this.gui.game.isMobile?2:0,this.secondElement=new Qs(this,this.stage,null,this.onTextUpdate,null,{left:1+t,right:1,top:1,bottom:0},null,!1,!0),this.addChild(this.secondElement))},setAdditionalSprite:function(t){if(null==t)return null!=this.additionalSprite&&this.additionalSprite.destroy(),void(this.additionalSprite=null);null==this.additionalSprite&&(this.additionalSprite=new PIXI.Sprite),this.additionalSprite.texture=t,this.spriteContainer.addChild(this.additionalSprite)},hasAdditionalSprite:function(){return null!=this.additionalSprite},handleMouse:function(t){return!!this.rect.contains(t.position)&&(null!=this.onHover&&this.onHover(),t.claimMouse(this),!0)},updateSize:function(){ds.prototype.updateSize.call(this),this.minWidth=this.baseWidth},__class__:Os}),fe=function(){},(V["gui.LanguageSelectWindow"]=fe).__name__="gui.LanguageSelectWindow",fe.create=function(e,i,t,n){e.game;i.windowAddTitleText(kn.lo("language"));for(var s=[{code:"en",name:"English"},{code:"vi",name:"Ting Vit (WIP)"}],r=0;r<s.length;){var o=s[r];++r;o=[o];ir.createActivatableButton(i,R.language==o[0].code,function(t){return function(){R.language=t[0].code,R.save(),kn.loadLanguage(t[0].code,!1,function(){kn.translateFiles(e.progress.resources.buildingInfoArray),kn.translateStory(e.progress.story.storyName,e.progress.story.storyInfo),i.onLanguageChange()},function(){})}}(o),o[0].name,"",i.windowInner)}n.addChild(new Cs(n,new Cn(2,4))),n.addChild(new Cs(n,new Cn(2,6))),i.windowAddBottomButtons()};var Ds=function(t,e){f.call(this,t,e)};(V["gui.MainMenuGUI"]=Ds).__name__="gui.MainMenuGUI",Ds.createNewScenarioWindow=function(n,s,r){s.createWindow();var t=n,e=s,i=r;s.addWindowToStack(function(){Ds.createNewScenarioWindow(t,e,i)}),s.windowAddTitleText(kn.lo("start_scenario"));for(var o,a=H.allStoriesInfo,l=0;l<a.length;){var h=a[l];++l,!h.freePlay&&go.hasCompletedRequirements(n,h)&&Ds.addStoryToWindow(n,s,h)}go.shouldShowUnlockAllStoriesButton(n)&&((o=new ls(s,s.innerWindowStage,s.windowInner,function(){n.metaGame.unlockAll();var t=n,e=s,i=r;s.reloadWindow(function(){Ds.createNewScenarioWindow(t,e,i)})})).container.padding.top=3,o.container.padding.left=3,o.container.padding.right=3,o.container.padding.bottom=1,o.container.fillSecondarySize=!0,o.container.addChild(new Qs(o.container,s.innerWindowStage,kn.lo("unlock_all"))),s.windowInner.addChild(o)),s.windowInner.addChild(new Cs(s.windowInner,new Cn(4,6))),s.windowAddInfoText(kn.lo("free_play")+":",null,"Arial");for(l=0;l<a.length;){h=a[l];++l,h.freePlay&&go.hasCompletedRequirements(n,h)&&Ds.addStoryToWindow(n,s,h)}s.windowAddBottomButtons(),s.windowOnDestroy=r},Ds.createPlayedBeforeWindow=function(e,t,i){t.createWindow();var n=e,s=t,r=i;t.addWindowToStack(function(){Ds.createPlayedBeforeWindow(n,s,r)}),t.windowAddTitleText(kn.lo("welcome_back")),ir.createActivatableButton(t,!1,function(){},kn.lo("import_city"),kn.lo("got_export"),t.windowInner).button.onHover=function(){e.setOnClickTo=function(){var t=window.document.getElementById("importFile");t.value="",t.click(),e.onClick=null}},ir.createActivatableButton(t,!1,function(){Ds.createNewScenarioWindow(e,t,i)},kn.lo("new_city"),kn.lo("new_city_explain"),t.windowInner),t.windowAddBottomButtons(),t.windowOnDestroy=i},Ds.addStoryToWindow=function(t,e,i){var n,s="";t.metaGame.hasWonScenario(i.link)&&(n=t.metaGame.getScenarioTime(i.link),s=kn.lo("best_time",[n/1440|0,(n/60|0)%24,n%60])+" \n"),s+=i.description,ir.createActivatableButton(e,!1,function(){e.windowOnDestroy;e.windowOnDestroy=null,t.createNewGameState(i.link)},N.replace(N.replace(i.name,"Free Play - ",""),kn.lo("free_play")+" - ",""),s,e.windowInner)},Ds.__super__=f,Ds.prototype=e(f.prototype,{createPlayWindow:function(t){Ds.createNewScenarioWindow(this.game,this,t)},doCreatePlayedBeforeWindow:function(t){Ds.createPlayedBeforeWindow(this.game,this,t)},__class__:Ds});var Rs=function(t,e,i){null==i&&(i=""),this.afterKnowledgeText=" "+kn.lo("to_research"),this.maxDisplayWidth=-1,this.displayCityAmounts=!1,PIXI.Container.call(this),this.city=t,this.materialDisplayedRed=new zr,this.materialDisplayedRed.h.food=!1,this.materialDisplayedRed.h.wood=!1,this.materialDisplayedRed.h.stone=!1,this.materialDisplayedRed.h.machineParts=!1,this.materialDisplayedRed.h.refinedMetal=!1,this.materialDisplayedRed.h.computerChips=!1,this.materialDisplayedRed.h.cacao=!1,this.materialDisplayedRed.h.chocolate=!1,this.materialDisplayedRed.h.graphene=!1;for(var n=0,s=z.modMaterials;n<s.length;){var r=s[n];++n;r=r.variableName;this.materialDisplayedRed.h[r]=!1}this.materialDisplayedRed.h.knowledge=!1,this.beforeKnowledgeText=i,this.cost=e,this.cityAmountDisplayed=null,this.updateCostDisplay()};(V["gui.MaterialsCostDisplay"]=Rs).__name__="gui.MaterialsCostDisplay",Rs.__super__=PIXI.Container,Rs.prototype=e(PIXI.Container.prototype,{setAfterKnowledgeText:function(t){this.afterKnowledgeText=t},setBeforeKnowledgeText:function(t){this.beforeKnowledgeText=t},setCost:function(t){this.cost=t,this.updateCostDisplay()},updateCostDisplay:function(){for(var t=this,e=!1,i=!0;i;){i=!1;for(var n=this.children.length;0<=--n;)this.children.splice(n,1);var s,r,o,a,l,h,u,d,c,p=[0],g=!1,m=!1;0<this.cost.food?(p[0]-=2,m=!0,(s=new PIXI.Sprite(H.getTexture("spr_resource_"+"food".toLowerCase()))).position.x=p[0],this.addChild(s),p[0]+=1+(0|s.width),p[0]-=2,r="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(r=zn.largeNumberFormat(Math,0|this.city.materials.food)+"/"),s=null!=this.city&&this.city.materials.food<this.cost.food,r=new Hn(r+this.cost.food+"",{font:"Arial",tint:null!=this.city&&s?16711680:0}),this.materialDisplayedRed.h.food=s,r.position.set(p[0],-1),this.addChild(r),p[0]+=3+(0|r.get_textWidth())):this.materialDisplayedRed.h.food=!1,0<this.cost.wood?(m=!0,(r=new PIXI.Sprite(H.getTexture("spr_resource_"+"wood".toLowerCase()))).position.x=p[0],this.addChild(r),p[0]+=1+(0|r.width),o="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(o=zn.largeNumberFormat(Math,0|this.city.materials.wood)+"/"),r=null!=this.city&&this.city.materials.wood<this.cost.wood,o=new Hn(o+this.cost.wood+"",{font:"Arial",tint:null!=this.city&&r?16711680:0}),this.materialDisplayedRed.h.wood=r,o.position.set(p[0],-1),this.addChild(o),p[0]+=3+(0|o.get_textWidth())):this.materialDisplayedRed.h.wood=!1,0<this.cost.stone?(m=!0,(o=new PIXI.Sprite(H.getTexture("spr_resource_"+"stone".toLowerCase()))).position.x=p[0],this.addChild(o),p[0]+=1+(0|o.width),a="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(a=zn.largeNumberFormat(Math,0|this.city.materials.stone)+"/"),o=null!=this.city&&this.city.materials.stone<this.cost.stone,a=new Hn(a+this.cost.stone+"",{font:"Arial",tint:null!=this.city&&o?16711680:0}),this.materialDisplayedRed.h.stone=o,a.position.set(p[0],-1),this.addChild(a),p[0]+=3+(0|a.get_textWidth())):this.materialDisplayedRed.h.stone=!1,0<this.cost.machineParts?(m=!0,(a=new PIXI.Sprite(H.getTexture("spr_resource_"+"machineParts".toLowerCase()))).position.x=p[0],this.addChild(a),p[0]+=1+(0|a.width),l="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(l=zn.largeNumberFormat(Math,0|this.city.materials.machineParts)+"/"),a=null!=this.city&&this.city.materials.machineParts<this.cost.machineParts,l=new Hn(l+this.cost.machineParts+"",{font:"Arial",tint:null!=this.city&&a?16711680:0}),this.materialDisplayedRed.h.machineParts=a,l.position.set(p[0],-1),this.addChild(l),p[0]+=3+(0|l.get_textWidth())):this.materialDisplayedRed.h.machineParts=!1,0<this.cost.refinedMetal?(m=!0,(l=new PIXI.Sprite(H.getTexture("spr_resource_"+"refinedMetal".toLowerCase()))).position.x=p[0],this.addChild(l),p[0]+=1+(0|l.width),h="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(h=zn.largeNumberFormat(Math,0|this.city.materials.refinedMetal)+"/"),l=null!=this.city&&this.city.materials.refinedMetal<this.cost.refinedMetal,h=new Hn(h+this.cost.refinedMetal+"",{font:"Arial",tint:null!=this.city&&l?16711680:0}),this.materialDisplayedRed.h.refinedMetal=l,h.position.set(p[0],-1),this.addChild(h),p[0]+=3+(0|h.get_textWidth())):this.materialDisplayedRed.h.refinedMetal=!1,0<this.cost.computerChips?(m=!0,(h=new PIXI.Sprite(H.getTexture("spr_resource_"+"computerChips".toLowerCase()))).position.x=p[0],this.addChild(h),p[0]+=1+(0|h.width),u="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(u=zn.largeNumberFormat(Math,0|this.city.materials.computerChips)+"/"),h=null!=this.city&&this.city.materials.computerChips<this.cost.computerChips,u=new Hn(u+this.cost.computerChips+"",{font:"Arial",tint:null!=this.city&&h?16711680:0}),this.materialDisplayedRed.h.computerChips=h,u.position.set(p[0],-1),this.addChild(u),p[0]+=3+(0|u.get_textWidth())):this.materialDisplayedRed.h.computerChips=!1,0<this.cost.cacao?(m=!0,(u=new PIXI.Sprite(H.getTexture("spr_resource_"+"cacao".toLowerCase()))).position.x=p[0],this.addChild(u),p[0]+=1+(0|u.width),d="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(d=zn.largeNumberFormat(Math,0|this.city.materials.cacao)+"/"),u=null!=this.city&&this.city.materials.cacao<this.cost.cacao,d=new Hn(d+this.cost.cacao+"",{font:"Arial",tint:null!=this.city&&u?16711680:0}),this.materialDisplayedRed.h.cacao=u,d.position.set(p[0],-1),this.addChild(d),p[0]+=3+(0|d.get_textWidth())):this.materialDisplayedRed.h.cacao=!1,0<this.cost.chocolate?(m=!0,(d=new PIXI.Sprite(H.getTexture("spr_resource_"+"chocolate".toLowerCase()))).position.x=p[0],this.addChild(d),p[0]+=1+(0|d.width),c="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(c=zn.largeNumberFormat(Math,0|this.city.materials.chocolate)+"/"),d=null!=this.city&&this.city.materials.chocolate<this.cost.chocolate,c=new Hn(c+this.cost.chocolate+"",{font:"Arial",tint:null!=this.city&&d?16711680:0}),this.materialDisplayedRed.h.chocolate=d,c.position.set(p[0],-1),this.addChild(c),p[0]+=3+(0|c.get_textWidth())):this.materialDisplayedRed.h.chocolate=!1,0<this.cost.graphene?(m=!0,(c=new PIXI.Sprite(H.getTexture("spr_resource_"+"graphene".toLowerCase()))).position.x=p[0],this.addChild(c),p[0]+=1+(0|c.width),y="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(y=zn.largeNumberFormat(Math,0|this.city.materials.graphene)+"/"),c=null!=this.city&&this.city.materials.graphene<this.cost.graphene,y=new Hn(y+this.cost.graphene+"",{font:"Arial",tint:null!=this.city&&c?16711680:0}),this.materialDisplayedRed.h.graphene=c,y.position.set(p[0],-1),this.addChild(y),p[0]+=3+(0|y.get_textWidth())):this.materialDisplayedRed.h.graphene=!1;for(var f,y,_,w=0,b=z.modMaterials;w<b.length;){var v=b[w];++w;var S,x,P=v.variableName;0<this.cost[P]?("food"==P?p[0]-=2:"knowledge"==P&&""!=this.beforeKnowledgeText&&m&&((S=new Hn(this.beforeKnowledgeText,{font:"Arial",tint:0})).position.set(p[0],-1),this.addChild(S),g=!0,p[0]+=3+(0|S.get_textWidth())),m=!0,(x=new PIXI.Sprite(H.getTexture("spr_resource_"+P.toLowerCase()))).position.x=p[0],this.addChild(x),p[0]+=1+(0|x.width),"food"==P&&(p[0]-=2),S=v="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(S=zn.largeNumberFormat(Math,0|this.city.materials[P])+"/"),"knowledge"!=P||e||(v=this.afterKnowledgeText),x=null!=this.city&&this.city.materials[P]<this.cost[P],v=new Hn(S+this.cost[P]+v,{font:"Arial",tint:null!=this.city&&x?16711680:0}),this.materialDisplayedRed.h[P]=x,v.position.set(p[0],-1),this.addChild(v),p[0]+=3+(0|v.get_textWidth())):this.materialDisplayedRed.h[P]=!1}0<this.cost.knowledge?(""!=this.beforeKnowledgeText&&m&&((f=new Hn(this.beforeKnowledgeText,{font:"Arial",tint:0})).position.set(p[0],-1),this.addChild(f),g=!0,p[0]+=3+(0|f.get_textWidth())),m=!0,(y=new PIXI.Sprite(H.getTexture("spr_resource_"+"knowledge".toLowerCase()))).position.x=p[0],this.addChild(y),p[0]+=1+(0|y.width),f=_="",!this.displayCityAmounts||e||this.city.progress.sandbox.unlimitedResources||(f=zn.largeNumberFormat(Math,0|this.city.materials.knowledge)+"/"),e||(_=this.afterKnowledgeText),y=null!=this.city&&this.city.materials.knowledge<this.cost.knowledge,_=new Hn(f+this.cost.knowledge+_,{font:"Arial",tint:null!=this.city&&y?16711680:0}),this.materialDisplayedRed.h.knowledge=y,_.position.set(p[0],-1),this.addChild(_),p[0]+=3+(0|_.get_textWidth())):this.materialDisplayedRed.h.knowledge=!1,g||""==this.beforeKnowledgeText||((_=new Hn(this.beforeKnowledgeText,{font:"Arial",tint:0})).position.set(p[0],-1),this.addChild(_),p[0]+=3+(0|_.get_textWidth()));(function(t){})(p);this.displayWidth=p[0],!e&&0<this.maxDisplayWidth&&p[0]>this.maxDisplayWidth&&(i=e=!0)}null!=this.city&&(this.cityAmountDisplayed=this.city.materials.copy())},wouldChangeDisplay:function(t){if(this.displayCityAmounts){if(null==this.cityAmountDisplayed)return!0;if(this.cityAmountDisplayed.anyMaterialDifferent(this.city.materials))return!0}if(t.food!=this.cost.food)return!0;var e=null!=this.city&&this.city.materials.food<t.food;if(this.materialDisplayedRed.h.food!=e)return!0;if(t.wood!=this.cost.wood)return!0;e=null!=this.city&&this.city.materials.wood<t.wood;if(this.materialDisplayedRed.h.wood!=e)return!0;if(t.stone!=this.cost.stone)return!0;e=null!=this.city&&this.city.materials.stone<t.stone;if(this.materialDisplayedRed.h.stone!=e)return!0;if(t.machineParts!=this.cost.machineParts)return!0;e=null!=this.city&&this.city.materials.machineParts<t.machineParts;if(this.materialDisplayedRed.h.machineParts!=e)return!0;if(t.refinedMetal!=this.cost.refinedMetal)return!0;e=null!=this.city&&this.city.materials.refinedMetal<t.refinedMetal;if(this.materialDisplayedRed.h.refinedMetal!=e)return!0;if(t.computerChips!=this.cost.computerChips)return!0;e=null!=this.city&&this.city.materials.computerChips<t.computerChips;if(this.materialDisplayedRed.h.computerChips!=e)return!0;if(t.cacao!=this.cost.cacao)return!0;e=null!=this.city&&this.city.materials.cacao<t.cacao;if(this.materialDisplayedRed.h.cacao!=e)return!0;if(t.chocolate!=this.cost.chocolate)return!0;e=null!=this.city&&this.city.materials.chocolate<t.chocolate;if(this.materialDisplayedRed.h.chocolate!=e)return!0;if(t.graphene!=this.cost.graphene)return!0;e=null!=this.city&&this.city.materials.graphene<t.graphene;if(this.materialDisplayedRed.h.graphene!=e)return!0;for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s=s.variableName;if(t[s]!=this.cost[s])return!0;e=null!=this.city&&this.city.materials[s]<t[s];if(this.materialDisplayedRed.h[s]!=e)return!0}if(t.knowledge!=this.cost.knowledge)return!0;e=null!=this.city&&this.city.materials.knowledge<t.knowledge;return this.materialDisplayedRed.h.knowledge!=e},__class__:Rs});var Us=function(t){PIXI.Container.call(this),this.materials=t,this.updateMaterialsDisplay()};(V["gui.MaterialsDisplay"]=Us).__name__="gui.MaterialsDisplay",Us.__super__=PIXI.Container,Us.prototype=e(PIXI.Container.prototype,{setMaterials:function(t){this.materials=t,this.updateMaterialsDisplay()},updateMaterialsDisplay:function(){for(var t=this.children.length;0<=--t;)this.children.splice(t,1);var e=0;0<this.materials.food&&(e-=2,(r=new PIXI.Sprite(H.getTexture("spr_resource_"+"food".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),e-=2,(o=new Hn(""+this.materials.food,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.wood&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"wood".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.wood,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.stone&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"stone".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.stone,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.machineParts&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"machineParts".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.machineParts,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.refinedMetal&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"refinedMetal".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.refinedMetal,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.computerChips&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"computerChips".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.computerChips,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.cacao&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"cacao".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.cacao,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.chocolate&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"chocolate".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.chocolate,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth())),0<this.materials.graphene&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"graphene".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.graphene,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth()));for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;var r,o,s=s.variableName;0<this.materials[s]&&("food"==s&&(e-=2),(r=new PIXI.Sprite(H.getTexture("spr_resource_"+s.toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),"food"==s&&(e-=2),(o=new Hn(""+this.materials[s],{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth()))}0<this.materials.knowledge&&((r=new PIXI.Sprite(H.getTexture("spr_resource_"+"knowledge".toLowerCase()))).position.x=e,this.addChild(r),e+=1+(0|r.width),(o=new Hn(""+this.materials.knowledge,{font:"Arial",tint:0},!0)).position.set(e,-1),this.addChild(o),e+=3+(0|o.get_textWidth()));this.displayWidth=e},__class__:Us});var Ls=function(){};(V["gui.MoreSettingsWindow"]=Ls).__name__="gui.MoreSettingsWindow",Ls.create=function(e,i,t,n,s,r,o){var a=e.game;i.windowAddTitleText(kn.lo("advanced_settings"));var l=null,h=new qs(i,t,n,function(){return R.musicVolume},function(t){R.musicVolume=t,R.save(),a.audio.setVolumeLevels()});h.addChild(new Qs(h,t,kn.lo("music_volume"))),n.addChild(h),i.windowInner.addChild(new Cs(i.windowInner,new Cn(2,4)));var u=new qs(i,t,n,function(){return R.soundVolume},function(t){R.soundVolume=t,R.save(),a.audio.setVolumeLevels()});u.addChild(new Qs(u,t,kn.lo("sound_effect_volume"))),n.addChild(u),i.windowInner.addChild(new Cs(i.windowInner,new Cn(2,4))),k.canHavePremium()&&(rs.createSettingButton(i,i.innerWindowStage,i.windowInner,function(){R.colorBlindMode=!R.colorBlindMode,R.save()},function(){return R.colorBlindMode},kn.lo("color_blind_mode")),i.windowInner.addChild(new Cs(i.windowInner,new Cn(2,4))));var d,c,p,g=null,m=null;o&&e.progress.story.canHaveUnlimitedResources()&&(k.get_allowUnlimitedResources()||e.progress.sandbox.unlimitedResources)&&(d=null,d=function(){i.windowOnDestroy=null,i.createWindow("confirmUnlimited"),i.addWindowToStack(d),i.windowAddTitleText(e.progress.sandbox.unlimitedResources?kn.lo("disable_unlimited_resources"):kn.lo("enable_unlimited_resources")),i.windowAddInfoText(e.progress.sandbox.unlimitedResources?kn.lo("stop_play_unlimited"):kn.lo("play_unlimited")),i.windowAddBottomButtons([{text:kn.lo("yes"),action:function(){e.progress.sandbox.unlimitedResources?e.progress.sandbox.disableUnlimitedResources():e.progress.sandbox.enableUnlimitedResources(),i.goPreviousWindow()}}])},g=new Ks(i,t,n,d,kn.lo("unlimited")),n.addChild(g),a.isMobile||(g.extraWidth=18),g.setText(e.progress.sandbox.unlimitedResources?kn.lo("disable_unlimited_resources"):kn.lo("enable_unlimited_resources")),n.addChild(new Cs(n,new Cn(2,4)))),a.isMobile||((f=new ds(i,t,n)).direction=vs.Vertical,(c=new ds(i,t,n)).direction=vs.Horizontal,c.padding.bottom=6,(p=new Qs(f,t,kn.lo("pathfinding_thread_limit")+" ")).handleMouseFunction=function(t){return!!p.rect.contains(t.position)&&(i.tooltip.setText(null,kn.lo("pathfinding_thread_limit_explain")),!0)},p.padding.top=1,c.addChild(p),c.addChild(new Cs(c,new Cn(4,2))),h=i,u=R.pathfindingWorkers,o=kn.lo("reset_pathfinding_limit"),o=new Ns(h,t,c,{left:0,right:0,top:0,bottom:0},function(){return 1},function(){return 15},u,function(t){R.pathfindingWorkers=t,e.simulation.pathfinder.setWorkerNumber(t,!0),R.save()},function(){return R.resetPathfindingWorkers()},o),c.addChild(o),f.addChild(c),n.addChild(f)),n.addChild(new Qs(n,i.innerWindowStage,kn.lo("have_code")));var f=new ds(i,i.innerWindowStage,i.windowInner),y=null,y=function(){i.windowOnDestroy=null,i.createWindow("secretWindow"),i.addWindowToStack(y),$s.create(e,i,i.innerWindowStage,i.windowInner)},t=new Ks(i,t,i.windowInner,y,kn.lo("input_code"));t.extraHeight+=3,t.extraTextPosY+=1,t.setText(kn.lo("input_code")),f.addChild(t),n.addChild(f),n.addChild(new Cs(i.windowInner,new Cn(2,4))),null!=l&&l.fillWidth(),a.isMobile&&(null!=g&&g.fillWidth(),null!=m&&m.fillWidth()),i.windowAddBottomButtons(),i.windowOnDestroy=function(){a.state instanceof P&&a.state.language!=R.language&&a.createMainMenu()}};var Es=function(){};(V["gui.MultiFollowWindow"]=Es).__name__="gui.MultiFollowWindow",Es.createWindow=function(l,h,t,u,d){l.gui.createWindow(h),l.gui.setWindowPositioning(l.game.isMobile?nr.TopLeft:nr.Top);var e=l,i=h,n=t,s=u,r=d,o=function(){Es.createWindow(e,i,n,s,r)};l.gui.setWindowReload(o);var a=l,c=h,p=t,g=u,m=d,o=function(){Es.createWindow(a,c,p,g,m)};l.gui.addWindowToStack(o),l.gui.windowAddTitleText(t);var f=new ds(l.gui,l.gui.innerWindowStage,l.gui.windowInner);f.direction=vs.Vertical;var y=[];l.gui.windowInner.addChild(f),l.gui.windowAddBottomButtons();var _=H.getTexture("spr_selectedhuman"),w=[],b=null;null!=u&&((b=H.makeSprite("spr_selectedbuilding")).alpha=.5,b.position.set(u.position.x-1,u.position.y-1),l.farForegroundStage.addChild(b)),l.gui.windowOnLateUpdate=function(){if(null!=u){if(u.destroyed)return l.gui.clearWindowStack(),void l.gui.closeWindow();b.position.set(u.position.x-1,u.position.y-1)}if(0==h.length){if(0<y.length){for(var t=0;t<y.length;){var e=y[t];++t,e.elem.destroy()}y=[],f.clear()}0==f.children.length&&f.addChild(new Qs(f,l.gui.innerWindowStage,d))}else{0==y.length&&f.clear();for(t=0;t<h.length;){var i,n,s=[h[t]];++t,null==tt.find(y,function(e){return function(t){return t.citizen==e[0]}}(s))&&((i=new ls(l.gui,l.gui.innerWindowStage,f,function(t){return function(){_s.createWindow(l,t[0],!1)}}(s))).container.padding.top=3,i.container.padding.left=3,i.container.padding.right=3,i.container.padding.bottom=0,i.container.fillSecondarySize=!0,i.container.addChildWithoutSizeUpdate(new Qs(i.container,l.gui.innerWindowStage,s[0].nameIndex<H.citizenNames.length?H.citizenNames[s[0].nameIndex]:Dn.firstToUpper(kn.lo("citizen")))),i.container.updateSizeNonRecursive(),n=i.container.parent.parent,i.container.parent.parent=null,i.container.parent.updateSize(),i.container.parent.parent=n,i.container.updateChildrenPosition(),f.addChildWithoutSizeUpdate(i),n=new Cs(f,new Cn(2,4)),f.addChildWithoutSizeUpdate(n),y.push({elem:i,elem2:n,citizen:s[0]}))}f.updateSize();for(var r=y.length-1;0<=r;){e=y[r];-1==h.indexOf(e.citizen)&&(f.removeChild(e.elem),f.removeChild(e.elem2),y.splice(r,1)),--r}}if(w.length>h.length){for(var t=h.length,o=w.length;t<o;){r=t++;w[r].destroy()}w.splice(h.length,w.length-h.length)}for(t=0,o=h.length;t<o;){(r=t++)>=w.length&&(a=new PIXI.Sprite(_),w.push(a),l.furtherForegroundStage.addChild(a));var a=h[r].getCityPosition();w[r].position.set(a.x-1,a.y-6)}},l.gui.windowOnDestroy=function(){for(var t=0;t<w.length;){var e=w[t];++t,e.destroy()}null!=b&&b.destroy()}};var Hs=function(t,e,i,n){this.currentTextureSet=0,this.npWidth=i,this.npHeight=n,PIXI.Container.call(this),this.textureSets=[],this.texture=t,this.sidePixels=e,this.updateTextures(),this.updateSprites()};(V["gui.NinePatch"]=Hs).__name__="gui.NinePatch",Hs.__super__=PIXI.Container,Hs.prototype=e(PIXI.Container.prototype,{setTextureSet:function(t){var e=this.textureSets[t];this.currentTextureSet=t,e!=this.textureParts&&(this.textureParts=e,this.updateSprites())},updateTextures:function(t){if(null==t&&(t=!0),null!=this.textureParts&&t?this.textureSets.pop():this.textureParts=[],null!=Hs.ninePatchTextureCache.h.__keys__[this.texture.__id__]&&Hs.ninePatchTextureCache.h[this.texture.__id__].h.hasOwnProperty(this.sidePixels))this.textureParts=Hs.ninePatchTextureCache.h[this.texture.__id__].h[this.sidePixels];else{for(var e,i=0;i<9;){var n=i++;this.textureParts[n]=this.texture.clone();var s=new PIXI.Rectangle;n%3==1?(s.width=this.texture.width-2*this.sidePixels,s.x=this.sidePixels):(s.width=this.sidePixels,n%3==2&&(s.x=this.texture.width-this.sidePixels)),3<=n&&n<=5?(s.height=this.texture.height-2*this.sidePixels,s.y=this.sidePixels):(s.height=this.sidePixels,5<n&&(s.y=this.texture.height-this.sidePixels)),this.textureParts[n].frame=new PIXI.Rectangle(this.textureParts[n].frame.x+s.x,this.textureParts[n].frame.y+s.y,s.width,s.height),this.textureParts[n].update()}null==Hs.ninePatchTextureCache.h.__keys__[this.texture.__id__]&&(e=Hs.ninePatchTextureCache,t=this.texture,r=new Ir,e.set(t,r));var r=this.textureParts;Hs.ninePatchTextureCache.h[this.texture.__id__].h[this.sidePixels]=r}this.textureSets.push(this.textureParts)},updateSprites:function(t){if(null==t&&(t=!1),0!=this.npWidth&&0!=this.npHeight){if(this.visible=!0,t){for(var e=0,i=this.children;e<i.length;){var n=i[e];++e,n.destroy()}this.children=[]}for(e=0;e<9;){var s,r,o=e++,a=null;switch(this.children.length<=o?(a=new PIXI.Sprite(this.textureParts[o]),this.addChild(a)):(a=this.children[o]).texture=this.textureParts[o],o%3){case 1:s=this.sidePixels;break;case 2:s=this.npWidth-this.sidePixels;break;default:s=0}switch(a.position.x=s,o%3==1&&(a.width=this.npWidth-2*this.sidePixels),o/3|0){case 1:r=this.sidePixels;break;case 2:r=this.npHeight-this.sidePixels;break;default:r=0}a.position.y=r,1==(o/3|0)&&(this.npHeight-2*this.sidePixels<0?a.height=0:a.height=this.npHeight-2*this.sidePixels)}}else this.visible=!1},__class__:Hs});var Ns=function(t,e,i,n,s,r,o,a,l,h,u){null==u&&(u=1),null==h&&(h=""),null==o&&(o=0),this.number=0;var d=this;ds.call(this,t,e,i,null,null,null,null,n),this.getMinValue=s,this.getMaxValue=r,this.number=o,this.setValue=a,this.setToOnClick=l,this.numberButton=new ls(t,e,this,function(){var t=d.number;d.number=l(),d.number!=t&&a(d.number)},null,function(){t.tooltip.setText(d,h)});n=t.game.isMobile?2:0,o=t.game.isMobile?4:0;this.numberButton.container.padding={left:3+o,right:3+o,top:3+n,bottom:n-1},this.numberButton.container.minHeight=12,this.numberButton.container.minWidth=20,this.numberButton.container.addChild(new Qs(this.numberButton.container,e,null,function(){return d.number==d.beyondHighestValue?d.beyondHighestText:""+d.number},null,null,null,!1,!0)),this.addChild(this.numberButton),this.numberButton.buttonPatch.updateSprites(!0);n=new ds(t,e,this);n.direction=t.game.isMobile?vs.Horizontal:vs.Vertical,this.upButton=new Fs(t,e,this,function(){null!=d.beyondHighestValue&&d.number==d.beyondHighestValue||(null==r||d.number+u<=r()?(d.number+=u,null!=a&&a(d.number)):null!=d.beyondHighestValue&&d.number!=d.beyondHighestValue&&(d.number=d.beyondHighestValue,null!=a&&a(d.number)))},H.getTexture(t.game.isMobile?"spr_arrowup_big":"spr_arrowup"),null,null,null,t.game.isMobile?"spr_button_small":"spr_minibutton"),this.upButton.canBeHeld=!0,n.addChild(this.upButton),this.downButton=new Fs(t,e,this,function(){null!=d.beyondHighestValue&&d.number==d.beyondHighestValue?(null!=r&&(d.number=r()),null!=a&&a(d.number)):(null==s||d.number-u>=s())&&(d.number-=u,null!=a&&a(d.number))},H.getTexture(t.game.isMobile?"spr_arrowdown_big":"spr_arrowdown"),null,null,null,t.game.isMobile?"spr_button_small":"spr_minibutton"),this.downButton.canBeHeld=!0,n.addChild(this.downButton),this.addChild(n)};(V["gui.NumberSelectControl"]=Ns).__name__="gui.NumberSelectControl",Ns.__super__=ds,Ns.prototype=e(ds.prototype,{enableBeyondHighestValuePossibility:function(t,e){this.beyondHighestValue=t,this.beyondHighestText=e},update:function(){var t,e,i;ds.prototype.update.call(this),this.number!=this.beyondHighestValue&&(t=this.number,null!=this.getMinValue&&(e=this.getMinValue(),i=this.number,this.number=e<i?i:e),null!=this.getMaxValue&&(e=this.getMaxValue(),i=this.number,this.number=i<e?i:e),this.number!=t&&this.setValue(this.number))},__class__:Ns});var Gs=function(){};(V["gui.PopulationInfoWindow"]=Gs).__name__="gui.PopulationInfoWindow",Gs.create=function(t,e,i,n){Gs.createWindow(t,e,i,n)},Gs.createWindow=function(o,a,r,l){l.clear(),a.windowAddTitleText(kn.lo("pop_by_age"),null,H.getTexture("spr_population"));var h=0;a.windowAddInfoText(null,function(){return kn.lo("citizens_and_children",[o.simulation.citizens.length,h])}),a.windowAddInfoText(null,function(){return kn.lo("citizens_by_age_explain")});function t(){d=!1,c=0,p.clear(),p.beginFill(0),p.drawRect(0,0,1,120),p.drawRect(39,0,1,120),p.drawRect(0,120,40,1);for(var t=[],e=0;e<121;){e++;t.push(0)}for(u=t,t=h=0,e=o.simulation.citizens;t<e.length;){var i=e[t];++t,120<(s=0|i.get_age())?(u[120]++,d=!0):u[s]++,s<16&&(h+=1),c<s&&(c=s)}var n=vn.max(u);if(0!=n)for(t=0,e=121;t<e;){var s=t++,r=u[s]/n;p.drawRect(40,s,210*r,1),p.drawRect(40,s,210*r,1),s%10==0&&p.drawRect(0,s,40,1)}p.endFill()}var u,d=!1,c=0,e=new PIXI.Container,p=new PIXI.Graphics;t(),e.addChild(p);var g=null,g=new us(l,r,e,{left:0,right:0,top:0,bottom:3},t,function(t){var e=t.get_x();if(e>=g.rect.x&&e<g.rect.x+g.rect.width&&((e=t.get_y())>=g.rect.y&&e<g.rect.y+g.rect.height)){if(t.get_x()>=g.rect.x+40){var i=t.get_y()-g.rect.y;i<120||120==i&&!d?a.tooltip.setText(g,1==u[i]?kn.lo("one_citizen_age",[i]):kn.lo("n_citizens_age",[u[i],i])):120==i&&a.tooltip.setText(g,1==u[i]?kn.lo("one_citizen_age_oldest",[i,c]):kn.lo("n_citizens_age_oldest",[u[i],i,c]))}else{i=10*((t.get_y()-g.rect.y)/10|0);if(i<120){for(var n=0,t=110==i,s=i,r=10+i+(t?1:0);s<r;){var o=s++;n+=u[o]}t&&d?a.tooltip.setText(g,1==n?kn.lo("one_citizen_age_upper_range",[i]):kn.lo("n_citizens_age_upper_range",[n,i])):a.tooltip.setText(g,1==n?kn.lo("one_citizen_age_range",[i,10+i]):kn.lo("n_citizens_age_range",[n,i,10+i]))}}return!0}return!1});l.addChild(g);for(var i=0;i<12;){var n=i++,s=new Hn(10*n+"-"+(10*n+10),{font:"Arial10",tint:0},!0);11==n&&d&&s.set_text(10*n+"+"),s.position.set(2,10*n),e.addChild(s)}l.onDestroy=function(){p.destroy()};var m=new ds(a,r,l);m.direction=vs.Vertical;var f=!1;m.onUpdate=function(){var t,e,i,n,s;!f&&1950<=o.simulation.citizens.length&&((t=new ds(a,r,l)).direction=vs.Horizontal,f=!0,t.padding.bottom=6,(s=new Qs(m,r,kn.lo("pop_limit")+" ")).padding.top=1,t.addChild(s),t.addChild(new Cs(t,new Cn(4,2))),e=a,i=r,n=o.simulation.babyMaker.softPopLimit,s=kn.lo("reset_pop_limit"),s=new Ns(e,i,t,{left:0,right:0,top:0,bottom:0},function(){return 2e3},function(){return 1e4},n,function(t){o.simulation.babyMaker.softPopLimit=t},function(){return 2e3},s,25),t.addChild(s),m.addChild(t),m.addChild(new Qs(m,r,kn.lo("pop_limit_hint"))))},l.addChild(m),a.windowAddBottomButtons([{text:kn.lo("follow_citizen"),action:function(){o.viewActions.showFollow()}}])};var Xs=function(){};(V["gui.ReplaceAllHousesWindow"]=Xs).__name__="gui.ReplaceAllHousesWindow",Xs.create=function(t,e,i,n){Xs.createWindow(t,e,i,n)},Xs.createWindow=function(i,n,t,s){s.clear(),n.windowAddTitleText(kn.lo("upgrade_basic_houses")),n.windowAddInfoText(kn.lo("upgrade_basic_houses_hint")),n.windowInner.addChild(new Cs(n.windowInner,new Cn(2,2)));var e=new ds(n,t,s);e.direction=vs.Horizontal,n.windowInner.addChild(e);for(var r=0,o=0,a=i.progress.resources.buildingInfoArray;o<a.length;){var l=[a[o]];++o;var h,u="buildings."+l[0].className,d=V[u],c=i.progress.unlocks.getUnlockState(d),p=D.field(d,"spriteName");"Houses"==l[0].category&&(c==mo.Unlocked&&null==l[0].showUnlockHint||c==mo.Researched||c==mo.Createable)&&-1==l[0].specialInfo.indexOf("rooftop")&&null!=l[0].residents&&"NormalHouse"!=l[0].className&&(9<++r&&((e=new ds(n,t,s)).direction=vs.Horizontal,n.windowInner.addChild(e),r=0),u=h=[],d=n,(c=[null])[0]=function(t,e){return function(){i.gui.createWindow(s),js.create(i,i.gui,i.gui.innerWindowStage,i.gui.windowInner,e[0]),i.gui.addWindowToStack(t[0])}}(c,l),u[0]=new Fs(d,t,e,c[0],H.getTexture(p+"@0,0,20,20"),function(){return!1},function(t,e){return function(){n.tooltip.setText(t[0],e[0].name)}}(h,l),H.getTexture(null==l[0].buttonBack?p+"@44,0,20,20":l[0].buttonBack)),e.addChild(h[0]))}n.windowInner.addChild(new Cs(n.windowInner,new Cn(2,6))),n.windowAddBottomButtons()};var js=function(){};(V["gui.ReplaceAllHousesWindowStep2"]=js).__name__="gui.ReplaceAllHousesWindowStep2",js.create=function(t,e,i,n,s){js.createWindow(t,e,i,n,s)},js.createWindow=function(a,l,t,e,h){e.clear(),l.windowAddTitleText(kn.lo("upgrade_to_x",[h.name]));var u=new Rs(a,new M(2,2)),e=new ds(l,l.innerWindowStage,l.windowInner),d=e.addChild(new us(e,l.innerWindowStage,u,{left:0,right:0,top:0,bottom:2})),c=M.fromBuildingInfo(h),p=null,g=null,m=0,f=null;l.windowAddInfoText(null,function(){for(var t=[],e=0,i=a.permanents;e<i.length;){var n=i[e];++e,Fr.getClass(n)==hi&&t.push(n)}if(0==(g=t).length)return u.setCost(new M),m=0,f.setText("-"),kn.lo("no_basic_houses");f.setText(kn.lo("confirm"));var s=c.copy(),r="buildings."+h.className;a.progress.unlocks.getUnlockState(V[r])==mo.Researched&&(s.knowledge=0);var o=new M(4,4);o.multiply(a.upgrades.vars.recyclingAmount),s.remove(o),s.roundAll(),p=s.copy();r=s.copy();r.knowledge=0;o=a.materials.canAffordNumber(r),r=g.length;m=o<1?1:r<o?r:o,p.multiply(m),p.knowledge=s.knowledge;s=p.copy();return s.wood<0&&(s.wood=0),s.stone<0&&(s.stone=0),u.setCost(s),d.updateSize(),kn.lo("no_undo")+"\n\n"+kn.lo("upgrade_basic_for",[m,g.length])}),l.windowInner.addChild(new Cs(l.windowInner,new Cn(2,4))),l.windowInner.addChild(e),l.windowInner.addChild(new Cs(l.windowInner,new Cn(2,4))),f=new Ks(l,t,l.windowInner,function(){if(null!=p&&null!=g&&0<g.length&&0<m&&a.materials.canAfford(p)){var t=[],e="buildings."+h.className,i=V[e];a.progress.unlocks.research(i);for(var n=0,s=m;n<s;){var r=n++,r=g[r];r.destroyForReplacement(),r.world.build(i,r.worldPosition.x,r.worldPosition.y),t.push(r)}a.connections.updateCityConnections(),a.simulation.updatePathfinder(!0);for(n=0;n<t.length;){var o=t[n];++n,o.postCreate()}a.progress.unlocks.checkBuildRelatedUnlocks(),a.materials.remove(p),l.showSimpleWindow(kn.lo("upgraded_houses",[m]),null,!0)}},kn.lo("confirm")),l.windowInner.addChild(f),l.windowInner.addChild(new Cs(l.windowInner,new Cn(2,6))),l.windowAddBottomButtons()};var Vs=function(){};(V["gui.SaveLoadWindows"]=Vs).__name__="gui.SaveLoadWindows",Vs.createSaveWindow=function(t,e,i,n,s){e.createWindow(),e.windowRelatedTo="saveLoad";var r=t,o=e,a=i,l=n,h=s;e.addWindowToStack(function(){Vs.createSaveWindow(r,o,a,l,h)}),e.windowAddTitleText(kn.lo("choose_save_slot")),e.windowAddInfoText(i),e.windowAddBottomButtons(),Vs.addSaveSlotButtons(t,e,function(t){n(t),e.windowOnDestroy=null,e.closeWindow()},!1,!0),e.windowOnDestroy=s},Vs.createLoadWindow=function(e,i,t,n,s){i.createWindow(),i.windowRelatedTo="saveLoad";var r=e,o=i,a=t,l=n,h=s;i.addWindowToStack(function(){Vs.createLoadWindow(r,o,a,l,h)}),i.windowAddTitleText(kn.lo("load_a_game")),i.windowAddInfoText(t),i.windowAddBottomButtons([{text:kn.lo("import_command"),action:function(){},onHover:function(){e.setOnClickTo=function(){var t=window.document.getElementById("importFile");t.value="",t.click(),e.onClick=null}}}]),Vs.addSaveSlotButtons(e,i,function(t){n(t),i.windowOnDestroy=null,i.closeWindow()},!0,!1),i.windowOnDestroy=s},Vs.addSaveSlotButtons=function(t,e,i,n,s){Vs.createSaveSlotButton(t,e,0,i,n,s,!1),Vs.createSaveSlotButton(t,e,1,i,n,s,!1),Vs.createSaveSlotButton(t,e,2,i,n,s,!1),Vs.createSaveSlotButton(t,e,3,i,n,s,!1),Vs.createSaveSlotButton(t,e,4,i,n,s,!1)},Vs.createSaveSlotButton=function(l,h,u,d,c,p,g){var m;null==g&&(g=!0),"saveLoad"==h.windowRelatedTo&&((m=new ds(h,h.innerWindowStage,h.windowInner)).fillSecondarySize=!0,m.direction=vs.Vertical,On.getItem(u+"__meta",function(t,e){var i,n,s,r,o,a;"saveLoad"==h.windowRelatedTo&&(n="",r=s=i=!1,null!=t||null==e?(e=kn.lo("empty"),i=c):(p&&(n=" "+kn.lo("overwrite"),s=!0),r=!0),o=!1,a=null,a=ir.createActivatableButton(h,i,function(){var t,e;s&&!o?(o=!0,t=a.titleText,e=kn.lo("really_overwrite",[u+1]),t.setText(e)):d(""+u)},kn.lo("slot_n",[u+1])+n,e,m,"spr_9p_button_disabled",null,Vs.isWeirdText(e)),g&&u<100&&r&&Vs.createSaveSlotButton(l,h,u+1,d,c,p,!0))}),m.padding.bottom=2,h.windowInner.insertChild(m,h.windowInner.children.length-1))},Vs.isWeirdText=function(t){return new c("[^a-zA-Z\\-: 0-9<>\\[\\]{}~`=|\\\\@!#$%^&*\\(\\)_?]+","g").match(t)};var Ys=function(t,e,i){this.resetTexturesNextUpdate=!1,this.width=10,S.isMobile&&(this.width=14),this.parent=t,this.stage=e,this.scrollable=i,this.rect=new xn(0,0,this.width,0);i=H.getTextures("spr_windowparts",4);this.background=new Hs(i[0],3,9,9),e.addChild(this.background),this.scrollbar=new Hs(i[1],3,9,9),this.scrollbar.texture=i[2],this.scrollbar.updateTextures(!1),this.scrollbar.texture=i[3],this.scrollbar.updateTextures(!1),this.scrollbar.texture=i[1],this.scrollbar.updateTextures(!1),e.addChild(this.scrollbar)};(V["gui.ScrollBar"]=Ys).__name__="gui.ScrollBar",Ys.__interfaces__=[Kt],Ys.prototype={get_scrollPart:function(){return this.scrollable.scrollPosition.y},get_scrollHandlePosition:function(){return Math.round(this.get_scrollPart()/this.scrollable.get_innerHeight()*this.rect.height)},get_scrollHandleHeight:function(){return Math.round(this.scrollable.rect.height/this.scrollable.get_innerHeight()*this.rect.height)},updateSize:function(){this.parent.updateSize()},updatePosition:function(t){var e=this.rect;e.x=t.x,e.y=t.y;this.redraw()},redraw:function(){var t,e,i;null!=this.scrollable&&(this.background.npWidth=this.width,this.background.npHeight=this.rect.height,t=(i=this.rect).x,e=i.y,this.background.position.x=t,t=(i=this.rect).x,e=i.y,this.background.position.y=e,this.background.updateSprites(!0),this.scrollbar.npWidth=this.width,this.scrollbar.npHeight=this.get_scrollHandleHeight(),t=(i=this.rect).x,e=i.y,this.scrollbar.position.x=t,t=(i=this.rect).x,e=i.y,i=this.get_scrollHandlePosition(),this.scrollbar.position.y=e+i,this.scrollbar.updateSprites(!0))},destroy:function(){this.stage.removeChild(this.background),this.stage.removeChild(this.scrollbar)},handleMouse:function(s){var r=this;if(this.rect.contains(s.position)){this.scrollable.handleScrollWheel(s);var o=!0,a=0,l=s.get_y()-r.rect.y,t=r.get_scrollHandlePosition(),e=r.get_scrollHandlePosition()+r.get_scrollHandleHeight(),h=t<=l&&l<e;return h&&(this.scrollbar.setTextureSet(1),this.resetTexturesNextUpdate=!1),s.strongClaimMouse(this,function(){var t,e,i,n;null!=r.scrollable&&null!=r.background.parent&&(r.resetTexturesNextUpdate=!1,r.scrollbar.setTextureSet(2),l=s.get_y()-r.rect.y,e=r.get_scrollHandlePosition(),i=r.get_scrollHandlePosition()+r.get_scrollHandleHeight(),h=e<=l&&l<i,s.pressed&&(a=l-r.get_scrollHandlePosition(),o=h),t=r.scrollable.get_innerHeight()-r.scrollable.rect.height,e=r.scrollable.scrollPosition.y,o?(n=l-a,0!=r.rect.height&&(e=Math.round(n*(r.scrollable.get_innerHeight()/r.rect.height)))):(i=r.get_scrollHandlePosition()+r.get_scrollHandleHeight()/2,n=Math.round(8*s.timeMod),l<i-n?e-=n:i+n<=l&&(e+=n)),e<0?e=0:t<e&&(e=t),r.scrollable.updateScrollPosition(new Cn(r.scrollable.scrollPosition.x,e)))}),!0}return!1},update:function(){this.resetTexturesNextUpdate&&this.scrollbar.setTextureSet(0),this.resetTexturesNextUpdate=!0},__class__:Ys};var $s=function(){};(V["gui.SecretCodeWindow"]=$s).__name__="gui.SecretCodeWindow",$s.create=function(o,a,t,e){a.windowAddTitleText(kn.lo("secret_code")),e.addChild(new Qs(e,t,kn.lo("secret_code_use")+"\n"+kn.lo("sample_code_2")+" Dance All Night")),e.addChild(new Cs(a.windowInner,new Cn(2,4)));function i(t){if(null==t)return!1;switch(t.toLowerCase()){case"coolmath":var e=null;return(e=function(){a.showSimpleWindow($s.getCoolMathText(o,!0),"",!0),a.addWindowToStack(e,!0),a.setWindowReload(e)})(),!0;case"dance all night":R.unlockSecretCode("nightClubColors");var i=null;return(i=function(){a.showSimpleWindow(kn.lo("secret_code_1"),kn.lo("secret_code_activated"),!0),a.addWindowToStack(i,!0),a.setWindowReload(i)})(),!0;case"debug_pathfinder":return a.createWindow(),a.windowAddInfoText(null,function(){return""+o.simulation.pathfinder.getTotalNumberOfRequested()}),!0;case"hangar":R.unlockSecretCode("hangar");var n=null;return(n=function(){a.showSimpleWindow("",kn.lo("secret_code_activated"),!0),a.addWindowToStack(n,!0),a.setWindowReload(n)})(),!0;case"orchid":R.unlockSecretCode("orchid");var s=null;return(s=function(){a.showSimpleWindow(kn.lo("secret_code_2"),kn.lo("secret_code_activated"),!0),a.addWindowToStack(s,!0),a.setWindowReload(s)})(),!0;case"stats":var r=null;return(r=function(){a.showSimpleWindow($s.getCoolMathText(o,!1),"",!0),a.addWindowToStack(r,!0),a.setWindowReload(r)})(),!0}return!1}t=new Zs(a.windowInner,a,o.game,kn.lo("enter_secret_code"));e.addChild(t),t.onInput=i,e.addChild(new Cs(a.windowInner,new Cn(2,4))),a.windowAddBottomButtons()},$s.getCoolMathText=function(t,e){var i=tt.count(t.permanents,function(t){return t.isBuilding}),n="";if(0<H.citizenNames.length){for(var s=Object.create(null),r=0,o=t.simulation.citizens;r<o.length;){var a=o[r];++r;var l=a.nameIndex<H.citizenNames.length?H.citizenNames[a.nameIndex]:Dn.firstToUpper(kn.lo("citizen"));Object.prototype.hasOwnProperty.call(s,l)?(C=s[y=a.nameIndex<H.citizenNames.length?H.citizenNames[a.nameIndex]:Dn.firstToUpper(kn.lo("citizen"))]+1,s[y]=C):s[a.nameIndex<H.citizenNames.length?H.citizenNames[a.nameIndex]:Dn.firstToUpper(kn.lo("citizen"))]=1}for(var h="",u=0,d=0,c=zr.keysIterator(s);c.hasNext();){var p=c.next();u<s[p]&&(u=s[h=p]),++d}var g=2<u&&e?" If you want to know why there is a name that is so relatively common, take a look at the birthday paradox.":"",n="\n\n"+kn.lo("citizen_name_stats",[t.simulation.citizens.length,d,h,s[h]])+g}for(var m=0,r=0,o=t.worlds;r<o.length;){var f=o[r];++r;for(var y=0,_=f.permanents;y<_.length;){var w=_[y];++y;for(var b=0,v=0,S=0;S<w.length;){var x=w[S];++S,null!=x&&x.isBuilding?++b:b=0,v<=b&&(v=b)}m<=v&&(m=v)}}var P="";0<t.landingSites.length&&(""==P?P="\n\n":P+=" ",P+=kn.lo("landing_pads_stats",[vn.sum(t.landingSites,function(t){return t.timesUsed}),vn.sum(t.landingSites,function(t){return t.timesUsedStopOver})]),10<t.simulation.flyingSaucers.length&&(g=vn.isum(t.simulation.flyingSaucers,function(t){return t.passengers.length}),P+=" "+kn.lo("landing_pads_air",[t.simulation.flyingSaucers.length,g])));for(r=[],o=0,y=t.permanents;o<y.length;){var C=y[o];++o,C.is(Ye)&&r.push(C)}0<r.length&&(""==P?P="\n\n":P+="\n",P+=kn.lo("hyper_elevators_stats",[vn.sum(r,function(t){return t.timesUsed})])),0<t.teleporters.length&&(""==P?P="\n\n":P+="\n",P+=kn.lo("teleporter_stats",[vn.sum(t.teleporters,function(t){return t.timesUsed})]));t=kn.lo("stats_info");return e&&(t="Alright, I did some cool math; here are some stats about your city!"),t+" :)\n\n"+kn.lo("building_stats",[i,m])+P+n};var qs=function(t,e,i,n,s){var r=H.getTexture("spr_slider_fill");this.fillPatch=new Hs(r,2,20,20),this.fillLevel=n,this.setFillLevel=s,ds.call(this,t,e,i,null,null,null,new Hs(H.getTexture("spr_slider_bg"),2,20,20)),this.padding.top=3,this.padding.left=3,this.padding.right=3,this.padding.bottom=1,this.fillSecondarySize=!0,e.addChild(this.fillPatch),this.updateFillSize()};(V["gui.Slider"]=qs).__name__="gui.Slider",qs.__super__=ds,qs.prototype=e(ds.prototype,{updateFillSize:function(){var t,e,i;null!=this.fillPatch&&(t=this.fillPatch.npWidth,e=this.fillPatch.npHeight,i=this.fillLevel()*this.rect.width,this.fillPatch.npWidth=Math.round(i),this.fillPatch.npHeight=this.rect.height,null!=this.fillPatch&&(this.fillPatch.position.x=this.rect.x,this.fillPatch.position.y=this.rect.y,this.fillPatch.updateSprites()),t==this.fillPatch.npWidth&&e==this.fillPatch.npHeight||this.fillPatch.updateSprites())},updatePosition:function(t){ds.prototype.updatePosition.call(this,t),null!=this.fillPatch&&(this.fillPatch.position.x=this.rect.x,this.fillPatch.position.y=this.rect.y,this.fillPatch.updateSprites())},updateChildrenPosition:function(){ds.prototype.updateChildrenPosition.call(this),this.updateFillSize()},updateSizeNonRecursive:function(){ds.prototype.updateSizeNonRecursive.call(this)},handleMouse:function(e){var i=this;return!!this.rect.contains(e.position)&&(e.hasNoClaim()&&e.strongClaimMouse(this,function(){var t=(e.position.x-i.rect.x)/i.rect.width,t=t<0?0:1<t?1:t;t<.025&&(t=0),.975<t&&(t=1),i.setFillLevel(t),i.updateFillSize(),e.strongClaimOnEnd=function(){i.gui.game.audio.playSound(i.gui.game.audio.buttonSound)}}),!0)},update:function(){ds.prototype.update.call(this)},destroy:function(){ds.prototype.destroy.call(this),this.stage.removeChild(this.fillPatch)},__class__:qs});var Ks=function(t,e,i,n,s,r,o,a){null==a&&(a="spr_button"),this.extraTextPosY=0,this.extraHeight=0,this.extraWidth=0,S.isMobile&&(this.extraHeight+=4,this.extraTextPosY+=2),ns.call(this,t,e,i,n,r,o),this.buttonTextures=H.getTextures(a,3),this.buttonPatch=new Hs(this.buttonTextures[0],2,2,0|this.buttonTextures[0].height),this.buttonPatch.texture=this.buttonTextures[1],this.buttonPatch.updateTextures(!1),this.buttonPatch.texture=this.buttonTextures[2],this.buttonPatch.updateTextures(!1),this.buttonPatch.setTextureSet(0),e.addChild(this.buttonPatch),this.rect=new xn(0,0,1,2+(0|this.buttonTextures[0].height)),this.bitmapText=new Hn(s,{font:"Arial",tint:0}),this.setText(s,!1),e.addChild(this.bitmapText)};(V["gui.TextButton"]=Ks).__name__="gui.TextButton",Ks.__super__=ns,Ks.prototype=e(ns.prototype,{setText:function(t,e){null==e&&(e=!0),null!=t?this.text=t:t=this.text,this.bitmapText.set_text(t);t=Math.ceil(this.bitmapText.get_textWidth())+6;this.rect.width=t+this.extraWidth;t=Math.ceil(this.bitmapText.get_textHeight())+3;this.rect.height=t+this.extraHeight,this.buttonPatch.npWidth=this.rect.width,this.buttonPatch.npHeight=this.rect.height,e&&this.updateSize()},updatePosition:function(t){var e=this.rect;e.x=t.x,e.y=t.y;this.buttonPatch.position.set(t.x,t.y),this.buttonPatch.updateSprites(),this.bitmapText.position.set(t.x+3+(this.extraWidth/2|0),t.y+1+this.extraTextPosY),ns.prototype.updatePosition.call(this,t)},fillWidth:function(){this.extraWidth=this.parent.rect.width-this.rect.width-4,this.setText(this.text)},handleMouse:function(t){var e=this;return ns.prototype.doHandleMouse.call(this,t,function(){e.buttonPatch.setTextureSet(1)},function(){e.buttonPatch.setTextureSet(2)})},update:function(){this.mouseOut&&this.buttonPatch.setTextureSet(0),this.isActive()&&this.buttonPatch.setTextureSet(2),ns.prototype.update.call(this)},destroy:function(){ns.prototype.destroy.call(this),this.stage.removeChild(this.buttonPatch),this.stage.removeChild(this.bitmapText)},__class__:Ks});var Qs=function(t,e,i,n,s,r,o,a,l){null==l&&(l=!1),null==a&&(a=!1),null==o&&(o=250),null==s&&(s="Arial"),null==i&&(i="");var h,l=new Hn("",{font:s,tint:0},l);switch(l.set_maxWidth(o),l.set_text(i),this.textUpdateFunction=n,this.neverDecreaseSize=a,s){case"Arial":h={left:0,right:0,top:-2,bottom:2};break;case"Arial10":h={left:0,right:0,top:-3,bottom:3};break;case"Arial15":h={left:0,right:0,top:-3,bottom:2};break;case"Arial16":h={left:0,right:0,top:-2,bottom:4};break;default:h={left:0,right:0,top:-3,bottom:2}}r=null==r?h:{left:r.left+h.left,right:r.right+h.right,top:r.top+h.top,bottom:r.bottom+h.bottom},us.call(this,t,e,l,r)};(V["gui.TextElement"]=Qs).__name__="gui.TextElement",Qs.__super__=us,Qs.prototype=e(us.prototype,{get_textContainer:function(){return this.container},updateSize:function(){var t,e,i=this.rect.width-this.padding.left-this.padding.right,n=this.rect.height-this.padding.top-this.padding.bottom;e=""==this.get_textContainer().get_text()?t=0:(e=this.container,t=Math.round(e.get_textWidth()),Math.round(e.get_textHeight())),this.neverDecreaseSize?(this.rect.width=i<t?t:i,this.rect.height=n<e?e:n):(this.rect.width=t,this.rect.height=e),i==this.rect.width&&n==this.rect.height||us.prototype.afterSizeUpdate.call(this)},setTextAndTextUpdate:function(t,e){this.setText(t),this.textUpdateFunction=e},setText:function(t){var e=this.container;N.startsWith(t,"[red]")?(t=Y.substr(t,"[red]".length,null),e.set_tint(16711680)):N.startsWith(t,"[green]")?(t=Y.substr(t,"[green]".length,null),e.set_tint(65280)):e.set_tint(0),this.get_textContainer().set_text(t),this.updateSize()},update:function(){var t;null!=this.textUpdateFunction&&(t=this.textUpdateFunction(),this.get_textContainer().get_text()!=t&&this.setText(t))},__class__:Qs});var Js=function(t,e,i,n,s,r,o,a,l){null==l&&(l=12),null==a&&(a=!1),null==o&&(o=250),null==s&&(s="Arial"),null==i&&(i="");o=new PIXI.Text("",{fontFamily:s,fill:0,fontSize:2*l,wordWrap:!0,wordWrapWidth:2*o});o.text=i,o.scale.x=.5,o.scale.y=.5,o.roundPixels=!0,this.textUpdateFunction=n,this.neverDecreaseSize=a,null==r&&(r={left:0,right:0,top:-3,bottom:2}),us.call(this,t,e,o,r)};(V["gui.TextElementAlt"]=Js).__name__="gui.TextElementAlt",Js.__super__=us,Js.prototype=e(us.prototype,{get_textContainer:function(){return this.container},setText:function(t){var e=this.container;e.text=t,e.updateText(),e.updateTexture(),e.updateTransform(),this.updateSize()},update:function(){var t;null!=this.textUpdateFunction&&(t=this.textUpdateFunction(),this.get_textContainer().text!=t&&this.setText(t))},__class__:Js});var Zs=function(t,e,i,n,s){null==s&&(s=""),null==n&&(n=""),this.onInput=null;var r=this;this.parent=t,this.gui=e,this.game=i,this.rect=new xn(0,0,250,20),this.inputElement=window.document.createElement("input"),this.inputElement.type="text",this.inputElement.style.position="absolute",this.inputElement.style.left="10px",this.inputElement.style.top="10px",this.inputElement.style.fontFamily="Arial,sans-serif",this.inputElement.style.fontSize="20px",this.inputElement.value=s,this.inputElement.placeholder=n,window.document.body.appendChild(this.inputElement),this.inputElement.focus(),i.keyboard.inputs.push(this.inputElement),this.inputElement.addEventListener("input",function(){null!=r.onInput&&r.onInput(r.inputElement.value)})};(V["gui.TextInput"]=Zs).__name__="gui.TextInput",Zs.__interfaces__=[Kt],Zs.prototype={updateSize:function(){var t=""+Math.floor(this.rect.width*this.game.get_preDPIAdjustScaling()-6);this.inputElement.style.width=t+"px";t=""+Math.floor(10*this.game.get_preDPIAdjustScaling());this.inputElement.style.fontSize=t+"px";t=""+Math.floor(this.rect.height*this.game.get_preDPIAdjustScaling()-6);this.inputElement.style.height=t+"px"},updatePosition:function(t){var e=Math.floor(t.x*this.game.get_preDPIAdjustScaling());this.inputElement.style.left=e+"px";e=Math.floor(t.y*this.game.get_preDPIAdjustScaling());this.inputElement.style.top=e+"px",this.updateSize()},destroy:function(){this.inputElement.parentNode.removeChild(this.inputElement),Y.remove(this.game.keyboard.inputs,this.inputElement)},handleMouse:function(t){return!!this.rect.contains(t.position)},update:function(){},__class__:Zs};var tr=function(t,e,i){this.isContinousDisplay=!1,this.contentsSetLastStep=!1,this.timeBeforeShown=0,this.owner=null,this.emptyCost2=new M,this.emptyCost=new M,this.game=t,this.stage=i,this.bg=new Hs(H.getTexture("spr_9p_tooltip"),2,4,4),this.bg.position.set(0,0),i.addChild(this.bg),this.tooltipHeader=new Hn("",{font:"Arial16",tint:0}),this.tooltipHeader.position.set(2,0),i.addChild(this.tooltipHeader),this.tooltipText=new Hn("",{font:"Arial",tint:0}),this.tooltipText.position.set(3,0),i.addChild(this.tooltipText),this.tooltipCost=new Rs(e,this.emptyCost),this.tooltipCost.position.set(3,0),i.addChild(this.tooltipCost),this.tooltipCost2=new Rs(e,new M),this.tooltipCost2.position.set(3,0),this.tooltipCost2.setAfterKnowledgeText(""),i.addChild(this.tooltipCost2),this.tooltipCost2Text=new Hn("",{font:"Arial",tint:0}),this.tooltipCost2Text.position.set(3,0),i.addChild(this.tooltipCost2Text),this.tooltipExtraIcons=new Ws([]),i.addChild(this.tooltipExtraIcons),this.tooltipExtraIcons2=new Ws([]),this.tooltipExtraIcons2.position.set(2,0),i.addChild(this.tooltipExtraIcons2),this.tooltipPosition=new Cn(0,0),i.position.set(-100,-100),this.owner=null,this.timeBeforeShown=0,this.setTextDisplay("","")};(V["gui.Tooltip"]=tr).__name__="gui.Tooltip",tr.prototype={get_tooltipDelay:function(){return this.game.mouse.isTouch?30:0},update:function(t){if(!this.contentsSetLastStep)return this.setTextDisplay(),this.isContinousDisplay=!1,this.owner=null,void(this.timeBeforeShown=0);if(this.contentsSetLastStep=!1,0<this.timeBeforeShown){if(this.isContinousDisplay||this.setTextDisplay(),this.timeBeforeShown-=t,!this.isContinousDisplay)return}else if(""==this.text&&""==this.header)return;var e;this.isContinousDisplay?(this.tooltipPosition=new Cn(0,0),e=new PIXI.Point(0,0),this.stage.position=e,e=null==this.game.state||null==this.game.state.get_publicGUI().window,this.stage.visible=e):(this.stage.visible=!0,this.game.mouse.isTouch||(this.tooltipPosition=this.game.mouse.position),t=this.tooltipPosition,e=new PIXI.Point(t.x,t.y),this.stage.position=e,this.stage.position.y+=this.tooltipPosition.y>this.height?-this.height:21/this.game.scaling|0,this.stage.position.x+this.width>this.game.rect.width&&(this.stage.position.x-=this.width,this.stage.position.x<0&&(this.stage.position.x=0)))},setText:function(t,e,i,n,s,r,o,a){null==a&&(a=""),null==i&&(i=""),this.contentsSetLastStep=!0,this.owner==t&&!this.game.mouse.pressed||(this.owner=t,this.timeBeforeShown=this.get_tooltipDelay(),this.game.mouse.isTouch&&(this.tooltipPosition=this.game.mouse.position)),0<this.timeBeforeShown?this.game.mouse.isTouch&&!this.game.mouse.down&&(this.owner=null,this.contentsSetLastStep=!1):(this.game.mouse.isTouch&&this.game.mouse.claimMouse(this),this.isContinousDisplay&&this.game.mouse.isTouch&&(this.tooltipPosition=this.game.mouse.position),this.isContinousDisplay=!1,this.setTextDisplay(e,i,n,s,r,o,a))},setTextForContinuous:function(t,e,i,n,s,r,o){null==o&&(o=""),null==e&&(e=""),null==this.owner&&(this.contentsSetLastStep=!0,this.isContinousDisplay=!0,this.setTextDisplay(t,e,i,n,s,r,o),this.isContinousDisplay=!0)},setTextDisplay:function(t,e,i,n,s,r,o){null==o&&(o=""),null==e&&(e=""),null==t&&(t="");var a,l,h,u,d,c=0,p=c,g=0;(this.header!=e||this.text!=t||this.cost2Text!=o||(null!=i||this.tooltipCost.wouldChangeDisplay(this.emptyCost))&&this.tooltipCost.wouldChangeDisplay(i)||(null!=r||this.tooltipCost2.wouldChangeDisplay(this.emptyCost))&&this.tooltipCost2.wouldChangeDisplay(r)||(null!=n||this.tooltipExtraIcons.wouldChangeDisplay([]))&&this.tooltipExtraIcons.wouldChangeDisplay(n)||(null!=s||this.tooltipExtraIcons2.wouldChangeDisplay([]))&&this.tooltipExtraIcons2.wouldChangeDisplay(s))&&(a=Math.max(this.game.rect.width/2,Math.min(Math.max(this.tooltipPosition.x-10,this.game.rect.width-this.tooltipPosition.x-10),240)),this.isContinousDisplay&&(a=this.game.rect.width),this.header=e,this.text=t,this.costInfo=i,null!=n&&0<n.length&&this.tooltipExtraIcons.setDisplay(n),this.width=0,!this.isContinousDisplay||""==this.header&&""==this.text||(this.width=Math.ceil(a)),""!=e?(p=c,--c,l=a-this.tooltipExtraIcons.displayWidth-10,h=this.isContinousDisplay?1e3:350,this.tooltipHeader.set_maxWidth(l<100?100:h<l?h:l),this.tooltipHeader.set_text(e),g=Math.ceil(this.tooltipHeader.get_textWidth())+6,u=this.width,this.width=u<g?g:u,c+=Math.ceil(this.tooltipHeader.get_textHeight())+2):this.tooltipHeader.set_text(""),""!=t?(++c,l=a-10,h=this.isContinousDisplay?1e3:350,this.tooltipText.set_maxWidth(l<100?100:h<l?h:l),this.tooltipText.set_text(t),this.tooltipText.position.y=c,u=this.width,d=Math.ceil(this.tooltipText.get_textWidth())+6,this.width=u<d?d:u,c+=Math.ceil(this.tooltipText.get_textHeight())):this.tooltipText.set_text(""),null!=s&&0<s.length?(this.tooltipExtraIcons2.setDisplay(s),this.tooltipExtraIcons2.position.y=c+1,u=this.width,d=Math.ceil(this.tooltipExtraIcons2.displayWidth)+6,this.width=u<d?d:u,c+=12):this.tooltipExtraIcons2.setDisplay([]),null!=i&&i.any()?(c+=2,this.tooltipCost.position.y=c,this.tooltipCost.displayCityAmounts=this.game.isMobile&&!this.game.isLargeMobile&&this.isContinousDisplay,this.tooltipCost.maxDisplayWidth=this.game.rect.width,this.tooltipCost.setCost(i),u=this.width,d=this.tooltipCost.displayWidth+6-6,this.width=u<d?d:u,c+=11):this.tooltipCost.setCost(this.emptyCost),null!=r&&r.any()?(i=3,this.tooltipCost2Text.set_text(o),this.tooltipCost2Text.position.y=c,""!=o&&(i+=Math.ceil(this.tooltipCost2Text.get_textWidth())+3),c+=2,this.tooltipCost2.position.x=i,this.tooltipCost2.position.y=c,this.tooltipCost2.maxDisplayWidth=this.game.rect.width-i,this.tooltipCost2.setCost(r),u=this.width,d=this.tooltipCost2.displayWidth+6-6+i,this.width=u<d?d:u,c+=11):(this.tooltipCost2Text.set_text(""),this.tooltipCost2.setCost(this.emptyCost2)),null!=n&&0<n.length?(u=this.width,d=g+this.tooltipExtraIcons.displayWidth,this.width=u<d?d:u,this.tooltipExtraIcons.position.x=this.width-1-this.tooltipExtraIcons.displayWidth,this.tooltipExtraIcons.position.y=p+3):this.tooltipExtraIcons.setDisplay([]),c+=2,this.height=c,this.bg.npWidth=this.width,this.bg.npHeight=this.height,this.bg.updateSprites())},shown:function(){return""!=this.text||""!=this.header},__class__:tr};var er=function(t,e,i,n,s,r){null==r&&(r=600),this.fadeout=1,this.game=t,this.gui=e,this.stage=new PIXI.Container,this.outerStage=i,this.outerStage.addChild(this.stage),this.bg=new Hs(H.getTexture("spr_9p_tooltip"),2,4,4),this.bg.position.set(0,0),this.stage.addChild(this.bg),this.tooltipHeader=new Hn("",{font:"Arial16",tint:0}),this.tooltipHeader.position.set(2,0),this.stage.addChild(this.tooltipHeader),this.tooltipText=new Hn("",{font:"Arial",tint:0}),this.tooltipText.position.set(3,0),this.stage.addChild(this.tooltipText),this.tooltipPosition=new Cn(0,0),this.stage.position.set(0,0),this.setTextDisplay(n,s),this.displayTime=r};(V["gui.TopScreenNotification"]=er).__name__="gui.TopScreenNotification",er.prototype={update:function(t){if(this.displayTime<0)return this.fadeout-=.05*t,this.stage.alpha=this.fadeout,void(this.fadeout<0&&(this.stage.destroy(),Y.remove(this.gui.notifications,this)));this.displayTime-=t},setTextDisplay:function(t,e){null==e&&(e=""),null==t&&(t="");var i,n,s=0;this.header==e&&this.text==t||(i=this.game.rect.width,this.header=e,this.text=t,this.width=0,""==this.header&&""==this.text||(this.width=Math.ceil(i)),""!=e?(--s,n=i-10,this.tooltipHeader.set_maxWidth(n<100?100:1e3<n?1e3:n),this.tooltipHeader.set_text(e),Math.ceil(this.tooltipHeader.get_textWidth()),s+=Math.ceil(this.tooltipHeader.get_textHeight())+2):this.tooltipHeader.set_text(""),""!=t?(++s,n=i-10,this.tooltipText.set_maxWidth(n<100?100:1e3<n?1e3:n),this.tooltipText.set_text(t),this.tooltipText.position.y=s,s+=Math.ceil(this.tooltipText.get_textHeight())):this.tooltipText.set_text(""),s+=2,this.height=s,this.bg.npWidth=this.width,this.bg.npHeight=this.height,this.bg.updateSprites())},__class__:er};var ir=function(){};(V["gui.UpgradeWindowParts"]=ir).__name__="gui.UpgradeWindowParts",ir.createActivatableButton=function(t,e,i,n,s,r,o,a,l){null==l&&(l=!1),null==o&&(o="spr_9p_button_active"),null==r&&(r=t.windowInner);var h,u=null;e?(h=new ds(t,t.innerWindowStage,r,null,null,null,new Hs(H.getTexture(o),1,3,3)),r.addChild(h)):(h=(d=new ls(t,t.innerWindowStage,r,i)).container,r.addChild(d),null!=a&&(d.buttonSound=a),u=d),h.padding.top=3,h.padding.left=3,h.padding.right=3,h.padding.bottom=1,h.fillSecondarySize=!0,h.direction=vs.Vertical;var d=h.addChild(new Qs(h,t.innerWindowStage,n)),n=null;return""!=s&&(n=l?h.addChild(new Js(h,t.innerWindowStage,s,null,"Arial",null,250,null,10)):h.addChild(new Qs(h,t.innerWindowStage,s,null,"Arial10"))),r.addChild(new Cs(r,new Cn(2,2))),{container:h,titleText:d,description:n,button:u}},ir.createCheckboxButton=function(t,i,e,n,s,r,o,a){null==o&&(o="spr_9p_button_active"),null==r&&(r=t.windowInner);var l,o=new rs(t,t.innerWindowStage,r,e,i),e=o.container;r.addChild(o),null!=a&&(o.buttonSound=a),l=o,e.padding.top=3,e.padding.left=3,e.padding.right=3,e.padding.bottom=1,e.fillSecondarySize=!0,e.direction=vs.Vertical;a=new ds(t,t.innerWindowStage,e);a.direction=vs.Horizontal;var h=H.getTextures("spr_checkbox",2),u=new PIXI.Sprite(h[1]),o=new us(a,t.innerWindowStage,u,{left:0,right:3,top:0,bottom:0},function(){var t=h,e=i()?0:1;u.texture=t[e]});a.addChild(o);n=new Qs(a,t.innerWindowStage,n);a.addChild(n),e.addChild(a);s=e.addChild(new Qs(e,t.innerWindowStage,s,null,"Arial10"));return r.addChild(new Cs(r,new Cn(2,2))),{container:e,titleText:n,description:s,button:l}},ir.createHeader=function(t,e,i){null==i&&(i=t.windowInner);var n=new ds(t,t.innerWindowStage,i);return n.fillSecondarySize=!0,n.addChild(new Qs(n,t.innerWindowStage,e,null,"Arial15",{left:0,right:0,top:3,bottom:0})),n.addChild(new Ps(n,2)),i.addChild(n),i.addChild(new Cs(i,new Cn(2,2))),n},ir.addOneAndMaxButtons=function(t,e,i,n,s,r,o,a){var l=new Ks(t,t.innerWindowStage,e,i,kn.lo("one"),function(){return!ir.hasMultiUpgradeModeOn},function(){t.tooltip.setText(l,s)});e.addChild(l),e.addChild(new Cs(e,new Cn(2,2)));var h=new Ks(t,t.innerWindowStage,e,n,a?kn.lo("max"):kn.lo("all"),function(){return ir.hasMultiUpgradeModeOn},function(){t.tooltip.setText(h,(a?r:o)())});e.addChild(h)};var nr=x["gui.WindowPosition"]={__ename__:"gui.WindowPosition",__constructs__:["Top","Center","CenterOffset","TopLeft","CenterWithBanner"],Top:{_hx_index:0,__enum__:"gui.WindowPosition",toString:i},Center:{_hx_index:1,__enum__:"gui.WindowPosition",toString:i},CenterOffset:((B=function(t){return{_hx_index:2,offsetToTop:t,__enum__:"gui.WindowPosition",toString:i}}).__params__=["offsetToTop"],B),TopLeft:{_hx_index:3,__enum__:"gui.WindowPosition",toString:i},CenterWithBanner:{_hx_index:4,__enum__:"gui.WindowPosition",toString:i}},sr=function(){};(V["gui.WorkerDistributionWindow"]=sr).__name__="gui.WorkerDistributionWindow",sr.create=function(t,e,i,n){sr.createWindow(t,e,i,n)},sr.createWindow=function(s,t,e,i){t.windowAllowBanner(),i.clear(),t.windowAddTitleText(kn.lo("assign_workers"),null,H.getTexture("spr_work"));for(var n=[],r=[],o=0,a=s.permanents;o<a.length;){var l=a[o];++o,l.is(Jt)&&(l=Fr.getClass(l),-1==(b=n.indexOf(l))&&(b=n.length,n.push(l),l=l.__name__.split("."),r.push(l[l.length-1])))}for(var h=[],o=0,a=s.progress.resources.buildingInfoArray;o<a.length;){var u=a[o];++o,-1!=(b=r.indexOf(u.className))&&h.push(n[b])}var d=[],c=function(){d=[];for(var t=0;t<h.length;){h[t];++t,d.push({number:0,filledJobs:0,jobs:0})}for(var t=0,e=s.permanents;t<e.length;){var i,n=e[t];++t,n.is(Jt)&&(i=n,n=Fr.getClass(n),-1!=(n=h.indexOf(n))&&((n=d[n]).jobs+=i.get_jobs(),n.filledJobs+=i.workers.length,n.number+=1))}};c(),i.onUpdate=c;var p={left:2,top:5,bottom:0,right:0},c=new ds(t,e,i),g=new ds(t,e,c),m=new ds(t,e,c),f=new ds(t,e,c);g.direction=vs.Vertical,m.direction=vs.Vertical,f.direction=vs.Vertical;for(o=0,a=h.length;o<a;){var y,_,w,b=[o++],v=[h[b[0]]],S=[v[0].__name__];"cityofthekey"==s.progress.story.storyName&&"buildings.SecretSocietyHouse"==S[0]||(y=d[b[0]],(_=new ds(t,e,g)).addChild(is.create(e,s,v[0],_,t)),(w=new ds(t,e,_,null,null,null,null,p)).addChild(new Qs(w,e,"x"+y.number+": ")),_.addChild(w),g.addChild(_),(w=new ds(t,e,m,null,null,null,null,p)).minHeight=15,w.addChild(new Qs(w,e,null,function(t){return function(){return kn.lo("workers",[d[t[0]].filledJobs,d[t[0]].jobs])+","}}(b))),m.addChild(w),(_=new ds(t,e,f,null,null,null,null,{left:4,top:2,bottom:0,right:0})).minHeight=18,null==(w=s.simulation.jobAssigner.priorityJobs.h[S[0]])&&(w=0),(v=new Ns(t,e,_,null,function(){return 0},function(t){return function(){return d[t[0]].jobs}}(b),w,function(i,n){return function(t){var e=s.simulation.jobAssigner.priorityJobs.h[i[0]];t<e&&s.simulation.jobAssigner.availableClassesForJob.push({classType:$.getClassID(n[0].__name__),number:e-t}),s.simulation.jobAssigner.priorityJobs.h[i[0]]=t,s.simulation.jobAssigner.buildingsHaveWork=!0}}(S,v),function(t){return function(){return s.game.keyboard.down[16]?0:s.game.keyboard.down[17]?1e6:d[t[0]].filledJobs}}(b),s.game.isMobile?kn.lo("set_priority_jobs_mobi"):kn.lo("set_priority_jobs_desktop"))).enableBeyondHighestValuePossibility(1e6,"Max"),_.addChild(v),"buildings.StoneMine"==S[0]?(sr.tutorialStoneMineUpButton=v.upButton,sr.tutorialStoneMineDownButton=v.downButton):"buildings.WoodcuttingCentre"==S[0]&&(sr.tutorialWoodCuttersUpButton=v.upButton),_.addChild(new Qs(_,e," "+kn.lo("priority")+".",null,null,{left:0,top:3,bottom:0,right:0})),f.addChild(_))}0==h.length&&t.windowAddInfoText(kn.lo("no_work_buildings")),c.addChild(g),c.addChild(m),c.addChild(f),i.addChild(c);function x(){sr.createWindow(P,C,I,T)}var o=fa(B=s.gui,B.reloadWindow),P=s,C=t,I=e,T=i;s.windowRelatedOnBuildOrDestroy=function(){o(x)},i.onDestroy=function(){s.windowRelatedOnBuildOrDestroy=null,sr.tutorialStoneMineUpButton=null,sr.tutorialStoneMineDownButton=null,sr.tutorialWoodCuttersUpButton=null},t.windowAddBottomButtons()};var rr=function(){};(V["gui.infoWindows.FindBuildingsOfType"]=rr).__name__="gui.infoWindows.FindBuildingsOfType",rr.createWindow=function(n,t){null==t&&(t=!0),t&&n.gui.clearWindowStack(),n.gui.createWindow("highlight_buildings");var e=n,i=t,s=function(){rr.createWindow(e,i)};n.gui.setWindowReload(s);function r(){rr.createWindow(a,l)}var o=fa(B=n.gui,B.reloadWindow),a=n,l=t,s=function(){o(r)};n.windowRelatedOnBuildOrDestroy=s,n.gui.window.onDestroy=function(){n.windowRelatedOnBuildOrDestroy=null};var h=n,u=t,s=function(){rr.createWindow(h,u)};n.gui.addWindowToStack(s);s=kn.lo("highlight_buildings");n.gui.windowAddTitleText(s);for(var d=!0,c=0,p=H.buildingCategoriesInfo;c<p.length;){var g=p[c];++c;var m=new Cs(n.gui.windowInner,new Cn(2,d?0:6));n.gui.windowInner.addChild(m);var f=n.gui.windowAddInfoText(kn.lo("categories/"+g.name+".name"),null,"Arial15"),y=new ds(n.gui,n.gui.innerWindowStage,n.gui.windowInner);y.direction=vs.Horizontal,n.gui.windowInner.addChild(y);for(var _=!0,w=0,b=0,v=n.progress.resources.buildingInfoArray;b<v.length;){var S=[v[b]];++b;var x="buildings."+S[0].className,P=[V[x]],C=n.progress.unlocks.getUnlockState(P[0]),I=D.field(P[0],"spriteName"),x=null!=S[0].showUnlockHint&&C==mo.Unlocked;S[0].category!=g.name||(C!=mo.Unlocked||x)&&C!=mo.Researched&&C!=mo.Createable||((C=[])[0]=new Fs(n.gui,n.gui.innerWindowStage,n.gui.windowInner,function(t,e){return function(){or.createWindow(n,t[0],e[0],!1),Zi.doHighlight(n,t[0])}}(P,S),H.getTexture(I+"@0,0,20,20"),function(){return!1},function(t,e,i){return function(){n.gui.tooltip.setText(t[0],i[0].name),Zi.doHighlight(n,e[0])}}(C,P,S),H.getTexture(null==S[0].buttonBack?I+"@44,0,20,20":S[0].buttonBack)),y.addChild(C[0]),_=!1,8<++w&&((y=new ds(n.gui,n.gui.innerWindowStage,n.gui.windowInner)).direction=vs.Horizontal,n.gui.windowInner.addChild(y),w=0))}_?(n.gui.windowInner.removeChild(m,!1),m.destroy(),n.gui.windowInner.removeChild(y,!1),y.destroy(),n.gui.windowInner.removeChild(f,!0),f.destroy()):d=!1}s=new Cs(n.gui.windowInner,new Cn(2,6));n.gui.windowInner.addChild(s),n.gui.windowAddBottomButtons()};var or=function(){};(V["gui.infoWindows.FindBuildingsOfTypeActive"]=or).__name__="gui.infoWindows.FindBuildingsOfTypeActive",or.createWindow=function(e,i,t,n){null==n&&(n=!0),n&&e.gui.clearWindowStack(),e.gui.createWindow(i),e.gui.setWindowPositioning(e.game.isMobile?nr.TopLeft:nr.Top);var s=e,r=i,o=t,a=n,l=function(){or.createWindow(s,r,o,a)};e.gui.setWindowReload(l);var h=e,u=i,d=t,c=n,l=function(){or.createWindow(h,u,d,c)};e.gui.addWindowToStack(l);t=kn.lo("highlighting",[t.name]);e.gui.windowAddTitleText(t);e.gui.windowAddBottomButtons([{text:kn.lo("select_any"),action:function(){var t=Zi.findLeastUpgraded(e,i);null!=t&&t.showWindow()}}]);e.gui.windowOnLateUpdate=function(){Zi.doHighlight(e,i)}};var ar=function(){};(V["gui.infoWindows.InvitePeopleWindow"]=ar).__name__="gui.infoWindows.InvitePeopleWindow",ar.createWindow=function(e,t){null==t&&(t=!0);function i(){return vn.isum(e.simulation.citizenSpawners,function(t){return t.spawn.amount})}function n(){return 500<e.simulation.citizens.length+i()?new M(0,0,10*(1+((e.simulation.citizens.length+i())/10|0)),0,0,10*(((e.simulation.citizens.length+i())/50|0)-8)):new M(0,0,10*Math.max(1,((e.simulation.citizens.length+i())/10|0)-5))}t&&e.gui.clearWindowStack(),e.gui.createWindow("invite_people");var s=e,r=t,o=function(){ar.createWindow(s,r)};e.gui.setWindowReload(o);var a=e,l=t,o=function(){ar.createWindow(a,l)};e.gui.addWindowToStack(o);o=kn.lo("invite_people");e.gui.windowAddTitleText(o);var h,u=" ",d=e.simulation.citizens.length+i()<1900;e.gui.windowAddInfoText(null,function(){return d&&1900<=e.simulation.citizens.length+i()?(e.gui.reloadWindow(),""):d?kn.lo("invite_people_description",[10]):kn.lo("invite_people_done")}),d&&((h=new Rs(e,new M(0,0,10),"")).displayCityAmounts=!0,e.game.isMobile&&(h.maxDisplayWidth=e.game.rect.width-10),e.gui.windowInner.addChild(new us(e.gui.windowInner,e.gui.innerWindowStage,h,{left:0,right:0,top:0,bottom:2},function(){h.setCost(n())})),dr.create(e.gui,function(){var t=n();e.materials.canAfford(t)?e.simulation.stats.houseCapacity>=e.simulation.citizens.length+i()+10?(u=kn.lo("invite_people_success",[10]),e.materials.remove(t),e.progress.story.justInvitedPeople=!0,t=vn.min(e.worlds,function(t){return t.rect.y+1e-5*t.rect.x}),e.simulation.citizenSpawners.push(new Go(e.simulation,e.farForegroundStage,t,{time:0,type:"SpawnCitizensFlyingSaucer",amount:10,ageRangeMin:18,ageRangeMax:22,world:e.worlds.indexOf(t)}))):u=kn.lo("invite_not_enough_houses"):u=kn.lo("cant_afford")},e.gui.windowInner,function(){return kn.lo("invite_people")},e.gui.innerWindowStage),o=new Cs(e.gui.windowInner,new Cn(2,4)),e.gui.windowInner.addChild(o),e.gui.windowAddInfoText(null,function(){return u}),o=new Cs(e.gui.windowInner,new Cn(2,6)),e.gui.windowInner.addChild(o)),e.gui.windowAddBottomButtons()};var lr=function(){};(V["gui.infoWindows.MaterialInfoWindow"]=lr).__name__="gui.infoWindows.MaterialInfoWindow",lr.create=function(t,e,i,n,s,r){lr.createWindow(t,e,i,n,s,r)},lr.createWindow=function(t,e,i,n,b,s){if(n.clear(),e.windowAddTitleText(s+"",null,H.getTexture("spr_resource_"+b.toLowerCase())),"stone"==b){for(var r=[],o=0,a=t.connections.numberOfWorldGroups;o<a;){var l=o++;r.push(!1)}for(var h=r,r=[],o=0,a=t.connections.numberOfWorldGroups;o<a;){l=o++;r.push(!1)}for(var u=r,r=[],o=0,a=t.connections.numberOfWorldGroups;o<a;){l=o++;r.push(!1)}for(var d=r,r=0,o=t.simulation.citizens;r<o.length;){var c=o[r];++r,null!=c.onWorld&&(h[c.onWorld.worldGroup]=!0)}for(r=0,o=t.worlds;r<o.length;){var p=o[r];++r,vn.any(p.permanents,function(t){return vn.any(t,function(t){return null!=t&&t.is(Bi)})})&&(u[p.worldGroup]=!0),vn.any(p.permanents,function(t){return vn.any(t,function(t){return null!=t&&(!!t.is(da)||t.is(Mi))})})&&(d[p.worldGroup]=!0)}for(var g=!0,m=!1,r=0,o=t.connections.numberOfWorldGroups;r<o;)h[l=r++]&&d[l]&&(g=!1),u[l]&&(m=!0);g&&m&&0<t.simulation.citizens.length&&e.windowAddInfoText(kn.lo("stone_warning"));var f=tt.count(t.permanents,function(t){return t.is(Bi)}),y=tt.count(t.permanents,function(t){return t.is(Mi)});12<=y&&(f<=5||f/y<.3)&&e.windowAddInfoText(kn.lo("mines_warning"))}var f=new PIXI.Container,v=new PIXI.Graphics,S=new PIXI.Container,x=t.simulation.stats,P=null,y=function(){v.clear(),v.beginFill(16711680,0),v.drawRect(0,0,1,1),v.endFill();var t=z.findMaterialIndex(b),e=x.materialProduction[t],i=x.materialUsed[t],n=!1,s=Math.max(9,e[0]);s=Math.max(s,i[0]),0<i[0]&&(n=!0),s=Math.max(s,e[1]),s=Math.max(s,i[1]),0<i[1]&&(n=!0),s=Math.max(s,e[2]),s=Math.max(s,i[2]),0<i[2]&&(n=!0),s=Math.max(s,e[3]),s=Math.max(s,i[3]),0<i[3]&&(n=!0),s=Math.max(s,e[4]),s=Math.max(s,i[4]),0<i[4]&&(n=!0),s=Math.max(s,e[5]),s=Math.max(s,i[5]),0<i[5]&&(n=!0),s=Math.max(s,e[6]),s=Math.max(s,i[6]),0<i[6]&&(n=!0);t=Math.floor(Math.log(s)/Math.log(10)),t=Math.floor(Math.pow(10,t));(Math.ceil(s)/t|0)<2?t=t/5|0:(Math.ceil(s)/t|0)<4&&(t=t/2|0);for(var s=Math.floor(s/t)*t+t,r=100/s,t=1+(s/t|0),o=179,a=0,l=7;a<l;){var h=r*e[p=a++],u=r*i[p];n?(v.beginFill(16711680),v.drawRect(o,105-u,9,u),v.endFill(),o-=9,v.beginFill(255),v.drawRect(o,105-h,9,h)):(o-=9,v.beginFill(255),v.drawRect(o,105-h,18,h)),v.endFill(),o-=13}var d=o+9+4-2;v.beginFill(0,1),v.drawRect(d-1,0,1,105),v.drawRect(d-1,105,188-d+3,1),S.removeChildren();for(var c=Math.floor(s/(t-1)),a=0,l=t;a<l;){var p=a++;(f=new Hn(""+zn.largeNumberFormatAlt(Math,c*p),{font:"Arial10",tint:0})).get_anchor().set(1,.5);var g=105-r*c*p;f.position.set(d-5,g),v.drawRect(d-3,g,2,1),S.addChild(f)}for(var o=188,m=0,a=0,l=7;a<l;){var f,y="";switch(p=a++){case 0:y=kn.lo("today");break;case 1:y=kn.lo("yesterday");break;default:y=kn.lo("n_days_ago",[p])}(f=new Hn(y,{font:"Arial10",tint:0})).get_anchor().set(0,.5),f.rotation=Math.PI/2,f.position.set(o-9,109),S.addChild(f),o-=22;var _=Math.ceil(f.position.y+f.get_textWidth());m<_&&(m=_)}v.endFill();var w=m+5,o=0,t=function(t,e){t=new Hn(t,{font:"Arial10",tint:0});188<o+13+Math.ceil(t.width)&&(o=0,w+=13),v.beginFill(e,1),v.drawRect(o,w,10,10),o+=13,t.position.set(o,w),o+=Math.ceil(t.width)+3,S.addChild(t),v.endFill()};t(kn.lo("production"),255),n&&(w+=13,o=0,t(kn.lo("usage"),16711680)),null!=P&&P.updateSize()};y(),f.addChild(v),f.addChild(S),P=new us(n,i,f,{left:0,right:0,top:0,bottom:3},y,function(t){return!1}),n.addChild(P);new Hn("0-10",{font:"Arial10",tint:0}),new Hn("10-20",{font:"Arial10",tint:0}),new Hn("20-30",{font:"Arial10",tint:0}),new Hn("30-40",{font:"Arial10",tint:0}),new Hn("40-50",{font:"Arial10",tint:0}),new Hn("50-60",{font:"Arial10",tint:0}),new Hn("60-70",{font:"Arial10",tint:0});n.onDestroy=function(){v.destroy()},"food"==b&&e.windowInner.addChild(new Qs(e.windowInner,e.innerWindowStage,"",function(){return t.simulation.eating.getFoodText()},"Arial",null,178,!0)),e.windowAddBottomButtons()};var hr=function(){};(V["gui.infoWindows.StoreInfo"]=hr).__name__="gui.infoWindows.StoreInfo",hr.createWindow=function(t){window.CordovaStore||(window.CordovaStore={},window.CordovaStore.isAvailable=function(){return!1});var e=new PIXI.Graphics;e.beginFill(2626656),e.drawRect(0,0,t.game.rect.width+10,t.game.rect.height+10),e.endFill(),t.stage.addChild(e),t.createWindow("get_premium"),t instanceof os&&t.pauseForWindow();var i=t;t.setWindowReload(function(){hr.createWindow(i)});var n=t;t.addWindowToStack(function(){hr.createWindow(n)}),t.windowReloadOnResize=!0,t.windowCapturesAllInput=!0,t.windowOnDestroy=function(){null!=e&&(e.destroy(),e=null)},t.windowAddTitleText(kn.lo("store"));t.windowInner.addChild(new Cs(t.windowInner,new Cn(250,1))),t.windowInner.addChild(new Qs(t.windowInner,t.innerWindowStage,kn.lo("store_description"),null,null,null,250,!0)),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,2))),CordovaStore.isAvailable()?k.hasPremium()?t.windowInner.addChild(new Qs(t.windowInner,t.innerWindowStage,kn.lo("already_has_premium"),null,null,null,250,!0)):Or.hasSpecific("remove_ads")&&!k.hasPremium()?(hr.createVersionUpgradeButton(t,t.windowInner,"premium_upgrade",kn.lo("premium_upgrade"),[kn.lo("premium_advantage_1"),kn.lo("premium_advantage_2"),kn.lo("premium_advantage_3"),kn.lo("premium_advantage_5")]),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6))),t.windowInner.addChild(new Qs(t.windowInner,t.innerWindowStage,kn.lo("removed_ads_already"),null,null,null,250,!0))):(hr.createVersionUpgradeButton(t,t.windowInner,"premium",kn.lo("get_premium_edition"),[kn.lo("premium_advantage_1"),kn.lo("premium_advantage_3"),kn.lo("premium_advantage_2"),kn.lo("premium_advantage_4"),kn.lo("premium_advantage_5")]),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6))),hr.createVersionUpgradeButton(t,t.windowInner,"remove_ads",kn.lo("remove_ads"),[kn.lo("remove_ads_1"),kn.lo("remove_ads_2")]),t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,6)))):t.windowInner.addChild(new Qs(t.windowInner,t.innerWindowStage,kn.lo("store_not_available"),null,null,null,250,!0)),t.windowAddBottomButtons()},hr.createVersionUpgradeButton=function(n,t,s,e,i){function r(){if(!CordovaStore.isAvailable())return!1;var t=CordovaStore.getProductInfo(s);return null!=t&&t.owned}var o=new ls(n,n.innerWindowStage,t,function(){var t,e,i;r()||(t=null,t=function(){n.showSimpleWindow(kn.lo("purchase_failed"),null,!0)},i=null,i=function(){n.showSimpleWindow(kn.lo("purchase_processing"),null,!0)},CordovaStore.isAvailable()?null!=(e=CordovaStore.getProductInfo(s))&&e.canPurchase?CordovaStore.purchase(s):null==e||!e.deferred&&"initiated"!=e.state?(t(),n.addWindowToStack(t)):i():(t(),n.addWindowToStack(t)))},r),a=o.container;a.padding.top=3,a.padding.left=3,a.padding.right=3,a.padding.bottom=1,a.fillSecondarySize=!0,a.direction=vs.Vertical,t.addChild(o);o=new ds(n,n.innerWindowStage,a);o.fillSecondarySize=!0,o.addChild(new Qs(o,n.innerWindowStage,e,null,"Arial16")),o.addChild(new Ps(o)),o.addChild(new Js(o,n.innerWindowStage,null,function(){if(!CordovaStore.isAvailable())return kn.lo("n/a");var t=CordovaStore.getProductInfo(s);return null==t?"":t.owned?kn.lo("purchased"):t.deferred||"initiated"==t.state?"...":t.valid?t.price:""},"Arial",{top:-2,bottom:0,right:0,left:0},200,null,14)),a.addChild(o),a.addChild(new Qs(a,n.innerWindowStage,"- "+i.join("\n- ")))};var ur=function(){};(V["gui.windowParts.CycleValueButton"]=ur).__name__="gui.windowParts.CycleValueButton",ur.create=function(t,e,i,n,s,r,o){null==o&&(o=1),null==s&&(s=""),null==r&&(r=function(){return s});r=dr.create(t,function(){var t=e();(t+=o)>=n()?i(t%o):i(t)},t.windowInner,r,t.innerWindowStage);return t.windowInner.addChild(new Cs(t.windowInner,new Cn(2,4))),r};var dr=function(){};(V["gui.windowParts.FullSizeTextButton"]=dr).__name__="gui.windowParts.FullSizeTextButton",dr.create=function(t,e,i,n,s){var r=new ls(t,s,i,e),e=r.container;i.addChild(r),e.padding.top=3,e.padding.left=3,e.padding.right=3,e.padding.bottom=0,e.fillSecondarySize=!0,e.direction=vs.Vertical;t=new ds(t,s,e);return t.alignment=Ss.Center,e.addChild(t),t.addChild(new Qs(t,s,null,function(){return n()})),r.buttonPatch.updateSprites(!0),r},Kt=function(){},(V["haxe.IMap"]=Kt).__name__="haxe.IMap",Kt.__isInterface__=!0;var cr=function(t,e,i){Error.call(this,t),this.message=t,this.__previousException=e,this.__nativeException=null!=i?i:this};(V["haxe.Exception"]=cr).__name__="haxe.Exception",cr.caught=function(t){return t instanceof cr?t:t instanceof Error?new cr(t.message,null,t):new wr(t,null,t)},cr.thrown=function(t){return t instanceof cr?t.get_native():t instanceof Error?t:new wr(t)},cr.__super__=Error,cr.prototype=e(Error.prototype,{get_native:function(){return this.__nativeException},__class__:cr});var pr={ucompare:function(t,e){return t<0?e<0?~e-~t|0:1:e<0?-1:t-e|0}},gr={divMod:function(t,e){if(0==e.high)switch(e.low){case 0:throw cr.thrown("divide by zero");case 1:return{quotient:new mr(t.high,t.low),modulus:new mr(0,0)}}var i,n=t.high<0!=e.high<0;i=t.high<0?(u=~t.high,0==(d=1+~t.low|0)&&(u++,u|=0),new mr(u,d)):new mr(t.high,t.low),e.high<0&&(u=~e.high,0==(d=1+~e.low|0)&&(u++,u|=0),e=new mr(u,d));for(var s=new mr(0,0),r=new mr(0,1);!(e.high<0);){var o=0!=(h=pr.ucompare(e.high,i.high))?h:pr.ucompare(e.low,i.low),a=1;e=0==(a&=63)?new mr(e.high,e.low):a<32?new mr(e.high<<a|e.low>>>32-a,e.low<<a):new mr(e.low<<a-32,0);var l=1;if(r=0==(l&=63)?new mr(r.high,r.low):l<32?new mr(r.high<<l|r.low>>>32-l,r.low<<l):new mr(r.low<<l-32,0),0<=o)break}for(;;){var h,u,d;if(0==r.high&&0==r.low)break;0<=(0!=(h=pr.ucompare(i.high,e.high))?h:pr.ucompare(i.low,e.low))&&(s=new mr(s.high|r.high,s.low|r.low),u=i.high-e.high|0,d=i.low-e.low|0,pr.ucompare(i.low,e.low)<0&&(u--,u|=0),i=new mr(u,d));a=1;r=0==(a&=63)?new mr(r.high,r.low):a<32?new mr(r.high>>>a,r.high<<32-a|r.low>>>a):new mr(0,r.high>>>a-32);l=1;e=0==(l&=63)?new mr(e.high,e.low):l<32?new mr(e.high>>>l,e.high<<32-l|e.low>>>l):new mr(0,e.high>>>l-32)}return n&&(u=~s.high,0==(d=1+~s.low|0)&&(u++,u|=0),s=new mr(u,d)),t.high<0&&(u=~i.high,0==(d=1+~i.low|0)&&(u++,u|=0),i=new mr(u,d)),{quotient:s,modulus:i}}},mr=function(t,e){this.high=t,this.low=e};(V["haxe._Int64.___Int64"]=mr).__name__="haxe._Int64.___Int64",mr.prototype={__class__:mr};var fr=function(){this.buf=new U,this.cache=[],this.useCache=fr.USE_CACHE,this.useEnumIndex=fr.USE_ENUM_INDEX,this.shash=new zr,this.scount=0};function yr(){}(V["haxe.Serializer"]=fr).__name__="haxe.Serializer",fr.run=function(t){var e=new fr;return e.serialize(t),e.toString()},fr.prototype={toString:function(){return this.buf.b},serializeString:function(t){var e=this.shash.h[t];if(null!=e)return this.buf.b+="R",void(this.buf.b+=null==e?"null":""+e);this.shash.h[t]=this.scount++,this.buf.b+="y",t=encodeURIComponent(t),this.buf.b+=q.string(t.length),this.buf.b+=":",this.buf.b+=null==t?"null":""+t},serializeRef:function(t){for(var e=typeof t,i=0,n=this.cache.length;i<n;){var s=i++,r=this.cache[s];if(typeof r==e&&r==t)return this.buf.b+="r",this.buf.b+=null==s?"null":""+s,!0}return this.cache.push(t),!1},serializeFields:function(t){for(var e=0,i=D.fields(t);e<i.length;){var n=i[e];++e,this.serializeString(n),this.serialize(D.field(t,n))}this.buf.b+="g"},serialize:function(t){switch((v=X.typeof(t))._hx_index){case 0:this.buf.b+="n";break;case 1:if(0==(e=t))return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==e?"null":""+e;break;case 2:var e=t;isNaN(e)?this.buf.b+="k":isFinite(e)?(this.buf.b+="d",this.buf.b+=null==e?"null":""+e):this.buf.b+=e<0?"m":"p";break;case 3:this.buf.b+=t?"t":"f";break;case 4:if(Fr.__instanceof(t,va)){var i=t.__name__;this.buf.b+="A",this.serializeString(i)}else if(Fr.__instanceof(t,Sa))this.buf.b+="B",this.serializeString(t.__ename__);else{if(this.useCache&&this.serializeRef(t))return;this.buf.b+="o",this.serializeFields(t)}break;case 5:throw cr.thrown("Cannot serialize function");case 6:var n=v.c;if(n==String)return void this.serializeString(t);if(this.useCache&&this.serializeRef(t))return;switch(n){case Array:var s=0;this.buf.b+="a";for(var r=0,o=t.length;r<o;)null==t[c=r++]?++s:(0<s&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s),s=0),this.serialize(t[c]));0<s&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s)),this.buf.b+="h";break;case Date:var a=t;this.buf.b+="v",this.buf.b+=q.string(a.getTime());break;case Ir:this.buf.b+="q";for(var l=(e=t).keys();l.hasNext();){var h=l.next();this.buf.b+=":",this.buf.b+=null==h?"null":""+h,this.serialize(e.h[h])}this.buf.b+="h";break;case Tr:this.buf.b+="l";for(var u=(e=t).h;null!=u;){var d=u.item,u=u.next,c=d;this.serialize(c)}this.buf.b+="h";break;case Mr:this.buf.b+="M";for(l=(e=t).keys();l.hasNext();){var h=l.next(),p=D.field(h,"__id__");D.deleteField(h,"__id__"),this.serialize(h),h.__id__=p,this.serialize(e.h[h.__id__])}this.buf.b+="h";break;case zr:this.buf.b+="b";for(e=t,l=zr.keysIterator(e.h);l.hasNext();){h=l.next();this.serializeString(h),this.serialize(e.h[h])}this.buf.b+="h";break;case br:e=t;this.buf.b+="s",this.buf.b+=q.string(Math.ceil(8*e.length/6)),this.buf.b+=":";var c=0,g=e.length-2;if(null==(m=fr.BASE64_CODES)){for(var m=new Array(fr.BASE64.length),r=0,o=fr.BASE64.length;r<o;){var f=r++;m[f]=Y.cca(fr.BASE64,f)}fr.BASE64_CODES=m}for(;c<g;){var y=e.b[c++],_=e.b[c++],w=e.b[c++];this.buf.b+=String.fromCodePoint(m[y>>2]),this.buf.b+=String.fromCodePoint(m[63&(y<<4|_>>4)]),this.buf.b+=String.fromCodePoint(m[63&(_<<2|w>>6)]),this.buf.b+=String.fromCodePoint(m[63&w])}c==g?(y=e.b[c++],_=e.b[c++],this.buf.b+=String.fromCodePoint(m[y>>2]),this.buf.b+=String.fromCodePoint(m[63&(y<<4|_>>4)]),this.buf.b+=String.fromCodePoint(m[_<<2&63])):c==1+g&&(y=e.b[c++],this.buf.b+=String.fromCodePoint(m[y>>2]),this.buf.b+=String.fromCodePoint(m[y<<4&63]));break;default:this.useCache&&this.cache.pop(),null!=t.hxSerialize?(this.buf.b+="C",this.serializeString(n.__name__),this.useCache&&this.cache.push(t),t.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(n.__name__),this.useCache&&this.cache.push(t),this.serializeFields(t))}break;case 7:i=v.e;if(this.useCache){if(this.serializeRef(t))return;this.cache.pop()}this.buf.b+=q.string(this.useEnumIndex?"j":"w"),this.serializeString(i.__ename__),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=q.string(t._hx_index)):(i=t,this.serializeString(x[i.__enum__].__constructs__[i._hx_index])),this.buf.b+=":";var b=X.enumParameters(t);this.buf.b+=q.string(b.length);for(var v=0;v<b.length;){var S=b[v];++v,this.serialize(S)}this.useCache&&this.cache.push(t);break;default:throw cr.thrown("Cannot serialize "+q.string(t))}},__class__:fr},(V["haxe._Unserializer.DefaultResolver"]=yr).__name__="haxe._Unserializer.DefaultResolver",yr.prototype={resolveClass:function(t){return V[t]},resolveEnum:function(t){return x[t]},__class__:yr};var _r=function(t){this.buf=t,this.length=t.length,this.pos=0,this.scache=[],this.cache=[];t=_r.DEFAULT_RESOLVER;null==t&&(t=new yr,_r.DEFAULT_RESOLVER=t),this.resolver=t};(V["haxe.Unserializer"]=_r).__name__="haxe.Unserializer",_r.initCodes=function(){for(var t=[],e=0,i=_r.BASE64.length;e<i;){var n=e++;t[_r.BASE64.charCodeAt(n)]=n}return t},_r.run=function(t){return new _r(t).unserialize()},_r.prototype={readDigits:function(){for(var t=0,e=!1,i=this.pos;;){var n=this.buf.charCodeAt(this.pos);if(n!=n)break;if(45!=n){if(n<48||57<n)break;t=10*t+(n-48),this.pos++}else{if(this.pos!=i)break;e=!0,this.pos++}}return e&&(t*=-1),t},readFloat:function(){for(var t=this.pos;;){var e=this.buf.charCodeAt(this.pos);if(e!=e)break;if(!(43<=e&&e<58||101==e||69==e))break;this.pos++}return parseFloat(Y.substr(this.buf,t,this.pos-t))},unserializeObject:function(t){for(;;){if(this.pos>=this.length)throw cr.thrown("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var e=this.unserialize();if("string"!=typeof e)throw cr.thrown("Invalid object key");var i=this.unserialize();t[e]=i}this.pos++},unserializeEnum:function(t,e){if(58!=this.buf.charCodeAt(this.pos++))throw cr.thrown("Invalid enum format");var i=this.readDigits();if(0==i)return X.createEnum(t,e);for(var n=[];0<i--;)n.push(this.unserialize());return X.createEnum(t,e,n)},unserialize:function(){switch(this.buf.charCodeAt(this.pos++)){case 65:var t=this.unserialize();if(null==(l=this.resolver.resolveClass(t)))throw cr.thrown("Class not found "+t);return l;case 66:t=this.unserialize();if(null==(h=this.resolver.resolveEnum(t)))throw cr.thrown("Enum not found "+t);return h;case 67:t=this.unserialize();if(null==(l=this.resolver.resolveClass(t)))throw cr.thrown("Class not found "+t);var e=Object.create(l.prototype);if(this.cache.push(e),e.hxUnserialize(this),103!=this.buf.charCodeAt(this.pos++))throw cr.thrown("Invalid custom data");return e;case 77:var i=new Mr;this.cache.push(i);for(var n=this.buf;104!=this.buf.charCodeAt(this.pos);){var s=this.unserialize();i.set(s,this.unserialize())}return this.pos++,i;case 82:if((p=this.readDigits())<0||p>=this.scache.length)throw cr.thrown("Invalid string reference");return this.scache[p];case 97:var n=this.buf,r=[];for(this.cache.push(r);;){if(104==(d=this.buf.charCodeAt(this.pos))){this.pos++;break}117==d?(this.pos++,p=this.readDigits(),r[r.length+p-1]=null):r.push(this.unserialize())}return r;case 98:i=new zr;this.cache.push(i);for(n=this.buf;104!=this.buf.charCodeAt(this.pos);){var s=this.unserialize(),o=this.unserialize();i.h[s]=o}return this.pos++,i;case 99:t=this.unserialize();if(null==(l=this.resolver.resolveClass(t)))throw cr.thrown("Class not found "+t);e=Object.create(l.prototype);return this.cache.push(e),this.unserializeObject(e),e;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:t=this.unserialize();if(null==(P=this.resolver.resolveEnum(t)))throw cr.thrown("Enum not found "+t);this.pos++;var a=this.readDigits(),l=P.__constructs__.slice()[a];if(null==l)throw cr.thrown("Unknown enum index "+t+"@"+a);var h=this.unserializeEnum(P,l);return this.cache.push(h),h;case 107:return NaN;case 108:var u=new Tr;this.cache.push(u);for(n=this.buf;104!=this.buf.charCodeAt(this.pos);)u.add(this.unserialize());return this.pos++,u;case 109:return-1/0;case 110:return null;case 111:e={};return this.cache.push(e),this.unserializeObject(e),e;case 112:return 1/0;case 113:i=new Ir;this.cache.push(i);for(var n=this.buf,d=this.buf.charCodeAt(this.pos++);58==d;){var c=this.readDigits(),o=this.unserialize();i.h[c]=o,d=this.buf.charCodeAt(this.pos++)}if(104!=d)throw cr.thrown("Invalid IntMap format");return i;case 114:var p;if((p=this.readDigits())<0||p>=this.cache.length)throw cr.thrown("Invalid reference");return this.cache[p];case 115:var g=this.readDigits(),n=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<g)throw cr.thrown("Invalid bytes length");var m=_r.CODES;null==m&&(m=_r.initCodes(),_r.CODES=m);for(var e=3&g,f=(c=this.pos)+(g-e),y=new br(new ArrayBuffer(3*(g>>2)+(2<=e?e-1:0))),_=0;c<f;){var w=m[n.charCodeAt(c++)],b=m[n.charCodeAt(c++)];y.b[_++]=w<<2|b>>4;var v=m[n.charCodeAt(c++)];y.b[_++]=b<<4|v>>2;var S=m[n.charCodeAt(c++)];y.b[_++]=v<<6|S}return 2<=e&&(w=m[n.charCodeAt(c++)],b=m[n.charCodeAt(c++)],y.b[_++]=w<<2|b>>4,3==e&&(v=m[n.charCodeAt(c++)],y.b[_++]=b<<4|v>>2)),this.pos+=g,this.cache.push(y),y;case 116:return!0;case 118:var x;return 48<=this.buf.charCodeAt(this.pos)&&this.buf.charCodeAt(this.pos)<=57&&48<=this.buf.charCodeAt(this.pos+1)&&this.buf.charCodeAt(this.pos+1)<=57&&48<=this.buf.charCodeAt(this.pos+2)&&this.buf.charCodeAt(this.pos+2)<=57&&48<=this.buf.charCodeAt(this.pos+3)&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4)?(x=Y.strDate(Y.substr(this.buf,this.pos,19)),this.pos+=19):x=new Date(this.readFloat()),this.cache.push(x),x;case 119:var P,t=this.unserialize();if(null==(P=this.resolver.resolveEnum(t)))throw cr.thrown("Enum not found "+t);h=this.unserializeEnum(P,this.unserialize());return this.cache.push(h),h;case 120:throw cr.thrown(this.unserialize());case 121:g=this.readDigits();if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<g)throw cr.thrown("Invalid string length");s=Y.substr(this.buf,this.pos,g);return this.pos+=g,s=decodeURIComponent(s.split("+").join(" ")),this.scache.push(s),s;case 122:return 0}throw this.pos--,cr.thrown("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:_r};var wr=function(t,e,i){cr.call(this,String(t),e,i),this.value=t};(V["haxe.ValueException"]=wr).__name__="haxe.ValueException",wr.__super__=cr,wr.prototype=e(cr.prototype,{__class__:wr});var br=function(t){this.length=t.byteLength,this.b=new Uint8Array(t),(this.b.bufferValue=t).hxBytes=this,t.bytes=this.b};(V["haxe.io.Bytes"]=br).__name__="haxe.io.Bytes",br.ofString=function(t,e){if(e==vr.RawNative){for(var i=new Uint8Array(t.length<<1),n=0,s=t.length;n<s;){var r=n++,o=t.charCodeAt(r);i[r<<1]=255&o,i[r<<1|1]=o>>8}return new br(i.buffer)}for(var a=[],r=0;r<t.length;)55296<=(o=t.charCodeAt(r++))&&o<=56319&&(o=o-55232<<10|1023&t.charCodeAt(r++)),o<=127?a.push(o):(o<=2047?a.push(192|o>>6):(o<=65535?a.push(224|o>>12):(a.push(240|o>>18),a.push(128|o>>12&63)),a.push(128|o>>6&63)),a.push(128|63&o));return new br(new Uint8Array(a).buffer)},br.ofData=function(t){var e=t.hxBytes;return null!=e?e:new br(t)},br.prototype={blit:function(t,e,i,n){if(t<0||i<0||n<0||t+n>this.length||i+n>e.length)throw cr.thrown(Ar.OutsideBounds);0==i&&n==e.b.byteLength?this.b.set(e.b,t):this.b.set(e.b.subarray(i,i+n),t)},getDouble:function(t){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getFloat64(t,!0)},setDouble:function(t,e){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setFloat64(t,e,!0)},getInt32:function(t){return null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getInt32(t,!0)},setInt32:function(t,e){null==this.data&&(this.data=new DataView(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setInt32(t,e,!0)},getString:function(t,e,i){if(t<0||e<0||t+e>this.length)throw cr.thrown(Ar.OutsideBounds);null==i&&(i=vr.UTF8);var n="",s=this.b,r=t,o=t+e;switch(i._hx_index){case 0:for(var a,l;r<o;)if((h=s[r++])<128){if(0==h)break;n+=String.fromCodePoint(h)}else h<224?(a=(63&h)<<6|127&s[r++],n+=String.fromCodePoint(a)):h<240?(l=(31&h)<<12|(127&s[r++])<<6|127&s[r++],n+=String.fromCodePoint(l)):(l=(15&h)<<18|(127&s[r++])<<12|(127&s[r++])<<6|127&s[r++],n+=String.fromCodePoint(l));break;case 1:for(;r<o;){var h=s[r++]|s[r++]<<8;n+=String.fromCodePoint(h)}}return n},toString:function(){return this.getString(0,this.length)},__class__:br};var vr=x["haxe.io.Encoding"]={__ename__:"haxe.io.Encoding",__constructs__:["UTF8","RawNative"],UTF8:{_hx_index:0,__enum__:"haxe.io.Encoding",toString:i},RawNative:{_hx_index:1,__enum__:"haxe.io.Encoding",toString:i}},Sr=function(){};(V["haxe.crypto.Base64"]=Sr).__name__="haxe.crypto.Base64",Sr.encode=function(t,e){null==e&&(e=!0);var i=new xr(Sr.BYTES).encodeBytes(t).toString();if(e)switch(t.length%3){case 1:i+="==";break;case 2:i+="="}return i},Sr.decode=function(t,e){if(null==e&&(e=!0),e)for(;61==Y.cca(t,t.length-1);)t=Y.substr(t,0,-1);return new xr(Sr.BYTES).decodeBytes(br.ofString(t))};var xr=function(t){for(var e=t.length,i=1;1<<i<e;)++i;if(8<i||e!=1<<i)throw cr.thrown("BaseCode : base length must be a power of two.");this.base=t,this.nbits=i};function Pr(t,e){this.elt=t,this.next=e}function Cr(){}(V["haxe.crypto.BaseCode"]=xr).__name__="haxe.crypto.BaseCode",xr.prototype={encodeBytes:function(t){for(var e=this.nbits,i=this.base,n=8*t.length/e|0,s=new br(new ArrayBuffer(n+(8*t.length%e==0?0:1))),r=0,o=0,a=(1<<e)-1,l=0,h=0;h<n;){for(;o<e;)o+=8,r<<=8,r|=t.b[l++];o-=e,s.b[h++]=i.b[r>>o&a]}return 0<o&&(s.b[h++]=i.b[r<<e-o&a]),s},initTable:function(){for(var t=[],e=0;e<256;)t[n=e++]=-1;for(var e=0,i=this.base.length;e<i;){var n=e++;t[this.base.b[n]]=n}this.tbl=t},decodeBytes:function(t){var e=this.nbits;this.base;null==this.tbl&&this.initTable();for(var i=this.tbl,n=t.length*e>>3,s=new br(new ArrayBuffer(n)),r=0,o=0,a=0,l=0;l<n;){for(;o<8;){o+=e,r<<=e;var h=i[t.b[a++]];if(-1==h)throw cr.thrown("BaseCode : invalid encoded char");r|=h}o-=8,s.b[l++]=r>>o&255}return s},__class__:xr},(V["haxe.ds.GenericCell"]=Pr).__name__="haxe.ds.GenericCell",Pr.prototype={__class__:Pr},(V["haxe.ds.GenericStack"]=Cr).__name__="haxe.ds.GenericStack",Cr.prototype={__class__:Cr};var Ir=function(){this.h={}};(V["haxe.ds.IntMap"]=Ir).__name__="haxe.ds.IntMap",Ir.__interfaces__=[Kt],Ir.prototype={remove:function(t){return!!this.h.hasOwnProperty(t)&&(delete this.h[t],!0)},keys:function(){var t,e=[];for(t in this.h)this.h.hasOwnProperty(t)&&e.push(0|t);return new Wr(e)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var t=this.it.next();return this.ref[t]}}},__class__:Ir};var Tr=function(){this.length=0};(V["haxe.ds.List"]=Tr).__name__="haxe.ds.List",Tr.prototype={add:function(t){t=new Br(t,null);null==this.h?this.h=t:this.q.next=t,this.q=t,this.length++},iterator:function(){return new kr(this.h)},__class__:Tr};var Br=function(t,e){this.item=t,this.next=e};(V["haxe.ds._List.ListNode"]=Br).__name__="haxe.ds._List.ListNode",Br.prototype={__class__:Br};var kr=function(t){this.head=t};(V["haxe.ds._List.ListIterator"]=kr).__name__="haxe.ds._List.ListIterator",kr.prototype={hasNext:function(){return null!=this.head},next:function(){var t=this.head.item;return this.head=this.head.next,t},__class__:kr};var Mr=function(){this.h={__keys__:{}}};(V["haxe.ds.ObjectMap"]=Mr).__name__="haxe.ds.ObjectMap",Mr.__interfaces__=[Kt],Mr.prototype={set:function(t,e){var i=t.__id__;null==i&&(i=t.__id__=o.$haxeUID++),this.h[i]=e,this.h.__keys__[i]=t},remove:function(t){t=t.__id__;return null!=this.h.__keys__[t]&&(delete this.h[t],delete this.h.__keys__[t],!0)},keys:function(){var t,e=[];for(t in this.h.__keys__)this.h.hasOwnProperty(t)&&e.push(this.h.__keys__[t]);return new Wr(e)},__class__:Mr};var zr=function(){this.h=Object.create(null)};(V["haxe.ds.StringMap"]=zr).__name__="haxe.ds.StringMap",zr.__interfaces__=[Kt],zr.keysIterator=function(t){var e=Object.keys(t),i=e.length,n=0;return{hasNext:function(){return n<i},next:function(){return e[(n+=1)-1]}}},zr.valueIterator=function(t){var e=Object.keys(t),i=e.length,n=0;return{hasNext:function(){return n<i},next:function(){return t[e[(n+=1)-1]]}}},zr.prototype={iterator:function(){return zr.valueIterator(this.h)},__class__:zr};var Ar=x["haxe.io.Error"]={__ename__:"haxe.io.Error",__constructs__:["Blocked","Overflow","OutsideBounds","Custom"],Blocked:{_hx_index:0,__enum__:"haxe.io.Error",toString:i},Overflow:{_hx_index:1,__enum__:"haxe.io.Error",toString:i},OutsideBounds:{_hx_index:2,__enum__:"haxe.io.Error",toString:i},Custom:((B=function(t){return{_hx_index:3,e:t,__enum__:"haxe.io.Error",toString:i}}).__params__=["e"],B)},Wr=function(t){this.current=0,this.array=t};(V["haxe.iterators.ArrayIterator"]=Wr).__name__="haxe.iterators.ArrayIterator",Wr.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:Wr};var Fr=function(){};(V["js.Boot"]=Fr).__name__="js.Boot",Fr.getClass=function(t){if(null==t)return null;if(t instanceof Array)return Array;var e=t.__class__;if(null!=e)return e;t=Fr.__nativeClassName(t);return null!=t?Fr.__resolveNativeClass(t):null},Fr.__string_rec=function(s,r){if(null==s)return"null";if(5<=r.length)return"<...>";var t,e=typeof s;switch("function"==e&&(s.__name__||s.__ename__)&&(e="object"),e){case"function":return"<function>";case"object":if(s.__enum__){var i=x[s.__enum__],n=i.__constructs__[s._hx_index],o=i[n];return o.__params__?(r+="\t",n+"("+function(){for(var t=[],e=0,i=o.__params__;e<i.length;){var n=i[e];e+=1,t.push(Fr.__string_rec(s[n],r))}return t}().join(",")+")"):n}if(s instanceof Array){var a="[";r+="\t";for(var l=0,h=s.length;l<h;){var u=l++;a+=(0<u?",":"")+Fr.__string_rec(s[u],r)}return a+="]"}try{t=s.toString}catch(l){return"???"}if(null!=t&&t!=Object.toString&&"function"==typeof t){n=s.toString();if("[object Object]"!=n)return n}a="{\n";r+="\t";var d=null!=s.hasOwnProperty,c=null;for(c in s)d&&!s.hasOwnProperty(c)||"prototype"!=c&&"__class__"!=c&&"__super__"!=c&&"__interfaces__"!=c&&"__properties__"!=c&&(2!=a.length&&(a+=", \n"),a+=r+c+" : "+Fr.__string_rec(s[c],r));return a+="\n"+(r=r.substring(1))+"}";case"string":return s;default:return String(s)}},Fr.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var i=t.__interfaces__;if(null!=i)for(var n=0,s=i.length;n<s;){var r=i[n++];if(r==e||Fr.__interfLoop(r,e))return!0}return Fr.__interfLoop(t.__super__,e)},Fr.__instanceof=function(t,e){if(null==e)return!1;switch(e){case Array:return t instanceof Array;case ba:return"boolean"==typeof t;case _a:return null!=t;case wa:return"number"==typeof t;case ya:return"number"==typeof t&&(0|t)===t;case String:return"string"==typeof t;default:if(null==t)return!1;if("function"==typeof e){if(Fr.__downcastCheck(t,e))return!0}else if("object"==typeof e&&Fr.__isNativeObj(e)&&t instanceof e)return!0;return e==va&&null!=t.__name__?!0:e==Sa&&null!=t.__ename__||null!=t.__enum__&&x[t.__enum__]==e}},Fr.__downcastCheck=function(t,e){return t instanceof e||!!e.__isInterface__&&Fr.__interfLoop(Fr.getClass(t),e)},Fr.__implements=function(t,e){return Fr.__interfLoop(Fr.getClass(t),e)},Fr.__nativeClassName=function(t){t=Fr.__toStr.call(t).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},Fr.__isNativeObj=function(t){return null!=Fr.__nativeClassName(t)},Fr.__resolveNativeClass=function(t){return o[t]};var Or=function(){};(V["mobileSpecific.Premium"]=Or).__name__="mobileSpecific.Premium",Or.init=function(t,e){return Or.premiumInfoLoaded=!0,void e()},Or.getBoughtText=function(t){switch(t){case"premium":return kn.lo("premium_activated");case"premium_upgrade":return kn.lo("premium_upgrade_activated");case"remove_ads":return kn.lo("remove_ads_activated");default:return""}},Or.save=function(){On.setItem("tfe2_iap",fr.run(Or.savedPurchases),function(){})},Or.hasSpecific=function(t){return 1==Or.savedPurchases.h[t]};var Dr=t.ModTools=function(){};(V["modding.ModTools"]=Dr).__name__="modding.ModTools",Dr._performOnLoadEarly=function(t,e){Dr._performOnLoadAny(t,e,Dr.onGlobalSaveFuncsEarly)},Dr._performOnLoad=function(t,e){Dr._performOnLoadAny(t,e,Dr.onGlobalSaveFuncs)},Dr._performOnLoadAny=function(t,e,i){var n=e.bytes.getInt32(e.readStart);e.readStart+=4;var s=n,r=Object.create(null);tt.iter(i,function(t){r[t.modIdentifier]=t});for(var o=0,a=s;o<a;){o++;var l=e.readString(),n=e.bytes.getInt32(e.readStart);e.readStart+=4;var h=n,u=e.bytes.getInt32(e.readStart);e.readStart+=4;u=u;null!=r[l]&&r[l].onLoad(t,e,h),e.readStart=u}};var Rr=function(){};(V["pathfinder.DirectConnectionFinder"]=Rr).__name__="pathfinder.DirectConnectionFinder",Rr.find=function(t,e,i,n){var s=new Qr;for(s.capacity==s.mSize&&s.grow(),s.mData[(s.mSize+++s.mFront)%s.capacity]=e,t.simulation.permanentFinder.pfSeenStart+=3,1e5<t.simulation.permanentFinder.pfSeenStart&&(t.simulation.permanentFinder.pfSeenStart=1),e.pfSeen=t.simulation.permanentFinder.pfSeenStart;0<s.mSize;){var r=s.mData[s.mFront++];s.mFront==s.capacity&&(s.mFront=0),s.mSize--;var o=r;if(i(o))return o;r=o.leftBuilding;null!=r&&(n(r)||r.pfSeen!=t.simulation.permanentFinder.pfSeenStart&&(s.capacity==s.mSize&&s.grow(),(s.mData[(s.mSize+++s.mFront)%s.capacity]=r).pfSeen=t.simulation.permanentFinder.pfSeenStart));r=o.rightBuilding;null!=r&&(n(r)||r.pfSeen!=t.simulation.permanentFinder.pfSeenStart&&(s.capacity==s.mSize&&s.grow(),(s.mData[(s.mSize+++s.mFront)%s.capacity]=r).pfSeen=t.simulation.permanentFinder.pfSeenStart));r=o.topBuilding;null!=r&&(n(r)||r.pfSeen!=t.simulation.permanentFinder.pfSeenStart&&(s.capacity==s.mSize&&s.grow(),(s.mData[(s.mSize+++s.mFront)%s.capacity]=r).pfSeen=t.simulation.permanentFinder.pfSeenStart));o=o.bottomBuilding;null!=o&&(n(o)||o.pfSeen!=t.simulation.permanentFinder.pfSeenStart&&(s.capacity==s.mSize&&s.grow(),(s.mData[(s.mSize+++s.mFront)%s.capacity]=o).pfSeen=t.simulation.permanentFinder.pfSeenStart))}return null};var Ur=function(t){this.gridIStart=0,this.city=t,this.allWaypoints=[],this.highestYPositions=[]};(V["pathfinder.FlyingPathfinder"]=Ur).__name__="pathfinder.FlyingPathfinder",Ur.prototype={updateWaypoints:function(){this.allWaypoints=[];var t=[],e=0,i=20;0<this.city.worlds.length&&(e=vn.min(this.city.worlds,function(t){return t.rect.x}).rect.x-40,i=vn.max(this.city.worlds,function(t){return t.rect.get_x2()}).rect.get_x2()+40);var n=[];(n=this.city.worlds.slice()).sort(function(t,e){return t.rect.y-e.rect.y});for(var s=e/20|0,r=[],o=0,a=M=(i/20|0)-(this.gridIStart=s)+1;o<a;){var l=o++;r.push([])}for(var h=r,r=0,o=this.city.landingSites;r<o.length;){var u=o[r];++r,h[(u.position.x/20|0)-s].push(u)}for(r=0,o=M;r<o;){var d=20*((l=r++)+s);t.push([]);for(a=0;a<n.length;){var c=n[a];++a;var p=c.rect.x,g=c.rect.get_x2();if(p<=d&&d<g){var m=(d-c.rect.x)/20|0,f=null;if(null!=c.mask)for(var y=c.mask[m],_=0,w=y.length;_<w;)y[O=_++]&&(f=O);for(var b=[c.rect.y-20*c.permanents[m].length],v=c.permanents[m].length,S=!1,p=c.permanents[m][v-1],x=null!=p&&p.is(Qe);0<--v;){var P,C,I=c.permanents[m][v];null==I?S||(v!=c.permanents[m].length-1&&(P=c.rect.y-20*(v+1),C=t[l][t[l].length-1],x?b[0]+=20:(0==t[l].length||b[0]>C+20)&&(b[0]-=20),0==t[l].length||b[0]>C?(t[l].push(b[0]),t[l].push(P)):t[l][t[l].length-1]=P),S=!0):S&&(b[0]=c.rect.y-20*(v+1),S=!1,x=I.is(Qe))}null!=f&&(g=20*(f+1)+c.rect.y,p=t[l][t[l].length-1],vn.any(h[l],function(e){return function(t){return t.position.y==e[0]}}(b))?b[0]+=20:(0==t[l].length||b[0]>p+20)&&(b[0]-=20),0==t[l].length||b[0]>p?(t[l].push(b[0]),t[l].push(g)):t[l][t[l].length-1]=g)}}}var T=new Ir,B=[];this.highestYPositions=[];for(r=1,o=(i/20|0)-s;r<o;){for(var d=20*((l=r++)+s),k=[],M=t[l].length/2|0,z=[t[l+1]],A=0,W=0,F=new Ir,a=0,_=1+M;a<_;){var O=a++,D=[[]],R=[-1e6],U=[1e6];0!=M&&(0==O?U[0]=t[l][0]:O==M?R[0]=t[l][2*M-1]:(R[0]=t[l][2*O-1],U[0]=t[l][2*O])),0==O&&this.highestYPositions.push(0==M?-1e6:U[0]);for(var L=function(s,r,o,a){return function(t){for(var e=0,i=-1,n=-1;e<a[0].length;){if(t>=a[0][e]&&t<a[0][e+1]){i=a[0][e],n=a[0][e+1];break}if(a[0][e]>t)break;e+=2}-1!=i&&(i>r[0]?o[0].push(i-20):n<s[0]&&o[0].push(n))}}(U,R,D,z);W<z[0].length;){if(z[0][W]>R[0]&&z[0][W+1]<U[0])D[0].push(z[0][W]-20),D[0].push(z[0][W+1]);else if(z[0][W]>R[0])break;W+=2}for(;A<B.length;){var E=B[A];if(E>=R[0]&&E<U[0])D[0].push(E),L(E);else if(E>=R[0])break;++A}for(var w=0,H=h[l];w<H.length;){u=H[w];++w,u.position.y==U[0]-20&&(D[0].push(u.position.y),L(u.position.y))}D[0].sort(function(t,e){return t-e});for(var N=null,G=D[0].length;0<=--G;)D[0][G]==N&&D[0].splice(G,1),N=D[0][G];for(var X=null,j=0;j<D[0].length;){var V=D[0][j];++j,k.push(V);var Y,$=new Lr(d,V);null!=X&&(X.connections.push($),$.connections.push(X)),T.h.hasOwnProperty(V)&&((Y=T.h[V]).connections.push($),$.connections.push(Y)),F.h[V]=$,this.allWaypoints.push($),X=$}}for(var q=0,K=h[l];q<K.length;){var Q=[K[q]];++q;var J=function(e){return function(t){return t.y==e[0].position.y}}(Q);Q[0].connectedWaypoint=tt.find(F,J),null!=Q[0].connectedWaypoint&&(Q[0].connectedWaypoint.connectedSite=Q[0])}B=k,T=F}},findRoute:function(t,e){if(null==t.connectedWaypoint||null==e.connectedWaypoint)return console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:282:","problem while finding an air route from:"),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:283:",t),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:284:","to:"),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:285:",e),console.log("FloatingSpaceCities/pathfinder/FlyingPathfinder.hx:286:","If you're an end user, please report this problem. The game should continue normally now, but saving+loading the game may help if you do encounter further pathfinding problems."),null;for(var i=0,n=this.allWaypoints;i<n.length;){var s=n[i];++i,s.seen=0}var r=new Zr(null,!0),o=t.connectedWaypoint;o.priority=0,r.enqueue(o);for(var a=e.connectedWaypoint;0!=r.mSize;){var l=r.dequeue();if(l.seen=2,l==a){for(var h=[];l!=o;)h.push(l),l=l.prevWaypoint;return h.push(o),h}for(i=0,n=l.connections;i<n.length;){var u=n[i];switch(++i,u.seen){case 0:u.seen=1,u.prevWaypoint=l,u.priority=l.priority+(Math.abs(l.x-u.x)+Math.abs(l.y-u.y)),r.enqueue(u);break;case 1:var d=l.priority+(Math.abs(l.x-u.x)+Math.abs(l.y-u.y));d<u.priority&&(u.prevWaypoint=l,r.reprioritize(u,d))}}}return null},findAnyOtherLandingSite:function(t){if(null==t.connectedWaypoint)return null;for(var e=0,i=this.allWaypoints;e<i.length;){var n=i[e];++e,n.seen=0}var s=new Cr,r=t.connectedWaypoint;for(r.priority=0,s.head=new Pr(r,s.head);null!=s.head;){var o=s.head,a=null==o?null:(s.head=o.next,o.elt);if(a.seen=2,null!=a.connectedSite&&a.connectedSite!=t&&null!=a.connectedSite.landingSiteGroup)return a.connectedSite;for(e=0,i=a.connections;e<i.length;){var l=i[e];++e,0==l.seen&&(l.seen=1,l.prevWaypoint=a,s.head=new Pr(l,s.head))}}return null},__class__:Ur},t=function(){},(V["polygonal.ds.Prioritizable"]=t).__name__="polygonal.ds.Prioritizable",t.__isInterface__=!0,t.prototype={__class__:t};var Lr=function(t,e){this.connectedSite=null,this.prevWaypoint=null,this.seen=0,this.connections=[],this.position=0,this.priority=0,this.x=t,this.y=e};(V["pathfinder.FlyingPathfinderWaypoint"]=Lr).__name__="pathfinder.FlyingPathfinderWaypoint",Lr.__interfaces__=[t],Lr.prototype={__class__:Lr};var Er=function(t){this.previousRequestSentToWorker=0,this.currentMaxThreads=15,this.usedWorkers=0,this.activeWorkers=0,this.restartPathfindingLimit=1e3,this.totalNumRequested=0,this.city=t,this.workers=[];t=[];t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),t.push(new Qr),this.citizensForPaths=t,(t=[]).push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),this.storedPathMessages=t,(t=[]).push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),t.push(null),this.pathRequests=t,(t=[]).push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),this.pathRequestPos=t,this.setWorkerNumber(R.pathfindingWorkers,!1)};function Hr(){}(V["pathfinder.PathfinderManager"]=Er).__name__="pathfinder.PathfinderManager",Er.prototype={setWorkerNumber:function(t,e){if(!(t<=0))if(t>this.activeWorkers)for(var i=t-this.activeWorkers,n=this.activeWorkers,s=0,r=i;s<r;){var o,a=s++;this.initNewWorkerIfPossible(),e&&this.activeWorkers>a+n&&(o=this.getPathfindingInfo(),this.postInt32Array(o,a+n,!1))}else this.usedWorkers=t},terminate:function(){for(var t=0,e=this.workers;t<e.length;){var i=e[t];++t,i.terminate()}this.activeWorkers=0},initNewWorkerIfPossible:function(){this.activeWorkers<this.currentMaxThreads&&(this.initWorker(this.activeWorkers),this.initPathRequests(this.activeWorkers),this.activeWorkers++,this.usedWorkers++)},initWorker:function(i){var n=this;try{this.workers[i]=new Worker(H.pathfinderCodeUrl)}catch(t){this.workers[i]=new Worker("js/pathfinder.js")}this.useModernPostMessage=!0;try{var t=new Int32Array(1);t[0]=2,this.workers[i].postMessage(t.buffer,[t.buffer])}catch(t){this.useModernPostMessage=!1,console.log("FloatingSpaceCities/pathfinder/PathfinderManager.hx:114:","Using legacy mode for web workers.")}this.storedPathMessages[i]=new Qr(200),this.workers[i].onmessage=function(t){var e=n.storedPathMessages[i],t=new Int32Array(t.data);e.capacity==e.mSize&&e.grow(),e.mData[(e.mSize+++e.mFront)%e.capacity]=t}},getPathfindingInfo:function(){for(var t=0,e=0,i=this.city.worlds;e<i.length;){var n=i[e];++e,t+=3;for(var s=0,r=n.permanents;s<r.length;){var o=r[s];++s,t+=1+2*o.length}}for(var a=[],e=0,i=this.city.permanents;e<i.length;){i[e];++e}var l=new Int32Array(t+4*this.city.connections.directWorldConnectionNumber+4+this.city.connections.landingSiteGroups.length+this.city.landingSites.length+a.length),h=0;l[h++]=0,l[h++]=this.city.worlds.length;for(e=0,i=this.city.worlds;e<i.length;){n=i[e];++e,l[h++]=n.permanents.length,l[h++]=n.rect.x,l[h++]=n.rect.y;for(s=0,r=n.permanents;s<r.length;){o=r[s];++s,l[h++]=o.length;for(var u=0;u<o.length;){var d=o[u];++u,null!=d?(l[h++]=d.id,d.isBuilding?l[h++]=2*d.get_typeID()+(d.isBuilding&&d.isRooftopBuilding?1:0):l[h++]=6):(l[h++]=-1,l[h++]=-1)}}}l[h++]=this.city.connections.directWorldConnectionNumber+(a.length/4|0);for(e=0,i=this.city.worlds;e<i.length;){n=i[e];++e;for(s=0,r=n.permanents[0];s<r.length;){var c,p,g,d=r[s];++s,null!=d&&d.isBuilding&&(null==(c=d).leftBuilding||((g=(p=c.leftBuilding).world).rect.y>n.rect.y||g.rect.y==n.rect.y&&g.rect.x>n.rect.x)&&(l[h++]=2,l[h++]=c.id,l[h++]=p.id,l[h++]=20,l[h++]=3,l[h++]=p.id,l[h++]=c.id,l[h++]=20))}for(var u=0,m=n.permanents[n.permanents.length-1];u<m.length;){var f,y,_=m[u];++u,null!=_&&_.isBuilding&&(null==(f=_).rightBuilding||((_=(y=f.rightBuilding).world).rect.y>n.rect.y||_.rect.y==n.rect.y&&_.rect.x>n.rect.x)&&(l[h++]=3,l[h++]=f.id,l[h++]=y.id,l[h++]=20,l[h++]=2,l[h++]=y.id,l[h++]=f.id,l[h++]=20))}}for(e=0;e<a.length;){var w=a[e];++e,l[h++]+=w}l[h++]=this.city.connections.landingSiteGroups.length;for(e=0,i=this.city.connections.landingSiteGroups;e<i.length;){var b=i[e];++e,l[h++]=b.length;for(s=0;s<b.length;){var v=b[s];++s,l[h++]=v.id}}return l},sendPathfindingInfo:function(){for(var t=this.getPathfindingInfo(),e=0,i=this.activeWorkers;e<i;){var n=e++;this.postInt32Array(t,n,!0)}},findPath:function(t,e){this.previousRequestSentToWorker++,this.previousRequestSentToWorker>=this.usedWorkers&&(this.previousRequestSentToWorker=0);var i=this.previousRequestSentToWorker,n=this.pathRequests[i];null!=t.inPermanent?(n[this.pathRequestPos[i]++]=-1,n[this.pathRequestPos[i]++]=t.inPermanent.id):(n[this.pathRequestPos[i]++]=this.city.worlds.indexOf(t.onWorld),n[this.pathRequestPos[i]++]=0|t.relativeX),n[this.pathRequestPos[i]++]=e.id,null!=t.home&&t.home.get_hasPrivateTeleporter()?n[this.pathRequestPos[i]++]=t.home.id:n[this.pathRequestPos[i]++]=-1;n=this.citizensForPaths[i];n.capacity==n.mSize&&n.grow(),(n.mData[(n.mSize+++n.mFront)%n.capacity]=t).isRequestingPath=!0,t.requestingPathGoal=e,403<=this.pathRequestPos[i]&&this.requestPaths(i)},requestAllPaths:function(){for(var t=0,e=this.activeWorkers;t<e;){var i=t++;this.requestPaths(i)}},requestPaths:function(t){3<this.pathRequestPos[t]&&(this.pathRequests[t][0]=1,this.pathRequests[t][1]=(this.pathRequestPos[t]-3)/4|0,this.pathRequests[t][2]=this.city.simulation.operatingCost.teleportersEnabled?1:0,this.postInt32Array(this.pathRequests[t],t,!1),this.totalNumRequested+=(this.pathRequestPos[t]-3)/4|0,this.initPathRequests(t))},initPathRequests:function(t){this.pathRequests[t]=new Int32Array(403),this.pathRequestPos[t]=3},distributePaths:function(){for(var t=0,e=this.activeWorkers;t<e;){for(var i=t++;0!=this.storedPathMessages[i].mSize;){var n=this.storedPathMessages[i],s=n.mData[n.mFront++];n.mFront==n.capacity&&(n.mFront=0),n.mSize--;for(var r=s,o=1,a=0,l=r[0];a<l;){a++;var h=r[o],u=this.citizensForPaths[i],d=u.mData[u.mFront++];u.mFront==u.capacity&&(u.mFront=0),u.mSize--,null!=d&&d.setPath(r,o+1,h),o+=h+1}}this.totalNumRequested=0}},getTotalNumberOfRequested:function(){for(var t=0,e=0,i=this.activeWorkers;e<i;){var n=e++;t+=this.citizensForPaths[n].mSize}return t},postInt32Array:function(t,e,i){this.useModernPostMessage&&!i?this.workers[e].postMessage(t.buffer,[t.buffer]):this.workers[e].postMessage(t.buffer)},invalidateAllPaths:function(){for(var t=0,e=this.citizensForPaths;t<e.length;){var i=e[t];++t;for(var n=i.iterator();n.hasNext();){var s=n.next();null!=s&&(s.isRequestingPath=!1)}}for(t=0,e=this.activeWorkers;t<e;){var r=t++;if(this.citizensForPaths[r].mSize>Math.min(this.city.simulation.citizens.length,this.restartPathfindingLimit))this.workers[r].terminate(),this.citizensForPaths[r].clear(),this.initWorker(r);else{var o=this.citizensForPaths[r].mSize-((this.pathRequestPos[r]-3)/4|0);this.citizensForPaths[r].clear();for(var a=0,l=o;a<l;){a++;var h=this.citizensForPaths[r];h.capacity==h.mSize&&h.grow(),h.mData[(h.mSize+++h.mFront)%h.capacity]=null}}this.initPathRequests(r)}},__class__:Er},(V["pathfinder.PathfindingTools"]=Hr).__name__="pathfinder.PathfindingTools",Hr.findNearestBestBuildingStack=function(t,e){for(var i=t.get_worldX(),n=-1/0,s=null,r=1/0,o=0,a=t.onWorld.permanents.length;o<a;){var l=o++,h=e(t.onWorld.permanents[l]),u=Math.abs(i-20*l);(n<h||h==n&&u<r)&&(s=l,r=u,n=h)}return s};var Nr=function(t){this.pfSeenStart=1,this.limitQueryAmountFor=0,this.updateQueries=0,this.pathQueue=new Zr(10,!0),this.city=t,this.savedResults=new zr};(V["pathfinder.PermanentFinder"]=Nr).__name__="pathfinder.PermanentFinder",Nr.prototype={preUpdate:function(){(this.updateQueries=0)<this.limitQueryAmountFor&&this.limitQueryAmountFor--},requestQueryLimiting:function(t){null==t&&(t=!1),this.limitQueryAmountFor=120,t&&(this.updateQueries=10)},canPerformQuery:function(){return!(0<this.limitQueryAmountFor)||this.updateQueries<10},query:function(t,e,i,n,s,r,o,a){null==a&&(a=1e8),null==r&&(r=-1);var l=this;if(this.updateQueries+=1,this.pfSeenStart+=3,1e5<this.pfSeenStart&&(this.pfSeenStart=1),null!=t){var h=Gr.create(0,t);t.pfRelatedPrioritizable=h,this.pathQueue.enqueue(h)}else for(var u=0,d=n.permanents;u<d.length;){var c=d[u];++u,0!=c.length&&null!=c[0]&&(S=Math.abs(c[0].position.x-s),-1!=r&&r<S||(c[0].pfRelatedPrioritizable=Gr.create(S,c[0]),this.pathQueue.enqueue(c[0].pfRelatedPrioritizable),c[0].pfSeen=this.pfSeenStart))}for(var p=-1e4,g=null,m=this.city.connections.landingSiteGroups,f=!this.city.simulation.operatingCost.teleportersEnabled,u=[],d=0;d<m.length;){m[d];++d,u.push(!1)}var y=u,_=null;for(null!=o&&null!=o.home&&(_=o.home.get_hasPrivateTeleporter()?o.home:null);0!=this.pathQueue.mSize;){var w=this.pathQueue.dequeue(),b=w.permanent;if(b.pfSeen=this.pfSeenStart+1,e(b)){if(null==i){for(;0!=this.pathQueue.mSize;)this.pathQueue.dequeue().destroy();g=b;break}var v=i(b);if(a<=v){g=b;break}p<v&&(g=b,p=v)}if(b.isBuilding){var S,x=b,v=x.leftBuilding;null!=v&&(v.pfSeen==l.pfSeenStart?(C=v.pfRelatedPrioritizable,(S=w.priority+20)<C.priority&&l.pathQueue.reprioritize(C,S)):v.pfSeen!=l.pfSeenStart+1&&(P=w.priority+20,(-1==r||P<=r)&&(v.pfSeen=l.pfSeenStart,v.pfRelatedPrioritizable=Gr.create(P,v),l.pathQueue.enqueue(v.pfRelatedPrioritizable))));var P,C=x.rightBuilding;null!=C&&(C.pfSeen==l.pfSeenStart?(P=C.pfRelatedPrioritizable,(v=w.priority+20)<P.priority&&l.pathQueue.reprioritize(P,v)):C.pfSeen!=l.pfSeenStart+1&&(I=w.priority+20,(-1==r||I<=r)&&(C.pfSeen=l.pfSeenStart,C.pfRelatedPrioritizable=Gr.create(I,C),l.pathQueue.enqueue(C.pfRelatedPrioritizable))));var I=x.topBuilding;null!=I&&(I.pfSeen==l.pfSeenStart?(C=I.pfRelatedPrioritizable,(B=w.priority+20)<C.priority&&l.pathQueue.reprioritize(C,B)):I.pfSeen!=l.pfSeenStart+1&&(T=w.priority+20,(-1==r||T<=r)&&(I.pfSeen=l.pfSeenStart,I.pfRelatedPrioritizable=Gr.create(T,I),l.pathQueue.enqueue(I.pfRelatedPrioritizable))));var T,B=x.bottomBuilding;null!=B&&(B.pfSeen==l.pfSeenStart?(T=B.pfRelatedPrioritizable,(I=w.priority+20)<T.priority&&l.pathQueue.reprioritize(T,I)):B.pfSeen!=l.pfSeenStart+1&&(k=w.priority+20,(-1==r||k<=r)&&(B.pfSeen=l.pfSeenStart,B.pfRelatedPrioritizable=Gr.create(k,B),l.pathQueue.enqueue(B.pfRelatedPrioritizable))));var k=_==b,B=b.is(Ai)||k;if(!f&&B){for(var M=bo.getFloat(2),B=this.city.teleporters.length,z=2/B,u=0,d=B;u<d;){var A,W=u++,F=this.city.teleporters[W],O=9+(M+W*z)%2;null!=F&&(F.pfSeen==l.pfSeenStart?(A=F.pfRelatedPrioritizable,(W=w.priority+O)<A.priority&&l.pathQueue.reprioritize(A,W)):F.pfSeen!=l.pfSeenStart+1&&(O=w.priority+O,(-1==r||O<=r)&&(F.pfSeen=l.pfSeenStart,F.pfRelatedPrioritizable=Gr.create(O,F),l.pathQueue.enqueue(F.pfRelatedPrioritizable))))}k||null==_||null!=_&&(_.pfSeen==l.pfSeenStart?(B=_.pfRelatedPrioritizable,(k=w.priority+10)<B.priority&&l.pathQueue.reprioritize(B,k)):_.pfSeen!=l.pfSeenStart+1&&(D=w.priority+10,(-1==r||D<=r)&&(_.pfSeen=l.pfSeenStart,_.pfRelatedPrioritizable=Gr.create(D,_),l.pathQueue.enqueue(_.pfRelatedPrioritizable)))),f=!0}else if(b.is(Qe)&&!y[b.landingSiteGroup]){for(var D=b.landingSiteGroup,R=0,U=this.city.connections.landingSiteGroups[D];R<U.length;){var L=U[R];++R;var E,H,N=L.estimatedFlyingDistanceTo(b);null!=L&&(L.pfSeen==l.pfSeenStart?(E=L.pfRelatedPrioritizable,(H=w.priority+N)<E.priority&&l.pathQueue.reprioritize(E,H)):L.pfSeen!=l.pfSeenStart+1&&(N=w.priority+N,(-1==r||N<=r)&&(L.pfSeen=l.pfSeenStart,L.pfRelatedPrioritizable=Gr.create(N,L),l.pathQueue.enqueue(L.pfRelatedPrioritizable))))}y[D]=!0}else if(!w.dontCheckElevators&&b.is(Ye)&&3!=b.pfSeen)for(var G=0,X=this.city.connections.elevatorConnections.h[x.world.__id__][x.worldPosition.x];G<X.length;){var j=X[G];++G;var V,Y,$=Math.abs(j.worldPosition.y-x.worldPosition.y);null!=j&&(j.pfSeen==l.pfSeenStart?(V=j.pfRelatedPrioritizable,(Y=w.priority+$)<V.priority&&l.pathQueue.reprioritize(V,Y)):j.pfSeen!=l.pfSeenStart+1&&($=w.priority+$,(-1==r||$<=r)&&(j.pfSeen=l.pfSeenStart,j.pfRelatedPrioritizable=Gr.create($,j),l.pathQueue.enqueue(j.pfRelatedPrioritizable)))),null!=j.pfRelatedPrioritizable&&(j.pfRelatedPrioritizable.dontCheckElevators=!0)}else b.is(Oi)}if(0==b.worldPosition.y)for(var q=0,K=b.world.permanents;q<K.length;){var Q,J,Z,tt,c=K[q];++q,0!=c.length&&null!=c[0]&&(Q=c[0],tt=Math.abs(c[0].position.x-b.position.x),null!=Q&&(Q.pfSeen==l.pfSeenStart?(J=Q.pfRelatedPrioritizable,(Z=w.priority+tt)<J.priority&&l.pathQueue.reprioritize(J,Z)):Q.pfSeen!=l.pfSeenStart+1&&(tt=w.priority+tt,(-1==r||tt<=r)&&(Q.pfSeen=l.pfSeenStart,Q.pfRelatedPrioritizable=Gr.create(tt,Q),l.pathQueue.enqueue(Q.pfRelatedPrioritizable)))))}w.destroy()}return g},queryForCitizen:function(t,e,i,n,s){return null==s&&(s=!1),null==n&&(n=-1),null!=t.inPermanent?this.query(t.inPermanent,e,i,null,0,n,s?null:t):this.query(null,e,i,t.onWorld,t.relativeX,n,s?null:t)},quickQueryForCitizen:function(t,e,i,n,s,r){null==r&&(r=-1);var o=this.city.simulation.time.timeSinceStart,a=null!=t.inPermanent?(l=t.inPermanent.worldPosition.x,t.inPermanent.worldPosition.y/5|0):(l=(0|t.relativeX)/20|0,0),l=t.onWorld.rect.x+";"+t.onWorld.rect.y+";"+l+";"+a+i,a=this.savedResults.h[l],i=null;return null!=a&&(o<a.expiry?i=a.permanent:null!=a.permanent&&e(a.permanent)&&(a.expiry+=60*n,i=a.permanent)),null==i&&(n={permanent:r=this.queryForCitizen(t,e,s,r,!0),expiry:o+60*n},this.savedResults.h[l]=n,i=r),i},invalidatePathfindingRelatedInfo:function(){this.savedResults=new zr},__class__:Nr};var Gr=function(){this.dontCheckElevators=!1};(V["pathfinder.PermanentPrioritizable"]=Gr).__name__="pathfinder.PermanentPrioritizable",Gr.__interfaces__=[t],Gr.create=function(t,e){var i=0==Gr.pool.length?new Gr:Gr.pool.pop();return i.___internal_pooling_initObject(t,e),i},Gr.prototype={___internal_pooling_initObject:function(t,e){this.priority=t,this.permanent=e},destroy:function(){Gr.pool.push(this)},__class__:Gr};var Xr=function(t){this.city=t,this.prev=new Mr};function jr(){var e=Fr.getClass(this).__name__;this.info=tt.find(H.cityUpgradesInfo,function(t){return"policies."+t.className==e})}(V["pathfinder.RouteFinder"]=Xr).__name__="pathfinder.RouteFinder",Xr.prototype={__class__:Xr},(V["policies.Policy"]=jr).__name__="policies.Policy",jr.__interfaces__=[n],jr.prototype={addToCity:function(t){this.city=t},destroy:function(){},save:function(t,e){null==e&&(e=!0),e&&t.addString(jr.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:jr};var Vr=function(){jr.call(this)};(V["policies.FoodRationing"]=Vr).__name__="policies.FoodRationing",Vr.__super__=jr,Vr.prototype=e(jr.prototype,{addToCity:function(t){this.city=t,this.city.simulation.eating.foodRationing=!0},destroy:function(){this.city.simulation.eating.foodRationing=!1},__class__:Vr});var Yr=function(){jr.call(this)};(V["policies.MandatoryOvertime"]=Yr).__name__="policies.MandatoryOvertime",Yr.__super__=jr,Yr.prototype=e(jr.prototype,{addToCity:function(t){(this.city=t).policies.vars.workTimeChange=2},destroy:function(){this.city.policies.vars.workTimeChange=0},__class__:Yr});var $r=function(t){this.city=t,this.policies=[],this.vars=new qr};(V["policies.Policies"]=$r).__name__="policies.Policies",$r.prototype={addPolicy:function(t){this.policies.push(t),t.addToCity(this.city)},removePolicy:function(t){Y.remove(this.policies,t),t.destroy()},save:function(t){var e,i=this.policies.length;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;for(var n=0,s=this.policies;n<s.length;){var r=s[n];++n;var o=Fr.getClass(r);t.addString(o.__name__),r.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var s=t.readString(),s=X.createInstance(V[s],[]);s.load(t),this.addPolicy(s)}},__class__:$r};var qr=function(){this.workTimeChange=0,this.schoolMaxEdu=1,this.schoolClassSizeMod=1};(V["policies.PolicyVars"]=qr).__name__="policies.PolicyVars",qr.prototype={__class__:qr};var Kr=function(){jr.call(this)};(V["policies.SmallerClasses"]=Kr).__name__="policies.SmallerClasses",Kr.__super__=jr,Kr.prototype=e(jr.prototype,{addToCity:function(t){(this.city=t).policies.vars.schoolClassSizeMod=.6666667,t.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,t.policies.vars.schoolMaxEdu=1.15;for(var e=0,i=t.permanents;e<i.length;){var n=i[e];if(++e,n.is(bi))for(var s=n;s.students.length>s.get_studentCapacity();)s.students[s.students.length-1].leaveSchool()}},destroy:function(){this.city.policies.vars.schoolClassSizeMod=1,this.city.simulation.schoolAssigner.schoolsShouldBeUpdated=!0,this.city.policies.vars.schoolMaxEdu=1},__class__:Kr}),t=function(){},(V["polygonal.ds.Hashable"]=t).__name__="polygonal.ds.Hashable",t.__isInterface__=!0,n=function(){},(V["polygonal.ds.Collection"]=n).__name__="polygonal.ds.Collection",n.__isInterface__=!0,n.__interfaces__=[t],t=function(){},(V["polygonal.ds.Queue"]=t).__name__="polygonal.ds.Queue",t.__isInterface__=!0,t.__interfaces__=[n];var Qr=function(t,e,i){var n;if(null==t&&(t=16),this.mIterator=null,this.mFront=0,this.mSize=0,this.reuseIterator=!1,this.growthRate=-2,this.mInitialCapacity=t<1?1:t,this.capacity=this.mInitialCapacity,null!=e&&(this.mSize=e.length,n=this.mSize,t=this.capacity,this.capacity=t<n?n:t),this.mData=new Array(this.capacity),null!=e)for(var s=this.mData,r=0,o=this.mSize;r<o;){var a=r++;s[a]=e[a]}i&&(this.growthRate=0)};(V["polygonal.ds.ArrayedQueue"]=Qr).__name__="polygonal.ds.ArrayedQueue",Qr.__interfaces__=[t],Qr.prototype={clear:function(t){null==t&&(t=!1),t&&eo.nullify(this.mData),this.mFront=this.mSize=0},iterator:function(){return this.reuseIterator?(null==this.mIterator?this.mIterator=new Jr(this):this.mIterator.reset(),this.mIterator):new Jr(this)},grow:function(){var t=this.capacity;this.capacity=to.compute(this.growthRate,this.capacity),this.resizeContainer(t,this.capacity)},resizeContainer:function(t,e){var i,n,s=new Array(e);t<e?this.mFront+this.mSize>t?(n=t-(i=t-this.mFront),eo.blit(this.mData,this.mFront,s,0,i),eo.blit(this.mData,0,s,i,n)):eo.blit(this.mData,this.mFront,s,0,this.mSize):this.mFront+this.mSize>t?(i=t-this.mFront,n=this.mSize-this.mFront,eo.blit(this.mData,this.mFront,s,0,i),eo.blit(this.mData,0,s,this.mFront,n)):eo.blit(this.mData,this.mFront,s,0,this.mSize),this.mData=s,this.mFront=0},__class__:Qr},n=function(){},(V["polygonal.ds.Itr"]=n).__name__="polygonal.ds.Itr",n.__isInterface__=!0,n.prototype={__class__:n};var Jr=function(t){this.mObject=t,this.reset()};(V["polygonal.ds.ArrayedQueueIterator"]=Jr).__name__="polygonal.ds.ArrayedQueueIterator",Jr.__interfaces__=[n],Jr.prototype={reset:function(){return this.mFront=this.mObject.mFront,this.mCapacity=this.mObject.capacity,this.mSize=this.mObject.mSize,this.mI=0,this.mData=this.mObject.mData.slice(),this},hasNext:function(){return this.mI<this.mSize},next:function(){return this.mData[(this.mI+++this.mFront)%this.mCapacity]},__class__:Jr};var Zr=function(t,e,i){if(null==e&&(e=!1),null==t&&(t=1),this.mSize=0,this.growthRate=-2,this.mInitialCapacity=t<1?1:t,this.capacity=t,this.mInverse=e,null!=i&&(this.mSize=i.length,t=this.mSize,e=this.capacity,this.capacity=e<t?t:e),this.mData=new Array(this.capacity+1),(this.mData[0]=null)!=i){for(var n=this.mData,s=1,r=this.mSize+1;s<r;){var o=s++;n[o]=i[o-1]}this.repair()}};(V["polygonal.ds.PriorityQueue"]=Zr).__name__="polygonal.ds.PriorityQueue",Zr.__interfaces__=[t],Zr.prototype={enqueue:function(t){this.mSize==this.capacity&&this.grow(),(this.mData[++this.mSize]=t).position=this.mSize;var e,i=this.mSize,n=this.mData,s=i>>1,t=n[i],r=t.priority;if(this.mInverse)for(;0<s;){if(!(r-(e=n[s]).priority<0))break;(n[i]=e).position=i,i=s,s>>=1}else for(;0<s;){if(!(0<r-(e=n[s]).priority))break;(n[i]=e).position=i,i=s,s>>=1}(n[i]=t).position=i},dequeue:function(){var t=this.mData,e=t[1];e.position=-1,t[1]=t[this.mSize];var i,n=1,s=n<<1,r=(t=this.mData)[n],o=r.priority;if(this.mInverse)for(;s<this.mSize&&(s<this.mSize-1&&0<t[s].priority-t[s+1].priority&&++s,0<o-(i=t[s]).priority);)(t[n]=i).position=n,n=r.position=s,s<<=1;else for(;s<this.mSize&&(s<this.mSize-1&&t[s].priority-t[s+1].priority<0&&++s,o-(i=t[s]).priority<0);)(t[n]=i).position=n,n=r.position=s,s<<=1;return(t[n]=r).position=n,this.mSize--,e},reprioritize:function(t,e){var i=t.priority;if(i==e)return this;t.priority=e;t=t.position;if(this.mInverse)if(e<i){var n=(a=t)>>1,s=(h=(l=this.mData)[a]).priority;if(this.mInverse)for(;0<n;){if(!(s-(u=l[n]).priority<0))break;(l[a]=u).position=a,a=n,n>>=1}else for(;0<n;){if(!(0<s-(u=l[n]).priority))break;(l[a]=u).position=a,a=n,n>>=1}(l[a]=h).position=a}else{var r=(a=t)<<1,s=(h=(l=this.mData)[a]).priority;if(this.mInverse)for(;r<this.mSize&&(r<this.mSize-1&&0<l[r].priority-l[r+1].priority&&++r,0<s-(o=l[r]).priority);)(l[a]=o).position=a,a=h.position=r,r<<=1;else for(;r<this.mSize&&(r<this.mSize-1&&l[r].priority-l[r+1].priority<0&&++r,s-(o=l[r]).priority<0);)(l[a]=o).position=a,a=h.position=r,r<<=1;(l[a]=h).position=a;n=(a=this.mSize)>>1,s=(h=(l=this.mData)[a]).priority;if(this.mInverse)for(;0<n;){if(!(s-(u=l[n]).priority<0))break;(l[a]=u).position=a,a=n,n>>=1}else for(;0<n;){if(!(0<s-(u=l[n]).priority))break;(l[a]=u).position=a,a=n,n>>=1}(l[a]=h).position=a}else if(i<e){n=(a=t)>>1,s=(h=(l=this.mData)[a]).priority;if(this.mInverse)for(;0<n;){if(!(s-(u=l[n]).priority<0))break;(l[a]=u).position=a,a=n,n>>=1}else for(;0<n;){if(!(0<s-(u=l[n]).priority))break;(l[a]=u).position=a,a=n,n>>=1}(l[a]=h).position=a}else{var o,r=(a=t)<<1,s=(h=(l=this.mData)[a]).priority;if(this.mInverse)for(;r<this.mSize&&(r<this.mSize-1&&0<l[r].priority-l[r+1].priority&&++r,0<s-(o=l[r]).priority);)(l[a]=o).position=a,a=h.position=r,r<<=1;else for(;r<this.mSize&&(r<this.mSize-1&&l[r].priority-l[r+1].priority<0&&++r,s-(o=l[r]).priority<0);)(l[a]=o).position=a,a=h.position=r,r<<=1;(l[a]=h).position=a;var a,l,h,u,n=(a=this.mSize)>>1,s=(h=(l=this.mData)[a]).priority;if(this.mInverse)for(;0<n;){if(!(s-(u=l[n]).priority<0))break;(l[a]=u).position=a,a=n,n>>=1}else for(;0<n;){if(!(0<s-(u=l[n]).priority))break;(l[a]=u).position=a,a=n,n>>=1}(l[a]=h).position=a}return this},repair:function(){for(var t=this.mSize>>1;1<=t;)this.heapify(t,this.mSize),--t},heapify:function(t,e){var i=this.mData,n=t<<1,s=1+n,r=t;this.mInverse?(n<=e&&i[n].priority-i[r].priority<0&&(r=n),1+n<=e&&i[1+n].priority-i[r].priority<0&&(r=s)):(n<=e&&0<i[n].priority-i[r].priority&&(r=n),1+n<=e&&0<i[1+n].priority-i[r].priority&&(r=s)),r!=t&&(n=i[r],s=i[t],i[r]=s,t=(i[t]=n).position,n.position=s.position,s.position=t,this.heapify(r,e))},grow:function(){this.capacity=to.compute(this.growthRate,this.capacity),this.resizeContainer(this.capacity)},resizeContainer:function(t){t=new Array(t+1);eo.blit(this.mData,0,t,0,this.mSize+1),this.mData=t},__class__:Zr};var to=function(){};(V["polygonal.ds.tools.GrowthRate"]=to).__name__="polygonal.ds.tools.GrowthRate",to.compute=function(t,e){if(0<t)e+=t;else switch(t){case-3:e<<=1;break;case-2:e=1+(3*e>>1);break;case-1:var i=e+1;e=(i>>3)+(i<9?3:6),e+=i;break;case 0:throw cr.thrown("out of space")}return e};var eo=function(){};(V["polygonal.ds.tools.NativeArrayTools"]=eo).__name__="polygonal.ds.tools.NativeArrayTools",eo.blit=function(t,e,i,n,s){if(0<s)if(t==i){if(e<n)for(var r=e+s,o=n+s,a=0,l=s;a<l;){a++;--r,t[--o]=t[r]}else if(n<e)for(r=e,o=n,a=0,l=s;a<l;){a++;t[o]=t[r],++r,++o}}else if(0==e&&0==n)for(a=0,l=s;a<l;)i[r=a++]=t[r];else if(0==e)for(a=0,l=s;a<l;)i[n+(r=a++)]=t[r];else if(0==n)for(a=0,l=s;a<l;)i[r=a++]=t[e+r];else for(a=0,l=s;a<l;)i[n+(r=a++)]=t[e+r]},eo.nullify=function(t,e,i){null==i&&(i=0),null==e&&(e=0);for(var n=e,s=i<=0?t.length:n+i;n<s;)t[n++]=null;return t};var io=function(){};function no(t){this.city=t}(V["pooling.Int32ArrayPool"]=io).__name__="pooling.Int32ArrayPool",io.returnToPool=function(t){t.length<20&&io.pool[t.length].length<1e4&&io.pool[t.length].push(t)};var so={create:function(t,e){var i;return null==so.pool.h[e.__id__]&&so.pool.set(e,[]),0==so.pool.h[e.__id__].length?(i=new PIXI.Sprite,e.addChild(i)):i=so.pool.h[e.__id__].pop(),i.texture=t,i.visible=!0,i}};function ro(){H.initializeCityResources(this)}(V["progress.BuildingCost"]=no).__name__="progress.BuildingCost",no.prototype={getBuildingCost:function(t){return"NormalHouse"!=t.className||"theLostShip"!=this.city.progress.story.storyName||null==this.city.progress.story.currentGoal||"BuildIndoorFarmAndHouse"!=this.city.progress.story.currentGoal.name||null!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]&&0!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]?M.fromBuildingInfo(t):new M(2,2)},getBuildingCostDescriptionAdder:function(t){return"NormalHouse"!=t.className||"theLostShip"!=this.city.progress.story.storyName||null==this.city.progress.story.currentGoal||"BuildIndoorFarmAndHouse"!=this.city.progress.story.currentGoal.name||null!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]&&0!=this.city.getAmountOfPermanentsPerType().h["buildings.NormalHouse"]?"":" "+kn.lo("first_house_cheaper")},__class__:no},n=function(t){(this.city=t).enableDisplayOnly(),this.spaceShipSprite=new PIXI.Sprite(H.getTexture("spr_explorationship"))},(V["progress.CityIntro"]=n).__name__="progress.CityIntro",n.prototype={update:function(t){this.city.gui.stage.visible=!1,this.city.gui.windowStage.visible=!1,null!=this.spaceShipSprite&&null==this.spaceShipSprite.parent&&(this.city.cityMidStage.addChild(this.spaceShipSprite),this.spaceShipSprite.position.set(this.city.viewPos.x,this.city.viewPos.y))},handleMouse:function(t){return this.spaceShipSprite.x=t.cityPosition.x,t.pressed&&(this.city.disableDisplayOnlyMode(null),this.city.gui.stage.visible=!0,this.city.gui.windowStage.visible=!0,this.city.progress.cityIntro=null),!0},__class__:n},(V["progress.CityResources"]=ro).__name__="progress.CityResources",ro.prototype={__class__:ro};var oo=function(t,e){this.shownPopLimitHint=!1,this.shownCtrlToHighlightHint=!1,this.city=t,this.storyName=e,this.goalHelp=new lo(t),this.sandbox=new uo(t),this.buildingCost=new no(t)};function ao(){}(V["progress.GameProgress"]=oo).__name__="progress.GameProgress",oo.prototype={init:function(){this.resources=new ro,this.unlocks=new fo(this.city),this.story=new po(this.city,this.storyName)},handleMouse:function(t){return null!=this.cityIntro&&this.cityIntro.handleMouse(t)},update:function(t){this.story.update(t),this.unlocks.update(t),this.sandbox.update(t),null!=this.cityIntro&&this.cityIntro.update(t),this.city.simulation.babyMaker.softPopLimit!=this.city.simulation.citizens.length||2e3!=this.city.simulation.babyMaker.softPopLimit||null!=this.city.gui.window||this.shownPopLimitHint||(this.shownPopLimitHint=!0,this.city.gui.showSimpleWindow(kn.lo("change_pop_limit"),kn.lo("pop_limit_reached")))},save:function(t){this.story.save(t),this.unlocks.save(t);var e=this.shownCtrlToHighlightHint?1:0;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e,t.size+=1,this.sandbox.save(t);var i,e=this.shownPopLimitHint;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},load:function(t){var e;this.story.load(t),this.unlocks.load(t),13<=t.version&&(e=t.bytes.b[t.readStart],t.readStart+=1,this.shownCtrlToHighlightHint=1==e),25<=t.version&&this.sandbox.load(t),40<=t.version&&(e=t.bytes.b[t.readStart],t.readStart+=1,this.shownPopLimitHint=0<e)},resetCtrlToHightlightHint:function(){100<=this.city.simulation.citizens.length&&(this.shownCtrlToHighlightHint=!0)},__class__:oo},(V["progress.GenerateWorld"]=ao).__name__="progress.GenerateWorld",ao.doGenerate=function(t,e,i,n,s,r,o){"RandomMiniWorlds"==t&&wo.doGenerate(e,i,n,s,r,o)};var lo=function(t){this.neverUpdatedBuildingGoal=!0,this.knowsHasBuildingGoalHelp=!1,this.city=t};(V["progress.GoalHelp"]=lo).__name__="progress.GoalHelp",lo.prototype={getCurrentGoalHelp:function(){var t=[];null!=this.city.progress.story&&null!=this.city.progress.story.currentGoal&&""!=this.city.progress.story.currentGoal.quickText&&t.push({category:kn.lo("main_goal"),text:this.city.progress.story.currentGoal.quickText});for(var e=this.getCurrentBuildingGoalHelp(),i=0;i<e.length;){var n=e[i];++i,t.push(n)}return t},getCurrentBuildingGoalHelp:function(){for(var t=[],e=0,i=this.city.permanents;e<i.length;){var n=i[e];++e,!n.is(m)||null!=(n=n.getGlobalGoal())&&t.push(n)}return t},updateHasBuildingGoal:function(){this.knowsHasBuildingGoalHelp=0<this.getCurrentBuildingGoalHelp().length},hasCurrentGoalHelp:function(){return null!=this.city.progress.story&&null!=this.city.progress.story.currentGoal&&""!=this.city.progress.story.currentGoal.quickText||(this.neverUpdatedBuildingGoal&&(this.updateHasBuildingGoal(),this.neverUpdatedBuildingGoal=!1),this.knowsHasBuildingGoalHelp)},__class__:lo};var ho=function(i){this.unlockedAll=!1;var n=this;On.getItem("progressFile",function(t,e){n.scenarioTimes=null==t&&null!=e?e:new zr,i()}),On.getItem("unlockedAllScenarios",function(t,e){null==t&&null!=e&&(n.unlockedAll=e)})};(V["progress.MetaGame"]=ho).__name__="progress.MetaGame",ho.prototype={unlockAll:function(){this.unlockedAll=!0,On.setItem("unlockedAllScenarios",!0,function(){})},winScenario:function(t,e){(!Object.prototype.hasOwnProperty.call(this.scenarioTimes.h,t)||this.scenarioTimes.h[t]>e)&&(this.scenarioTimes.h[t]=e,this.saveProgress())},getScenarioTime:function(t){return Object.prototype.hasOwnProperty.call(this.scenarioTimes.h,t)?this.scenarioTimes.h[t]:null},hasWonScenario:function(t){return Object.prototype.hasOwnProperty.call(this.scenarioTimes.h,t)},saveProgress:function(){On.setItem("progressFile",this.scenarioTimes,function(){})},__class__:ho};var uo=function(t){this.everPlayedWithUnlimitedResources=!1,this.unlimitedResources=!1,this.city=t};function co(t,e){this.city=t,this.simulation=t.simulation,this.story=e}(V["progress.SandboxHelper"]=uo).__name__="progress.SandboxHelper",uo.prototype={update:function(t){if(this.unlimitedResources){this.city.materials.food<1e7&&this.city.materials.set_food(1e7),this.city.materials.wood<1e7&&(this.city.materials.wood=1e7),this.city.materials.stone<1e7&&(this.city.materials.stone=1e7),this.city.materials.machineParts<1e7&&(this.city.materials.machineParts=1e7),this.city.materials.refinedMetal<1e7&&(this.city.materials.refinedMetal=1e7),this.city.materials.computerChips<1e7&&(this.city.materials.computerChips=1e7),this.city.materials.cacao,this.city.materials.chocolate,this.city.materials.graphene<1e7&&(this.city.materials.graphene=1e7);for(var e=0,i=z.modMaterials;e<i.length;){var n=i[e];++e;n=n.variableName;this.city.materials[n]<1e7&&"cacao"!=n&&"chocolate"!=n&&(this.city.materials[n]=1e7)}this.city.materials.knowledge<1e7&&(this.city.materials.knowledge=1e7)}},enableUnlimitedResources:function(){if(!this.unlimitedResources){this.unlimitedResources=!0,this.everPlayedWithUnlimitedResources=!0,(t=this.city.materials).set_food(t.food+1e7),this.city.materials.wood+=1e7,this.city.materials.stone+=1e7,this.city.materials.machineParts+=1e7,this.city.materials.refinedMetal+=1e7,this.city.materials.computerChips+=1e7,this.city.materials.graphene+=1e7;for(var t=0,e=z.modMaterials;t<e.length;){var i=e[t];++t;i=i.variableName;"cacao"!=i&&"chocolate"!=i&&(this.city.materials[i]+=1e7)}this.city.materials.knowledge+=1e7}},disableUnlimitedResources:function(){if(this.unlimitedResources){this.unlimitedResources=!1,(t=this.city.materials).set_food(t.food-1e7),this.city.materials.food<0&&this.city.materials.set_food(0),this.city.materials.wood-=1e7,this.city.materials.wood<0&&(this.city.materials.wood=0),this.city.materials.stone-=1e7,this.city.materials.stone<0&&(this.city.materials.stone=0),this.city.materials.machineParts-=1e7,this.city.materials.machineParts<0&&(this.city.materials.machineParts=0),this.city.materials.refinedMetal-=1e7,this.city.materials.refinedMetal<0&&(this.city.materials.refinedMetal=0),this.city.materials.computerChips-=1e7,this.city.materials.computerChips<0&&(this.city.materials.computerChips=0),this.city.materials.graphene-=1e7,this.city.materials.graphene<0&&(this.city.materials.graphene=0);for(var t=0,e=z.modMaterials;t<e.length;){var i=e[t];++t;i=i.variableName;"cacao"!=i&&"chocolate"!=i&&(this.city.materials[i]-=1e7,this.city.materials[i]<0&&(this.city.materials[i]=0))}this.city.materials.knowledge-=1e7,this.city.materials.knowledge<0&&(this.city.materials.knowledge=0)}},save:function(t,e){null==e&&(e=!0),e&&t.addString(uo.saveDefinition);e=this.unlimitedResources;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.everPlayedWithUnlimitedResources;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"unlimitedResources")&&(this.unlimitedResources=t.h.unlimitedResources),Object.prototype.hasOwnProperty.call(t.h,"everPlayedWithUnlimitedResources")&&(this.everPlayedWithUnlimitedResources=t.h.everPlayedWithUnlimitedResources)},__class__:uo},(V["progress.ScriptedStoryPart"]=co).__name__="progress.ScriptedStoryPart",co.prototype={update:function(t){},initialize:function(t){},save:function(t,e){null==e&&(e=!0),e&&t.addString(co.saveDefinition)},load:function(t,e){null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:co};var po=function(t,e){null==e&&(e="theLostShip"),this.goalTimer=0,this.justInvitedPeople=!1,this.hiddenBoost=!1,this.disableDestroy=!1,this.disableDying=!1,this.city=t,this.storyInfo=H.storiesInfo.h[e],this.storyName=e,kn.translateStory(this.storyName,this.storyInfo),this.plannings=[],this.scriptedParts=[]};(V["progress.Story"]=po).__name__="progress.Story",po.prototype={get_speedUpStartNights:function(){return null!=this.storyInfo.speedUpStartNights&&this.storyInfo.speedUpStartNights},start:function(){if(this.city.materials.add(M.fromStoryMaterials(this.storyInfo.initialMaterials)),null!=this.storyInfo.lockPermanents)for(var t=0,e=this.storyInfo.lockPermanents;t<e.length;){var i=e[t];++t,this.city.progress.unlocks.lock(V["buildings."+i])}if(1==this.storyInfo.lockAllPermanents){this.city.progress.unlocks.unlockedDecorationTab=!1,this.city.progress.unlocks.unlockedBuildingModeButton=!1,this.city.progress.unlocks.unlockedManagementOptions=!1;for(t=0,e=this.city.progress.resources.buildingInfoArray;t<e.length;){i=e[t];++t;var n="buildings."+i.className;this.city.progress.unlocks.lock(V[n])}}""!=this.storyInfo.startGoal&&this.startGoal(this.findGoal(this.storyInfo.startGoal)),null!=this.storyInfo.viewYFromBottom&&(this.city.fixViewBottom(this.city.game.isMobile&&null!=this.storyInfo.viewYMobi?this.storyInfo.viewYMobi:this.storyInfo.viewYFromBottom),this.city.resize(),this.city.fixViewBottom(null)),this.city.game.isMobile&&null!=this.storyInfo.mobileViewStartX&&(this.city.viewPos.x=this.storyInfo.mobileViewStartX,this.city.resize()),null!=this.storyInfo.viewStartX&&(this.city.viewPos.x=this.storyInfo.viewStartX,this.city.resize()),"cityofthekey"==this.storyName&&this.city.simulation.happiness.createGloryOfTheKey()},update:function(t){this.city.displayOnly&&null!=this.storyInfo.viewYFromBottom&&(this.city.fixViewBottom(this.city.game.isMobile&&null!=this.storyInfo.viewYMobi?this.storyInfo.viewYMobi:this.storyInfo.viewYFromBottom),this.city.resize(),this.city.fixViewBottom(null)),null!=this.currentGoal&&this.city.gui.windowRelatedTo!=this&&this.goalComplete(this.currentGoal)&&(p.sendEvent("story","goal_complete",null,this.storyName+"-"+this.currentGoal.name),this.currentGoal.name,this.storyInfo.startGoal,""!=this.currentGoal.nextGoal?this.startGoal(this.findGoal(this.currentGoal.nextGoal)):this.currentGoal=null);for(var e=this.plannings.length;0<=--e;){var i,n=this.plannings[e];n.plan.length>n.nextEventToHandle&&(i=n.plan[n.nextEventToHandle],n.timeStart+i.time<this.city.simulation.time.timeSinceStart/60&&(this.executePlannedEvent(i),n.nextEventToHandle+=1)),n.plan.length<=n.nextEventToHandle&&this.plannings.splice(e,1)}for(e=this.scriptedParts.length;0<=--e;)this.scriptedParts[e].update(t);this.goalTimer+=t},executePlannedEvent:function(t){switch(t.type){case"ScriptedStoryPart":var e=t,i="progress.scriptedStoryParts."+e.className,i=X.createInstance(V[i],[this.city,this]);i.initialize(e),this.scriptedParts.push(i);break;case"SpawnCitizens":var n=t;this.spawnCitizens(this.city.worlds[n.world],n);break;case"SpawnCitizensFlyingSaucer":n=t;this.city.simulation.citizenSpawners.push(new Go(this.city.simulation,this.city.farForegroundStage,this.city.worlds[n.world],n,n.toXIndex))}},getDesiredGoalHighlights:function(){if(null==this.currentGoal)return[];for(var t=[],e=0,i=this.currentGoal.subGoals;e<i.length;){var n=i[e];if(++e,!this.subGoalComplete(n))switch(n.type){case"BuildPermanents":var s=n.permanentToBuildClass;N.startsWith(s,"buildings.")||N.startsWith(s,"worldResources.")||(s="buildings."+s),t.push(V[s]);break;case"PerformBuildingUpgrades":var r=n.upgradeClass;N.startsWith(r,"buildingUpgrades.")||(r="buildingUpgrades."+r),t.push(V[r]);break;case"PerformCityUpgrades":r=n.upgradeClass;N.startsWith(r,"cityUpgrades.")||(r="cityUpgrades."+r),t.push(V[r])}}return t},goalComplete:function(t){for(var e=!0,i=0,n=t.subGoals;i<n.length;){var s=n[i];++i,this.subGoalComplete(s)||(e=!1)}return e},subGoalComplete:function(t){switch(t.type){case"BuildPermanents":var e=t,i=e.permanentToBuildClass;N.startsWith(i,"buildings.")||N.startsWith(i,"worldResources.")||(i="buildings."+i);var n,s,r,o,a=null!=e.needsExactClass&&e.needsExactClass?function(t){return Fr.getClass(t).__name__==i}:function(t){return t.is(V[i])};return null!=e.onWorld?(n=this.city.worlds[e.onWorld],s=a,a=function(t){return!!s(t)&&t.world==n}):null!=e.notOnWorld&&(r=this.city.worlds[e.notOnWorld],o=a,a=function(t){return!!o(t)&&t.world!=r}),tt.count(this.city.permanents,a)>=e.amount;case"CompleteHackerMissions":for(var l=t,h=0,u=this.city.permanents;h<u.length;){var d=u[h];if(++h,d.is(Ne))return d.currentMission>=l.amount}return!1;case"ExploreAlienRuins":for(h=0,u=this.city.worlds;h<u.length;){var c=u[h];++h;for(var p=0,g=c.permanents;p<g.length;){d=g[p];if(++p,1<=d.length&&null!=d[0]&&d[0].is(ca))return 99.99<=d[0].explored}}return!1;case"ExploredWithResearchSpacecraft":for(h=0,u=this.city.permanents;h<u.length;){d=u[h];if(++h,d.is(mi))return 540<=d.timeWorking}return!1;case"GatherMaterials":var m=t;if(null!=m.materials.food&&this.city.materials.food<m.materials.food)return!1;if(null!=m.materials.wood&&this.city.materials.wood<m.materials.wood)return!1;if(null!=m.materials.stone&&this.city.materials.stone<m.materials.stone)return!1;if(null!=m.materials.machineParts&&this.city.materials.machineParts<m.materials.machineParts)return!1;if(null!=m.materials.refinedMetal&&this.city.materials.refinedMetal<m.materials.refinedMetal)return!1;if(null!=m.materials.computerChips&&this.city.materials.computerChips<m.materials.computerChips)return!1;if(null!=m.materials.cacao&&this.city.materials.cacao<m.materials.cacao)return!1;if(null!=m.materials.chocolate&&this.city.materials.chocolate<m.materials.chocolate)return!1;if(null!=m.materials.graphene&&this.city.materials.graphene<m.materials.graphene)return!1;for(h=0,u=z.modMaterials;h<u.length;){var f=u[h];++h;var y=f.variableName;if(null!=m.materials[y]&&this.city.materials[y]<m.materials[y])return!1}return null!=m.materials.knowledge&&this.city.materials.knowledge<m.materials.knowledge?!1:!0;case"GloryGoal":return null!=this.city.simulation.happiness.gloryOfTheKey&&99.99<=this.city.simulation.happiness.gloryOfTheKey.gloryOfTheKeyHappiness;case"HousingCapacity":return this.city.simulation.stats.houseCapacity>=t.amount;case"InvitePeople":return this.justInvitedPeople;case"MinimumCitizens":return this.city.simulation.citizens.length>=t.number;case"MinimumHappiness":return this.city.simulation.happiness.happiness>=t.happiness;case"PerformBuildingUpgrades":var e=t,_=e.upgradeClass;N.startsWith(_,"buildingUpgrades.")||(_="buildingUpgrades."+_);var w=V[_];return tt.count(this.city.permanents,function(t){return!!t.isBuilding&&vn.any(t.upgrades,function(t){return Fr.__instanceof(t,w)})})>=e.amount;case"PerformCityUpgrade":_=t.upgradeClass;N.startsWith(_,"cityUpgrades.")||(_="cityUpgrades."+_);var b=V[_];return 1<=tt.count(this.city.upgrades.upgrades,function(t){return Fr.__instanceof(t,b)});case"ProductionGoal":var v=t;if(null!=v.materials.food&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("food")],function(t){return t>=v.materials.food}))return!1;if(null!=v.materials.wood&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("wood")],function(t){return t>=v.materials.wood}))return!1;if(null!=v.materials.stone&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("stone")],function(t){return t>=v.materials.stone}))return!1;if(null!=v.materials.machineParts&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("machineParts")],function(t){return t>=v.materials.machineParts}))return!1;if(null!=v.materials.refinedMetal&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("refinedMetal")],function(t){return t>=v.materials.refinedMetal}))return!1;if(null!=v.materials.computerChips&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("computerChips")],function(t){return t>=v.materials.computerChips}))return!1;if(null!=v.materials.cacao&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("cacao")],function(t){return t>=v.materials.cacao}))return!1;if(null!=v.materials.chocolate&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("chocolate")],function(t){return t>=v.materials.chocolate}))return!1;if(null!=v.materials.graphene&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("graphene")],function(t){return t>=v.materials.graphene}))return!1;for(h=0,u=z.modMaterials;h<u.length;){f=u[h];++h;y=[f.variableName];if(null!=v.materials[y[0]]&&!vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex(y[0])],function(e){return function(t){return t>=v.materials[e[0]]}}(y)))return!1}return null==v.materials.knowledge||vn.any(this.city.simulation.stats.materialProduction[z.findMaterialIndex("knowledge")],function(t){return t>=v.materials.knowledge})?!0:!1;case"Wait":return this.goalTimer>t.waitTime?!0:!1;case"WaitForDecryption":for(h=0,u=this.city.permanents;h<u.length;){d=u[h];if(++h,d.is(jt))return 1440<=d.timeWorking}return!1}return!1},findGoal:function(e){return tt.find(this.storyInfo.goals,function(t){return t.name==e})},startGoal:function(t){var e,i=this;if(this.currentGoal=t,this.goalTimer=0,null!=t.flags&&this.handleFlagsChanges(t.flags),this.showGoalText(),null!=t.unlocks)for(var n=0,s=t.unlocks;n<s.length;){var r=s[n];++n,"decorations"==r?this.city.progress.unlocks.unlockedDecorationTab=!0:"buildingModes"==r?this.city.progress.unlocks.unlockedBuildingModeButton=!0:"managementOptions"==r?this.city.progress.unlocks.unlockedManagementOptions=!0:this.city.progress.unlocks.unlock(V["buildings."+r])}if(null!=t.researches)for(n=0,s=t.researches;n<s.length;){r=s[n];++n,this.city.progress.unlocks.research(V["buildings."+r],!1)}null!=t.planning&&this.plannings.push({goalName:t.name,plan:t.planning,nextEventToHandle:0,timeStart:this.city.simulation.time.timeSinceStart/60}),"Win"==t.name&&this.city.game.metaGame.winScenario(this.storyName,0|this.city.simulation.time.timeSinceStart),this.city.gui.clearTutorial(),(this.city.postCreateBuilder=null)!=t.showTutorial&&(1==t.showTutorial?(this.city.gui.showTutorialArrows1(),this.city.postCreateBuilder=function(){i.city.builder.fixBuilder(i.city.worlds[0],2)}):2==t.showTutorial?(e=this.city.gui.showWindowCloseWarning(120),this.city.gui.showTutorialArrows2(e)):101==t.showTutorial?(e=this.city.gui.showWindowCloseWarning(120),this.city.gui.showTutorialArrowsBuildStoneMine(e)):3==t.showTutorial?this.city.gui.showTutorialArrows3():4==t.showTutorial?this.city.gui.showTutorialArrows4():4001==t.showTutorial&&this.city.gui.showTutorialArrowsInviteCitizens())},showGoalText:function(t){null==t&&(t=!1);var r=this,o=this.currentGoal;this.city.gui.createWindow(this),null!=o.title&&""!=o.title&&this.city.gui.windowAddTitleText(o.title);var e="",i=o.text;k.isLimitedDemo&&null!=o.flags&&null!=o.flags.demoText&&(i+=o.flags.demoText);for(var n=i.indexOf("["),s=!0,a=this.goalComplete(o);-1!=n;){s&&(e+=Y.substr(i,0,n));var l=(i=Y.substr(i,n+1,null)).indexOf("]"),h=Y.substr(i,0,l),i=Y.substr(i,l+1,null);"n"==h?s=!a:"c"==h?s=a:"mobi"==h?s=this.city.game.isMobile:"nonmobi"==h?s=!this.city.game.isMobile:"nmobi"==h?s=!a&&this.city.game.isMobile:"nnonmobi"==h?s=!a&&!this.city.game.isMobile:"/"==h?s=!0:"d"==h&&(e+=(1+((0|(h=this.city.simulation.time).timeSinceStart)/1440|0)==1?kn.lo("one_day"):kn.lo("n_days",[1+((0|h.timeSinceStart)/1440|0)]))+", "+(((0|h.timeSinceStart)/60|0)%24==1?kn.lo("one_hour"):kn.lo("n_hours",[((0|h.timeSinceStart)/60|0)%24]))+", "+kn.lo("and")+" "+((0|h.timeSinceStart)%60==1?kn.lo("one_minute"):kn.lo("n_minutes",[(0|h.timeSinceStart)%60]))),n=i.indexOf("[")}s&&(e+=i),this.city.gui.windowAddInfoText(t?o.tldr:e),this.city.gui.pauseForWindow();var u,d,c,p=null!=o.tldr,g=[];p&&g.push({text:t?"Too short?":"tl;dr?",action:function(){r.showGoalText(!t)}}),"Win"==o.name&&(k.isLimitedDemo&&g.push({text:"Wishlist the Full Version Now!",action:function(){greenworks.activateGameOverlayToWebPage("https://store.steampowered.com/app/1180130/The_Final_Earth_2/")}}),null!=o.nextStory&&""!=o.nextStory?g.push({text:kn.lo("next_scenario"),action:function(){var t=r.city.game,e=r.city.gui,i=kn.lo("save_slot_choice"),n=fa(B=r.city.game,B.newCity),s=o.nextStory;Vs.createSaveWindow(t,e,i,function(t){n(s,t)}),k.hadFullStepWithInput&&bn.showNonRewardedInterstitialIfAllowed()}}):(u=kn.lo("new_city"),d=this.city.game,c=this.city.gui,g.push({text:u,action:function(){Ds.createNewScenarioWindow(d,c)}})),this.city.gui.windowOnDestroy=function(){});g=this.city.gui.windowAddBottomButtons(g);p&&!t&&0<g.length&&(g[0].onHover=function(){r.city.gui.tooltip.setText(r,"Want a shorter version?")})},makeWorlds:function(t,e,i,n){for(var s=0,r=this.storyInfo.worlds;s<r.length;){var o=r[s];++s;var a=new K(t,this.city,e,i,n,xn.fromStoryRect(o.rect),o.seed,o.appearance);this.city.worlds.push(a);for(var l=0,h=o.worldResources;l<h.length;){var u=h[l];++l;var d="worldResources."+u.className;a.createWorldResource(V[d],u.position)}for(var c=0,p=o.buildingStacks;c<p.length;){var g=p[c];++c;for(var m=0,f=g.classNames;m<f.length;){var y=f[m];++m;var _="buildings."+y;"LandedExplorationShip_mirrored"==y&&(_="buildings.LandedExplorationShip");var w,b,v=!1,S=0;-1!=y.indexOf("*")&&(v="true"==(b=(w=y.split("*"))[1].split("."))[0],S=q.parseInt(b[1]),_="buildings."+w[0]);_=a.build(V[_],g.position);"LandedExplorationShip_mirrored"==y&&_.mirror(),!v&&0==S||(_.customize(S,v),_.postCreate())}}if(null!=o.decoration)for(var x=0,P=a.permanents.length;x<P;){var C=x++;a.setDecoration(o.decoration,C)}if(null!=o.decorations)for(var I=0,T=o.decorations;I<T.length;){var B=T[I];++I,a.setDecoration(B.spriteName,B.position)}for(var k=0,M=o.citizens;k<M.length;){var z=M[k];++k,this.spawnCitizens(a,z)}null!=o.unbuildableAliens&&o.unbuildableAliens&&a.setUnbuildableAliens(),null!=o.protectedKey&&o.protectedKey&&a.setProtectedKey()}if(null!=this.storyInfo.generatorScripts)for(s=0,r=this.storyInfo.generatorScripts;s<r.length;){var A=r[s];++s,ao.doGenerate(A.name,A.args,this.city,this.storyInfo,e,i,n)}},spawnCitizens:function(t,e){for(var i=0,n=e.amount;i<n;){i++;var s=e.ageRangeMin;e.ageRangeMin!=e.ageRangeMax&&(s=bo.getFloat(e.ageRangeMin,e.ageRangeMax));var r=null;null!=e.minX&&null!=e.maxX&&(r=e.minX==e.maxX?e.minX:bo.getInt(e.minX,e.maxX)),this.city.simulation.createCitizen(t,s,null,r)}},handleFlagsChanges:function(t){if(null!=t.disableDying&&(this.disableDying=t.disableDying),null!=t.disableDestroy&&(this.disableDestroy=t.disableDestroy),null!=t.happinessEnthusiasmLevel&&(this.city.simulation.happiness.happinessEnthusiasmLevel=t.happinessEnthusiasmLevel),null!=t.hiddenBoost&&(this.hiddenBoost=t.hiddenBoost),null!=t.disableRewardedAd&&null!=this.city.simulation.boostManager&&(this.city.simulation.boostManager.disableRewardedAd=t.disableRewardedAd),null!=t.setBuildableAliens)for(var e=0,i=this.city.worlds;e<i.length;){var n=i[e];++e,n.makeBuildableAliens()}},save:function(t){this.saveBasics(t),t.addString(null==this.currentGoal?"":this.currentGoal.name);var e=this.plannings.length;t.size+4>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,a,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var i=0,n=this.plannings;i<n.length;){var s=n[i];++i,t.addString(s.goalName);e=s.nextEventToHandle;t.size+4>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,a,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var r,o=s.timeStart;t.size+8>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,r,0,t.size)),t.bytes.setDouble(t.size,o),t.size+=8}var a,e=this.scriptedParts.length;t.size+4>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,a,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(i=0,n=this.scriptedParts;i<n.length;){s=n[i];++i;var l=Fr.getClass(s);t.addString(l.__name__),s.save(t)}},load:function(t){this.loadBasics(t),this.storyInfo=H.storiesInfo.h[this.storyName];var e=t.readString();this.currentGoal=""==e?null:this.findGoal(e);var i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var n=0,s=i;n<s;){n++;var r=t.readString(),i=t.bytes.getInt32(t.readStart);t.readStart+=4;var o=i,a=t.bytes.getDouble(t.readStart);t.readStart+=8;a=a;this.plannings.push({goalName:r,plan:this.findGoal(r).planning,nextEventToHandle:o,timeStart:a})}i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(n=0,s=i;n<s;){n++;var l=t.readString(),l=X.createInstance(V[l],[this.city,this]);l.load(t),this.scriptedParts.push(l)}""!=e&&"Win"!=e||("theLostShip"==this.storyName?Bn.setStat("binaryWontheLostShip",1):"multipleWorlds"==this.storyName&&(Bn.setStat("binaryWontheLostShip",1),Bn.setStat("binaryWonmultipleWorlds",1)))},canHaveUnlimitedResources:function(){return null==this.currentGoal},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(po.saveDefinition),t.addString(this.storyName);e=this.disableDying;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.disableDestroy;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.hiddenBoost;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.goalTimer;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"storyName")&&(this.storyName=t.h.storyName),Object.prototype.hasOwnProperty.call(t.h,"disableDying")&&(this.disableDying=t.h.disableDying),Object.prototype.hasOwnProperty.call(t.h,"disableDestroy")&&(this.disableDestroy=t.h.disableDestroy),Object.prototype.hasOwnProperty.call(t.h,"hiddenBoost")&&(this.hiddenBoost=t.h.hiddenBoost),Object.prototype.hasOwnProperty.call(t.h,"goalTimer")&&(this.goalTimer=t.h.goalTimer)},__class__:po};var go=function(i,t,n){var e="https://529473016-184630684593625815.preview.editmysite.com/uploads/b/139890129-811652923688457694/files/stories/"+i+".json",s=new PIXI.loaders.Loader;s.add(e);var r=!1;s.use(function(t,e){if(t.error)return console.log("FloatingSpaceCities/progress/StoryLoader.hx:21:",t.error),void(r||(n(),r=!0));t=t.data;H.storiesInfo.h[i]=t,e()}),s.load(t)};(V["progress.StoryLoader"]=go).__name__="progress.StoryLoader",go.shouldShowUnlockAllStoriesButton=function(t){for(var e=H.allStoriesInfo,i=0;i<e.length;){var n=e[i];if(++i,n.unlockedWithAll&&!go.hasCompletedRequirements(t,n))return!0}return!1},go.hasCompletedRequirements=function(e,t){return null==t.requirements||(!(!t.unlockedWithAll||!e.metaGame.unlockedAll)||vn.all(t.requirements,function(t){return"notDemo"==t&&!k.isLimitedDemo||e.metaGame.hasWonScenario(t)}))},go.prototype={__class__:go};var mo=x["progress.UnlockState"]={__ename__:"progress.UnlockState",__constructs__:["Locked","Unlocked","Createable","Researched"],Locked:{_hx_index:0,__enum__:"progress.UnlockState",toString:i},Unlocked:{_hx_index:1,__enum__:"progress.UnlockState",toString:i},Createable:{_hx_index:2,__enum__:"progress.UnlockState",toString:i},Researched:{_hx_index:3,__enum__:"progress.UnlockState",toString:i}},fo=function(t){this.unlockMost=!1,this.checkBuildRelatedUnlocksIn=0,this.numberOfModernArtMuseumArtworksUnlocked=4,this.unlockedManagementOptions=!0,this.unlockedBuildingModeButton=!0,this.unlockedDecorationTab=!0,this.city=t,this.unlockState=new zr,this.shouldNotifyForUnlock=new zr,this.shouldNotifyForCategoryUnlock=new zr,this.explicityLocked=[],this.unlockedMaterials=[];for(var e=zr.valueIterator(t.progress.resources.buildingInfo.h);e.hasNext();){var i=e.next(),n=i.unlockedByDefault&&0==i.knowledge?mo.Researched:i.unlockedByDefault?mo.Unlocked:mo.Locked;this.unlockState.h["buildings."+i.className]=n}for(var s=zr.valueIterator(H.buildingUpgradesInfo.h);s.hasNext();){var r=s.next(),n=(h=null==r.unlockedByDefault||r.unlockedByDefault)&&0==r.knowledge?mo.Researched:h?mo.Unlocked:mo.Locked;this.unlockState.h["buildingUpgrades."+r.className]=n}for(var o=zr.valueIterator(H.cityUpgradesInfo.h);o.hasNext();){var a=o.next(),n=(h=null==a.unlockedByDefault||a.unlockedByDefault)?mo.Unlocked:mo.Locked;this.unlockState.h["cityUpgrades."+a.className]=n}for(var l=zr.valueIterator(H.policiesInfo.h);l.hasNext();){var h,u=l.next(),n=(h=null==u.unlockedByDefault||u.unlockedByDefault)?mo.Unlocked:mo.Locked;this.unlockState.h["policies."+u.className]=n}};function yo(t,e){this.alienRayInited=!1,this.isInvasionFinished=!1,this.isInvasion=!1,this.invasionProgress=0,this.timeUntilInvasion=0,co.call(this,t,e)}function _o(t,e){this.afterDoneMessage=null,this.timeBetweenMax=0,this.timeBetweenMin=0,this.worldID=0,this.ageRangeMax=0,this.ageRangeMin=0,this.groupSizeMax=1,this.groupSizeMin=0,this.nextSpawn=0,this.spawnNumber=0,co.call(this,t,e)}(V["progress.Unlocks"]=fo).__name__="progress.Unlocks",fo.prototype={postInitialCreate:function(){if(this.unlockMost){for(var t=zr.valueIterator(this.city.progress.resources.buildingInfo.h);t.hasNext();){var e=t.next(),i=e.notUnlockedWithAll||0!=e.knowledge?e.notUnlockedWithAll?mo.Locked:mo.Createable:mo.Researched;this.unlockState.h["buildings."+e.className]=i}for(var n=zr.valueIterator(H.buildingUpgradesInfo.h);n.hasNext();){var s=n.next(),i=(l=null==s.notUnlockedWithAll||!s.notUnlockedWithAll)&&0==s.knowledge?mo.Researched:l?mo.Unlocked:mo.Locked;this.unlockState.h["buildingUpgrades."+s.className]=i}for(var r=zr.valueIterator(H.cityUpgradesInfo.h);r.hasNext();){var o=r.next(),i=(l=null==o.notUnlockedWithAll||!o.notUnlockedWithAll)?mo.Unlocked:mo.Locked;this.unlockState.h["cityUpgrades."+o.className]=i}for(var a=zr.valueIterator(H.policiesInfo.h);a.hasNext();){var l,h=a.next(),i=(l=null==h.notUnlockedWithAll||!h.notUnlockedWithAll)?mo.Unlocked:mo.Locked;this.unlockState.h["policies."+h.className]=i}this.checkBuildRelatedUnlocks()}},postLoad:function(){for(var t=zr.valueIterator(this.city.progress.resources.buildingInfo.h);t.hasNext();){var e=t.next(),i="buildings."+e.className,n=e.unlockedByDefault&&-1==this.explicityLocked.indexOf(i);n&&0==e.knowledge?(c=mo.Researched,this.unlockState.h[i]=c):!n||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=mo.Locked?null==this.unlockState.h[i]&&(r=mo.Locked,this.unlockState.h[i]=r):(d=mo.Unlocked,this.unlockState.h[i]=d)}for(var s=zr.valueIterator(H.buildingUpgradesInfo.h);s.hasNext();){var r,o=s.next(),i="buildingUpgrades."+o.className;(u=(null==o.unlockedByDefault||o.unlockedByDefault)&&-1==this.explicityLocked.indexOf(i))&&0==o.knowledge?(c=mo.Researched,this.unlockState.h[i]=c):!u||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=mo.Locked?null==this.unlockState.h[i]&&(r=mo.Locked,this.unlockState.h[i]=r):(d=mo.Unlocked,this.unlockState.h[i]=d)}for(var a=zr.valueIterator(H.cityUpgradesInfo.h);a.hasNext();){var l=a.next(),i="cityUpgrades."+l.className;!(u=null==l.unlockedByDefault||l.unlockedByDefault)||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=mo.Locked?null==this.unlockState.h[i]&&(d=mo.Locked,this.unlockState.h[i]=d):(c=mo.Unlocked,this.unlockState.h[i]=c)}for(var h=zr.valueIterator(H.policiesInfo.h);h.hasNext();){var u,d,c,p=h.next(),i="policies."+p.className;!(u=null==p.unlockedByDefault||p.unlockedByDefault)||null!=this.unlockState.h[i]&&this.unlockState.h[i]!=mo.Locked?null==this.unlockState.h[i]&&(d=mo.Locked,this.unlockState.h[i]=d):(c=mo.Unlocked,this.unlockState.h[i]=c)}this.city.permanentNumberCached=null,this.checkBuildRelatedUnlocks(),this.city.gui.refreshCategoryBuildingsShown()},lock:function(t){var e=t.__name__,t=mo.Locked;this.unlockState.h[e]=t,this.city.gui.refreshCategoryBuildingsShown(),this.explicityLocked.push(e)},unlock:function(t,e){null==e&&(e=!1);var i=t.__name__;if(null!=this.unlockState.h[i]&&this.unlockState.h[i]!=mo.Locked)return!1;var n=this.city.progress.resources.buildingInfo.h[i];null==n&&(n=H.buildingUpgradesInfo.h[i]),null==n&&(n=H.cityUpgradesInfo.h[i]);var s=0==n.knowledge&&null==n.showUnlockHint?mo.Researched:mo.Unlocked;return this.unlockState.h[i]=s,null==n.showUnlockHint&&this.notifyForUnlock(t),this.city.gui.refreshCategoryBuildingsShown(),e||this.city.gui.reloadWindow(),this.city.permanentNumberCached=null,this.checkBuildRelatedUnlocks(),!0},fullyUnlock:function(t){var e,i=t.__name__;this.unlockState.h[i]==mo.Unlocked&&(e=mo.Createable,this.unlockState.h[i]=e,this.notifyForUnlock(t),this.city.gui.refreshCategoryBuildingsShown(),this.city.gui.reloadWindow())},research:function(t,e){null==e&&(e=!0);var i=t.__name__,n=this.unlockState.h[i],t=mo.Researched;this.unlockState.h[i]=t,n==mo.Locked&&this.city.gui.refreshCategoryBuildingsShown(),e&&n!=mo.Researched&&p.sendEvent("research",i)},getUnlockState:function(t){t=t.__name__;return this.unlockState.h[t]},getShouldNotifyForUnlock:function(t){t=t.__name__,t=this.shouldNotifyForUnlock.h[t];return null!=t&&t},notifyForUnlock:function(t){t=t.__name__;this.shouldNotifyForUnlock.h[t]=!0;t=this.city.progress.resources.buildingInfo.h[t];null!=t&&(this.shouldNotifyForCategoryUnlock.h[t.category]=!0)},stopNotifyForUnlock:function(t){t=t.__name__;this.shouldNotifyForUnlock.h[t]=!1},stopAllNotifyForUnlock:function(){this.shouldNotifyForUnlock=new zr,this.shouldNotifyForCategoryUnlock=new zr},getShouldNotifyForCategoryUnlock:function(t){return this.shouldNotifyForCategoryUnlock.h[t]},stopNotifyCategoryUnlock:function(t){this.shouldNotifyForCategoryUnlock.h[t]=!1},checkBuildRelatedUnlocksSoon:function(){this.checkBuildRelatedUnlocksIn=0<this.checkBuildRelatedUnlocksIn?this.checkBuildRelatedUnlocksIn:60},update:function(t){0<this.checkBuildRelatedUnlocksIn&&(this.checkBuildRelatedUnlocksIn-=t,this.checkBuildRelatedUnlocksIn<=0&&this.checkBuildRelatedUnlocks())},checkBuildRelatedUnlocks:function(){var t=this.city.getAmountOfPermanentsPerType();if(5<=t.h["buildings.Park"]&&(this.unlock(he),10<=t.h["buildings.Park"]&&5<=t.h["buildings.Laboratory"]&&this.fullyUnlock(he)),3<=t.h["buildings.ModernArtMuseum"]&&this.fullyUnlock(ee),this.unlockState.h["buildings.BotanicalGardens"]!=mo.Researched&&this.unlockState.h["buildings.BotanicalGardens"]!=mo.Createable||(this.unlock(Se),10<=t.h["buildings.BotanicalGardens"]&&1<=t.h["buildings.ExperimentalFarm"]&&this.fullyUnlock(Se)),5<=t.h["buildings.Laboratory"]&&1<=t.h["buildings.RefinedMetalFactory"]&&this.fullyUnlock(be),1<=t.h["buildings.ComputerResearchCenter"]&&this.unlock(we),3<=t.h["buildings.MachinePartsFactory"]&&this.fullyUnlock(ii),1<=t.h["buildings.LivingResearchCenter"]&&(this.fullyUnlock(ve),this.unlock(pi),this.unlock(lt),this.unlock(Dt)),1<=t.h["buildings.ComputerChipFactory"]&&(this.unlock(Ne),3<=t.h["buildings.Arcade"]&&this.fullyUnlock(Ne)),2<=t.h["buildings.Pub"]&&(this.unlock(fi),5<=t.h["buildings.Pub"]&&(this.fullyUnlock(fi),this.unlock(Ge))),2<=t.h["buildings.Restaurant"]&&this.fullyUnlock(Ge),2<=t.h["buildings.BlossomRestaurant"]&&(this.unlock(se),10<=t.h["buildings.BlossomRestaurant"]&&this.fullyUnlock(se)),10<=t.h["buildings.FarmByProductProcessor"]&&200<=t.h["buildings.BotanicalGardens"]&&50<=t.h["buildings.BlossomHut"]&&this.unlock(Di),1<=t.h["buildings.RefinedMetalFactory"]&&15<=t.h["buildings.StoneMine"]&&3<=t.h["buildings.StoneTeleporter"]&&this.fullyUnlock(ki),4<=t.h["buildings.MechanicalHouse"]&&3<=t.h["buildings.RefinedMetalFactory"]&&1<=t.h["buildings.ComputerChipFactory"]&&(this.unlock(Ie),12<=t.h["buildings.MechanicalHouse"]&&10<=t.h["buildings.RefinedMetalFactory"]&&3<=t.h["buildings.ComputerChipFactory"]&&this.fullyUnlock(Ie)),1<=t.h["buildings.TheMachine"]&&1<=t.h["buildings.FestivalHQ"]&&this.unlock(De),5<=t.h["buildings.School"]&&this.unlock(Je),1<=t.h["buildings.StatueOfHappiness"]&&this.unlock(ie),this.getUnlockState(ne)==mo.Unlocked&&20<=t.h["buildings.BotanicalGardens"]){for(var e=!1,i=0,n=this.city.permanents;i<n.length;){var s=n[i];if(++i,s.is(he)){s=s;if(null==s.bottomBuilding||!s.bottomBuilding.is(he)){for(var r=s.topBuilding,o=1;null!=r&&r.is(he);)r=r.topBuilding,++o;20<=o&&(e=!0)}}}e&&this.fullyUnlock(ne)}1<=t.h["buildings.ComputerChipFactory"]&&k.hasPremium()&&this.unlock(Oi),6<=t.h["buildings.HerbGarden"]&&1<=t.h["buildings.RefinedMetalFactory"]&&k.hasPremium()&&(this.unlock(Qt),12<=t.h["buildings.HerbGarden"]&&this.fullyUnlock(Qt))},unlockMaterial:function(t){-1==this.unlockedMaterials.indexOf(t)&&(this.unlockedMaterials.push(t),this.city.gui.refreshCityInfo())},unlockedMaterial:function(t){return-1!=this.unlockedMaterials.indexOf(t)},checkStatRelatedUnlocks:function(){200<=this.city.simulation.stats.peopleWithHome&&this.fullyUnlock(Ze),200<=this.city.simulation.citizens.length&&this.fullyUnlock(Ye),99.99<=this.city.simulation.happiness.happiness&&this.unlock(Ii),500<=this.city.simulation.citizens.length&&1<this.city.teleporters.length&&this.unlock(Si),5<=this.city.simulation.bonuses.fossilsCollected&&this.unlock(Re),750<=this.city.simulation.citizens.length&&this.unlock(ne),this.getUnlockState(ie)==mo.Unlocked&&20160<=this.city.simulation.happiness.fullHappinessTime&&(this.fullyUnlock(ie),console.log("FloatingSpaceCities/progress/Unlocks.hx:540:","beacon_unlocked")),100<=this.city.simulation.citizens.length&&1<this.city.workBuildings.length&&this.unlock(me)},save:function(t,e){null==e&&(e=!0),e&&t.addString(fo.saveDefinition),t.addString(fr.run(this.unlockState)),t.addString(fr.run(this.explicityLocked));e=this.unlockedDecorationTab;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.unlockedBuildingModeButton;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.unlockedManagementOptions;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.numberOfModernArtMuseumArtworksUnlocked;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,t.addString(fr.run(this.unlockedMaterials))},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"unlockState")&&(this.unlockState=t.h.unlockState),Object.prototype.hasOwnProperty.call(t.h,"explicityLocked")&&(this.explicityLocked=t.h.explicityLocked),Object.prototype.hasOwnProperty.call(t.h,"unlockedDecorationTab")&&(this.unlockedDecorationTab=t.h.unlockedDecorationTab),Object.prototype.hasOwnProperty.call(t.h,"unlockedBuildingModeButton")&&(this.unlockedBuildingModeButton=t.h.unlockedBuildingModeButton),Object.prototype.hasOwnProperty.call(t.h,"unlockedManagementOptions")&&(this.unlockedManagementOptions=t.h.unlockedManagementOptions),Object.prototype.hasOwnProperty.call(t.h,"numberOfModernArtMuseumArtworksUnlocked")&&(this.numberOfModernArtMuseumArtworksUnlocked=t.h.numberOfModernArtMuseumArtworksUnlocked),Object.prototype.hasOwnProperty.call(t.h,"unlockedMaterials")&&(this.unlockedMaterials=t.h.unlockedMaterials),this.postLoad()},__class__:fo},(V["progress.scriptedStoryParts.AlienInvasion"]=yo).__name__="progress.scriptedStoryParts.AlienInvasion",yo.__super__=co,yo.prototype=e(co.prototype,{initialize:function(t){this.timeUntilInvasion=t.timeUntilInvasion},update:function(t){var e,i,n=this;this.isInvasionFinished||(this.isInvasion?(this.invasionProgress+=t,i=0,this.alienRayInited||(this.graphics=new PIXI.Graphics,this.city.movingViewStage.addChild(this.graphics),this.alienRayInited=!0),30<=this.invasionProgress?(this.city.mainMovingViewStage.alpha=0,i=1-(this.invasionProgress-30)/30,60<=this.invasionProgress&&(this.city.progress.story.currentGoal=null,this.loseAliens(),this.isInvasionFinished=!0)):i=this.invasionProgress/30,this.graphics.clear(),0<i&&(this.graphics.beginFill(4388075,i),e=vn.min(this.city.worlds,function(t){return t.rect.x-10}).rect.x-10,i=(i=vn.min(this.city.worlds,function(t){return t.rect.y-20*vn.max(t.permanents,function(t){return 20*t.length}).length-n.city.game.rect.height*n.city.game.scaling})).rect.y-20*vn.max(i.permanents,function(t){return 20*t.length}).length-n.city.game.rect.height*n.city.game.scaling,this.graphics.drawRect(e,i,vn.max(this.city.worlds,function(t){return t.rect.get_x2()+10}).rect.get_x2()+10-e,vn.max(this.city.worlds,function(t){return t.rect.get_y2()}).rect.get_y2()+this.city.game.rect.height*this.city.game.scaling-i),this.graphics.endFill())):(this.timeUntilInvasion-=t,this.isInvasion=!0))},loseAliens:function(){var t=this;this.city.activateLoserState(),this.city.gui.createWindow(),this.city.gui.windowAddTitleText("You Lost!"),this.city.gui.windowAddInfoText("Aliens have destroyed your city blah blah."),this.city.gui.windowAddBottomButtons(null,"Try Again"),this.city.gui.windowOnDestroy=function(){t.city.game.newCity(t.city.progress.story.storyName,t.city.cityFile)}},save:function(t,e){null==e&&(e=!0),co.prototype.save.call(this,t),e&&t.addString(yo.saveDefinition);e=this.timeUntilInvasion;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.invasionProgress;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.isInvasion;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.isInvasionFinished;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},load:function(t,e){co.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"timeUntilInvasion")&&(this.timeUntilInvasion=t.h.timeUntilInvasion),Object.prototype.hasOwnProperty.call(t.h,"invasionProgress")&&(this.invasionProgress=t.h.invasionProgress),Object.prototype.hasOwnProperty.call(t.h,"isInvasion")&&(this.isInvasion=t.h.isInvasion),Object.prototype.hasOwnProperty.call(t.h,"isInvasionFinished")&&(this.isInvasionFinished=t.h.isInvasionFinished)},__class__:yo}),(V["progress.scriptedStoryParts.SpawnCitizensRegularly"]=_o).__name__="progress.scriptedStoryParts.SpawnCitizensRegularly",_o.__super__=co,_o.prototype=e(co.prototype,{update:function(t){var e,i;0<this.spawnNumber&&this.simulation.time.timeSinceStart>=this.nextSpawn?(i=this.spawnNumber,i=(e=bo.getInt(this.groupSizeMin,this.groupSizeMax+1))<i?e:i,this.spawnNumber-=i,this.city.simulation.citizens.length<200&&1.5<this.city.simulation.boostManager.currentGlobalBoostAmount&&(i*=2),this.city.simulation.citizenSpawners.push(new Go(this.city.simulation,this.city.farForegroundStage,this.city.worlds[this.worldID],{time:0,type:"SpawnCitizensFlyingSaucer",amount:i,ageRangeMin:this.ageRangeMin,ageRangeMax:this.ageRangeMax,world:this.worldID})),i=1,this.city.simulation.stats.houseCapacity>this.city.simulation.stats.peopleWithHome+this.groupSizeMin&&this.city.simulation.stats.jobs>this.city.simulation.stats.laborForce+this.groupSizeMin&&5<this.spawnNumber&&(i=10<this.city.materials.food?.6:.7),this.nextSpawn=this.simulation.time.timeSinceStart+60*i*bo.getFloat(this.timeBetweenMin,this.timeBetweenMax)):this.spawnNumber<=0&&0==this.simulation.citizenSpawners.length&&(null==this.afterDoneMessage||""==this.afterDoneMessage||this.city.gui.showSimpleWindow(this.afterDoneMessage,null,!1,!0))&&Y.remove(this.story.scriptedParts,this)},initialize:function(t){this.spawnNumber=t.spawnNumber,this.groupSizeMin=t.groupSizeMin,this.groupSizeMax=t.groupSizeMax,this.ageRangeMin=t.ageRangeMin,this.ageRangeMax=t.ageRangeMax,this.worldID=t.world,this.timeBetweenMin=t.timeBetweenMin,this.timeBetweenMax=t.timeBetweenMax,this.afterDoneMessage=t.afterDoneMessage},save:function(t,e){null==e&&(e=!0),co.prototype.save.call(this,t),e&&t.addString(_o.saveDefinition);e=this.spawnNumber;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.nextSpawn;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.groupSizeMin;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.groupSizeMax;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.ageRangeMin;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.ageRangeMax;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.worldID;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.timeBetweenMin;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.timeBetweenMax;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,t.addString(this.afterDoneMessage)},load:function(t,e){co.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"spawnNumber")&&(this.spawnNumber=t.h.spawnNumber),Object.prototype.hasOwnProperty.call(t.h,"nextSpawn")&&(this.nextSpawn=t.h.nextSpawn),Object.prototype.hasOwnProperty.call(t.h,"groupSizeMin")&&(this.groupSizeMin=t.h.groupSizeMin),Object.prototype.hasOwnProperty.call(t.h,"groupSizeMax")&&(this.groupSizeMax=t.h.groupSizeMax),Object.prototype.hasOwnProperty.call(t.h,"ageRangeMin")&&(this.ageRangeMin=t.h.ageRangeMin),Object.prototype.hasOwnProperty.call(t.h,"ageRangeMax")&&(this.ageRangeMax=t.h.ageRangeMax),Object.prototype.hasOwnProperty.call(t.h,"worldID")&&(this.worldID=t.h.worldID),Object.prototype.hasOwnProperty.call(t.h,"timeBetweenMin")&&(this.timeBetweenMin=t.h.timeBetweenMin),Object.prototype.hasOwnProperty.call(t.h,"timeBetweenMax")&&(this.timeBetweenMax=t.h.timeBetweenMax),Object.prototype.hasOwnProperty.call(t.h,"afterDoneMessage")&&(this.afterDoneMessage=t.h.afterDoneMessage)},__class__:_o});var wo=function(){};(V["progress.worldGenerators.RandomMiniWorlds"]=wo).__name__="progress.worldGenerators.RandomMiniWorlds",wo.doGenerate=function(t,e,i,n,s,r){for(var o=t.numberOfWorldsMin,a=t.numberOfWorldsMax,l=t.minX,h=t.minY,u=t.maxX,d=t.maxY,c=t.minWidth,p=t.maxWidth,g=t.minHeight,m=t.maxHeight,f=t.heightVariation,y=[],_=0,w=bo.getInt(o,a);_<w;){_++;for(var b=0;++b<1e4;){for(var v=20*bo.getInt(l/20|0,1+(u/20|0)),S=20*bo.getInt(h/20|0,1+(d/20|0)),x=20*bo.getInt(c/20|0,1+(p/20|0)),P=Math.round(((x-c)/(p-c)*(m-g)+g+bo.getInt(f))/20),C=20*(P<1?1:100<P?100:P),I=!0,T=0,B=e.worlds;T<B.length;){var k=B[T];if(++T,k.rect.intersects(new xn(v-20,S-40,41+x,61+C))){I=!1;break}}if(I){P=new K(e.game,e,n,s,r,new xn(v,S,x,C),bo.getInt(1e6));e.worlds.push(P),y.push(P);break}}1e3<=b&&(console.log("FloatingSpaceCities/progress/worldGenerators/RandomMiniWorlds.hx:48:","world not generated; max # of tries exceeded - RandomMiniWorlds.doGenerate with args:"),console.log("FloatingSpaceCities/progress/worldGenerators/RandomMiniWorlds.hx:49:",t))}for(var M=y.slice(),z=[],_=0,w=t.initialBuildings;_<w.length;){var A=w[_];++_;for(T=0,B=bo.getInt(A.numberMin,A.numberMax);T<B;){T++;var W="buildings."+q.string(A.className);z.push(V[W])}}for(_=0,w=t.initialWorldResources;_<w.length;){var F=w[_];++_;for(T=0,B=bo.getInt(F.numberMin,F.numberMax);T<B;){T++;W="worldResources."+q.string(F.className);z.push(V[W])}}for(var O=!1,_=0;_<z.length;){var D=z[_];++_;var R=-1!=D.__name__.indexOf("buildings.");O||R||(t.rememberWorldSpreadBetweenBuildingsAndWorldResources&&(M=y.slice()),O=!0);for(var U,L=[],b=0;++b<=2;){var E=y;(t.spreadBuildingsEvenlyBetweenWorlds&&R||t.spreadWorldResourcesEvenlyBetweenWorlds&&!R)&&(E=M);for(w=0;w<E.length;){var H=E[w];++w;for(var N=0,T=0,B=H.permanents.length;T<B;){v=T++;0==H.permanents[v].length&&++N}if(R||!t.avoidGeneratingOverfullWorlds||1<H.permanents.length&&1<N)for(var G=0,X=H.permanents.length;G<X;){var j=G++;0==H.permanents[j].length&&L.push({world:H,xPos:j})}}if(0!=L.length)break;M=y.slice()}0<L.length&&(U=bo.fromArray(L),Y.remove(M,U.world),R?U.world.build(D,U.xPos):U.world.createWorldResource(D,U.xPos))}};var bo=function(){};(V["random.Random"]=bo).__name__="random.Random",bo.getFloat=function(t,e){var i=0,n=1;return null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t),Math.random()*(n-i)+i},bo.getInt=function(t,e){var i=0,n=2147483647;return null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t),Math.floor(Math.random()*(n-i))+i},bo.fromArray=function(t){if(0==t.length)throw cr.thrown("You can't get a random item from an empty array!");return t[bo.getInt(t.length)]};var vo=function(t){t=this.seed=null==t?q.random(2147483647):t,t=new mr(t>>31,t);this.state0=t;t=new mr(0,89432);this.state1=t};(V["random.SeedeableRandom"]=vo).__name__="random.SeedeableRandom",vo.prototype={getInt64:function(){var t=this.state0,e=this.state1;this.state0=e;var i=23;s=n=0==(i&=63)?new mr(e.high,e.low):i<32?new mr(e.high<<i|e.low>>>32-i,e.low<<i):new mr(e.low<<i-32,0);e=n=new mr(e.high^s.high,e.low^s.low),i=18;s=n=0==(i&=63)?new mr(e.high,e.low):i<32?new mr(e.high>>i,e.high<<32-i|e.low>>>i):new mr(e.high>>31,e.high>>i-32);var n=new mr(e.high^s.high,e.low^s.low);e=n=new mr((e=n).high^t.high,e.low^t.low);i=5;s=n=0==(i&=63)?new mr(t.high,t.low):i<32?new mr(t.high>>i,t.high<<32-i|t.low>>>i):new mr(t.high>>31,t.high>>i-32),e=n=new mr(e.high^s.high,e.low^s.low),this.state1=e;var s=this.state0,i=this.state1,e=s.high+i.high|0,i=s.low+i.low|0;return pr.ucompare(i,s.low)<0&&(e++,e|=0),n=new mr(e,i)},getInt:function(t,e){var i=0,n=2147483647;null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t);e=this.getInt64(),t=1;t&=63,e=t=new mr(e.high>>>1,e.high<<31|e.low>>>1);n-=i,t=new mr(n>>31,n);if((n=gr.divMod(e,t).modulus).high!=n.low>>31)throw cr.thrown("Overflow");return i+n.low},getFloat:function(t,e){var i=0,n=1;null!=t&&null!=e?(i=t,n=e):null!=t&&(n=t);t=this.getInt64();return Math.abs(t.low/2147483647)*(n-i)+i},__class__:vo};var So=function(t,e){this.totalBabyMakeCapacity=0,this.targetPopAmount=-1,this.mode=0,this.softPopLimit=2e3,this.updateStatsIn=-2,this.city=t,this.simulation=e,this.babyMakerCapacity=new Mr,this.babiesPerYear=new Mr};(V["simulation.BabyMaker"]=So).__name__="simulation.BabyMaker",So.prototype={getCurrentBabyProduction:function(){if(this.simulation.happiness.happiness<10&&this.simulation.stats.peopleWithHome<this.simulation.stats.people/2&&this.city.materials.food<1)return 0;if(this.simulation.happiness.happiness<10)return.8;switch(this.mode){case 0:return 1+this.simulation.happiness.happiness/140/Math.pow((Math.pow(this.simulation.citizens.length,1.2)+500)/1400,.4);case 1:return-1==this.targetPopAmount?1:this.simulation.citizens.length>=this.targetPopAmount?.1:3;case 2:return 1+this.simulation.happiness.happiness/140*.4/Math.pow((Math.pow(this.simulation.citizens.length,1.2)+500)/1400,.4);case 3:return 1+(this.simulation.happiness.happiness/140+Math.max(0,(this.simulation.happiness.happiness-60)/120))/Math.pow((Math.pow(this.simulation.citizens.length,1.2)+500)/1400,.4)}},update:function(t){this.updateStatsIn<=0&&(this.updateStatsIn+=60,this.updateStats()),this.updateStatsIn-=t;for(var e=this.simulation.time.minutesPerTick*t/60/24,i=0,n=this.city.worlds;i<n.length;){var s=n[i];++i,this.simulation.citizens.length<this.softPopLimit&&2<=this.simulation.citizens.length&&2<=this.babyMakerCapacity.h[s.__id__]&&bo.getFloat()<this.babiesPerYear.h[s.__id__]*e&&this.createBaby(s)}},createBaby:function(e){var t,i;0!=this.simulation.citizens.length&&(t=vn.findRandom(this.simulation.citizens,function(t){return t.onWorld==e&&20<=t.get_age()&&t.get_age()<55}),i=this.simulation.citizens[0],null!=t&&(i=t),this.simulation.createCitizen(i.onWorld,0,i.inPermanent,0|i.relativeX))},onCitizenDeath:function(){if(this.simulation.citizens.length==this.softPopLimit&&0!=this.totalBabyMakeCapacity){for(var t=bo.getFloat(),e=this.city.worlds[0],i=0,n=this.city.worlds;i<n.length;){var s=n[i];++i,(t-=this.babyMakerCapacity.h[s.__id__]/this.totalBabyMakeCapacity)<=0&&(e=s)}this.createBaby(e)}},updateStats:function(){for(var t=0,e=this.city.worlds;t<e.length;){var i=e[t];++t,this.babyMakerCapacity.set(i,0)}for(t=0,e=this.simulation.citizens;t<e.length;){var n=e[t];++t;var s=n.onWorld,r=this.babyMakerCapacity,o=r.h[s.__id__]+(20<=n.get_age()&&n.get_age()<45?1:45<=n.get_age()&&n.get_age()<55?1-(n.get_age()-45)/10:0);r.set(s,o)}for(t=0,e=this.city.worlds;t<e.length;){i=e[t];++t;var a=this.getCurrentBabyProduction(),o=this.babyMakerCapacity.h[i.__id__]*a/30;this.babiesPerYear.set(i,o),this.totalBabyMakeCapacity+=this.babyMakerCapacity.h[i.__id__]}},save:function(t,e){null==e&&(e=!0),e&&t.addString(So.saveDefinition);e=this.softPopLimit;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,t.addString(fr.run(this.mode));var i,e=this.targetPopAmount;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"softPopLimit")&&(this.softPopLimit=t.h.softPopLimit),Object.prototype.hasOwnProperty.call(t.h,"mode")&&(this.mode=t.h.mode),Object.prototype.hasOwnProperty.call(t.h,"targetPopAmount")&&(this.targetPopAmount=t.h.targetPopAmount)},__class__:So};var xo=function(){this.fossilsCollected=0,this.indoorFarmSpeed=1,this.labSpeed=1,this.machinePartsFactorySpeed=1,this.extraFoodFromFarms=0};(V["simulation.BonusResults"]=xo).__name__="simulation.BonusResults",xo.prototype={save:function(t,e){null==e&&(e=!0),e&&t.addString(xo.saveDefinition);e=this.extraFoodFromFarms;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.machinePartsFactorySpeed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.labSpeed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.indoorFarmSpeed;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.fossilsCollected;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"extraFoodFromFarms")&&(this.extraFoodFromFarms=t.h.extraFoodFromFarms),Object.prototype.hasOwnProperty.call(t.h,"machinePartsFactorySpeed")&&(this.machinePartsFactorySpeed=t.h.machinePartsFactorySpeed),Object.prototype.hasOwnProperty.call(t.h,"labSpeed")&&(this.labSpeed=t.h.labSpeed),Object.prototype.hasOwnProperty.call(t.h,"indoorFarmSpeed")&&(this.indoorFarmSpeed=t.h.indoorFarmSpeed),Object.prototype.hasOwnProperty.call(t.h,"fossilsCollected")&&(this.fossilsCollected=t.h.fossilsCollected)},__class__:xo};var Po=x["simulation.ExtraBoostType"]={__ename__:"simulation.ExtraBoostType",__constructs__:["DoubleBoost","TripleBoost","DoubleMaterialReward","TripleMaterialReward"],DoubleBoost:{_hx_index:0,__enum__:"simulation.ExtraBoostType",toString:i},TripleBoost:{_hx_index:1,__enum__:"simulation.ExtraBoostType",toString:i},DoubleMaterialReward:{_hx_index:2,__enum__:"simulation.ExtraBoostType",toString:i},TripleMaterialReward:{_hx_index:3,__enum__:"simulation.ExtraBoostType",toString:i}},Co=function(t){this.timeUntilNextExtraBoost=0,this.claimedExtraBoostType=null,this.currentExtraBoostLeft=0,this.currentExtraBoostType=null,this.currentExtraBoostArrow=null,this.disableRewardedAd=!1,this.currentGlobalBoostAmount=1,this.infoButtonShown=!1,this.infoButtonParent=null,this.normalMaxBoost=10800,this.maxBoost=10800,this.boostLeft=0,this.simulation=t,this.city=t.city,this.timeUntilNextExtraBoost=36e3+bo.getFloat(36e3)};(V["simulation.BoostManager"]=Co).__name__="simulation.BoostManager",Co.prototype={update:function(t){0<this.boostLeft?(this.boostLeft-=t,this.currentGlobalBoostAmount=2):this.currentGlobalBoostAmount=1,null!=this.infoButtonParent&&((0<this.boostLeft||this.boostAvailable())&&!R.boostHidden?this.infoButtonShown||(this.infoButtonShown=!0,this.actuallyCreateBoostButton()):this.infoButtonShown&&(this.infoButtonShown=!1,this.infoButtonParent.removeChild(this.infoButton),this.infoButton=null)),this.optionallyCreateExtraBoost(t)},optionallyCreateExtraBoost:function(t){this.city.simulationSpeed<.1||this.city.pauseGame||this.city.game.isMobile},getExtraBoostTypeText:function(){if(null==this.currentExtraBoostType)return"";switch(this.currentExtraBoostType._hx_index){case 0:return kn.lo("2x_boost");case 1:return kn.lo("3x_boost");case 2:return kn.lo("double_bonus_boost");case 3:return kn.lo("triple_bonus_boost")}},getSpecialSuccessText:function(){if(null==this.claimedExtraBoostType)return"";switch(this.claimedExtraBoostType._hx_index){case 0:return kn.lo("2x_boost_claimed");case 1:return kn.lo("3x_boost_claimed");case 2:return kn.lo("double_bonus_boost_claimed");case 3:return kn.lo("triple_bonus_boost_claimed")}},destroyExtraBoost:function(){null!=this.currentExtraBoostArrow&&(this.currentExtraBoostArrow.destroy(),this.currentExtraBoostArrow=null),this.currentExtraBoostLeft=0,this.currentExtraBoostType=null},createExtraBoost:function(){var t=this;null==this.currentExtraBoostArrow&&(this.currentExtraBoostArrow=new Ms(this.city.gui,this.city.gui.stage,function(){return t.infoButtonShown?t.infoButton:null},function(){return!0},ks.DownHint),this.currentExtraBoostType=bo.fromArray([Po.DoubleBoost,Po.DoubleBoost,Po.DoubleBoost,Po.TripleBoost,Po.DoubleMaterialReward,Po.TripleMaterialReward]),this.currentExtraBoostArrow.addText(this.getExtraBoostTypeText()+" "+kn.lo("claim_within_n_s",[16])),this.currentExtraBoostLeft=960)},boostAvailable:function(){return!(!(bn.adAvailableRewarded()&&this.boostLeft<=0)||this.disableRewardedAd)&&!this.city.progress.sandbox.unlimitedResources},createBoostButton:function(t,e,i){this.infoButtonParent=e},hideBoostButtonAfterGUIHide:function(){this.infoButtonParent=null,this.infoButtonShown=!1},actuallyCreateBoostButton:function(){var s=this,t=this.infoButtonParent,e=this.city.gui.stage,i=this.city.gui;this.infoButton=new hs(this.city.gui,e,t,function(){s.boostLeft<=0&&s.boostAvailable()&&(null!=s.currentExtraBoostType&&0<=s.currentExtraBoostLeft&&(s.claimedExtraBoostType=s.currentExtraBoostType,s.destroyExtraBoost()),bn.showRewardedInterstitial(function(){s.boostLeft=s.normalMaxBoost,s.maxBoost=s.normalMaxBoost;var t,e,i="",n=1;if(null!=s.claimedExtraBoostType){switch(s.claimedExtraBoostType._hx_index){case 0:s.boostLeft*=2,s.maxBoost*=2;break;case 1:s.boostLeft*=3,s.maxBoost*=3;break;case 2:n*=2;break;case 3:n*=3}i=s.getSpecialSuccessText(),s.claimedExtraBoostType=null}Co.enableExtraReward&&(s.city.game.mouse.resetPosition(),(t=s.getRandomReward(n)).materials.addToProduction(s.city.simulation.stats),s.city.materials.add(t.materials),e=null,(e=function(){s.city.gui.createWindow("adRewardWindow"),s.city.gui.setWindowReload(e),Qn.create(s.city,s.city.gui,s.city.gui.innerWindowStage,s.city.gui.windowInner,t,i)})())},function(){s.city.gui.showSimpleWindow(kn.lo("boost_failed"))},!0))},function(){return 0<s.boostLeft},function(){0<s.boostLeft?i.tooltip.setText(kn.lo("boost"),kn.lo("boost_active_description"),kn.lo("boost_active")):i.tooltip.setText(kn.lo("boost"),kn.lo("boost_use_case")+(Co.enableExtraReward?"\n"+kn.lo("boost_earn_extra_reward"):""))},"spr_transparentbutton_info",10526880,16777215,function(){if(s.boostLeft<=0)return-1;var t=s.boostLeft/s.maxBoost;return t<0?0:1<t?1:t}),this.infoButton.container.fillSecondarySize=!0;var n=i.game.isMobile?3:0,r=i.game.isMobile?2:0;return this.infoButton.container.padding={left:2+n,right:3+n,top:2+n,bottom:1+n},this.infoButton.container.updateSize(),this.infoButton.container.addChild(new us(this.infoButton.container,e,new PIXI.Sprite(H.getTexture("spr_icon_boost")))),this.infoButton.container.addChild(new Qs(this.infoButton.container,e,null,function(){return kn.lo("boost")},"Arial15",{left:1+r,right:0,top:2,bottom:0})),this.infoButton.container.minWidth=20,t.insertChild(this.infoButton,0),this.infoButton},getRandomReward:function(t){var e="",i=new M,n=!1,s=!1,r=!1,o=11;switch(.2<this.city.materials.machineParts&&(o=16,n=!0),.2<this.city.materials.refinedMetal&&(o=19,s=!0),.2<this.city.materials.computerChips&&(o=22,r=!0),bo.getInt(o)){case 0:e="Lunchbox",i.add(new M(0,0,10));break;case 1:e="Pile of Wood",i.add(new M(25));break;case 2:e="Book",i.add(new M(0,0,0,0,15));break;case 3:e="Alien Candy Bar",i.add(new M(0,0,15,0,5));break;case 4:e="Rock",i.add(new M(0,20,0,0,0));break;case 5:e="Pile of Materials",i.add(new M(bo.getInt(10,30),bo.getInt(10,30),0,0,0));break;case 6:e="Flower",i.add(new M(5,0,0,0,9));break;case 7:e="Statue",i.add(new M(0,15,0,0,7));break;case 8:e="Comet",i.add(new M(0,20,0,0,15));break;case 9:e="Brick",i.add(new M(0,25,0,0));break;case 10:e=bo.fromArray(["Cabbage","Potato","Carrot","Bread"]),i.add(new M(0,0,7));break;case 11:e="Box of Wires",i.add(new M(5,0,0,10,0));break;case 12:e="Toolbox",i.add(new M(0,12,0,9));break;case 13:e="Mechanical Pear",i.add(new M(0,0,1,1,20));break;case 14:e="Beeping Device",i.add(new M(0,10,0,5,2));break;case 15:e="Robot Arm",i.add(new M(0,10,0,10,25));break;case 16:e="Sphere",i.add(new M(0,0,0,0,10,10,0));break;case 17:e="Gem",i.add(new M(0,0,0,0,0,20,0));break;case 18:e="Pile of Pebbles",i.add(new M(0,40,0,0,0,10,0));break;case 19:e="Laptop",i.add(new M(0,0,0,5,0,4,1));break;case 20:e="UFO",i.add(new M(0,0,0,0,15,5,2));break;case 21:e="Flashing Box",i.add(new M(0,20,0,0,8,0,1))}var a,l=bo.getFloat(.8),o=!1;l<.05&&!o&&(e="Big "+e,i.multiply(1.5),o=!0),(l-=.05)<.04&&!o&&(e="Mega "+e,i.multiply(2),o=!0),(l-=.04)<.02&&!o&&(e="Giant "+e,i.multiply(3),o=!0),(l-=.02)<.02&&!o&&(e="Smart "+e,i.knowledge+=5,r&&(i.computerChips+=1),o=!0),(l-=.02)<.01&&r&&!o&&(e="Network-Connected "+e,i.computerChips+=2,o=!0),(l-=.01)<.02&&!o&&(e="Edible "+e,(a=i).set_food(a.food+20),o=!0),(l-=.02)<.02&&!o&&(e="Slimy "+e,(a=i).set_food(a.food+5),o=!0),(l-=.02)<.02&&s&&!o&&(e="Cold "+e,i.refinedMetal+=5,o=!0),(l-=.02)<.02&&n&&!o&&-1==e.indexOf("Mechanical")&&(e="Mechanical "+e,i.machineParts+=6,o=!0),(l-=.02)<.02&&!o&&(e="Growing "+e,i.wood+=20,i.multiply(1.5),o=!0),(l-=.02)<.02&&!o&&s&&(e="Metal "+e,i.refinedMetal+=4,o=!0),(l-=.02)<.02&&!o&&(e="Musical "+e,i.wood+=5,i.knowledge+=10,o=!0),(l-=.02)<.02&&!o&&(e="Paper "+e,i.multiply(.5),i.knowledge+=15,o=!0),(l-=.02)<.02&&!o&&n&&(e="Rotating "+e,i.machineParts+=10,o=!0),(l-=.02)<.03&&!o&&(e="Cool-Looking "+e,i.multiply(2.2),i.knowledge+=1,o=!0),(l-=.03)<.02&&!o&&r&&(e="IOT "+e,i.computerChips+=1,o=!0),(l-=.02)<.02&&!o&&(e="Overgrown "+e,i.wood*=3,i.wood+=20,o=!0),(l-=.02)<.01&&!o&&(e="Tiny "+e,i.multiply(.75),o=!0),(l-=.01)<.02&&!o&&r&&(e="Luminous "+e,i.computerChips+=1,i.knowledge+=2,o=!0),(l-=.02)<.02&&!o&&(e="Dark "+e,i.knowledge+=5,i.stone+=2,o=!0),(l-=.02)<.02&&!o&&(e="Stony "+e,i.stone+=20,o=!0),(l-=.02)<.02&&!o&&(e="Ancient "+e,i.stone+=10,o=!0),(l-=.02)<.02&&!o&&(e="Starry "+e,i.stone+=10,i.knowledge+=5,o=!0),(l-=.02)<.02&&!o&&(e="Delicious "+e,(a=i).set_food(a.food+10),o=!0),(l-=.02)<.02&&!o&&(e="Profitable "+e,i.multiply(1.2),(a=i).set_food(a.food+15),o=!0),(l-=.02)<.02&&!o&&(e="Extremely Normal-Looking "+e,o=!0),(l-=.02)<.02&&!o&&s&&(e="Shiny "+e,i.refinedMetal+=10,o=!0),(l-=.02)<.02&&!o&&n&&(e="Dancing "+e,i.machineParts+=8,o=!0),(l-=.02)<.02&&!o&&r&&(e="Computerized "+e,i.computerChips+=2,o=!0);o=Math.pow(this.city.simulation.stats.materialProduction[z.findMaterialIndex("wood")][1]+this.city.simulation.stats.materialProduction[z.findMaterialIndex("stone")][1]+this.city.simulation.stats.materialProduction[z.findMaterialIndex("food")][1]+this.city.simulation.stats.materialProduction[z.findMaterialIndex("knowledge")][1],.66)/16,l=1.5<t?2:1;return i.multiply(o<l?l:12<o?12:o),i.multiply(t),i.roundAll(),{text:e,materials:i}},save:function(t,e){null==e&&(e=!0),e&&t.addString(Co.saveDefinition);e=this.boostLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.maxBoost;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.normalMaxBoost;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"boostLeft")&&(this.boostLeft=t.h.boostLeft),Object.prototype.hasOwnProperty.call(t.h,"maxBoost")&&(this.maxBoost=t.h.maxBoost),Object.prototype.hasOwnProperty.call(t.h,"normalMaxBoost")&&(this.normalMaxBoost=t.h.normalMaxBoost)},__class__:Co};var Io=function(t){this.entertainmentInited=!1,this.tryForDayEntertainment=0,this.tryForEntertainment=0;for(var e=[],i=this.entertainmentFinishedTime=0,n=zo.entertainmentTypeNumber;i<n;){i++;e.push(0)}this.recentEntertainmentTypes=e,this.citizen=t,this.entertainmentInited=!1,this.tryForDayEntertainment=0,this.setAgeRelatedEntertainment()};function To(t){this.citizen=null,this.citizen=t,this.simulation=t.onWorld.city.simulation,this.time=this.simulation.time}(V["simulation.CitizenEntertainment"]=Io).__name__="simulation.CitizenEntertainment",Io.prototype={get_normallyAtHomeTimeFrom:function(){var t=this.citizen.get_workTimePreference(),e=null==this.citizen.job?23:(e=this.citizen.job.endTime,e+=4,e%=24);return t+e},get_normallyAtHomeTimeTo:function(){return this.citizen.get_workTimePreference()+(null==this.citizen.job?8:this.citizen.job.startTime)},setAgeRelatedEntertainment:function(){this.citizen.get_age()<16&&bo.getInt(1e3)<998&&(this.recentEntertainmentTypes[0]=this.citizen.simulation.time.timeSinceStart+1440*(this.citizen.get_age()-bo.getFloat(14,16)))},updateEntertainment:function(t){var e,i,n,s,r,o,a,l=!1;return null!=this.citizen.inPermanent&&this.citizen.inPermanent.isBuilding&&this.citizen.inPermanent.isEntertainment&&(e=!0,i=this.citizen.inPermanent,n=this.citizen.simulation.time.timeSinceStart,this.entertainmentInited||(i.get_isOpen()?(s=1,null==this.citizen.job&&null==this.citizen.school&&(s=.75),this.entertainmentFinishedTime=n+60*bo.getFloat(i.get_minimumNormalTimeToSpend(),i.get_maximumNormalTimeToSpend()),this.recentEntertainmentTypes[i.get_entertainmentType()]=n+1440*bo.getFloat(i.get_minimumEntertainmentGroupSatisfy(),i.get_maximumEntertainmentGroupSatisfy())*s,this.entertainmentInited=!0):this.entertainmentFinishedTime=n-1e3),(!i.get_isOpenForExistingVisitors()||n>=this.entertainmentFinishedTime)&&i.finishEntertainment(this.citizen,t)?(e=!1,this.entertainmentInited=!1):i.beEntertained(this.citizen,t),l=e),!!l||(!!(16<this.citizen.get_age()&&this.citizen.likesNightclubs)&&(r=this.citizen.simulation.time.timeSinceStart/60%24,(o=23+this.citizen.get_workTimePreference())<(a=6+this.citizen.get_workTimePreference())?o<=r&&r<a:o<=r||r<a)&&this.citizen.wantsNightEntertainmentIn<=0?l=this.searchNightEntertainment():(r=this.citizen.simulation.time.timeSinceStart/60%24,((o=this.get_normallyAtHomeTimeFrom())<(a=this.get_normallyAtHomeTimeTo())?o<=r&&r<a:o<=r||r<a)||(l=this.searchDayEntertainment())),l)},stop:function(){this.entertainmentInited=!1},searchNightEntertainment:function(){if(this.citizen.simulation.time.timeSinceStart>=this.tryForEntertainment){if(!this.citizen.simulation.permanentFinder.canPerformQuery())return!0;var t=this.citizen.simulation.permanentFinder.quickQueryForCitizen(this.citizen,function(t){if(!t.isBuilding||!t.isEntertainment)return!1;return t.get_isOpen()},"nightEntertainmentFind",1,null,bo.getFloat()<.02?480:320);if(null!=t){var e=this.citizen;return e.simulation.pathfinder.findPath(e,t),e.pathOnFail=null,!(this.entertainmentInited=!1)}this.tryForEntertainment=this.citizen.simulation.time.timeSinceStart+120*this.citizen.simulation.time.minutesPerTick}return!1},searchDayEntertainment:function(){var e=this,i=this.citizen.simulation.time.timeSinceStart;if(i>=this.tryForDayEntertainment){if(!this.citizen.simulation.permanentFinder.canPerformQuery())return!1;var t=this.citizen.simulation.permanentFinder.queryForCitizen(this.citizen,function(t){if(!t.isBuilding||!t.isEntertainment)return!1;return!!t.get_isOpen()&&i>=e.recentEntertainmentTypes[t.get_entertainmentType()]},null,bo.getFloat()<.02?480:160);if(null!=t){var n=this.citizen;return n.simulation.pathfinder.findPath(n,t),n.pathOnFail=null,!(this.entertainmentInited=!1)}this.tryForDayEntertainment=i+120*this.citizen.simulation.time.minutesPerTick}return!1},__class__:Io},(V["simulation.CitizenSpecialAction"]=To).__name__="simulation.CitizenSpecialAction",To.prototype={update:function(t){},isActive:function(){return!1},onDie:function(){this.simulation.possibleCitizenHobbies.push({hobbyClass:Fr.getClass(this),minimumCitizenAmount:0})},__class__:To};var Bo=function(t){this.i=0,this.simulation=t};(V["simulation.CitizenUpdater"]=Bo).__name__="simulation.CitizenUpdater",Bo.prototype={update:function(t){this.i++;for(var e=0,i=this.simulation.citizens;e<i.length;){var n=i[e];++e,n.update(t)}},__class__:Bo};var ko=function(t){this.city=t};(V["simulation.CityConnections"]=ko).__name__="simulation.CityConnections",ko.prototype={updateCityConnections:function(){var S=this;this.city.simulation.flyingPathfinder.updateWaypoints();for(var x=this.city.worlds,t=this.city.permanents,e=[],i=0;i<t.length;){var n=t[i];++i,n.isBuilding&&(n.leftBuilding=null,n.rightBuilding=null,n.topBuilding=null,n.bottomBuilding=null)}this.elevatorConnections=new Mr;for(i=0;i<x.length;){var s=x[i];++i;var r=[];this.elevatorConnections.set(s,r);for(var o=0,a=s.permanents.length-1;o<a;)for(var l=o++,h=s.permanents[l],u=s.permanents[1+l],d=0,c=h.length,l=u.length,p=l<c?l:c;d<p;){var g=d++,m=h[g],g=u[g];null!=m&&null!=g&&m.isBuilding&&g.isBuilding&&(g=g,(m=m).isRooftopBuilding||g.isRooftopBuilding||((m.rightBuilding=g).leftBuilding=m))}for(var f=0,y=s.permanents;f<y.length;){var _=y[f];++f;var w=[];r.push(w);for(var b=0;b<_.length;){var v=_[b];++b,null!=v&&v.is(Ye)&&w.push(v)}for(var P=0,C=_.length-1;P<C;){var I=P++,T=_[I],I=_[1+I];null!=T&&null!=I&&T.isBuilding&&I.isBuilding&&!T.isRooftopBuilding&&((T.topBuilding=I).bottomBuilding=T)}}}for(i=0,o=this.city.teleporters;i<o.length;){var B=o[i];++i,-1==e.indexOf(B.world)&&e.push(B.world)}var k=this.city.simulation;this.landingSiteGroups=[];for(i=0,o=this.city.landingSites;i<o.length;){var M=o[i];++i,M.landingSiteGroup=null}for(i=0,o=this.city.landingSites;i<o.length;){M=o[i];++i;var z=!1,A=k.flyingPathfinder.findAnyOtherLandingSite(M);null!=A&&(z=!0,M.landingSiteGroup=A.landingSiteGroup,this.landingSiteGroups[A.landingSiteGroup].push(M)),z||(M.landingSiteGroup=this.landingSiteGroups.length,this.landingSiteGroups.push([M]))}for(i=this.directWorldConnectionNumber=0;i<x.length;){s=x[i];++i,-1!=e.indexOf(s)?s.reachableWorlds=e:s.reachableWorlds=[s]}for(i=0,o=this.landingSiteGroups;i<o.length;){var W=o[i];++i;for(var F=null,a=0;a<W.length;){var O=W[a];if(++a,null==F)F=O.world.reachableWorlds;else if(O.world.reachableWorlds!=F){for(d=0,p=O.world.reachableWorlds;d<p.length;){var D=p[d];++d,-1==F.indexOf(D)&&F.push(D),D.reachableWorlds=F}O.world.reachableWorlds=F}}}for(i=0;i<x.length;){s=[x[i]];++i;var R=[null!=s[0].relevantWorldsForDirectCityConnectionsCache],U=[R[0]?s[0].relevantWorldsForDirectCityConnectionsCache:x];R[0]||(s[0].relevantWorldsForDirectCityConnectionsCache=[]);R=function(w,b,v){return function(t,e,i){if(null!=e)for(var n=0;n<w[0].length;){var s=w[0][n];if(++n,(s.rect.y>v[0].rect.y||s.rect.y==v[0].rect.y&&s.rect.x>v[0].rect.x)&&s.rect.x%20==v[0].rect.x%20&&s.rect.y%20==v[0].rect.y%20){var r=((e-s.rect.x)/20|0)+i;if(0<=r&&r<s.permanents.length){b[0]||-1!=v[0].relevantWorldsForDirectCityConnectionsCache.indexOf(s)||v[0].relevantWorldsForDirectCityConnectionsCache.push(s);var o=s.permanents[r],a=(s.rect.y-v[0].rect.y)/20|0;if(o.length>a){for(var l=!1,h=0,u=t.length,r=o.length-a,d=r<u?r:u;h<d;){var c=h++,p=t[c],c=o[c+a];null!=p&&null!=c&&p.isBuilding&&c.isBuilding&&(c=c,(p=p).isRooftopBuilding||c.isRooftopBuilding||(1==i?(p.rightBuilding=c).leftBuilding=p:(p.leftBuilding=c).rightBuilding=p,l=!0,S.directWorldConnectionNumber+=2))}if(l){var g=v[0].reachableWorlds;if(v[0].reachableWorlds!=s.reachableWorlds){v[0].reachableWorlds=s.reachableWorlds;for(var m=0;m<g.length;){var f=g[m];++m,-1==v[0].reachableWorlds.indexOf(f)&&v[0].reachableWorlds.push(f)}}for(var y=0;y<x.length;){var _=x[y];++y,_.reachableWorlds==g&&(_.reachableWorlds=v[0].reachableWorlds)}}}}}}}}(U,R,s);R(s[0].permanents[0],s[0].rect.x,-1),R(s[0].permanents[s[0].permanents.length-1],s[0].rect.x+20*(s[0].permanents.length-1),1)}for(var L=0,i=0,o=this.city.worlds;i<o.length;){var E=o[i];++i,E.worldGroup=null}for(i=0,o=this.city.worlds;i<o.length;){E=o[i];if(++i,null==E.worldGroup){var H=!1;-1!=e.indexOf(E)&&(H=!0);for(a=0,d=E.reachableWorlds;a<d.length;){var N=d[a];++a,N.worldGroup=L,N.hasTeleporterOnGroup=H}++L}}this.numberOfWorldGroups=L,null!=this.city.builder&&this.city.builder.invalidateCache()},__class__:ko};var Mo=function(t){this.foodRationing=!1,this.currentFoodSaveByHerbsPct=0,this.herbsCap=0,this.foodShortage=0,this.totalConsumedFoodPerDay=-1,this.simulation=t};(V["simulation.Eating"]=Mo).__name__="simulation.Eating",Mo.prototype={update:function(t){var e=this.simulation.time.timeSinceStart/60%24;0!=this.totalConsumedFoodPerDay?this.currentFoodSaveByHerbsPct=Math.min(1,this.herbsCap/this.totalConsumedFoodPerDay):this.currentFoodSaveByHerbsPct=0;var i,n,s,r=.2*Math.min(this.totalConsumedFoodPerDay,this.herbsCap);this.totalConsumedFoodPerDay=this.simulation.citizens.length-.5*this.simulation.stats.children,this.totalConsumedFoodPerDay-=r,this.foodRationing&&(this.totalConsumedFoodPerDay*=.5),7<=e&&e<20&&(s=this.simulation.time.minutesPerTick*t/60/13,t=Math.max(0,this.totalConsumedFoodPerDay*s),i=Math.min(this.simulation.city.materials.food,t),(s=(n=this.simulation.city).materials).set_food(s.food-i),n.simulation.stats.materialUsed[0][0]+=i,this.foodShortage+=t-i,this.foodShortage=Math.min(this.foodShortage,Math.ceil(this.totalConsumedFoodPerDay/2))),0<this.foodShortage&&.1<this.simulation.city.materials.food&&(i=Math.min(this.simulation.city.materials.food,this.foodShortage),this.foodShortage-=i,(s=(n=this.simulation.city).materials).set_food(s.food-i),n.simulation.stats.materialUsed[0][0]+=i,0<this.simulation.city.materials.food&&(this.foodShortage=0))},getFoodText:function(){var t="";return this.foodRationing&&(t=kn.lo("rationing_halves_this")+" "),kn.lo("food_description_1")+"\n"+kn.lo("food_description_2")+" "+t+(this.currentFoodSaveByHerbsPct<1e-4?"":kn.lo("food_description_3",[Math.round(.2*this.currentFoodSaveByHerbsPct*100),20])+" ")+(-1==this.totalConsumedFoodPerDay?"":kn.lo("food_description_4",[0|this.totalConsumedFoodPerDay]))},save:function(t,e){null==e&&(e=!0),e&&t.addString(Mo.saveDefinition);var i=this.foodShortage;t.size+8>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,e,0,t.size)),t.bytes.setDouble(t.size,i),t.size+=8},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"foodShortage")&&(this.foodShortage=t.h.foodShortage)},__class__:Mo};var zo=function(){};function Ao(t,e,i,n,s){this.destroyed=!1,this.verticalHeightToUse=0,this.verticalWidthToUse=0,this.startSlowingProb=.05,this.stopMoveProb=.2,this.normalSlowdown=.1,this.normalAcceleration=.05,this.maxSpeed=.6,this.stopSpeedSpeed=.4,this.slowing=!1,this.speeding=!1,this.moveSpeed=0,this.relativeY=2,this.relativeX=2,this.inPermanent=null,this.spriteCanBeRotated=!1,this.height=1,this.width=2,this.type=0,this.city=t,this.stage=e,this.type=bo.getInt(11),this.sprite=new PIXI.Sprite,e.addChild(this.sprite),this.setTypeSprite(),this.sprite.anchor.set(.5,.5),this.inPermanent=i,this.relativeX=n,this.relativeY=s,this.moveDirection=0,this.moveSpeed=0,_.isLoading||this.updateDisplay()}(V["simulation.EntertainmentTypeHelpers"]=zo).__name__="simulation.EntertainmentTypeHelpers",zo.getName=function(t){switch(t){case 0:return kn.lo("night_clubs");case 1:return kn.lo("pubs_restaurants");case 2:return kn.lo("art");case 3:return kn.lo("nature");case 4:return kn.lo("gaming");case 5:return kn.lo("libraries")}},(V["simulation.Fish"]=Ao).__name__="simulation.Fish",Ao.prototype={destroy:function(){this.sprite.destroy(),Y.remove(this.city.simulation.fishes.fishes,this),this.destroyed=!0},getCityPosition:function(){return new In(this.inPermanent.position.x+this.relativeX,this.inPermanent.position.y+this.relativeY)},onClick:function(){ws.createWindow(this.city,this)},save:function(t){this.saveBasics(t);var e,i=this.inPermanent.id;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4},load:function(t){this.loadBasics(t);var e=this.city.permanentsByID,i=t.bytes.getInt32(t.readStart);t.readStart+=4,this.inPermanent=e.h[i],this.updateDisplay()},update:function(t){if(0<this.moveSpeed||this.speeding){var e=0;switch(this.moveDirection){case 0:(e=this.leftMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeX-=Math.min(e,t*this.moveSpeed);break;case 1:(e=this.topMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeY-=Math.min(e,t*this.moveSpeed);break;case 2:(e=this.rightMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeX+=Math.min(e,t*this.moveSpeed);break;case 3:(e=this.bottomMovePotential())<=0?(this.moveSpeed=0,this.speeding=!1,this.slowing=!1):this.relativeY+=Math.min(e,t*this.moveSpeed)}var i=this.inPermanent;this.relativeX<0&&i.leftIsWaterFilled&&(this.relativeX+=20,this.inPermanent=i.leftAsWaterFilled),this.relativeY<0&&i.topIsWaterFilled&&(this.relativeY+=20,this.inPermanent=i.topAsWaterFilled),20<=this.relativeX&&i.rightIsWaterFilled&&(this.relativeX-=20,this.inPermanent=i.rightAsWaterFilled),20<=this.relativeY&&i.bottomIsWaterFilled&&(this.relativeY-=20,this.inPermanent=i.bottomAsWaterFilled),this.speeding?(this.moveSpeed=Math.min(this.maxSpeed,this.moveSpeed+this.normalAcceleration*t),(this.moveSpeed>this.stopSpeedSpeed&&bo.getFloat(1)<this.stopMoveProb*t||e<2)&&(this.speeding=!1)):this.slowing?this.moveSpeed=Math.max(0,this.moveSpeed-this.normalSlowdown*t):(bo.getFloat(1)<this.startSlowingProb*(5/(e<1?1:15<e?15:e))*t||e<3)&&(this.slowing=!0)}0==this.moveSpeed&&(0==(i=bo.getInt(12))||4==i||0==this.moveDirection&&11==i?3<this.leftMovePotential()&&(this.moveDirection=0,this.speeding=!0,this.slowing=!1):1==i||5==i||2==this.moveDirection&&11==i?3<this.rightMovePotential()&&(this.moveDirection=2,this.speeding=!0,this.slowing=!1):2==i||1==this.moveDirection&&10<=i?3<this.topMovePotential()&&(this.moveDirection=1,this.speeding=!0,this.slowing=!1):3==i||3==this.moveDirection&&10<=i?3<this.bottomMovePotential()&&(this.moveDirection=3,this.speeding=!0,this.slowing=!1):(this.speeding=!1,this.slowing=!1)),this.updateDisplay()},leftMovePotential:function(){var t=0,e=this.inPermanent;return t+=this.relativeX-this.width/2-3,null!=e&&null!=(e=e.leftAsWaterFilled)&&(this.relativeY>3+this.height/2||e.topIsWaterFilled)&&(this.relativeY<17-this.height/2||e.bottomIsWaterFilled)&&(t+=20),t},rightMovePotential:function(){var t=0,e=this.inPermanent;return t+=17-this.width/2-this.relativeX,null!=e&&null!=(e=e.rightAsWaterFilled)&&(this.relativeY>3+this.height/2||e.topIsWaterFilled)&&(this.relativeY<17-this.height/2||e.bottomIsWaterFilled)&&(t+=20),t},topMovePotential:function(){var t=0,e=this.inPermanent;return t+=this.relativeY-this.verticalWidthToUse/2-3,null!=e&&null!=(e=e.topAsWaterFilled)&&(this.relativeX>3+this.verticalHeightToUse/2||e.leftIsWaterFilled)&&(this.relativeX<17-this.verticalHeightToUse/2||e.rightIsWaterFilled)&&(t+=20),t},bottomMovePotential:function(){var t=0,e=this.inPermanent;return t+=17-this.verticalWidthToUse/2-this.relativeY,null!=e&&null!=(e=e.bottomAsWaterFilled)&&(this.relativeX>3+this.verticalHeightToUse/2||e.leftIsWaterFilled)&&(this.relativeX<17-this.verticalHeightToUse/2||e.rightIsWaterFilled)&&(t+=20),t},updateDisplay:function(){this.sprite.position.set(this.inPermanent.position.x+this.relativeX,this.inPermanent.position.y+this.relativeY),this.spriteCanBeRotated&&(1==this.moveDirection?this.sprite.rotation=1.5*Math.PI:3==this.moveDirection?this.sprite.rotation=.5*Math.PI:2==this.moveDirection?this.sprite.rotation=0:this.sprite.rotation=Math.PI)},postLoad:function(){this.setTypeSprite()},setTypeSprite:function(){var t=H.getTexturesByWidth("spr_fish",2),e=H.getTexturesByWidth("spr_fish_jelly",5),i=H.getTexturesByWidth("spr_fish_big",4),n=H.getTexturesByWidth("spr_fish_snake",8),s=H.getTexturesByWidth("spr_fish_big2",5);switch(this.spriteCanBeRotated=!1,this.type){case 0:this.sprite.texture=t[0],this.spriteCanBeRotated=!0;break;case 1:this.sprite.texture=t[1],this.spriteCanBeRotated=!0;break;case 2:this.sprite.texture=e[0],this.maxSpeed=.4,this.stopSpeedSpeed=.2,this.normalAcceleration=.025,this.normalSlowdown=.025,this.spriteCanBeRotated=!1,this.stopMoveProb=.03,this.startSlowingProb=.1;break;case 3:this.sprite.texture=i[0],this.spriteCanBeRotated=!0;break;case 4:this.sprite.texture=n[0],this.spriteCanBeRotated=!0,this.maxSpeed=.3,this.stopSpeedSpeed=.2,this.normalAcceleration=.02,this.normalSlowdown=.02,this.stopMoveProb=.02,this.startSlowingProb=.1;break;case 5:this.sprite.texture=t[2],this.spriteCanBeRotated=!0;break;case 6:this.sprite.texture=i[1],this.spriteCanBeRotated=!0;break;case 7:this.sprite.texture=s[0],this.spriteCanBeRotated=!0;break;case 8:this.sprite.texture=t[3],this.spriteCanBeRotated=!0;break;case 9:this.sprite.texture=t[4],this.spriteCanBeRotated=!0;break;case 10:this.sprite.texture=i[2],this.spriteCanBeRotated=!0}this.width=Math.round(this.sprite.texture.width),this.height=Math.round(this.sprite.texture.height),this.spriteCanBeRotated?(this.verticalWidthToUse=this.width,this.verticalHeightToUse=this.height):(this.verticalWidthToUse=this.height,this.verticalHeightToUse=this.width)},pushBackIntoPermanent:function(){var t=this.inPermanent,e=1==this.moveDirection||3==this.moveDirection?this.verticalHeightToUse:this.width,i=1==this.moveDirection||3==this.moveDirection?this.verticalWidthToUse:this.height;!t.leftIsWaterFilled&&this.relativeX<3+e/2&&(this.relativeX=3+e/2),!t.topIsWaterFilled&&this.relativeY<3+i/2&&(this.relativeY=3+i/2),!t.rightIsWaterFilled&&this.relativeX>17-e/2&&(this.relativeX=17-e/2),!t.bottomIsWaterFilled&&this.relativeY>17-i/2&&(this.relativeY=17-i/2)},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Ao.saveDefinition);e=this.type;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.relativeX;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.relativeY;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"type")&&(this.type=t.h.type),Object.prototype.hasOwnProperty.call(t.h,"relativeX")&&(this.relativeX=t.h.relativeX),Object.prototype.hasOwnProperty.call(t.h,"relativeY")&&(this.relativeY=t.h.relativeY),this.postLoad()},__class__:Ao};var Wo=function(t){this.simulation=t,this.fishes=[]};(V["simulation.FishManager"]=Wo).__name__="simulation.FishManager",Wo.prototype={update:function(t){for(var e=0,i=this.fishes;e<i.length;){var n=i[e];++e,n.update(t)}},save:function(t){var e,i=this.fishes.length;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;for(var n=0,s=this.fishes;n<s.length;){var r=s[n];++n,r.save(t)}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var s=new Ao(this.simulation.city,this.simulation.city.aboveCitizensInBuildingStage,null,0,0);s.load(t),this.fishes.push(s)}},__class__:Wo},t=function(){},(V["simulation.Vehicle"]=t).__name__="simulation.Vehicle",t.prototype={get_citizenOffset:function(){return new In(0,0)},__class__:t};var Fo=function(t,e,i,n,s){this.stage=e,this.simulation=t,this.start=n,this.destination=s,this.pathPos=i.length-1,this.position=new In(i[this.pathPos].x,i[this.pathPos].y),this.sprite=H.makeSprite(n.get_saucherTexture()),this.sprite.position.set(this.position.x,this.position.y),e.addChild(this.sprite),this.path=i,this.passengers=[],this.leavingIn=12,n.currentlyLandedSaucer=this};function Oo(t){this.sculpturesHappiness=0,this.expensiveRestaurantHappiness=0,this.highEndHomeHappiness=0,this.gloryOfTheKeyHappiness=0,this.city=t}(V["simulation.FlyingSaucer"]=Fo).__name__="simulation.FlyingSaucer",Fo.__super__=t,Fo.prototype=e(t.prototype,{get_citizenOffset:function(){return new In(9,16)},setDestination:function(t,e){this.path=e,this.pathPos=this.path.length-1,this.destination=t},addPassenger:function(t){this.passengers.push(t),this.start.timesUsed++},destroy:function(){Y.remove(this.simulation.flyingSaucers,this),this.stage.removeChild(this.sprite)},cancel:function(){for(var t=0,e=this.passengers;t<e.length;){var i=e[t];++t,i.fullyBeingControlled=!1,i.canViewSelfInBuilding=!0,i.recyclePathArray&&(io.returnToPool(i.path),i.recyclePathArray=!1),i.path=null,i.nextPathPos=-1,i.pathEnd=-1,i.currentPathAction=null,i.canViewSelfInBuilding||(i.delayCanViewSelfInBuilding=!0),i.canViewSelfInBuilding=!0,i.verticalPathProgress=0,i.pathEndFunction=null,i.requestingPathGoal=null,i.pathOnlyRelatedTo=null,i.pathWalkSpeed=1,i.pathCanBeReconsidered=!0,0<i.sprite.alpha&&i.sprite.alpha<1&&(i.sprite.alpha=1)}this.destroy()},update:function(t){if(0<this.leavingIn)return this.leavingIn-=t,void(this.leavingIn<=0&&(this.start.currentlyLandedSaucer=null));for(var e=3*t;0<e;){var i=this.path[this.pathPos].x,n=this.path[this.pathPos].y;if(.01<Math.abs(this.position.x-i)){var s=i-this.position.x;this.position.x+=(0<s?1:s<0?-1:0)*Math.min(e,Math.abs(s)),e-=Math.abs(s)}else if(.01<Math.abs(this.position.y-n)){s=n-this.position.y;this.position.y+=(0<s?1:s<0?-1:0)*Math.min(e,Math.abs(s)),e-=Math.abs(s)}else{if(this.position.x=i,this.position.y=n,0==this.pathPos){for(var r=0,o=this.passengers;r<o.length;){var a=o[r];++r,a.fullyBeingControlled=!1,null!=a.inPermanent&&a.inPermanent.onCitizenLeave(a,this.destination),a.inPermanent=this.destination,a.onWorld=a.inPermanent.world,a.inBuildingSince=a.city.simulation.time.timeSinceStart,a.currentPathActionPermanent!=this.destination?this.destination.timesUsedStopOver++:this.destination.timesUsedTo++}return this.destination.addFlyingSaucer(),void this.destroy()}this.pathPos--}}this.sprite.position.set(this.position.x,this.position.y)},__class__:Fo}),(V["simulation.GloryOfTheKey"]=Oo).__name__="simulation.GloryOfTheKey",Oo.prototype={get_simulation:function(){return this.city.simulation},updateHappiness:function(){for(var t=0,e=0,i=0,n=0,s=this.city.permanents;n<s.length;){var r=s[n];++n,r.is(Li)||r.is(De)?++t:r.is(ti)?++e:(r.is(Ci)||r.is(Ii)||r.is(Ti))&&++i}var o=16e3*t/(this.get_simulation().citizens.length+1);this.highEndHomeHappiness=o<0?0:100<o?100:o;o=11e3*e/(this.get_simulation().citizens.length+1);this.expensiveRestaurantHappiness=o<0?0:100<o?100:o;o=5e3*i/(this.get_simulation().citizens.length+1);this.sculpturesHappiness=o<0?0:100<o?100:o;o=(this.highEndHomeHappiness+this.expensiveRestaurantHappiness+this.sculpturesHappiness)/3+.01;this.gloryOfTheKeyHappiness=o<0?0:100<o?100:o},__class__:Oo};var Do=function(t,e){this.gloryOfTheKey=null,this.healthCapacityByType=null,this.veryUnhappyFromDay=-1,this.lastShownVeryUnhappyWarning=-1,this.shouldUpdateHappinessIn=0,this.happinessEnthusiasmLevel=0,this.actualHappiness=0,this.ignoreUnhappyCitizens=!1,this.lastRestoreTime=-1,this.lastOvertimeDay=-1,this.lastOvertime=0,this.overtimeStarted=0,this.overtimeUnhappinessShown=0,this.overtimeUnhappinessActual=0,this.foodRationingUnhappiness=0,this.foodShortageUnhappiness=0,this.enthusiasmHappiness=0,this.fullHappinessTimeout=0,this.fullHappinessTime=0,this.happiness=-1,this.city=t,this.simulation=e,this.entertainmentTypes=[0,1,2,3,4],Y.remove(this.entertainmentTypes,5);for(var i=[],n=0,s=this.entertainmentTypes.length;n<s;){n++;i.push(0)}this.happinessPerEntertainmentType=i,this.actionSpeedModifierWithoutPenalties=1,this.happinessBoosts=[],(i=[]).push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),this.healthCapacityByType=i};(V["simulation.Happiness"]=Do).__name__="simulation.Happiness",Do.prototype={set_happiness:function(t){return this.actionSpeedModifier=t<=50?.25+t/50*.75:1+(t-50)/50,this.happiness=t},update:function(t){for(var e=this.simulation.time,i=this.happinessBoosts.length-1;0<=i;)this.happinessBoosts[i].hasPassed(e)&&this.happinessBoosts.splice(i,1),--i;this.shouldUpdateHappinessIn<=0?(this.actualHappiness=this.getActualHappiness(),this.shouldUpdateHappinessIn=60):this.shouldUpdateHappinessIn-=Math.max(1,t),-1==this.happiness&&this.set_happiness(this.actualHappiness);var n,s=.05*t;Math.abs(this.actualHappiness-this.happiness)<s?this.set_happiness(this.actualHappiness):(n=this.actualHappiness-this.happiness,this.set_happiness(this.happiness+(0<n?1:n<0?-1:0)*s)),99.99<=this.happiness?(this.fullHappinessTime+=t*this.city.simulation.time.minutesPerTick,this.fullHappinessTimeout=300):this.fullHappinessTimeout<0?this.fullHappinessTime=0:this.fullHappinessTimeout-=t,this.happiness<=10.01?1+((0|e.timeSinceStart)/1440|0)!=this.lastShownVeryUnhappyWarning&&-1==this.veryUnhappyFromDay&&(this.veryUnhappyFromDay=1+((0|e.timeSinceStart)/1440|0),this.lastShownVeryUnhappyWarning=1+((0|e.timeSinceStart)/1440|0),this.city.simulation.happiness.ignoreUnhappyCitizens||(this.city.gui.showSimpleWindow(kn.lo("cityofthekey"==this.city.progress.story.storyName?"citizens_unhappy_key":"citizens_unhappy")+" "+kn.lo("more_happiness_info"),kn.lo("citizens_unhappy_title"),!0,!0),this.city.gui.pauseForWindow())):this.veryUnhappyFromDay=-1},getActualHappiness:function(){for(var t=new Mr,e=new Mr,i=0,n=[],s=[],r=[],o=[],a=this.entertainmentTypes.length,l=0,h=this.city.worlds;l<h.length;){var u=h[l];if(++l,!t.h[u.__id__]){for(var d=[],c=0,p=a;c<p;){var g=c++;d.push([])}for(var m=d,f=[],y=0,_=0,w=u.reachableWorlds;_<w.length;){var b=w[_];++_,e.set(b,i),t.set(b,!0);for(var v=0,S=b.permanents;v<S.length;){var x=S[v];++v;for(var P=0;P<x.length;){var C,I=x[P];++P,null!=I&&(I.isBuilding&&(I.isEntertainment?(F=I,-1!=(C=this.entertainmentTypes.indexOf(F.get_entertainmentType()))&&m[C].push(F)):I.isMedical&&(L=I,f.push(L))),y+=I.get_baseEntertainmentCapacity()+I.bonusEntertainmentCapacity)}}}n[i]=y,s[i]=m,r[i]=f,o[i]=0,++i}}this.homeHappiness=0,this.schoolHappiness=0;for(var T=this.purposeHappiness=0,l=0,h=this.simulation.citizens;l<h.length;){var B=h[l];++l,null!=B.home&&(this.homeHappiness+=B.home.get_attractiveness()),null!=B.job?this.purposeHappiness+=100:B.lastInfrequentUpdateAge<16&&(++T,null!=B.school&&(this.schoolHappiness+=100,this.purposeHappiness+=100)),o[e.h[B.onWorld.__id__]]+=1}0<this.simulation.citizens.length&&(this.homeHappiness/=this.simulation.citizens.length,this.purposeHappiness/=this.simulation.citizens.length),0<T?this.schoolHappiness/=T:this.schoolHappiness=vn.any(this.city.permanents,function(t){return!!t.is(bi)&&1<=t.workers.length})?100:0;for(l=0,h=this.happinessPerEntertainmentType.length;l<h;){g=l++;this.happinessPerEntertainmentType[g]=0}this.entertainmentHappiness=0,this.medicalHappiness=0,(l=[]).push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),this.healthCapacityByType=l;for(l=0,h=i;l<h;){for(var g=l++,k=32.99999999999999*Math.min(n[g],o[g]),d=0,c=s[g].length;d<c;){var M=d++,z=s[g][M];z.sort(function(t,e){t=e.get_entertainmentQuality()-t.get_entertainmentQuality();return 0<t?1:t<0?-1:0});for(var A=o[g],W=0,p=0;p<z.length;){var F=z[p];++p;var O=A>F.get_entertainmentCapacity()?F.get_entertainmentCapacity():A;if(W+=O*F.get_entertainmentQuality(),(A-=O)<=0)break}k+=W*(.67/a),this.happinessPerEntertainmentType[M]+=W/this.simulation.citizens.length}this.entertainmentHappiness+=k/this.simulation.citizens.length,(f=r[g]).sort(function(t,e){t=e.get_medicalQuality()-t.get_medicalQuality()+.01*(e.get_medicalTypeID()-t.get_medicalTypeID());return 0<t?1:t<0?-1:0});for(var D=o[g],R=0,U=0,_=0;_<f.length;){var L=f[_];++_;var E=L.get_medicalTypeID()+1;U<E&&(U=E)}for(w=[],v=0,S=U;v<S;){v++;w.push(0)}for(var H=w,P=0;P<f.length;){var N=f[P];++P;var G=D>N.get_medicalCapacity()?N.get_medicalCapacity():D,X=N.get_medicalTypeLimit()*o[g]-H[N.get_medicalTypeID()];if(X<0?G=0:G<X||(G=X),H[N.get_medicalTypeID()]+=G,this.healthCapacityByType[N.get_medicalTypeID()]+=G,R+=G*N.get_medicalQuality(),(D-=G)<=0)break}this.medicalHappiness+=R/this.simulation.citizens.length}this.entertainmentHappiness=Math.min(100,this.entertainmentHappiness+.01),this.medicalHappiness=Math.min(100,this.medicalHappiness+.01);var j=.1,V=.4,Y=.1,$=.1,q=.3;null!=this.gloryOfTheKey&&(j-=.02,V-=.02,Y-=.02,$-=.02,q-=.02);var K=this.homeHappiness*V+this.entertainmentHappiness*q+this.schoolHappiness*$+this.medicalHappiness*Y+this.purposeHappiness*j;null!=this.gloryOfTheKey&&(this.gloryOfTheKey.updateHappiness(),K+=.1*this.gloryOfTheKey.gloryOfTheKeyHappiness),K=Math.min(100,K+.01),this.actionSpeedModifierWithoutPenalties=K<=50?.25+K/50*.75:1+(K-50)/50;var Q,j=this.simulation.eating.foodShortage;0<j?(this.foodRationingUnhappiness=0,this.actionSpeedModifierWithoutPenalties<1&&(this.actionSpeedModifierWithoutPenalties=1),10<=j?(this.foodShortageUnhappiness=K,K=0):10<K?(this.foodShortageUnhappiness=K-10,K=10):this.foodShortageUnhappiness=0):(this.foodShortageUnhappiness=0,this.foodRationingUnhappiness=0,10<K&&this.city.simulation.eating.foodRationing&&(Q=Math.max(10,.67*K),this.foodRationingUnhappiness=K-Q,K=Q)),0<this.city.policies.vars.workTimeChange?(this.lastOvertime=this.city.simulation.time.timeSinceStart/1440,this.overtimeUnhappinessActual=Math.max(this.overtimeUnhappinessActual,5),-1==this.lastOvertimeDay?this.lastOvertimeDay=this.lastOvertime:this.city.simulation.time.timeSinceStart/1440>this.lastOvertimeDay+1&&(this.lastOvertimeDay=this.city.simulation.time.timeSinceStart/1440,this.overtimeUnhappinessActual=Math.min(this.overtimeUnhappinessActual+5,50)),this.lastRestoreTime=-1):this.city.simulation.time.timeSinceStart/1440>this.lastOvertimeDay+1&&(-1==this.lastRestoreTime?this.lastRestoreTime=this.city.simulation.time.timeSinceStart/1440:(Q=10*(this.city.simulation.time.timeSinceStart/1440-this.lastRestoreTime),this.lastRestoreTime=this.city.simulation.time.timeSinceStart/1440,this.overtimeUnhappinessActual=Math.max(0,this.overtimeUnhappinessActual-Q)),this.lastOvertimeDay=-1),(this.overtimeUnhappinessShown=0)<this.overtimeUnhappinessActual&&(this.overtimeUnhappinessShown=Math.min(this.overtimeUnhappinessActual,K),K-=this.overtimeUnhappinessShown),K<this.happinessEnthusiasmLevel?(this.enthusiasmHappiness=this.happinessEnthusiasmLevel-K,K=this.happinessEnthusiasmLevel):this.enthusiasmHappiness=0;for(l=0,h=this.happinessBoosts;l<h.length;){var J=h[l];++l,J.canGoOverMax||(K=Math.min(100,K+J.boost))}for(l=0,h=this.happinessBoosts;l<h.length;){J=h[l];++l,J.canGoOverMax&&(K+=J.boost)}return K},addBoost:function(t){this.happinessBoosts.push(t)},save:function(t){this.saveBasics(t);var e,i=this.happinessBoosts.length;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;for(var n=0,s=this.happinessBoosts;n<s.length;){var r=s[n];++n,r.save(t)}},load:function(t){if(this.loadBasics(t),20<=t.version){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var s=new Ro(0,0,"");s.load(t),this.happinessBoosts.push(s)}}"cityofthekey"==this.city.progress.story.storyName&&(this.gloryOfTheKey=new Oo(this.city))},createGloryOfTheKey:function(){this.gloryOfTheKey=new Oo(this.city)},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Do.saveDefinition);e=this.happiness;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.homeHappiness;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.purposeHappiness;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.entertainmentHappiness;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.schoolHappiness;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.medicalHappiness;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.fullHappinessTime;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.overtimeUnhappinessActual;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.overtimeStarted;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.lastOvertime;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.lastOvertimeDay;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.lastRestoreTime;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.ignoreUnhappyCitizens;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;e=this.actualHappiness;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.happinessEnthusiasmLevel;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.lastShownVeryUnhappyWarning;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.veryUnhappyFromDay;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"happiness")&&this.set_happiness(t.h.happiness),Object.prototype.hasOwnProperty.call(t.h,"homeHappiness")&&(this.homeHappiness=t.h.homeHappiness),Object.prototype.hasOwnProperty.call(t.h,"purposeHappiness")&&(this.purposeHappiness=t.h.purposeHappiness),Object.prototype.hasOwnProperty.call(t.h,"entertainmentHappiness")&&(this.entertainmentHappiness=t.h.entertainmentHappiness),Object.prototype.hasOwnProperty.call(t.h,"schoolHappiness")&&(this.schoolHappiness=t.h.schoolHappiness),Object.prototype.hasOwnProperty.call(t.h,"medicalHappiness")&&(this.medicalHappiness=t.h.medicalHappiness),Object.prototype.hasOwnProperty.call(t.h,"fullHappinessTime")&&(this.fullHappinessTime=t.h.fullHappinessTime),Object.prototype.hasOwnProperty.call(t.h,"overtimeUnhappinessActual")&&(this.overtimeUnhappinessActual=t.h.overtimeUnhappinessActual),Object.prototype.hasOwnProperty.call(t.h,"overtimeStarted")&&(this.overtimeStarted=t.h.overtimeStarted),Object.prototype.hasOwnProperty.call(t.h,"lastOvertime")&&(this.lastOvertime=t.h.lastOvertime),Object.prototype.hasOwnProperty.call(t.h,"lastOvertimeDay")&&(this.lastOvertimeDay=t.h.lastOvertimeDay),Object.prototype.hasOwnProperty.call(t.h,"lastRestoreTime")&&(this.lastRestoreTime=t.h.lastRestoreTime),Object.prototype.hasOwnProperty.call(t.h,"ignoreUnhappyCitizens")&&(this.ignoreUnhappyCitizens=t.h.ignoreUnhappyCitizens),Object.prototype.hasOwnProperty.call(t.h,"actualHappiness")&&(this.actualHappiness=t.h.actualHappiness),Object.prototype.hasOwnProperty.call(t.h,"happinessEnthusiasmLevel")&&(this.happinessEnthusiasmLevel=t.h.happinessEnthusiasmLevel),Object.prototype.hasOwnProperty.call(t.h,"lastShownVeryUnhappyWarning")&&(this.lastShownVeryUnhappyWarning=t.h.lastShownVeryUnhappyWarning),Object.prototype.hasOwnProperty.call(t.h,"veryUnhappyFromDay")&&(this.veryUnhappyFromDay=t.h.veryUnhappyFromDay)},__class__:Do};var Ro=function(t,e,i){this.canGoOverMax=!0,this.boostUntil=t,this.boost=e,this.text=i};(V["simulation.HappinessBoost"]=Ro).__name__="simulation.HappinessBoost",Ro.withDuration=function(t,e,i,n){return new Ro(t.timeSinceStart+e,i,n)},Ro.prototype={hasPassed:function(t){return t.timeSinceStart>this.boostUntil},save:function(t,e){null==e&&(e=!0),e&&t.addString(Ro.saveDefinition);e=this.boostUntil;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.boost;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8,t.addString(this.text);var i,e=this.canGoOverMax;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"boostUntil")&&(this.boostUntil=t.h.boostUntil),Object.prototype.hasOwnProperty.call(t.h,"boost")&&(this.boost=t.h.boost),Object.prototype.hasOwnProperty.call(t.h,"text")&&(this.text=t.h.text),Object.prototype.hasOwnProperty.call(t.h,"canGoOverMax")&&(this.canGoOverMax=t.h.canGoOverMax)},__class__:Ro};var Uo=function(t,e){this.shouldUpdateHouses=!0,this.city=t,this.simulation=e;for(var i=[],n=0;n<101;){n++;i.push(0)}this.peoplePerHomeQuality=i;for(i=[],n=0;n<101;){n++;i.push(0)}this.emptyPlacesPerHomeQuality=i;for(i=[],n=0;n<101;){n++;i.push(0)}this.transferFrom=i,this.citizensWithFixedHomes=[]};(V["simulation.HouseAssigner"]=Uo).__name__="simulation.HouseAssigner",Uo.prototype={assignHouses:function(){if(this.shouldUpdateHouses){for(var t=[],e=0,i=this.city.connections.numberOfWorldGroups;e<i;){var n=e++;t.push(!1)}for(var s=t,t=[],e=0,i=this.city.connections.numberOfWorldGroups;e<i;){n=e++;t.push(0)}Uo.privateTeleportersLeft=t;for(t=0,e=this.city.worlds;t<e.length;){var r=e[t];if(++t,!s[r.worldGroup]){for(i=0;i<101;){n=i++;this.peoplePerHomeQuality[n]=0}for(var o=0;o<101;){var a=o++;this.emptyPlacesPerHomeQuality[a]=0}for(var l=0;l<101;){var h=l++;this.transferFrom[h]=0}for(var u=Uo.privateTeleportersLeft[r.worldGroup]=0,d=this.city.worlds;u<d.length;){var c=d[u];if(++u,r.worldGroup==c.worldGroup)for(var p=0,g=c.permanents;p<g.length;){var m=g[p];++p;for(var f=0;f<m.length;){var y=m[f];if(++f,null!=y&&y.is(Yt)){var _=y,w=_.get_attractiveness(),b=0|(w<0?0:100<w?100:w);if(!y.is(te)){_.get_hasPrivateTeleporter()&&0<_.get_remainingCapacity()&&(Uo.privateTeleportersLeft[r.worldGroup]+=1);for(var v=0,S=_.residents;v<S.length;){var x=S[v];++v,x.isForcedHome||(this.peoplePerHomeQuality[b]+=1)}this.emptyPlacesPerHomeQuality[b]+=_.get_remainingCapacity()}}}}}for(var P=0,C=100;P<C;){for(;P<C&&0<this.peoplePerHomeQuality[P];){var I=this.emptyPlacesPerHomeQuality[C],T=this.peoplePerHomeQuality[P],I=T<I?T:I;this.transferFrom[P]+=I,this.emptyPlacesPerHomeQuality[C]-=I,this.peoplePerHomeQuality[P]-=I,--C}++P}for(var B=0,k=this.city.worlds;B<k.length;){var M=k[B];if(++B,r.worldGroup==M.worldGroup)for(var z=0,A=M.permanents;z<A.length;){var W=A[z];++z;for(var F=0;F<W.length;){var O=W[F];if(++F,null!=O&&O.is(Yt)){var D=O,O=D.get_attractiveness(),R=0|(O<0?0:100<O?100:O);if(0<this.transferFrom[R])for(var U=D.residents.length;0<=--U;){var L=D.residents[U];0<this.transferFrom[R]&&!L.isForcedHome&&(L.evictFromHome(),this.transferFrom[R]--)}}}}}s[r.worldGroup]=!0}}for(t=[],e=0,i=this.city.connections.numberOfWorldGroups;e<i;){n=e++;t.push(!1)}for(var E=t,t=0,e=this.simulation.citizens;t<e.length;){var H,N,G,X,j,V,Y,$,q,K,Q,J,Z,L=e[t];++t,E[L.onWorld.worldGroup]||(Z=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.onWorld.worldGroup==e.world.worldGroup}],N=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.world.worldGroup==e.world.worldGroup}],G=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.onWorld.worldGroup==e.world.worldGroup)||e.is(Ai)}],V=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.world.worldGroup==e.world.worldGroup)||e.is(Ai)}],null==(H=[L])[0].home&&(Y=null,0<Uo.privateTeleportersLeft[H[0].onWorld.worldGroup]?null!=(Y=null!=H[0].job?(X=this.simulation.permanentFinder,j=H[0].job,V=function(e,i){return function(t){return i[0](e[0],t)}}([H[0].job],V),$=function(t){return t.is(Ai)?100:t.get_baseAttractiveness()+t.bonusAttractiveness},X.query(j,V,$,null,99.999999)):($=this.city.permanents,q=function(e,i){return function(t){return i[0](e[0],t)}}([H[0]],G),K=function(t){return t.is(Ai)?100:t.get_baseAttractiveness()+t.bonusAttractiveness},vn.whereMax($,q,K)))&&Y.is(Ai)&&(Y=tt.find(this.city.permanents,function(i){return function(t){if(t.is(Yt)&&i[0].onWorld.worldGroup==t.world.worldGroup&&t.get_hasPrivateTeleporter()){var e=t;return!!(e.is(Yt)&&0<e.get_remainingCapacity())&&(0==e.get_fixedCapacityForWorkers()||tt.count(e.workers,function(t){return t.job==e})>=e.get_fixedCapacityForWorkers())}return!1}}(H))):Y=null!=H[0].job?(q=this.simulation.permanentFinder,K=H[0].job,Q=function(e,i){return function(t){return i[0](e[0],t)}}([H[0].job],N),J=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness},q.query(K,Q,J,null,99.999999)):(Q=this.city.permanents,J=function(e,i){return function(t){return i[0](e[0],t)}}([H[0]],Z),Z=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness},vn.whereMax(Q,J,Z)),null!=Y&&((H[0].home=Y).residents.push(H[0]),Y.get_hasPrivateTeleporter()&&Uo.privateTeleportersLeft[H[0].onWorld.worldGroup]--)),null==L.home&&(E[L.onWorld.worldGroup]=!0))}this.shouldUpdateHouses=!1}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;var i=e;this.citizensWithFixedHomes=[];for(var n=0,s=i;n<s;){n++;var r=this.simulation.citizens,e=t.bytes.getInt32(t.readStart);t.readStart+=4;r=r[e];r.isForcedHome=!0,this.citizensWithFixedHomes.push(r)}},save:function(t){var e=this.citizensWithFixedHomes.length;if(t.size+4>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,r,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,10<=this.citizensWithFixedHomes.length)for(var i=0,n=this.simulation.citizens;i<n.length;){var s=n[i];++i,s.isForcedHome&&(e=this.simulation.citizens.indexOf(s),t.size+4>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,r,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4)}else for(i=0,n=this.citizensWithFixedHomes;i<n.length;){s=n[i];++i;var r,e=this.simulation.citizens.indexOf(s);t.size+4>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,r,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4}},__class__:Uo};var Lo=function(t,e){this.availableClassesForJob=[],this.citizensWithoutJob=[],this.buildingsHaveWork=!0,this.city=t,this.simulation=e,this.priorityJobs=new zr};(V["simulation.JobAssigner"]=Lo).__name__="simulation.JobAssigner",Lo.prototype={assignJobs:function(){if(this.doStorySpecific(),this.buildingsHaveWork){for(var t=[],e=[],i=0,n=$.getClassIDLength();i<n;){var s=i++;e.push(0)}for(var r=e,e=[],i=0,n=$.getClassIDLength();i<n;){s=i++;e.push(!1)}for(var o=e,a=zr.keysIterator(this.priorityJobs.h);a.hasNext();){var l=a.next(),h=$.getClassID(l),l=Object.prototype.hasOwnProperty.call(this.priorityJobs.h,l)?this.priorityJobs.h[l]:0;o[h]=1e6==l,r[h]=o[h]?0:l}for(e=0,i=this.city.workBuildings;e<i.length;){var u=i[e];++e,u.workers.length<u.get_jobs()&&t.push(u),o[u.classID]&&(r[u.classID]+=u.get_jobs()),r[u.classID]-=u.workers.length}for(var d=!1,c=0,e=0;e<r.length;){var p=r[e];++e,0<p&&(d=!0,++c)}if(d||0!=this.citizensWithoutJob.length||0!=this.availableClassesForJob.length){for(var g=!0,m=!0,e=[],i=0,n=this.city.connections.numberOfWorldGroups;i<n;){s=i++;e.push(!1)}for(var f=e;m;){m=!1,g&&("cityofthekey"==this.city.progress.story.storyName?t.sort(function(t,e){return"buildings.SecretSocietyHouse"==t.className?-1:"buildings.SecretSocietyHouse"==e.className||t.workers.length>e.workers.length?1:t.workers.length<e.workers.length?-1:0}):t.sort(function(t,e){return t.workers.length>e.workers.length?1:t.workers.length<e.workers.length?-1:0}),g=!1);for(e=0;e<t.length;){var y=[t[e]];if(++e,y[0].workers.length!=y[0].get_jobs()&&!(d&&r[y[0].classID]<=0)){var _=tt.find(this.citizensWithoutJob,function(e){return function(t){return t.onWorld.worldGroup==e[0].world.worldGroup||!(null==t.home||!t.home.get_hasPrivateTeleporter()||!e[0].world.hasTeleporterOnGroup)&&!e[0].is(Yt)}}(y));if(d&&null==_){if(!f[y[0].world.worldGroup]){for(var w=null,b=0,i=0,n=this.city.workBuildings;i<n.length;){u=n[i];++i,y[0].world.worldGroup==u.world.worldGroup&&u.workers.length>b&&r[u.classID]<0&&(b=(w=u).workers.length)}null!=w&&0<w.workers.length?((_=w.workers[w.workers.length-1]).loseJob(!0),r[w.classID]+=1):f[y[0].world.worldGroup]=!0}}else if(0<this.availableClassesForJob.length&&null==_){for(var v=null,S=0,x=this.availableClassesForJob,P=new Array(x.length),C=0,I=x.length;C<I;)P[s=C++]=x[s].classType;for(var T=P,B=0,k=this.city.workBuildings;B<k.length;){var M=k[B];++B,y[0].world.worldGroup==M.world.worldGroup&&M.workers.length>S&&r[M.classID]<0&&-1!=T.indexOf(M.classID)&&(S=(v=M).workers.length)}if(null!=v){for(var z=0,A=this.availableClassesForJob.length;z<A;){var W=z++;if(this.availableClassesForJob[W].classType==y[0].classID){--this.availableClassesForJob[W].number,this.availableClassesForJob[W].number<=0&&this.availableClassesForJob.splice(W,1);break}}v!=y[0]&&((_=v.workers[v.workers.length-1]).loseJob(!0),r[v.classID]+=1)}}if(null!=_){var F,O,D,R,U,L,E,H,N,G,X,j,m=!0;if(--r[y[0].classID],Y.remove(this.citizensWithoutJob,_),y[0].workers.push(_),_.job=y[0],y[0].afterGiveJob(_),_.onWorld.worldGroup!=y[0].world.worldGroup||null!=_.home&&!_.home.is(Ve)||(_.evictFromHome(),D=!1,y[0].is(Yt)&&0<y[0].get_remainingCapacity()&&(U=y[0],(_.home=U).residents.push(_),D=!0),D&&null!=_.home||(X=this.simulation.houseAssigner,j=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.onWorld.worldGroup==e.world.worldGroup}],N=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers()))&&t.world.worldGroup==e.world.worldGroup}],O=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.onWorld.worldGroup==e.world.worldGroup)||e.is(Ai)}],R=[function(t,e){var i=e;return!!(i.is(Yt)&&0<i.get_remainingCapacity()&&(0==i.get_fixedCapacityForWorkers()||tt.count(i.workers,function(t){return t.job==i})>=i.get_fixedCapacityForWorkers())&&t.world.worldGroup==e.world.worldGroup)||e.is(Ai)}],null==(F=[_])[0].home&&(U=null,0<Uo.privateTeleportersLeft[F[0].onWorld.worldGroup]?null!=(U=null!=F[0].job?(D=X.simulation.permanentFinder,_=F[0].job,R=function(e,i){return function(t){return i[0](e[0],t)}}([F[0].job],R),L=function(t){return t.is(Ai)?100:t.get_baseAttractiveness()+t.bonusAttractiveness},D.query(_,R,L,null,99.999999)):(L=X.city.permanents,E=function(e,i){return function(t){return i[0](e[0],t)}}([F[0]],O),H=function(t){return t.is(Ai)?100:t.get_baseAttractiveness()+t.bonusAttractiveness},vn.whereMax(L,E,H)))&&U.is(Ai)&&(U=tt.find(X.city.permanents,function(i){return function(t){if(t.is(Yt)&&i[0].onWorld.worldGroup==t.world.worldGroup&&t.get_hasPrivateTeleporter()){var e=t;return!!(e.is(Yt)&&0<e.get_remainingCapacity())&&(0==e.get_fixedCapacityForWorkers()||tt.count(e.workers,function(t){return t.job==e})>=e.get_fixedCapacityForWorkers())}return!1}}(F))):U=null!=F[0].job?(E=X.simulation.permanentFinder,H=F[0].job,N=function(e,i){return function(t){return i[0](e[0],t)}}([F[0].job],N),G=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness},E.query(H,N,G,null,99.999999)):(G=X.city.permanents,X=function(e,i){return function(t){return i[0](e[0],t)}}([F[0]],j),j=function(t){return t.get_baseAttractiveness()+t.bonusAttractiveness},vn.whereMax(G,X,j)),null!=U&&((F[0].home=U).residents.push(F[0]),U.get_hasPrivateTeleporter()&&Uo.privateTeleportersLeft[F[0].onWorld.worldGroup]--)))),0==this.citizensWithoutJob.length&&!d)return void(this.availableClassesForJob=[]);if(r[y[0].classID]<=0&&--c<=0){g=!(d=!1);break}}}}!m&&d&&(g=!(d=!(m=!0)))}this.buildingsHaveWork=!1,this.availableClassesForJob=[]}else this.buildingsHaveWork=!1}},giveCitizenJob:function(t,e){-1!=this.citizensWithoutJob.indexOf(t)&&Y.remove(this.citizensWithoutJob,t),e.workers.push(t),(t.job=e).afterGiveJob(t)},save:function(t){var e=tt.count(this.priorityJobs);t.size+4>t.bytes.length&&(s=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,s,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var i=zr.keysIterator(this.priorityJobs.h);i.hasNext();){var n=i.next();t.addString(n);var s,e=this.priorityJobs.h[n];t.size+4>t.bytes.length&&(s=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,s,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4}},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;var s=t.readString(),r=this.priorityJobs,e=t.bytes.getInt32(t.readStart);t.readStart+=4,r.h[s]=e}},doStorySpecific:function(){"cityofthekey"==this.city.progress.story.storyName&&(this.priorityJobs.h["buildings.SecretSocietyHouse"]=8)},__class__:Lo};var Eo=function(t){this.teleportersAreUserEnabled=!0,this.teleportersEnabled=!0,this.operatingCost=new M,this.city=t};(V["simulation.OperatingCost"]=Eo).__name__="simulation.OperatingCost",Eo.prototype={changeTeleportersEnabledState:function(t,e){t!=this.teleportersEnabled?(e||this.teleportersAreUserEnabled||this.teleportersEnabled)&&(this.teleportersEnabled=t,e&&(this.teleportersAreUserEnabled=this.teleportersEnabled),this.teleportersEnabled&&(this.city.simulation.houseAssigner.shouldUpdateHouses=!0),this.recalculate()):e&&(this.teleportersAreUserEnabled=this.teleportersEnabled)},recalculate:function(){this.operatingCost=this.getWholeCityOperatingCost()},update:function(t){this.recalculate(),this.city.materials.knowledge>10*t&&this.teleportersAreUserEnabled&&!this.teleportersEnabled&&this.changeTeleportersEnabledState(!0,!1);var e=this.operatingCost.copy();e.multiply(t/1440*this.city.simulation.time.minutesPerTick),this.city.materials.canAfford(e)?(this.city.materials.remove(e),e.addToConsumption(this.city.simulation.stats)):this.changeTeleportersEnabledState(!1,!1)},getWholeCityOperatingCost:function(){for(var t=new M,e=0,i=this.city.permanents;e<i.length;){var n=i[e];++e,n.isBuilding&&t.add(this.getOperatingCost(n.info,!0))}return t},getWholeCityOperatingCostTeleporters:function(){for(var t=new M,e=0,i=this.city.permanents;e<i.length;){var n=i[e];++e,n.isBuilding&&("Teleporter"!=n.info.className&&"Villa"!=n.info.className&&"FlowerPenthouse"!=n.info.className||t.add(this.getOperatingCost(n.info,!0)))}return t},getOperatingCost:function(t,e){null==e&&(e=!1);var i=null==this.city.misdirector?1:.5;if(!e||this.teleportersEnabled){if("Teleporter"==t.className)return new M(0,0,0,0,20*i);if("Villa"==t.className||"FlowerPenthouse"==t.className)return new M(0,0,0,0,2*i)}return new M},getOperatingCostReason:function(t){return kn.lo("operating_cost_pd")+" "},save:function(t,e){null==e&&(e=!0),e&&t.addString(Eo.saveDefinition);e=this.teleportersEnabled;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1;var i,e=this.teleportersAreUserEnabled;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"teleportersEnabled")&&(this.teleportersEnabled=t.h.teleportersEnabled),Object.prototype.hasOwnProperty.call(t.h,"teleportersAreUserEnabled")&&(this.teleportersAreUserEnabled=t.h.teleportersAreUserEnabled)},__class__:Eo};var Ho=function(t){this.priorities=[],this.city=t};(V["simulation.ResourcePriorityManager"]=Ho).__name__="simulation.ResourcePriorityManager",Ho.prototype={prioritize:function(t){-1==this.priorities.indexOf(t)&&this.priorities.push(t),this.invalidatePathfindingAfterPrioritizeChange(t)},invalidatePathfindingAfterPrioritizeChange:function(t){if(t.is(da))for(var e=0,i=this.city.permanents;e<i.length;){var n=i[e];++e,n.is(Bi)&&n.invalidatePathfindingRelatedInfo()}if(t.is(ua))for(e=0,i=this.city.permanents;e<i.length;){n=i[e];++e,n.is(Ei)&&n.invalidatePathfindingRelatedInfo()}},hasResourcePrioritiesFor:function(e){return vn.any(this.priorities,function(t){return t.is(e)})},deprioritize:function(t){-1!=this.priorities.indexOf(t)&&(this.invalidatePathfindingAfterPrioritizeChange(t),Y.remove(this.priorities,t))},isPrioritized:function(t){return-1!=this.priorities.indexOf(t)},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;var i=e;this.priorities=[];for(var n=0,s=i;n<s;){n++;var r=this.city.permanentsByID,e=t.bytes.getInt32(t.readStart);t.readStart+=4;r=r.h[e];null!=r&&this.priorities.push(r)}},save:function(t){var e=this.priorities.length;t.size+4>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,r,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var i=0,n=this.priorities;i<n.length;){var s=n[i];++i;var r,e=s.id;t.size+4>t.bytes.length&&(r=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,r,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4}},__class__:Ho};var No=function(t,e){this.schoolsShouldBeUpdated=!1,this.city=t,this.simulation=e};(V["simulation.SchoolAssigner"]=No).__name__="simulation.SchoolAssigner",No.prototype={assignSchools:function(){if(this.schoolsShouldBeUpdated){for(var t=[],e=0,i=this.city.permanents;e<i.length;){var n,s,r=i[e];++e,(n=!!r.is(bi)&&((s=r).students.length<s.get_studentCapacity()&&0<s.workers.length))&&t.push(r)}if(0<=(n=t).length){n.sort(function(t,e){return t.students.length-e.students.length});for(t=[],e=0,i=this.city.simulation.citizens;e<i.length;){r=i[e];++e,r.get_age()<16&&null==r.school&&t.push(r)}for(var o=t,a=!0;0<o.length&&a;){a=!1;for(var l=n.length;0<=--l;){var h=[n[l]],u=tt.find(o,function(e){return function(t){return t.onWorld.worldGroup==e[0].world.worldGroup||!(null==t.home||!t.home.get_hasPrivateTeleporter())&&e[0].world.hasTeleporterOnGroup}}(h));if(null!=u&&(a=!0,Y.remove(o,u),u.school=h[0],h[0].students.push(u),h[0].students.length>=h[0].get_studentCapacity()&&n.splice(l,1)),0==o.length)break}}}this.schoolsShouldBeUpdated=!1}},__class__:No};var Go=function(t,e,i,n,s){if(this.stage=e,this.simulation=t,this.toWorld=i,this.spawn=n,null==s){for(var r=-5,o=[],a=0,l=i.permanents.length;a<l;){var h=a++,u=-1,d=i.permanents[h];0==d.length?u=1:null!=d[0]&&d[0].is(m)&&!d[0].isRooftopBuilding&&(u=0),r<u&&(r=u,o=[]),r<=u&&o.push(h)}s=bo.fromArray(o)}this.toXIndex=s,this.yPositionAboveWorld=1e3+20*i.permanents[s].length,this.sprite=H.makeSprite("spr_flyingsaucer"),this.setSpritePosition(),e.addChild(this.sprite)};(V["simulation.SpawnFlyingSaucer"]=Go).__name__="simulation.SpawnFlyingSaucer",Go.fromLoad=function(t,e,i){var n=e.city.worlds,s=t.bytes.getInt32(t.readStart);t.readStart+=4;var r=n[s],s=t.bytes.getInt32(t.readStart);t.readStart+=4;n=s,s=t.bytes.getDouble(t.readStart);t.readStart+=8;t=t.readJSON(),n=new Go(e,i,r,t,n);return n.yPositionAboveWorld=s,n},Go.prototype={update:function(t){this.yPositionAboveWorld-=3*t,this.setSpritePosition(),this.yPositionAboveWorld<=20*this.toWorld.permanents[this.toXIndex].length&&(this.spawnCitizens(),this.destroy())},spawnCitizens:function(){var t=null,e=null,i=this.toWorld.permanents[this.toXIndex];0==i.length?e=20*this.toXIndex:t=i[i.length-1];for(var n=0,s=this.spawn.amount;n<s;){n++;var r=this.spawn.ageRangeMin;this.spawn.ageRangeMin!=this.spawn.ageRangeMax&&(r=bo.getFloat(this.spawn.ageRangeMin,this.spawn.ageRangeMax)),this.simulation.createCitizen(this.toWorld,r,t,e)}},setSpritePosition:function(){this.sprite.position.set(this.toWorld.rect.x+20*this.toXIndex,this.toWorld.rect.y-this.yPositionAboveWorld-20+1)},destroy:function(){this.stage.removeChild(this.sprite),Y.remove(this.simulation.citizenSpawners,this)},save:function(t){var e=this.simulation.city.worlds.indexOf(this.toWorld);t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;e=this.toXIndex;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;var i,e=this.yPositionAboveWorld;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8,t.addJSON(this.spawn)},__class__:Go};var Xo=function(t,e){this.peopleWorkingAtLabs=0,this.people=0,this.jobs=0,this.houseCapacity=0,this.peopleWithHome=0,this.peopleWithAJob=0,this.children=0,this.laborForce=0,this.shouldUpdateIn=-1,this.city=t,this.simulation=e,this.materialProduction=[],this.materialUsed=[],this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]),this.materialProduction.push([0,0,0,0,0,0,0]);for(var i=0,n=z.modMaterials;i<n.length;){var s=n[i];++i;s.variableName;this.materialProduction.push([0,0,0,0,0,0,0])}this.materialProduction.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]),this.materialUsed.push([0,0,0,0,0,0,0]);for(i=0,n=z.modMaterials;i<n.length;){s=n[i];++i;s.variableName;this.materialUsed.push([0,0,0,0,0,0,0])}this.materialUsed.push([0,0,0,0,0,0,0])};(V["simulation.Stats"]=Xo).__name__="simulation.Stats",Xo.prototype={save:function(t){this.saveBasics(t);var e=this.materialProduction.length;t.size+4>t.bytes.length&&(l=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,l,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var i=0,n=this.materialProduction.length;i<n;){var s=i++;t.addString(z.findMaterialName(s));e=this.materialProduction[s].length;t.size+4>t.bytes.length&&(l=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,l,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var r=0,o=this.materialProduction[s];r<o.length;){var a=o[r];++r,t.size+8>t.bytes.length&&(h=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,h,0,t.size)),t.bytes.setDouble(t.size,a),t.size+=8}}e=this.materialUsed.length;t.size+4>t.bytes.length&&(l=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,l,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(i=0,n=this.materialUsed.length;i<n;){s=i++;t.addString(z.findMaterialName(s));var l,e=this.materialUsed[s].length;t.size+4>t.bytes.length&&(l=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,l,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(r=0,o=this.materialUsed[s];r<o.length;){var h,a=o[r];++r,t.size+8>t.bytes.length&&(h=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,h,0,t.size)),t.bytes.setDouble(t.size,a),t.size+=8}}},load:function(t){if(this.loadBasics(t),5<=t.version){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i=0,n=e;i<n;){i++;if(-1!=(c=z.findMaterialIndex(t.readString()))){var s=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var r=0,o=s;r<o;){var a=r++,l=t.bytes.getDouble(t.readStart);t.readStart+=8;var h=l;this.materialProduction[c].length<=a?this.materialProduction[c].push(h):this.materialProduction[c][a]=h}}else{e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var u=0,d=e;u<d;){u++,t.bytes.getDouble(t.readStart);t.readStart+=8}}}}if(11<=t.version){e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(i=0,n=e;i<n;){var c;i++;if(-1!=(c=z.findMaterialIndex(t.readString()))){s=t.bytes.getInt32(t.readStart);t.readStart+=4;for(r=0,o=s;r<o;){a=r++,l=t.bytes.getDouble(t.readStart);t.readStart+=8;var p=l;this.materialUsed[c].length<=a?this.materialUsed[c].push(p):this.materialUsed[c][a]=p}}else{e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(u=0,d=e;u<d;){u++,t.bytes.getDouble(t.readStart);t.readStart+=8}}}}},update:function(t){if(this.shouldUpdateIn<=0){this.laborForce=0,this.peopleWithAJob=0,this.peopleWithHome=0,this.children=0,this.houseCapacity=0,this.peopleWorkingAtLabs=0,this.people=this.simulation.citizens.length,this.jobs=0;for(var e=this.simulation.eating.herbsCap=0,i=this.simulation.citizens;e<i.length;){var n=i[e];++e,16<=n.lastInfrequentUpdateAge?(this.laborForce+=1,null!=n.job&&(this.peopleWithAJob+=1,(n.job.is(qe)||n.job.is(Ie))&&(this.peopleWorkingAtLabs+=1))):this.children+=1,null!=n.home&&(this.peopleWithHome+=1)}for(e=0,i=this.city.permanents;e<i.length;){var s=i[e];++e,s.is(Yt)&&(this.houseCapacity+=s.get_residentCapacity()),s.is(Jt)&&(this.jobs+=s.get_jobs()),s.is(Ge)&&(this.simulation.eating.herbsCap+=s.getHerbCapacity())}this.shouldUpdateIn+=20,this.city.progress.unlocks.checkStatRelatedUnlocks()}else this.shouldUpdateIn-=Math.max(1,t)},midnightUpdate:function(){for(var t=0,e=this.materialProduction;t<e.length;){var i=e[t];++t;for(var n=i.length;1<=--n;)i[n]=i[n-1];i[0]=0}for(t=0,e=this.materialUsed;t<e.length;){var s=e[t];++t;for(n=s.length;1<=--n;)s[n]=s[n-1];s[0]=0}},amountOfBuildingsOfType:function(t){for(var e=0,i=0,n=this.city.permanents;i<n.length;){var s=n[i];++i,s.is(t)&&++e}return e},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(Xo.saveDefinition)},loadBasics:function(t,e){null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:Xo},n=function(){},(V["simulation.Train"]=n).__name__="simulation.Train",n.__super__=t,n.prototype=e(t.prototype,{__class__:n});var jo=function(t){To.call(this,t)};(V["simulation.citizenSpecialActions.ClimbIntoTree"]=jo).__name__="simulation.citizenSpecialActions.ClimbIntoTree",jo.__super__=To,jo.prototype=e(To.prototype,{update:function(t){if(null!=this.citizen.inPermanent&&this.citizen.inPermanent.is(ua)){var e,i,n=this.citizen.inPermanent;((0|this.time.timeSinceStart)/60|0)%24==4&&45<(0|this.time.timeSinceStart)%60?0!=this.citizen.relativeY&&(e=this.citizen,(s=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=9,s[1]=0,e.setPath(s,0,2)):0==this.citizen.relativeY&&(e=this.citizen,(s=0<(i=io.pool)[4].length?i[4].splice(i[4].length-1,1)[0]:new Int32Array(4))[0]=4,s[1]=n.get_treeClimbX(),s[2]=9,s[3]=n.get_treeClimbY(),e.setPath(s,0,4))}else{for(var s,r=null,o=1e5,a=0,l=this.citizen.onWorld.permanents;a<l.length;){var h,u=l[a];++a,1<=u.length&&null!=u[0]&&u[0].is(ua)&&((h=u[0]).materialsLeft!=h.initialMaterials||(u=20*h.worldPosition.x-this.citizen.get_worldX())<o&&(r=h,o=u))}null!=r&&((s=this.citizen).simulation.pathfinder.findPath(s,r),s.pathOnFail=null)}},isActive:function(){return 0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4},__class__:jo});var Vo=function(t){this.cancelAction=!1,To.call(this,t)};(V["simulation.citizenSpecialActions.ClimbOntoRuins"]=Vo).__name__="simulation.citizenSpecialActions.ClimbOntoRuins",Vo.__super__=To,Vo.prototype=e(To.prototype,{update:function(t){if(!this.cancelAction)if(null!=this.citizen.inPermanent&&this.citizen.inPermanent.is(la)){var e,i,n=this.citizen.inPermanent;((0|this.time.timeSinceStart)/60|0)%24==4.5&&45<(0|this.time.timeSinceStart)%60?0!=this.citizen.relativeY&&(e=this.citizen,(s=0<(i=io.pool)[2].length?i[2].splice(i[2].length-1,1)[0]:new Int32Array(2))[0]=9,s[1]=0,e.setPath(s,0,2)):0==this.citizen.relativeY&&(e=this.citizen,(s=0<(i=io.pool)[4].length?i[4].splice(i[4].length-1,1)[0]:new Int32Array(4))[0]=4,s[1]=n.get_climbX(),s[2]=9,s[3]=n.get_climbY(),e.setPath(s,0,4))}else{for(var s,r=null,o=1e5,a=0,l=this.citizen.onWorld.permanents;a<l.length;){var h,u=l[a];++a,1<=u.length&&null!=u[0]&&u[0].is(la)&&((u=20*(h=u[0]).worldPosition.x-this.citizen.get_worldX())<o&&(r=h,o=u))}null!=r?((s=this.citizen).simulation.pathfinder.findPath(s,r),s.pathOnFail=null):this.cancelAction=!0}},isActive:function(){return.5<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4.5&&!this.cancelAction},__class__:Vo});var Yo=function(t){this.goIntoDirection=1,this.currentSprite=null,To.call(this,t)};(V["simulation.citizenSpecialActions.DanceOnBall"]=Yo).__name__="simulation.citizenSpecialActions.DanceOnBall",Yo.__super__=To,Yo.prototype=e(To.prototype,{update:function(t){var e;1<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=5?null!=this.citizen.inPermanent?this.citizen.goDownTowardsWorldSurface(t):(this.citizen.setRelativeY(4),null==this.currentSprite&&(this.goIntoDirection=bo.fromArray([-1,1]),this.currentSprite=new PIXI.Sprite(H.getTexture("spr_citizen_ball")),this.currentSprite.position.y=this.citizen.onWorld.rect.y-4,this.citizen.onWorld.city.farForegroundStage.addChild(this.currentSprite)),this.citizen.setRelativeX(this.citizen.relativeX+.5*t*this.goIntoDirection),(1==this.goIntoDirection&&this.citizen.relativeX>=this.citizen.onWorld.rect.width-2||-1==this.goIntoDirection&&this.citizen.relativeX<=0)&&(this.goIntoDirection=-this.goIntoDirection),this.currentSprite.position.x=this.citizen.onWorld.rect.x+this.citizen.relativeX-1):null!=this.currentSprite&&(this.citizen.onWorld.city.farForegroundStage.removeChild(this.currentSprite),e=this.citizen,(t=0<(t=io.pool)[2].length?t[2].splice(t[2].length-1,1)[0]:new Int32Array(2))[0]=8,t[1]=5,e.setPath(t,0,2,!0),e.pathEndFunction=null,e.pathOnlyRelatedTo=e.inPermanent,this.currentSprite=null,this.citizen.setRelativeY(0))},isActive:function(){return 1<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=5||null!=this.currentSprite},onDie:function(){To.prototype.onDie.call(this),null!=this.currentSprite&&this.citizen.onWorld.city.farForegroundStage.removeChild(this.currentSprite)},__class__:Yo});var $o=function(t){To.call(this,t)};(V["simulation.citizenSpecialActions.MoveToEdge"]=$o).__name__="simulation.citizenSpecialActions.MoveToEdge",$o.__super__=To,$o.prototype=e(To.prototype,{update:function(t){var e,i,n=this.citizen.onWorld.rect.width-2;(null!=this.citizen.inPermanent||0<this.citizen.relativeX&&this.citizen.relativeX<n)&&(null==this.citizen.inPermanent?(e=this.citizen,i=this.citizen.relativeX<n/2?0:n,(n=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,n[1]=i,e.setPath(n,0,2,!0),e.pathEndFunction=null,e.pathOnlyRelatedTo=e.inPermanent):this.citizen.goDownTowardsWorldSurface(t))},isActive:function(){var t=this.time.timeSinceStart/60%24;return 23<=t||t<5},__class__:$o});var qo=function(t){this.goingIntoThisDirection=0,this.goIntoDirection=1,this.currentSprite=null,To.call(this,t)};(V["simulation.citizenSpecialActions.Protester"]=qo).__name__="simulation.citizenSpecialActions.Protester",qo.__super__=To,qo.prototype=e(To.prototype,{update:function(t){var e;0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4&&(this.citizensAreVeryHappy()||this.citizensAreVeryUnhappy())?null!=this.citizen.inPermanent?this.citizen.goDownTowardsWorldSurface(t):(null==this.currentSprite&&(this.goIntoDirection=bo.fromArray([-1,1]),this.citizensAreVeryHappy()?this.currentSprite=new PIXI.Sprite(H.getTexture("spr_protestsign_happy")):this.currentSprite=new PIXI.Sprite(H.getTexture("spr_protestsign_sad")),this.currentSprite.position.y=this.citizen.onWorld.rect.y-this.currentSprite.height,this.citizen.onWorld.city.farForegroundStage.addChild(this.currentSprite)),this.citizen.setRelativeX(this.citizen.relativeX+.6666666666666666*t*this.goIntoDirection),1==this.goIntoDirection&&this.citizen.relativeX>=this.citizen.onWorld.rect.width-2||-1==this.goIntoDirection&&this.citizen.relativeX<=0?this.goIntoDirection=-this.goIntoDirection:150<this.goingIntoThisDirection&&1==bo.getInt(90)?(this.goIntoDirection=-this.goIntoDirection,this.goingIntoThisDirection=0):this.goingIntoThisDirection+=t,this.currentSprite.position.x=this.citizen.onWorld.rect.x+this.citizen.relativeX-(1==this.goIntoDirection?2:5)):null!=this.currentSprite&&(this.citizen.onWorld.city.farForegroundStage.removeChild(this.currentSprite),e=this.citizen,(t=0<(t=io.pool)[2].length?t[2].splice(t[2].length-1,1)[0]:new Int32Array(2))[0]=8,t[1]=5,e.setPath(t,0,2,!0),e.pathEndFunction=null,e.pathOnlyRelatedTo=e.inPermanent,this.currentSprite=null)},isActive:function(){return!!(0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4&&(this.citizensAreVeryHappy()||this.citizensAreVeryUnhappy()))||null!=this.currentSprite},citizensAreVeryHappy:function(){return 99.99<=this.simulation.happiness.happiness},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01},onDie:function(){To.prototype.onDie.call(this),null!=this.currentSprite&&this.citizen.onWorld.city.farForegroundStage.removeChild(this.currentSprite)},__class__:qo});var Ko=function(t){qo.call(this,t)};(V["simulation.citizenSpecialActions.Protester2"]=Ko).__name__="simulation.citizenSpecialActions.Protester2",Ko.__super__=qo,Ko.prototype=e(qo.prototype,{citizensAreVeryHappy:function(){return!1},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01&&this.simulation.happiness.veryUnhappyFromDay<1+((0|this.simulation.time.timeSinceStart)/1440|0)-2},__class__:Ko});var Qo=function(t){qo.call(this,t)};(V["simulation.citizenSpecialActions.Protester3"]=Qo).__name__="simulation.citizenSpecialActions.Protester3",Qo.__super__=qo,Qo.prototype=e(qo.prototype,{citizensAreVeryHappy:function(){return!1},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01&&this.simulation.happiness.veryUnhappyFromDay<1+((0|this.simulation.time.timeSinceStart)/1440|0)-4},__class__:Qo});var Jo=function(t){qo.call(this,t)};(V["simulation.citizenSpecialActions.Protester4"]=Jo).__name__="simulation.citizenSpecialActions.Protester4",Jo.__super__=qo,Jo.prototype=e(qo.prototype,{citizensAreVeryHappy:function(){return!1},citizensAreVeryUnhappy:function(){return this.simulation.happiness.happiness<=10.01&&this.simulation.happiness.veryUnhappyFromDay<1+((0|this.simulation.time.timeSinceStart)/1440|0)-7},__class__:Jo});var Zo=function(t){this.currentSprite=null,To.call(this,t)};function ta(t,e,i,n){this.started=!1,this.city=t,this.simulation=e,this.manager=i,this.centerBuilding=n}(V["simulation.citizenSpecialActions.WatchStars"]=Zo).__name__="simulation.citizenSpecialActions.WatchStars",Zo.__super__=To,Zo.prototype=e(To.prototype,{update:function(t){var e,i,n,s,r=this;0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4?null==this.currentSprite&&(null!=this.citizen.inPermanent?this.citizen.goDownTowardsWorldSurface(t):(e=20*Hr.findNearestBestBuildingStack(this.citizen,function(t){return 0==t.length||null==t[0]?1e3:t[0].is(ua)?999:0})+bo.getInt(4,14),i=this.citizen,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=4,s[1]=e,i.setPath(s,0,2,!0),i.pathEndFunction=function(){var t=H.getTexture("spr_telescope");r.currentSprite=new PIXI.Sprite(t),r.currentSprite.position.y=r.citizen.onWorld.rect.y-5,0==bo.getInt(2)?r.currentSprite.position.x=r.citizen.onWorld.rect.x+e-4:(r.currentSprite.position.x=r.citizen.onWorld.rect.x+e+2+4,r.currentSprite.scale.x=-1),r.citizen.onWorld.city.farForegroundStage.addChild(r.currentSprite)},i.pathOnlyRelatedTo=i.inPermanent)):null!=this.currentSprite&&(this.citizen.onWorld.city.farForegroundStage.removeChild(this.currentSprite),i=this.citizen,(s=0<(n=io.pool)[2].length?n[2].splice(n[2].length-1,1)[0]:new Int32Array(2))[0]=8,s[1]=5,i.setPath(s,0,2,!0),i.pathEndFunction=null,i.pathOnlyRelatedTo=i.inPermanent,this.currentSprite=null)},isActive:function(){return 0<=((0|this.time.timeSinceStart)/60|0)%24&&((0|this.time.timeSinceStart)/60|0)%24<=4||null!=this.currentSprite},onDie:function(){To.prototype.onDie.call(this),null!=this.currentSprite&&this.citizen.onWorld.city.farForegroundStage.removeChild(this.currentSprite)},__class__:Zo}),(V["simulation.festival.Festival"]=ta).__name__="simulation.festival.Festival",ta.prototype={get_normalDuration:function(){return 1440},plan:function(){this.city.simulation.time.timeSinceStart;this.timeStart=this.city.simulation.time.timeSinceStart,this.timeEnd=this.timeStart+this.get_normalDuration()},isNow:function(){return this.city.simulation.time.timeSinceStart>=this.timeStart},getText:function(){return kn.lo("festival_doing")},end:function(){this.manager.endFestival(this);for(var t=0,e=this.city.permanents;t<e.length;){var i=e[t];++t,Fr.__implements(i,le)&&i.stopFestival()}},update:function(t){this.city.simulation.time.timeSinceStart>this.timeEnd?this.end():this.isNow()&&(this.started||(this.startFestival(),this.started=!0),this.updateFestival(t))},updateFestival:function(t){},startFestival:function(){},doStartRepeatables:function(){for(var t=0,e=this.city.permanents;t<e.length;){var i=e[t];++t,Fr.__implements(i,le)&&i.initFestival()}},isInvolvedWithFestival:function(t){return!0},citizenFestivalUpdate:function(t,e){},updateFestivalCitizen:function(t,e){this.isInvolvedWithFestival(t)?t.fullyBeingControlled||(I.shouldUpdateDraw=!1,t.delayCanViewSelfInBuilding&&(t.delayCanViewSelfInBuilding=!1,I.shouldUpdateDraw=!0),t.updatePath(e),null!=t.path||t.isRequestingPath||fa(this,this.citizenFestivalUpdate)(t,e),I.shouldUpdateDraw&&t.actuallyUpdateDraw()):t.update(e)},save:function(t,e){null==e&&(e=!0),e&&t.addString(ta.saveDefinition);e=this.timeStart;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;e=this.timeEnd;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.started;t.size+1>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,i,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1},load:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"timeStart")&&(this.timeStart=t.h.timeStart),Object.prototype.hasOwnProperty.call(t.h,"timeEnd")&&(this.timeEnd=t.h.timeEnd),Object.prototype.hasOwnProperty.call(t.h,"started")&&(this.started=t.h.started)},__class__:ta};var ea=function(t,e){this.festivalCoolDown=0,this.city=t,this.simulation=e,this.festivals=[];e=[];e.push(!1),e.push(!1),e.push(!1),e.push(!1),e.push(!1),e.push(!1),e.push(!1),this.wasFestivalOnDay=e};(V["simulation.festival.FestivalManager"]=ea).__name__="simulation.festival.FestivalManager",ea.prototype={addFestival:function(t){this.festivals.push(t)},hasNoPlannedFestival:function(){return 0==this.festivals.length},plannedFestival:function(){for(var t=0,e=this.festivals;t<e.length;){var i=e[t];if(++t,!i.started)return i}return null},hasFestival:function(){return vn.any(this.festivals,function(t){return t.isNow()})},updateFestivalCitizens:function(t){for(var e=0,i=this.festivals;e<i.length;){var n=i[e];++e;for(var s=0,r=this.simulation.citizens;s<r.length;){var o=r[s];++s,n.updateFestivalCitizen(o,t)}}},currentFestival:function(){for(var t=0,e=this.festivals;t<e.length;){var i=e[t];if(++t,i.isNow())return i}return null},update:function(t){var e=this.currentFestival();null!=e&&(e.update(t),this.wasFestivalOnDay[0]=!0),-1<this.festivalCoolDown&&(this.festivalCoolDown-=t*this.city.simulation.time.minutesPerTick)},endFestival:function(t){Y.remove(this.festivals,t)},save:function(t){var e=this.festivals.length;t.size+4>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,a,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(var i=0,n=this.festivals;i<n.length;){var s=n[i];++i;var r=Fr.getClass(s);t.addString(r.__name__);e=s.centerBuilding.id;t.size+4>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,a,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,s.save(t)}e=this.wasFestivalOnDay.length;t.size+4>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,a,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4;for(i=0,n=this.wasFestivalOnDay.length;i<n;){var o=i++,e=this.wasFestivalOnDay[o];t.size+1>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+1))),t.bytes.blit(0,a,0,t.size)),t.bytes.b[t.size]=e?1:0,t.size+=1}var a,e=this.festivalCoolDown;t.size+8>t.bytes.length&&(a=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,a,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t){var e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var i,n=0,s=e;n<s;){var r=n++,o=t.readString(),e=t.bytes.getInt32(t.readStart);t.readStart+=4;o=X.createInstance(V[o],[this.city,this.simulation,this,this.city.findPermanentByID(e)]);o.load(t),this.festivals.push(o)}if(28<=t.version){e=t.bytes.getInt32(t.readStart);t.readStart+=4;for(n=0,s=e;n<s;){var r=n++,a=t.bytes.b[t.readStart];t.readStart+=1,this.wasFestivalOnDay[r]=0<a}}30<=t.version&&(i=t.bytes.getDouble(t.readStart),t.readStart+=8,this.festivalCoolDown=i)},afterLoad:function(){for(var t=0,e=this.festivals;t<e.length;){var i=e[t];++t,i.started&&i.doStartRepeatables()}},__class__:ea};var ia=function(t,e,i,n){ta.call(this,t,e,i,n)};function na(){}(V["simulation.festival.MusicFestival"]=ia).__name__="simulation.festival.MusicFestival",ia.involvedCitizens=function(t){for(var e=[],i=0,n=t.citizens;i<n.length;){var s=n[i];++i,18<s.get_age()&&(null==s.job||!s.job.is(bi))&&e.push(s)}return e},ia.canDo=function(t,e,i){var n=ia.involvedCitizens(e).length,i=ia.relevantBuildings(e,i).length;return n>ia.minCitizens&&(n/100|0)<i},ia.relevantBuildings=function(t,e){var i=[];return t.permanentFinder.query(e,function(t){var e;return!t.isBuilding||(e=t).isEntertainment&&(3!=(t=e).get_entertainmentType()&&0!=t.get_entertainmentType()&&1!=t.get_entertainmentType()||e.couldStandHere()&&!e.is(Se)&&i.push(t)),!1}),i},ia.__super__=ta,ia.prototype=e(ta.prototype,{isInvolvedWithFestival:function(t){return 18<t.get_age()&&(null==t.job||!t.job.is(bi))},updateFestival:function(t){},doStartRepeatables:function(){ta.prototype.doStartRepeatables.call(this);var t=ia.involvedCitizens(this.simulation).length/ia.citizensPerVenue|0,e=[];this.currentFestivalVenues=ia.relevantBuildings(this.simulation,this.centerBuilding),this.currentFestivalVenues.length>t&&(e=this.currentFestivalVenues.splice(t,this.currentFestivalVenues.length-t));for(var i=0,n=this.currentFestivalVenues.length;i<n;){for(var s=i++,r=this.currentFestivalVenues[s];null!=r.leftBuilding&&-1!=e.indexOf(r.leftBuilding);)Y.remove(e,r.leftBuilding),this.currentFestivalVenues.push(r.leftBuilding),r=r.leftBuilding;for(r=this.currentFestivalVenues[s];null!=r.rightBuilding&&-1!=e.indexOf(r.rightBuilding);)Y.remove(e,r.rightBuilding),this.currentFestivalVenues.push(r.rightBuilding),r=r.rightBuilding}this.currentFestivalVenuesSet=new Mr,this.currentTempWorkers=new Mr;for(i=0,n=this.currentFestivalVenues;i<n.length;){r=n[i];++i,this.currentFestivalVenuesSet.set(r,!0);this.currentTempWorkers.set(r,[])}},startFestival:function(){this.doStartRepeatables(),this.simulation.happiness.addBoost(Ro.withDuration(this.simulation.time,ia.happinessBoostDuration,ia.happinessBoostGiven,kn.lo("music_festival_boost")))},citizenFestivalUpdate:function(t,e){var i=!1;if(t.tryFinishWork(e)){if(null!=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null)&&null!=this.currentFestivalVenuesSet.h.__keys__[(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).__id__]){var n=this.currentTempWorkers.h[(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).__id__],s=(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null).is(Jt),r=null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null,o=null,a=!1;Fr.__implements(null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null,le)&&(o=null!=t.inPermanent&&t.inPermanent.isBuilding?t.inPermanent:null,a=!0);for(var l,h,u,d,c=!1,p=n.length,g=0;0<=--p;){var m=n[p];m.hasDied||!this.isInvolvedWithFestival(m)?n.splice(p,1):m==t&&(g=p,c=!0)}(!a&&s&&n.length<r.get_jobs()||a&&n.length<o.festivalJobs)&&(c||(c=!0,n.push(t))),c?(i=!0,a?o.doFestivalWork(this,t,e,g):r.work(t,e,!1)):(h=!0,u=(l=d=t.entertainment).citizen.inPermanent,s=d.citizen.simulation.time.timeSinceStart,d.entertainmentInited||(r=1,null==d.citizen.job&&null==d.citizen.school&&(r=.75),d.entertainmentFinishedTime=s+60*bo.getFloat(u.get_minimumNormalTimeToSpend(),u.get_maximumNormalTimeToSpend()),d.recentEntertainmentTypes[u.get_entertainmentType()]=s+1440*bo.getFloat(u.get_minimumEntertainmentGroupSatisfy(),u.get_maximumEntertainmentGroupSatisfy())*r,d.entertainmentInited=!0),s>=d.entertainmentFinishedTime&&u.finishEntertainment(d.citizen,e)?(h=!1,d.entertainmentInited=!1):a?(o=null!=(d=l.citizen).inPermanent&&d.inPermanent.isBuilding?d.inPermanent:null).beEntertainedFestival(this,l.citizen,e):u.beEntertained(l.citizen,e),i=h,t.dynamicUnsavedVars.searchingFestivalBuilding=null),t.canViewSelfInBuilding=!0}i||(null==t.dynamicUnsavedVars.searchingFestivalBuilding||t.dynamicUnsavedVars.searchingFestivalBuilding.destroyed?(i=bo.fromArray(this.currentFestivalVenues)).destroyed||(t.simulation.pathfinder.findPath(t,i),t.pathOnFail=null,t.dynamicUnsavedVars.searchingFestivalBuilding=i):(t.simulation.pathfinder.findPath(t,t.dynamicUnsavedVars.searchingFestivalBuilding),t.pathOnFail=null))}},getText:function(){return this.isNow()?kn.lo("music_festival_doing"):kn.lo("music_festival_planned")},end:function(){for(var t=0,e=this.city.simulation.citizens;t<e.length;){var i,n,s,r=e[t];++t,null==(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null)||null!=(s=this.currentTempWorkers.h[(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null).__id__])&&-1!=s.indexOf(r)&&(n=!1,s=(i=null)!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null,Fr.__implements(null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null,le)&&(i=null!=r.inPermanent&&r.inPermanent.isBuilding?r.inPermanent:null,n=!0),n?i.endFestivalWork(this,r):s.work(r,0,!0))}ta.prototype.end.call(this)},save:function(t,e){null==e&&(e=!0),ta.prototype.save.call(this,t),e&&t.addString(ia.saveDefinition)},load:function(t,e){ta.prototype.load.call(this,t),null==e&&(e=t.readString());Un.makeLoadMap(e,t)},__class__:ia}),(V["thx.Floats"]=na).__name__="thx.Floats",na.wrapCircular=function(t,e){return(t%=e)<0&&(t+=e),t};var sa={toRgb:function(t){return aa.toRgb(sa.toRgbx(t))},toRgbx:function(t){return[sa._c(t[0]+120,t[1],t[2]),sa._c(t[0],t[1],t[2]),sa._c(t[0]-120,t[1],t[2])]},_c:function(t,e,i){e=i<=.5?i*(1+e):i+e-i*e,i=2*i-e;return(t=na.wrapCircular(t,360))<60?i+(e-i)*t/60:t<180?e:t<240?i+(e-i)*(240-t)/60:i}},ra={toRgb:function(t){return aa.toRgb(ra.toRgbx(t))},toRgbx:function(t){var e,i,n;if(0==t[1])return[t[2],t[2],t[2]];var s=t[0]/60,r=Math.floor(s),s=s-r,o=t[2]*(1-t[1]),a=t[2]*(1-s*t[1]),l=t[2]*(1-(1-s)*t[1]);switch(r){case 0:e=t[2],i=l,n=o;break;case 1:e=a,i=t[2],n=o;break;case 2:e=o,i=t[2],n=l;break;case 3:e=o,i=a,n=t[2];break;case 4:e=l,i=o,n=t[2];break;default:e=t[2],i=o,n=a}return t=[e,i,n]}},oa={toInt:function(t){return t},get_red:function(t){return t>>16&255},get_green:function(t){return t>>8&255},get_blue:function(t){return 255&t}},aa={toRgb:function(t){return(255&Math.round(255*t[0]))<<16|(255&Math.round(255*t[1]))<<8|255&Math.round(255*t[2])}},la=function(t,e,i,n,s,r,o,a){this.standingPlaces=[],this.spriteName="",this.bonusesAwarded=0,this.explored=0,this.spriteName=null==a?bo.fromArray(["spr_alienruins","spr_alienruins_2"]):a,j.call(this,t,e,i,n,s,r,o,H.getTexture(this.spriteName)),this.standingPlaces=[2,3,8,9,10,15,16],this.bonusesAwarded=0,this.myAwardedBonuses=[]};(V["worldResources.AlienRuins"]=la).__name__="worldResources.AlienRuins",la.__super__=j,la.prototype=e(j.prototype,{get_name:function(){return kn.lo("alien_ruins")},get_climbX:function(){return"spr_alienruins"==this.spriteName?9:15},get_climbY:function(){return"spr_alienruins"==this.spriteName?17:16},getBonuses:function(t){function e(t,e,i){return{name:t,description:e,onGet:i}}function i(t,e,i){return{name:t,description:e,onGet:function(){n.city.materials.add(i),i.addToProduction(n.city.simulation.stats)}}}var n=this;switch(t){case 0:return[i(kn.lo("alien_ruins_find_1a"),kn.lo("alien_ruins_description_1a"),new M(20)),i(kn.lo("alien_ruins_find_1b"),kn.lo("alien_ruins_description_1b"),new M(0,25)),i(kn.lo("alien_ruins_find_1c"),kn.lo("alien_ruins_description_1c"),new M(0,22)),i(kn.lo("alien_ruins_find_1d"),kn.lo("alien_ruins_description_1d"),new M(0,0,12,5))];case 1:return[i(kn.lo("alien_ruins_find_2a"),kn.lo("alien_ruins_description_2a"),new M(40)),i(kn.lo("alien_ruins_find_2b"),kn.lo("alien_ruins_description_2b"),new M(0,35)),i(kn.lo("alien_ruins_find_2c"),kn.lo("alien_ruins_description_2c"),new M(0,0,0,20)),i(kn.lo("alien_ruins_find_2d"),kn.lo("alien_ruins_description_2d"),new M(0,0,42,0))];case 2:return[i(kn.lo("alien_ruins_find_3a"),kn.lo("alien_ruins_description_3a"),new M(10,0,0,5)),i(kn.lo("alien_ruins_find_3b"),kn.lo("alien_ruins_description_3b"),new M(17)),i(kn.lo("alien_ruins_find_3c"),kn.lo("alien_ruins_description_3c"),new M(0,15)),i(kn.lo("alien_ruins_find_3d"),kn.lo("alien_ruins_description_3d"),new M(0,0,22))];case 3:return[e(kn.lo("alien_ruins_find_4a"),kn.lo("alien_ruins_description_4a"),function(){n.city.simulation.bonuses.extraFoodFromFarms+=5}),e(kn.lo("alien_ruins_find_4b"),kn.lo("alien_ruins_description_4b"),function(){n.city.progress.unlocks.unlock($t),n.city.progress.unlocks.unlock(gn)}),e(kn.lo("alien_ruins_find_4c"),kn.lo("alien_ruins_description_4c"),function(){n.city.simulation.bonuses.machinePartsFactorySpeed*=1.1}),e(kn.lo("alien_ruins_find_4d"),kn.lo("alien_ruins_description_4d"),function(){n.city.simulation.bonuses.labSpeed*=1.05})];default:return[]}},addWindowInfoLines:function(){var t=this;j.prototype.addWindowInfoLines.call(this);var e=this.city.gui,i=e.windowInner;if(e.windowAddInfoText(null,function(){return kn.lo("n_pct_explored",[0|t.explored])}),i.addChild(new Qs(i,e.innerWindowStage,kn.lo("findings"),null,"Arial15",{left:0,right:0,top:3,bottom:0})),0==this.myAwardedBonuses.length)e.windowAddInfoText(kn.lo("exploration_nothing_found"));else for(var n=0,s=this.myAwardedBonuses;n<s.length;){var r=s[n];++n,e.windowAddInfoText(r.name+": "+r.description)}},createMoveWindow:function(){var e=this;this.city.createWorldResourceBuilderMove(this),this.city.gui.showSimpleWindow(kn.lo("move_ruins_howto"),null,!0),this.city.gui.setWindowPositioning(nr.Top),this.selectedSprite=H.makeSprite("spr_selectedbuilding"),this.selectedSprite.position.set(this.position.x-1,this.position.y-1),this.city.farForegroundStage.addChild(this.selectedSprite),this.city.gui.windowOnDestroy=function(){var t;null==e.city.builder||(3!=(t=e.city.builder.builderType)._hx_index||(t.worldResource,0))||e.city.builder.cancel(),null!=e.selectedSprite&&(e.city.farForegroundStage.removeChild(e.selectedSprite),e.selectedSprite=null)},this.city.gui.windowOnLateUpdate=function(){var t;null!=e.city.builder&&(3==(t=e.city.builder.builderType)._hx_index&&(t.worldResource,1))||e.city.gui.closeWindow()},this.city.gui.addWindowToStack(fa(this,this.createMoveWindow))},createWindowAddBottomButtons:function(){var t=this;100<=this.explored?this.city.gui.windowAddBottomButtons([{text:kn.lo("move"),action:function(){t.createMoveWindow()}}]):this.city.gui.windowAddBottomButtons()},awardAnyBonuses:function(){if(this.bonusesAwarded<((0|this.explored)/25|0)&&this.explored>=25*(this.bonusesAwarded+1)){for(var t,e=this.getBonuses(this.bonusesAwarded),i=[],n=0,s=e;n<s.length;){var r=s[n];++n,-1==la.alreadyFoundBonuses.indexOf(r.name)&&i.push(r)}0<(e=tt.array(i)).length&&(t=bo.fromArray(e),e=tt.find(e,function(t){return t.name==kn.lo("alien_ruins_find_4b")}),tt.count(this.city.permanents,function(t){return t.is(la)})<4&&null!=e&&(t=e),t.onGet(),this.myAwardedBonuses.push(t),la.alreadyFoundBonuses.push(t.name),this.city.gui.windowRelatedTo==this&&this.reloadWindow()),this.bonusesAwarded+=1}},createBonusWindow:function(t){this.city.gui.showSimpleWindow(t.description,"Alien Ruins Exploration Update",!0)},save:function(t,e){null==e&&(e=!1),j.prototype.save.call(this,t),this.saveBasics(t);var i=this.myAwardedBonuses.length;t.size+4>t.bytes.length&&(e=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,e,0,t.size)),t.bytes.setInt32(t.size,i),t.size+=4;for(var n=0,s=this.myAwardedBonuses;n<s.length;){var r=s[n];++n,t.addString(r.name),t.addString(r.description)}},load:function(t,e){j.prototype.load.call(this,t),this.loadBasics(t);var i=t.bytes.getInt32(t.readStart);t.readStart+=4;for(var n=0,s=i;n<s;){n++;var r={name:t.readString(),description:t.readString()};this.myAwardedBonuses.push(r),la.alreadyFoundBonuses.push(r.name)}},postLoad:function(){this.sprite.texture=H.getTexture(this.spriteName)},saveBasics:function(t,e){null==e&&(e=!0),e&&t.addString(la.saveDefinition);e=this.explored;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.bonusesAwarded;t.size+4>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+4))),t.bytes.blit(0,i,0,t.size)),t.bytes.setInt32(t.size,e),t.size+=4,t.addString(this.spriteName)},loadBasics:function(t,e){null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"explored")&&(this.explored=t.h.explored),Object.prototype.hasOwnProperty.call(t.h,"bonusesAwarded")&&(this.bonusesAwarded=t.h.bonusesAwarded),Object.prototype.hasOwnProperty.call(t.h,"spriteName")&&(this.spriteName=t.h.spriteName),this.postLoad()},__class__:la});var ha=function(t,e,i,n,s,r,o,a,l,h){this.maxCitizenX=17,this.minCitizenX=1,this.regrowProgress=0,this.textures=H.getTexturesByWidth(a,20),this.regrowTextures=null==h?null:H.getTexturesByWidth(h,20),this.initialMaterials=l,this.materialsLeft=l,j.call(this,t,e,i,n,s,r,o,this.textures[0])};(V["worldResources.LimitedWorldResource"]=ha).__name__="worldResources.LimitedWorldResource",ha.__interfaces__=[s],ha.updateTextureOfLimitedResourceSprite=function(t,e,i,n,s,r){t<=1e-7?r.texture=null!=s?s[i/100*s.length|0]:n[n.length-1]:(s=Math.floor((e-t)/e*n.length),e!=t&&0==s&&1<n.length&&(s=1),r.texture=n[s])},ha.updateRegrow=function(t,e,i){var n,s,r;t.materialsLeft<=0&&(n=i.simulation.time.timeSinceStart/60%24,((s=7)<(r=20)?s<=n&&n<r:s<=n||n<r)?t.regrowProgress+=t.get_regrowSpeed()*e:(n=i.simulation.time.timeSinceStart/60%24,((s=6)<(r=21)?s<=n&&n<r:s<=n||n<r)&&(t.regrowProgress+=t.get_regrowSpeed()*e*.5)),100<=t.regrowProgress&&(t.materialsLeft=t.initialMaterials,t.regrowProgress=0),t.updateTexture())},ha.__super__=j,ha.prototype=e(j.prototype,{get_destroyedOnEmpty:function(){return!0},get_doNotGather:function(){return!1},get_resourceName:function(){return""},get_regrowSpeed:function(){return 0},get_stayIfEmpty:function(){return!1},postLoad:function(){this.updateTexture()},update:function(t){j.prototype.update.call(this,t);var e,i,n,s=this.city;this.materialsLeft<=0&&(e=s.simulation.time.timeSinceStart/60%24,((i=7)<(n=20)?i<=e&&e<n:i<=e||e<n)?this.regrowProgress+=this.get_regrowSpeed()*t:(e=s.simulation.time.timeSinceStart/60%24,((i=6)<(n=21)?i<=e&&e<n:i<=e||e<n)&&(this.regrowProgress+=this.get_regrowSpeed()*t*.5)),100<=this.regrowProgress&&(this.materialsLeft=this.initialMaterials,this.regrowProgress=0),this.updateTexture())},updateTexture:function(){var t=this.materialsLeft,e=this.initialMaterials,i=this.textures,n=this.regrowTextures,s=this.sprite;t<=1e-7?s.texture=null!=n?n[this.regrowProgress/100*n.length|0]:i[i.length-1]:(n=Math.floor((e-t)/e*i.length),e!=t&&0==n&&1<i.length&&(n=1),s.texture=i[n])},addWindowInfoLines:function(){var t=this;j.prototype.addWindowInfoLines.call(this),this.city.gui.windowAddInfoText(null,function(){return t.materialsLeft<=0?kn.lo("pct_grown",[0|t.regrowProgress]):kn.lo("pct_left",[0|t.materialsLeft,t.initialMaterials,t.get_resourceName()])})},save:function(t,e){null==e&&(e=!0),j.prototype.save.call(this,t),e&&t.addString(ha.saveDefinition);e=this.materialsLeft;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8;var i,e=this.regrowProgress;t.size+8>t.bytes.length&&(i=t.bytes,t.bytes=new br(new ArrayBuffer(2*(t.size+8))),t.bytes.blit(0,i,0,t.size)),t.bytes.setDouble(t.size,e),t.size+=8},load:function(t,e){j.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"materialsLeft")&&(this.materialsLeft=t.h.materialsLeft),Object.prototype.hasOwnProperty.call(t.h,"regrowProgress")&&(this.regrowProgress=t.h.regrowProgress),this.postLoad()},__class__:ha});var ua=function(t,e,i,n,s,r,o,a,l,h){null==h&&(h="spr_forest_grow"),null==l&&(l=200),null==a&&(a="spr_forest"),ha.call(this,t,e,i,n,s,r,o,a,l,h),this.managementMode=pa.CutDownAndRegrow};(V["worldResources.Forest"]=ua).__name__="worldResources.Forest",ua.__super__=ha,ua.prototype=e(ha.prototype,{get_name:function(){return kn.lo("forest")},get_resourceName:function(){return"wood"},get_regrowSpeed:function(){return.003},get_destroyedOnEmpty:function(){return this.managementMode==pa.CutDownAndUproot},get_doNotGather:function(){return this.managementMode==pa.Protect},get_treeClimbX:function(){return 7},get_treeClimbY:function(){return 13},setManagementMode:function(t,e){if(null==e&&(e=!1),this.managementMode=t,!e&&ir.hasMultiUpgradeModeOn)for(var i=0,n=this.city.permanents;i<n.length;){var s=n[i];++i,s.is(ua)&&s.setManagementMode(t,!0)}},createMainWindowPart:function(){var t=this,e=this.city.gui;ha.prototype.createMainWindowPart.call(this),"en"==R.language&&(e.window.minWidth=235);var i=ir.createHeader(e,kn.lo("forest_management"));ir.addOneAndMaxButtons(e,i,function(){ir.hasMultiUpgradeModeOn=!1,t.reloadWindow()},function(){ir.hasMultiUpgradeModeOn=!0,t.reloadWindow()},kn.lo("forest_management_only_this"),function(){return"---"},function(){return kn.lo("forest_management_all")+(" ("+t.city.simulation.stats.amountOfBuildingsOfType(ua))+")."},!1),e.windowAddInfoText(ir.hasMultiUpgradeModeOn?kn.lo("forest_management_question_1")+" ":kn.lo("forest_management_question_2")+" "),ir.createActivatableButton(e,this.managementMode==pa.CutDownAndRegrow,function(){t.setManagementMode(pa.CutDownAndRegrow),t.reloadWindow()},kn.lo("forest_regrow"),ir.hasMultiUpgradeModeOn?kn.lo("forest_regrow_description_1"):kn.lo("forest_regrow_description_2")),ir.createActivatableButton(e,this.managementMode==pa.Protect,function(){t.setManagementMode(pa.Protect),t.reloadWindow()},kn.lo("forest_protect"),ir.hasMultiUpgradeModeOn?kn.lo("forest_protect_description_1"):kn.lo("forest_protect_description_2")),ir.createActivatableButton(e,this.managementMode==pa.CutDownAndUproot,function(){t.setManagementMode(pa.CutDownAndUproot),t.reloadWindow()},kn.lo("forest_uproot"),ir.hasMultiUpgradeModeOn?kn.lo("forest_uproot_description_1"):kn.lo("forest_uproot_description_2")),e.windowInner.addChild(new Cs(e.windowInner,new Cn(2,4)))},createWindowAddBottomButtons:function(){var t=this,e=null,i=!1,e=this.city.gui.windowAddBottomButtons([{text:this.materialsLeft<=0?kn.lo("forest_instant_uproot"):this.city.simulation.resourcePriorityManager.isPrioritized(this)?kn.lo("prioritized"):kn.lo("prioritize"),onHover:function(){t.materialsLeft<=0?i||t.city.gui.tooltip.setText(t,kn.lo("forest_instant_uproot_description")):t.city.simulation.resourcePriorityManager.isPrioritized(t)?t.city.gui.tooltip.setText(t,kn.lo("prioritize_description_1"),kn.lo("prioritized")):t.city.gui.tooltip.setText(t,kn.lo("prioritize_description_2"),kn.lo("prioritize"))},action:function(){t.materialsLeft<=0?i?(t.city.gui.closeWindow(),t.destroy(),t.materialsLeft=0):(e.setText(kn.lo("really_uproot")),i=!0):t.city.simulation.resourcePriorityManager.isPrioritized(t)?(t.city.simulation.resourcePriorityManager.deprioritize(t),e.setText(kn.lo("prioritize"))):(t.city.simulation.resourcePriorityManager.prioritize(t),e.setText(kn.lo("prioritized")))}}])[0],n=this.materialsLeft<=0;e.onUpdate=function(){t.materialsLeft<=0!=n&&(t.materialsLeft<=0?(i=!1,e.setText(kn.lo("forest_instant_uproot"))):t.city.simulation.resourcePriorityManager.isPrioritized(t)?e.setText(kn.lo("prioritize")):e.setText(kn.lo("prioritized")),n=t.materialsLeft<=0)}},save:function(t,e){null==e&&(e=!0),ha.prototype.save.call(this,t),e&&t.addString(ua.saveDefinition);e=this.managementMode;t.addString(x[e.__enum__].__constructs__[e._hx_index])},load:function(t,e){ha.prototype.load.call(this,t),null==e&&(e=t.readString());t=Un.makeLoadMap(e,t);Object.prototype.hasOwnProperty.call(t.h,"managementMode")&&(this.managementMode=t.h.managementMode)},__class__:ua}),s=function(t,e,i,n,s,r,o){ua.call(this,t,e,i,n,s,r,o,"spr_birchforest",120,"spr_pineforest_grow")},(V["worldResources.BirchForest"]=s).__name__="worldResources.BirchForest",s.__super__=ua,s.prototype=e(ua.prototype,{get_name:function(){return"Pine Forest"},get_regrowSpeed:function(){return.01},get_treeClimbX:function(){return 12},get_treeClimbY:function(){return 13},__class__:s});var da=function(t,e,i,n,s,r,o,a,l){null==l&&(l=250),null==a&&(a="spr_rock"),ha.call(this,t,e,i,n,s,r,o,a,l),this.managementMode=ga.Mine};(V["worldResources.Rock"]=da).__name__="worldResources.Rock",da.__super__=ha,da.prototype=e(ha.prototype,{get_name:function(){return kn.lo("rock")},get_resourceName:function(){return"stone"},get_doNotGather:function(){return this.managementMode==ga.Protect},setManagementMode:function(t,e){if(null==e&&(e=!1),this.managementMode=t,!e&&ir.hasMultiUpgradeModeOn)for(var i=0,n=this.city.permanents;i<n.length;){var s=n[i];++i,s.is(da)&&s.setManagementMode(t,!0)}},createMainWindowPart:function(){var t=this,e=this.city.gui;"en"==R.language&&(e.window.minWidth=195),ha.prototype.createMainWindowPart.call(this);var i=ir.createHeader(e,kn.lo("rock_mining"));ir.addOneAndMaxButtons(e,i,function(){ir.hasMultiUpgradeModeOn=!1,t.reloadWindow()},function(){ir.hasMultiUpgradeModeOn=!0,t.reloadWindow()},kn.lo("set_management_rock"),function(){return"---"},function(){return kn.lo("set_management_all_rocks")+(" ("+t.city.simulation.stats.amountOfBuildingsOfType(da))+")."},!1),e.windowAddInfoText(ir.hasMultiUpgradeModeOn?kn.lo("rock_management_question_1")+" ":kn.lo("rock_management_question_2")+" "),ir.createActivatableButton(e,this.managementMode==ga.Mine,function(){t.setManagementMode(ga.Mine),t.reloadWindow()},kn.lo("rock_management_mine"),ir.hasMultiUpgradeModeOn?kn.lo("rock_management_mine_description_1"):kn.lo("rock_management_mine_description_2")),ir.createActivatableButton(e,this.managementMode==ga.Protect,function(){t.setManagementMode(ga.Protect),t.reloadWindow()},kn.lo("forest_protect"),ir.hasMultiUpgradeModeOn?kn.lo("rock_management_protect_description_1"):kn.lo("rock_management_protect_description_2")),e.windowInner.addChild(new Cs(e.windowInner,new Cn(2,4)))},createWindowAddBottomButtons:function(){var t=this,e=null,e=this.city.gui.windowAddBottomButtons([{text:this.city.simulation.resourcePriorityManager.isPrioritized(this)?kn.lo("prioritized"):kn.lo("prioritize"),onHover:function(){t.city.simulation.resourcePriorityManager.isPrioritized(t)?t.city.gui.tooltip.setText(t,kn.lo("rock_prioritized_description"),kn.lo("prioritized")):t.city.gui.tooltip.setText(t,kn.lo("rock_prioritized_description_2"),kn.lo("prioritize"))},action:function(){t.city.simulation.resourcePriorityManager.isPrioritized(t)?(t.city.simulation.resourcePriorityManager.deprioritize(t),e.setText(kn.lo("prioritize"))):(t.city.simulation.resourcePriorityManager.prioritize(t),e.setText(kn.lo("prioritized")))}}])[0]},save:function(t,e){null==e&&(e=!0),ha.prototype.save.call(this,t),e&&t.addString(da.saveDefinition);e=this.managementMode;t.addString(x[e.__enum__].__constructs__[e._hx_index])},load:function(t,e){ha.prototype.load.call(this,t),t.version<39||(null==e&&(e=t.readString()),t=Un.makeLoadMap(e,t),Object.prototype.hasOwnProperty.call(t.h,"managementMode")&&(this.managementMode=t.h.managementMode))},__class__:da}),s=function(t,e,i,n,s,r,o){da.call(this,t,e,i,n,s,r,o,"spr_boulder",200)},(V["worldResources.Boulder"]=s).__name__="worldResources.Boulder",s.__super__=da,s.prototype=e(da.prototype,{get_name:function(){return"Boulder"},createMainWindowPart:function(){this.city.gui.windowAddInfoText("Texture by DT from the Discord, who won the first art contest!"),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,4))),da.prototype.createMainWindowPart.call(this)},__class__:s}),s=function(t,e,i,n,s,r,o){ua.call(this,t,e,i,n,s,r,o,"spr_forest_branches",200,"spr_forest_branches_grow")},(V["worldResources.BranchyForest"]=s).__name__="worldResources.BranchyForest",s.__super__=ua,s.prototype=e(ua.prototype,{get_name:function(){return kn.lo("buildableWorldResourcesInfo.json/BranchyForest.name")},get_regrowSpeed:function(){return.005},get_treeClimbX:function(){return 16},get_treeClimbY:function(){return 12},createMainWindowPart:function(){this.city.gui.windowAddInfoText("Texture by DT from the Discord, who won the first art contest!"),this.city.gui.windowInner.addChild(new Cs(this.city.gui.windowInner,new Cn(2,4))),ua.prototype.createMainWindowPart.call(this)},__class__:s});var ca=function(t,e,i,n,s,r,o){la.call(this,t,e,i,n,s,r,o,"spr_alienruins_3")};(V["worldResources.ComputerAlienRuins"]=ca).__name__="worldResources.ComputerAlienRuins",ca.__super__=la,ca.prototype=e(la.prototype,{get_climbX:function(){return 9},get_climbY:function(){return 15},getBonuses:function(t){function e(t,e,i){return{name:t,description:e,onGet:function(){n.city.materials.add(i),i.addToProduction(n.city.simulation.stats)}}}var n=this;switch(t){case 0:return[e(kn.lo("alien_ruins_find_1e"),kn.lo("alien_ruins_description_1e"),new M(0,35))];case 1:return[e(kn.lo("alien_ruins_find_2e"),kn.lo("alien_ruins_description_2e"),new M(0,0,55))];case 2:return[e(kn.lo("alien_ruins_find_3e"),kn.lo("alien_ruins_description_3e"),new M(0,0,0,7))];case 3:return[{name:kn.lo("alien_ruins_find_4e"),description:kn.lo("alien_ruins_description_4e"),onGet:function(){}}];default:return[]}},__class__:ca});var pa=x["worldResources.ForestManagementMode"]={__ename__:"worldResources.ForestManagementMode",__constructs__:["CutDownAndRegrow","Protect","CutDownAndUproot"],CutDownAndRegrow:{_hx_index:0,__enum__:"worldResources.ForestManagementMode",toString:i},Protect:{_hx_index:1,__enum__:"worldResources.ForestManagementMode",toString:i},CutDownAndUproot:{_hx_index:2,__enum__:"worldResources.ForestManagementMode",toString:i}},s=function(t,e,i,n,s,r,o){ua.call(this,t,e,i,n,s,r,o,"spr_pineforest",200,"spr_pineforest_grow")};(V["worldResources.PineForest"]=s).__name__="worldResources.PineForest",s.__super__=ua,s.prototype=e(ua.prototype,{get_name:function(){return kn.lo("pine_forest")},get_regrowSpeed:function(){return.005},get_treeClimbX:function(){return 15},get_treeClimbY:function(){return 3},__class__:s});var ga=x["worldResources.RockManagementMode"]={__ename__:"worldResources.RockManagementMode",__constructs__:["Mine","Protect"],Mine:{_hx_index:0,__enum__:"worldResources.RockManagementMode",toString:i},Protect:{_hx_index:1,__enum__:"worldResources.RockManagementMode",toString:i}};function ma(t){return t instanceof Array?new Wr(t):t.iterator()}function fa(t,e){return null==e?null:(null==e.__id__&&(e.__id__=o.$haxeUID++),null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[e.__id__],null==i&&(i=e.bind(t),t.hx__closures__[e.__id__]=i),i);var i}o.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(Y.now=performance.now.bind(performance)),V.Math=Math,null==String.fromCodePoint&&(String.fromCodePoint=function(t){return t<65536?String.fromCharCode(t):String.fromCharCode(55232+(t>>10))+String.fromCharCode(56320+(1023&t))}),String.prototype.__class__=V.String=String,String.__name__="String",V.Array=Array,Array.__name__="Array",Date.prototype.__class__=V.Date=Date,Date.__name__="Date";var ya={},_a={},wa=Number,ba=Boolean,va={},Sa={};Mr.count=0,Fr.__toStr={}.toString,p.enabled=!1,p.ready=!1,p.useAltEarlyGame=!1,p.sessionTime=0,p.reportedLongPlaytime=!1,p.didABTest=!1,p.capturedErrors=[],p.errorsReported=0,h.width=20,h.height=20,h.destroyingForReplacement=!1,h.destroyingDisableMoveDown=!1,h.saveDefinition="",m.spriteName="",r.saveDefinition="spriteIndex$Int",I.spriteCitizens=new Mr,I.shouldUpdateDraw=!1,I.saveDefinition="hasBuildingInited$Bool|spriteIndex$Int|relativeX$Float|bornOn$Float|actualWorkTimePreference$Float|currentAction$LifeAction|hasWorkTools$Bool|lastInfrequentUpdateAge$Float|dieAgeModifier$Float|educationLevel$Float",g.saveDefinition="maxPermanentID$Int|viewPos$FPoint|zoomScale$Float|cityName$String",u.saveDefinition="timeSinceStart$Float",k.isAdsTest=!1,k.enableCheats=!1,k.earlyGameFix1=!1,k.earlyGameFix2=!1,k.isLimitedDemo=!1,k.splashScreenDone=!1,k.siteLockUrls=null,k.hasFullscreen=!!window.document.fullscreenEnabled||window.document.webkitFullscreenEnabled,k.canBeMobile=!0,k.mobileTrailerMode=!1,k.mobileTrailerModeMultiplier=3,k.forceMobile=k.mobileTrailerMode,k.noInputYet=!0,k.hadFullStepWithInput=!1,k.lastInput=0,k.cheatSpeedEnabled=!1,f.closeButtonEnabled=!0,_.isLoading=!1,b.mobileBackPressed=!1,S.isMobile=!1,S.isLargeMobile=!1,S.isCanvasRenderer=!1,M.saveDefinition="wood$Float|stone$Float|food$Float|machineParts$Float|knowledge$Float|refinedMetal$Float|computerChips$Float|graphene$Float|cacao$Float|chocolate$Float",z.materialNames=["food","wood","stone","machineParts","refinedMetal","computerChips","cacao","chocolate","graphene","knowledge"],z.modMaterials=[],z.productionReasons=[[],[],[],[],[],[],[],[],[],[]],O.MEASUREMENT_INTERVAL=1e3,O.FONT_FAMILY="Helvetica,Arial",O.FPS_BG_CLR="#00FF00",O.FPS_WARN_BG_CLR="#FF8000",O.FPS_PROB_BG_CLR="#FF0000",O.MS_BG_CLR="#FFFF00",O.MEM_BG_CLR="#086A87",O.INFO_BG_CLR="#00FFFF",O.FPS_TXT_CLR="#000000",O.MS_TXT_CLR="#000000",O.MEM_TXT_CLR="#FFFFFF",O.INFO_TXT_CLR="#000000",O.TOP_LEFT="TL",O.TOP_RIGHT="TR",O.BOTTOM_LEFT="BL",O.BOTTOM_RIGHT="BR",O.DELAY_TIME=4e3,$.buildingClassesNumber=0,$.registeredClassNames=new zr,H.storiesInfo=new zr,H.singleTextureCache=new zr,H.multiTextureCache=new zr,H.multiTextureCache2=new zr,H.citizenNames=[],R.settingsLoaded=!1,R.musicOn=!0,R.soundOn=!0,R.fullscreen=!1,R.musicVolume=1,R.soundVolume=1,R.boostHidden=!1,R.colorBlindMode=!1,R.language="en",R.secretCodesEnabled=[],R.pathfindingWorkers=-1,J.stoneBoost=.3,et.entertainmentBoost=40,it.stoneBoost=.2,ut.efficiencyMod=2,ut.extraChipsPerStepPerWorker=5e-5,pt.extraFoodPerHarvest=10,mt.stoneBoost=.3,vt.efficiencyMod=1,St.efficiencyMod=2,St.extraMachinePartsMadePerStepPerWorker=.0015,Mt.extraYearsPerYear=.05,zt.stoneBoost=.3,At.efficiencyMod=1,At.extraRefinedMetalsMadePerWorker=5e-4,Ht.growthSpeedBoost=.2,Nt.efficiencyMod=.058,jt.spriteName="spr_aliendecryptor",jt.saveDefinition="timeWorking$Float",$t.spriteName="spr_alienhouse",Qt.spriteName="spr_aquarium",Qt.gardenTextureSets=[1],Qt.openTime=5,Qt.closeTime=23.5,Qt.saveDefinition="currentTexture$Int",Zt.spriteName="spr_arcade",Zt.closeTime=23,Zt.saveDefinition="",ee.spriteName="spr_artcolony",ee.progressPerStep=2e-5,ee.unlockNewWorkAfter=[4,7,8,10,13,13],ee.openTime=15,ee.closeTime=21.5,ee.saveDefinition="currentTexture$Int|currentWorkProgress$Float",ie.spriteName="spr_beacon",ie.saveDefinition="",ne.spriteName="spr_blossomhippiehq",ne.lastMission=8,ne.saveDefinition="lastEventDoneOnDay$Int|doingEvent$Int|eventPhase$Int|currentMission$Int",se.spriteName="spr_bloomrestaurant",re.spriteName="spr_bloomrestaurant",re.closeTime=.5,oe.workToolsX=4,oe.workToolsTime=20,ae.spriteName="spr_boardgamestore",ae.closeTime=23,ae.firstFloorChairs=[4,12],ae.saveDefinition="",he.spriteName="spr_botanicalgardens",he.gardenTextureSets=[2,3,2,4,2,2],he.mainTextures=["spr_botanicalgardens","spr_indoorpark","spr_indoorpark_alt1"],he.openTime=6,he.closeTime=22,he.saveDefinition="currentMainTexture$Int|currentTexture$Int",ue.spriteName="spr_cacaofarm",ue.foodPerHarvest=35,ue.growSpeed=.75,ue.harvestAmount=.025,ue.passiveGrowSpeed=.012,ue.passiveGrowSpeedBadLight=.006,ue.saveDefinition="farmStage$buildings.CacaoFarmStage|percentGrown$Float|foodLeft$Float|percentCleaned$Float",ce.timePerFrame=4,pe.saveDefinition="totalMaterialUsed$Float|materialMade$Float",ge.spriteName="spr_chocolatefactory",ge.saveDefinition="",me.spriteName="spr_cityhall",me.saveDefinition="",ye.spriteName="spr_coloredblock",ye.saveDefinition="currentTexture$Int",_e.spriteName="spr_comfortablehouse",we.spriteName="spr_computerchipfactory",we.saveDefinition="",be.spriteName="spr_computerresearchcenter",be.knowledgePerStep=.0014,be.saveDefinition="totalKnowledgeGenerated$Float",ve.spriteName="spr_cuttingedgehome",Se.spriteName="spr_ecofarm",Se.openTime=12,Se.closeTime=20.5,Se.crop2Sprites=["spr_ecofarm_crop2","spr_ecofarm_crop2_alt","spr_ecofarm_crop2_alt2"],Se.crop3Sprites=["spr_ecofarm_crop3","spr_ecofarm_crop3_alt"],Se.saveDefinition="openDay$Int|crop2Sprite$Int|crop3Sprite$Int",xe.spriteName="spr_labescaperoom",xe.closeTime=23.99,xe.maxVisitors=10,xe.saveDefinition="",Ce.spriteName="spr_experimentalfarm",Ce.indoorFarmSpeedIncrease=.1,Ce.saveDefinition="",Ie.spriteName="spr_experimentationlab",Ie.saveDefinition="",Te.spriteName="spr_explorationcentre",Te.explorePerAction=.25,Te.knowledgePerExploreAction=.25,Te.knowledgePerStep=.001,ke.spriteName="spr_refinedmetalfactory",ke.originalEfficiency=5,ke.origMaterialsMadePerStepPerWorker=.001,ke.saveDefinition="",Me.spriteName="spr_refinedmetalfactorypub",Me.closeTime=4.5,Me.saveDefinition="",ze.spriteName="spr_farmbyproductprocessor",ze.woodPerFarm=.0014,ze.saveDefinition="woodMade$Float",Ae.saveDefinition="farmStage$buildings.FarmStage|percentGrown$Float|foodLeft$Float|originalFoodLeft$Float|percentCleaned$Float",We.spriteName="spr_farmhouse",We.saveDefinition="stageProgress$Float|materialPhase$Int|totalMaterialsProduced$Float",Oe.spriteName="spr_festivalhq",Oe.saveDefinition="festivalCoolDown$Float",De.spriteName="spr_flowerpenthouse",De.saveDefinition="mirrored$Bool|timesUsed$Int|timesUsedTo$Int",Re.spriteName="spr_fossilmuseum",Re.knowledgePerStepPerFossil=.001,Re.closeTime=23,Re.educationPerDay=.035,Re.educationCap=1.61,Re.saveDefinition="totalKnowledgeGenerated$Float",Le.spriteName="spr_futuristichome",Le.educationPerDay=.005,Le.educationCap=1.2,Le.saveDefinition="mirrored$Bool|interior$Int",Ee.spriteName="spr_graphenefactory",Ee.saveDefinition="totalStoneUsed$Float|totalKnowledgeUsed$Float|materialMade$Float",He.spriteName="spr_grapheneresearchcenter",He.stoneUsePerGrapheneSheet=2,He.grapheneSheetsPerAction=.0015,He.knowledgePerAction=.0375,He.saveDefinition="totalKnowledgeGenerated$Float|totalStoneUsed$Float|totalGrapheneProduced$Float",Ne.spriteName="spr_hackerhq",Ne.lastMission=11,Ne.walkAroundPositions=[3,9,12,13],Ne.saveDefinition="lastEventDoneOnDay$Int|doingEvent$Int|eventPhase$Int|currentMission$Int",Ge.spriteName="spr_herbgarden",Ge.saveDefinition="currentTexture$Int",Xe.spriteName="spr_tech_nightclub",Xe.closeTime=6,Xe.saveDefinition="",je.spriteName="spr_hologamehall",je.openTime=12,je.closeTime=2,je.monsterSize=14,je.boosterSpriteSize=9,Ve.spriteName="spr_houseofthekeyfriends",Ye.spriteName="spr_hyperelevator",Ye.closeDoorSpeed=.5,Ye.openDoorSpeed=.5,Ye.doorOpenTime=45,Ye.saveDefinition="timesUsed$Int|timesUsedTo$Int",$e.spriteName="spr_indoorfarm",$e.foodPerHarvest=25,$e.growSpeed=1.15,$e.harvestAmount=.25,$e.cleanSpeed=5,$e.passiveGrowSpeed=.018,$e.passiveGrowSpeedBadLight=.009,$e.saveDefinition="farmStage$buildings.FarmStage|percentGrown$Float|foodLeft$Float|percentCleaned$Float",qe.spriteName="spr_laboratory",qe.knowledgePerStep=.00125,qe.firstScientistX=5,qe.secondScientistX=13,qe.scientistY=9,qe.saveDefinition="totalKnowledgeGenerated$Float",Ke.spriteName="spr_explorationship",Ke.saveDefinition="mirrored$Bool",Qe.spriteName="spr_landingplace",Qe.flyingSpeed=3,Qe.flyingSpeedForPathCalculations=1.5,Qe.gettingNewFlyingSaucerStageNumber=16,Qe.yChangePerNewGetStep=.25,Qe.maxTimeUntilCanGetNewFlyingSaucer=30,Qe.numberOfFlyingSaucerTypes=6,Qe.saveDefinition="timesUsed$Int|timesUsedTo$Int|timesUsedStopOver$Int|saucerType$Int",Je.spriteName="spr_library",Je.closeTime=22,Je.educationPerDay=.025,Je.educationCap=1.5,Je.saveDefinition="",Ze.spriteName="spr_livingresearchcenter",Ze.knowledgePerWalk=.10799999999999998,Ze.saveDefinition="totalKnowledgeGenerated$Float",ti.spriteName="spr_luxuryrestaurant",ti.closeTime=.5,ei.spriteName="spr_machinepartsfactory",ei.saveDefinition="",ii.spriteName="spr_mechanicalhouse",ii.ifMachinePartsFactoryBonus=50,ni.spriteName="spr_medicalclinic",ri.spriteName="spr_misdirector",ri.normalKnowledgeProduction=.5,ri.reducedKnowledgeProduction=.05,ri.saveDefinition="knowledgeGenerated$Float|timesUsedTo$Int",oi.spriteName="spr_modernartmuseum",oi.closeTime=21.5,oi.saveDefinition="currentTexture$Int",ai.spriteName="spr_modernrustichome",li.spriteName="spr_nightclub",li.laserMinXWithLeft=1,li.laserMinX=6,li.laserMaxX=18,li.laserMaxY=18,li.closeTime=6,li.nightClubColorOptions=5,li.saveDefinition="nightClubColor$Int",hi.spriteName="spr_normalhouse",hi.saveDefinition="doorMainTexture$Int",ui.spriteName="spr_observatory",ui.knowledgePerStep=.002,ui.starDatabaseUpgradeAmount=1.5,ui.starDatabaseAndUniverseDBUpgradeAmount=6,ui.saveDefinition="totalKnowledgeGenerated$Float",di.spriteName="spr_outposthouse",ci.spriteName="spr_botanicalgardens",ci.mainTextures=["spr_botanicalgardens","spr_indoorpark","spr_indoorpark_alt1"],ci.openTime=6,ci.closeTime=22,ci.saveDefinition="currentTexture$Int|currentMainTexture$Int",pi.spriteName="spr_botanicalgardens",pi.mainTextures=["spr_botanicalgardens","spr_indoorpark","spr_indoorpark_alt1"],pi.saveDefinition="currentTexture$Int|currentMainTexture$Int",gi.spriteName="spr_pub",gi.closeTime=4.5,gi.saveDefinition="markingTexture$String",mi.spriteName="spr_researchbot_landingplace",mi.knowledgePerStep=.00125,mi.hSpeed=3,mi.vSpeed=3,mi.saveDefinition="flying$Bool|returning$Bool|flyingSaucerXProg$Float|flyingSaucerXI$Int|flyingSaucerY$Float|flyingSaucerTargetX$Int|waiting$Float|timeWorking$Float",fi.spriteName="spr_restaurant",fi.closeTime=.5,yi.spriteName="spr_rocketlaunchplatform_whilebuilding",yi.saveDefinition="",_i.spriteName="spr_slantedroof",_i.saveDefinition="mirrored$Bool|currentTexture$Int",wi.spriteName="spr_slantedrooftop",wi.saveDefinition="mirrored$Bool|currentTexture$Int",bi.spriteName="spr_school",vi.spriteName="spr_scrapyardnightclub",vi.closeTime=6,vi.saveDefinition="mainTextureLeft$Int|mainTextureOther$Int",Si.spriteName="spr_secretsocietyhouse",Si.lastMission=8,Si.saveDefinition="lastEventDoneOnDay$Int|doingEvent$Int|eventPhase$Int|currentMission$Int",xi.spriteName="spr_shadyhouse",Pi.spriteName="spr_spacioushouse",Ci.spriteName="spr_botanicalgardens",Ci.saveDefinition="mirrored$Bool",Ii.spriteName="spr_botanicalgardens",Ii.openTime=0,Ii.closeTime=23.5,Ii.saveDefinition="",Ti.spriteName="spr_botanicalgardens",Ti.openTime=0,Ti.closeTime=23.5,Ti.saveDefinition="",Bi.spriteName="spr_stonemine",Bi.normalStoneMinedPerAction=.2,Bi.stoneMineTimeMin=90,Bi.stoneMineTimeMax=120,ki.spriteName="spr_stoneresearchcentre",ki.bonusDivider=200,ki.bonusMultiplier=.075,ki.bonusMultiplierStart=.15,ki.bonusLogFactor=2,ki.bonusDividerPT=195,ki.bonusMultiplierPT=.1,ki.bonusLogFactorPT=1.65,ki.linearBonusFactorPT=25e-6,ki.saveDefinition="totalKnowledgeGenerated$Float",Mi.spriteName="spr_stoneteleporter",Mi.bigStoneInitialMaterials=150,Mi.fossilChancePerIM=1e-5,Mi.saveDefinition="regrowProgress$Float|materialsLeft$Float|hasBigStone$Bool",zi.spriteName="spr_supercomputer",zi.knowledgePerDayPerEmployee=2,zi.saveDefinition="knowledgeSoFar$Float",Ai.spriteName="spr_teleporter",Ai.saveDefinition="timesUsed$Int|timesUsedTo$Int",Ue.spriteName="spr_contraption",Wi.spriteName="spr_secretsocietymachine",Wi.saveDefinition="animProgress$Float|lastDayReward$Int|thisDayMaterialReward$ds|totalMaterialReward$ds",Fi.spriteName="spr_tinkerershouse",Fi.educationPerDay=.01,Fi.educationCap=1.25,Fi.saveDefinition="frontTextureUsed$Int|backTextureUsed$Int",Oi.saveDefinition="",Di.spriteName="spr_bloomrestaurant",Ri.spriteName="spr_treeplantation",Ri.workerRegrowBoost=.5,Ri.growWaitTimeMin=120,Ri.growWaitTimeMax=180,Ri.saveDefinition="regrowProgress$Float|materialsLeft$Float",Ui.spriteName="spr_unknownbuilding",Li.spriteName="spr_villa",Li.saveDefinition="timesUsed$Int|timesUsedTo$Int",Ei.spriteName="spr_woodcuttingcentre",Ei.woodCutPerAction=.2,Ei.woodCutTimeMin=60,Ei.woodCutTimeMax=90,Hi.spriteName="spr_workshop",Hi.materialsMadePerWalkPerWorker=.075,Hi.woodToMachinePartsEfficiency=2,Hi.knowledgePerWalk=.15,Hi.machinePartsFactorySpeedIncrease=1.25,Hi.saveDefinition="materialMade$Float|totalMaterialUsed$Float|totalKnowledgeGenerated$Float",nn.saveDefinition="",bn.adExpireTime=18e3,bn.noAdShown=!0,bn.adExpireTimeRewarded=0,bn.adCapRemaining=1e6,bn.minTimeBetweenRewarded=10800,bn.standardAdExpireTime=-1,Bn.highestHappinessReported=0,Bn.highestHappinessKnown=0,Bn.statTimeout=0,Bn.kongJSLoaded=!1,kn.defaultLocalizations=new zr,kn.localizations=new zr,An.frameTimeValues=[],An.previousTime=0,An.isDrawingFPSCurrently=!1,On.knowsSupport=!1,On.hasSupport=!1,jn.pool=[],Is.canUndoReset=!1,Hs.ninePatchTextureCache=new Mr,fr.USE_CACHE=!1,fr.USE_ENUM_INDEX=!1,fr.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",_r.DEFAULT_RESOLVER=new yr,_r.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",Sr.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Sr.BYTES=br.ofString(Sr.CHARS),Or.premiumInfoLoaded=!1,Or.savedPurchases=new zr,Dr.onGlobalSaveFuncs=[],Dr.onGlobalSaveFuncsEarly=[],Gr.pool=[],jr.saveDefinition="",io.maxSize=20,io.maxPoolAmount=1e4,io.pool=((Ue=[]).push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue.push([]),Ue),so.pool=new Mr,uo.saveDefinition="unlimitedResources$Bool|everPlayedWithUnlimitedResources$Bool",co.saveDefinition="",po.saveDefinition="storyName$String|disableDying$Bool|disableDestroy$Bool|hiddenBoost$Bool|goalTimer$Float",fo.saveDefinition="unlockState$ds|explicityLocked$ds|unlockedDecorationTab$Bool|unlockedBuildingModeButton$Bool|unlockedManagementOptions$Bool|numberOfModernArtMuseumArtworksUnlocked$Int|unlockedMaterials$ds",yo.saveDefinition="timeUntilInvasion$Float|invasionProgress$Float|isInvasion$Bool|isInvasionFinished$Bool",_o.saveDefinition="spawnNumber$Int|nextSpawn$Float|groupSizeMin$Int|groupSizeMax$Int|ageRangeMin$Int|ageRangeMax$Int|worldID$Int|timeBetweenMin$Int|timeBetweenMax$Int|afterDoneMessage$String",So.saveDefinition="softPopLimit$Int|mode$ds|targetPopAmount$Int",xo.saveDefinition="extraFoodFromFarms$Int|machinePartsFactorySpeed$Float|labSpeed$Float|indoorFarmSpeed$Float|fossilsCollected$Int",Co.enableExtraReward=!0,Co.saveDefinition="boostLeft$Float|maxBoost$Float|normalMaxBoost$Float",Mo.saveDefinition="foodShortage$Float",zo.entertainmentTypeNumber=6,Ao.saveDefinition="type$Int|relativeX$Float|relativeY$Float",Do.saveDefinition="happiness$Float|homeHappiness$Float|purposeHappiness$Float|entertainmentHappiness$Float|schoolHappiness$Float|medicalHappiness$Float|fullHappinessTime$Float|overtimeUnhappinessActual$Float|overtimeStarted$Float|lastOvertime$Float|lastOvertimeDay$Float|lastRestoreTime$Float|ignoreUnhappyCitizens$Bool|actualHappiness$Float|happinessEnthusiasmLevel$Int|lastShownVeryUnhappyWarning$Int|veryUnhappyFromDay$Int",Ro.saveDefinition="boostUntil$Float|boost$Float|text$String|canGoOverMax$Bool",Uo.privateTeleportersLeft=[],Eo.saveDefinition="teleportersEnabled$Bool|teleportersAreUserEnabled$Bool",Xo.saveDefinition="",jo.fromHour=0,jo.toHour=4,Vo.fromHour=.5,Vo.toHour=4.5,Yo.fromHour=1,Yo.toHour=5,Yo.moveSpeed=.5,$o.fromHour=23,$o.toHour=5,qo.fromHour=0,qo.toHour=4,qo.moveSpeed=.6666666666666666,Zo.fromHour=0,Zo.toHour=4,ta.saveDefinition="timeStart$Float|timeEnd$Float|started$Bool",ia.minCitizens=100,ia.happinessBoostDuration=10080,ia.happinessBoostGiven=25,ia.citizensPerVenue=20,ia.saveDefinition="",la.saveDefinition="explored$Float|bonusesAwarded$Int|spriteName$String",ha.saveDefinition="materialsLeft$Float|regrowProgress$Float",ua.saveDefinition="managementMode$worldResources.ForestManagementMode",da.saveDefinition="managementMode$worldResources.RockManagementMode",S.main()}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);